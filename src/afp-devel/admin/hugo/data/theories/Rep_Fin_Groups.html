<div id="Rep_Fin_Groups">
<div class="head">
<h1>Theory Rep_Fin_Groups</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Rep_Fin_Groups

<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Function_Algebras.html">HOL-Library.Function_Algebras</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Set_Algebras.html">HOL-Library.Set_Algebras</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial.html">HOL-Computational_Algebra.Polynomial</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>




<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we establish some basic facts about logic, sets, and functions that are not
  available in the HOL library. As well, we develop some theory for almost-everywhere-zero functions
  in preparation of the definition of the group ring.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Logic›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-conjcases"><span class="command">lemma</span></span> conjcases <span class="main">[</span><span class="operator">case_names</span> BothTrue OneTrue OtherTrue BothFalse<span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> BothTrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span>    <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     OneTrue<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">Q</span>  <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     OtherTrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span>  <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     BothFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">P</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">Q</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   assms
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">fast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sets›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-empty_set_diff_single"><span class="command">lemma</span></span> empty_set_diff_single <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-seteqI"><span class="command">lemma</span></span> seteqI <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subset_antisym subsetI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-prod_ballI"><span class="command">lemma</span></span> prod_ballI <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">AxB</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span><span class="free">AxB</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-good_card_imp_finite"><span class="command">lemma</span></span> good_card_imp_finite <span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>semiring_1<span class="main">)</span> <span class="main">⟹</span> finite <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_ge_0_finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lists›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>zip›</span></span></span></span>›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-zip_truncate_left"><span class="command">lemma</span></span> zip_truncate_left <span class="main">:</span> <span class="quoted"><span class="quoted">"zip <span class="free">xs</span> <span class="free">ys</span> <span class="main">=</span> zip <span class="main">(</span>take <span class="main">(</span>length <span class="free">ys</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-zip_truncate_right"><span class="command">lemma</span></span> zip_truncate_right <span class="main">:</span> <span class="quoted"><span class="quoted">"zip <span class="free">xs</span> <span class="free">ys</span> <span class="main">=</span> zip <span class="free">xs</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lemmas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>zip_append1›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>zip_append2›</span></span></span></span> in theory <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="../../HOL/HOL/List.html"></a><a href="../../HOL/HOL/List.html">HOL.List</a><span class="antiquote"><span class="antiquote">}</span></span></span></span> have unnecessary
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>take (length _)›</span></span></span></span> in them. Here are replacements.
›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-zip_append_left"><span class="command">lemma</span></span> zip_append_left <span class="main">:</span>
  <span class="quoted"><span class="quoted">"zip <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="free">zs</span> <span class="main">=</span> zip <span class="free">xs</span> <span class="free">zs</span> <span class="main">@</span> zip <span class="free">ys</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zip_append1 zip_truncate_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">zs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-zip_append_right"><span class="command">lemma</span></span> zip_append_right <span class="main">:</span>
  <span class="quoted"><span class="quoted">"zip <span class="free">xs</span> <span class="main">(</span><span class="free">ys</span><span class="main">@</span><span class="free">zs</span><span class="main">)</span> <span class="main">=</span> zip <span class="free">xs</span> <span class="free">ys</span> <span class="main">@</span> zip <span class="main">(</span>drop <span class="main">(</span>length <span class="free">ys</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">zs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zip_append2 zip_truncate_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-length_concat_map_split_zip"><span class="command">lemma</span></span> length_concat_map_split_zip <span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span><span class="main">←</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">]</span> <span class="main">=</span> min <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>length <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-concat_map_split_eq_map_split_zip"><span class="command">lemma</span></span> concat_map_split_eq_map_split_zip <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span><span class="main">←</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">]</span> <span class="main">=</span> map <span class="main">(</span>case_prod <span class="free">f</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-set_zip_map2"><span class="command">lemma</span></span> set_zip_map2 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">z</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">xs</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>concat›</span></span></span></span>›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-concat_eq"><span class="command">lemma</span></span> concat_eq <span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> length <span class="bound">ys</span><span class="main">)</span> <span class="free">xss</span> <span class="free">yss</span> <span class="main">⟹</span> concat <span class="free">xss</span> <span class="main">=</span> concat <span class="free">yss</span>
        <span class="main">⟹</span> <span class="free">xss</span> <span class="main">=</span> <span class="free">yss</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xss</span></span> <span class="quoted"><span class="free">yss</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_all2_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-match_concat"><span class="command">lemma</span></span> match_concat <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">bss</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> list list"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> eq_len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eq_len</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> length <span class="bound">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">as</span><span class="main">::</span><span class="tfree">'a</span> list<span class="main">.</span> length <span class="bound">as</span> <span class="main">=</span> length <span class="main">(</span>concat <span class="free">bss</span><span class="main">)</span>
                <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">css</span><span class="main">::</span><span class="tfree">'a</span> list list<span class="main">.</span> <span class="bound">as</span> <span class="main">=</span> concat <span class="bound">css</span> <span class="main">∧</span> list_all2 <span class="free">eq_len</span> <span class="bound">css</span> <span class="free">bss</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bss</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq_len
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">as</span><span class="main">.</span> length <span class="bound">as</span> <span class="main">=</span> length <span class="main">(</span>concat <span class="main">[]</span><span class="main">)</span>
                <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">css</span><span class="main">.</span> <span class="bound">as</span> <span class="main">=</span> concat <span class="bound">css</span> <span class="main">∧</span> list_all2 <span class="free">eq_len</span> <span class="bound">css</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>   <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">fss</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> list list"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> prevcase<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">as</span><span class="main">.</span> length <span class="bound">as</span> <span class="main">=</span> length <span class="main">(</span>concat <span class="skolem">fss</span><span class="main">)</span>
                         <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">css</span><span class="main">.</span> <span class="bound">as</span> <span class="main">=</span> concat <span class="bound">css</span> <span class="main">∧</span> list_all2 <span class="free">eq_len</span> <span class="bound">css</span> <span class="skolem">fss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> length <span class="bound">as</span> <span class="main">=</span> length <span class="main">(</span>concat <span class="main">(</span><span class="skolem">fs</span> <span class="main">#</span> <span class="skolem">fss</span><span class="main">)</span><span class="main">)</span>
             <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">css</span><span class="main">.</span> <span class="bound">as</span> <span class="main">=</span> concat <span class="bound">css</span> <span class="main">∧</span> list_all2 <span class="free">eq_len</span> <span class="bound">css</span> <span class="main">(</span><span class="skolem">fs</span> <span class="main">#</span> <span class="skolem">fss</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">as</span> <span class="main">=</span> length <span class="main">(</span>concat <span class="main">(</span><span class="skolem">fs</span><span class="main">#</span><span class="skolem">fss</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">fs</span><span class="main">)</span> <span class="skolem">as</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="skolem">fs</span><span class="main">)</span> <span class="skolem">as</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">gss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gss</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">css</span><span class="main">.</span> <span class="skolem">ys</span> <span class="main">=</span> concat <span class="bound">css</span> <span class="main">∧</span> list_all2 <span class="free">eq_len</span> <span class="bound">css</span> <span class="skolem">fss</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hss</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">#</span> <span class="skolem">gss</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> xs_def ys_def as gss_def eq_len prevcase
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> concat <span class="skolem">hss</span> <span class="main">∧</span> list_all2 <span class="free">eq_len</span> <span class="skolem">hss</span> <span class="main">(</span><span class="skolem">fs</span><span class="main">#</span><span class="skolem">fss</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">css</span><span class="main">.</span> <span class="skolem">ys</span> <span class="main">=</span> concat <span class="bound">css</span> <span class="main">∧</span> list_all2 <span class="free">eq_len</span> <span class="bound">css</span> <span class="skolem">fss</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">as</span><span class="main">.</span> length <span class="bound">as</span> <span class="main">=</span> length <span class="main">(</span>concat <span class="main">(</span><span class="skolem">fs</span> <span class="main">#</span> <span class="skolem">fss</span><span class="main">)</span><span class="main">)</span>
             <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">css</span><span class="main">.</span> <span class="bound">as</span> <span class="main">=</span> concat <span class="bound">css</span> <span class="main">∧</span> list_all2 <span class="free">eq_len</span> <span class="bound">css</span> <span class="main">(</span><span class="skolem">fs</span> <span class="main">#</span> <span class="skolem">fss</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>strip_while›</span></span></span></span>›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-strip_while_0_nnil"><span class="command">lemma</span></span> strip_while_0_nnil <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> set <span class="free">as</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> strip_while <span class="main">(</span><span class="main">(=)</span> <span class="main">0</span><span class="main">)</span> <span class="free">as</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_nonempty_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sum_list›</span></span></span></span>›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-const_sum_list"><span class="command">lemma</span></span> const_sum_list <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⟹</span> sum_list <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_prod_cong"><span class="command">lemma</span></span> sum_list_prod_cong <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span>
        <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arg_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>case_prod <span class="free">f</span><span class="main">)</span> <span class="free">xys</span>"</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>case_prod <span class="free">g</span><span class="main">)</span> <span class="free">xys</span>"</span></span> <span class="quoted">sum_list</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_prod_map2"><span class="command">lemma</span></span> sum_list_prod_map2 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span>zip <span class="free">as</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">bs</span><span class="main">)</span><span class="main">.</span> <span class="free">g</span> <span class="bound">a</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">←</span>zip <span class="free">as</span> <span class="free">bs</span><span class="main">.</span> <span class="free">g</span> <span class="bound">a</span> <span class="main">(</span><span class="free">f</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_fun_apply"><span class="command">lemma</span></span> sum_list_fun_apply <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_prod_fun_apply"><span class="command">lemma</span></span> sum_list_prod_fun_apply <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xys</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_monoid_add<span class="main">)</span> sum_list_plus <span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>
        <span class="main">⟹</span> sum_list <span class="free">xs</span> <span class="main">+</span> sum_list <span class="free">ys</span> <span class="main">=</span> sum_list <span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_const_mult_prod"><span class="command">lemma</span></span> sum_list_const_mult_prod <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'r</span><span class="main">::</span>semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">r</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_list_const_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"case_prod <span class="free">f</span>"</span></span><span class="main">]</span> prod.case_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">r</span><span class="main">*</span><span class="bound">x</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_mult_const_prod"><span class="command">lemma</span></span> sum_list_mult_const_prod <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'r</span><span class="main">::</span>semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_list_mult_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"case_prod <span class="free">f</span>"</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> prod.case_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">*</span><span class="free">r</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_update"><span class="command">lemma</span></span> sum_list_update <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ab_group_add list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> sum_list <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="free">n</span> <span class="main">:=</span> <span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="free">xs</span> <span class="main">-</span> <span class="free">xs</span><span class="main">!</span><span class="free">n</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_replicate0"><span class="command">lemma</span></span> sum_list_replicate0 <span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>replicate <span class="free">n</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>listset›</span></span></span></span>›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-listset_ConsI"><span class="command">lemma</span></span> listset_ConsI <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">∈</span> listset <span class="free">Xs</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">#</span><span class="free">xs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">X</span><span class="main">#</span><span class="free">Xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> listset_def set_Cons_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-listset_ConsD"><span class="command">lemma</span></span> listset_ConsD <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">#</span><span class="free">xs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">A</span> <span class="main">#</span> <span class="free">As</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">∈</span> listset <span class="free">As</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> listset_def set_Cons_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-listset_Cons_conv"><span class="command">lemma</span></span> listset_Cons_conv <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">A</span> <span class="main">#</span> <span class="free">As</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="bound">ys</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">ys</span> <span class="main">∈</span> listset <span class="free">As</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">=</span> <span class="bound">y</span><span class="main">#</span><span class="bound">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> listset_def set_Cons_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-listset_length"><span class="command">lemma</span></span> listset_length <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> listset <span class="free">Xs</span> <span class="main">⟹</span> length <span class="free">xs</span> <span class="main">=</span> length <span class="free">Xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>     listset_ConsD
  <span class="keyword1"><span class="command">unfolding</span></span> listset_def set_Cons_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">Xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-set_sum_list_element"><span class="command">lemma</span></span> set_sum_list_element <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">A</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">as</span> <span class="main">∈</span> listset <span class="free">As</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">←</span><span class="bound">as</span><span class="main">.</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">As</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">←</span><span class="main">[]</span><span class="main">.</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> listset <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">A</span> <span class="skolem">As</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">as</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> a_as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">∈</span> listset <span class="skolem">As</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">←</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_plus_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"listset <span class="main">(</span><span class="skolem">A</span><span class="main">#</span><span class="skolem">As</span><span class="main">)</span> <span class="main">=</span> set_Cons <span class="skolem">A</span> <span class="main">(</span>listset <span class="skolem">As</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> a_as<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">A</span><span class="main">#</span><span class="skolem">As</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_Cons_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> a_as<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bs</span><span class="main">∈</span>listset <span class="main">(</span><span class="skolem">A</span><span class="main">#</span><span class="skolem">As</span><span class="main">)</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">←</span><span class="bound">bs</span><span class="main">.</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-set_sum_list_element_Cons"><span class="command">lemma</span></span> set_sum_list_element_Cons <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="main">(</span><span class="free">A</span><span class="main">#</span><span class="free">As</span><span class="main">)</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">as</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">∧</span> <span class="bound">as</span> <span class="main">∈</span> listset <span class="free">As</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">←</span><span class="bound">as</span><span class="main">.</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="free">A</span><span class="main">#</span><span class="free">As</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">←</span><span class="skolem">xs</span><span class="main">.</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_sum_list_element <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> xs<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">∈</span> listset <span class="free">As</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> listset_Cons_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> xs<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_listset"><span class="command">lemma</span></span> sum_list_listset <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">∈</span> listset <span class="free">As</span> <span class="main">⟹</span> sum_list <span class="free">as</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">A</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> length <span class="free">As</span> <span class="main">⟹</span> <span class="free">as</span> <span class="main">∈</span> listset <span class="free">As</span> <span class="main">⟹</span> sum_list <span class="free">as</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">A</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">As</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span> <span class="skolem">A</span> <span class="skolem">As</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> listset_ConsD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">∈</span> listset <span class="free">As</span> <span class="main">⟹</span> sum_list <span class="free">as</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">A</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> listset_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-listsetI_nth"><span class="command">lemma</span></span> listsetI_nth <span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">Xs</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span><span class="main">!</span><span class="bound">n</span> <span class="main">∈</span> <span class="free">Xs</span><span class="main">!</span><span class="bound">n</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">∈</span> listset <span class="free">Xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">Xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">X</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">X</span><span class="main">#</span><span class="skolem">Xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> listset_ConsI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">Xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-listsetD_nth"><span class="command">lemma</span></span> listsetD_nth <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> listset <span class="free">Xs</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span><span class="main">!</span><span class="bound">n</span> <span class="main">∈</span> <span class="free">Xs</span><span class="main">!</span><span class="bound">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">Xs</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">∈</span> listset <span class="free">Xs</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span><span class="main">!</span><span class="bound">n</span> <span class="main">∈</span> <span class="free">Xs</span><span class="main">!</span><span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">Xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">X</span> <span class="skolem">Xs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> x_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> listset <span class="skolem">Xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> listset_ConsD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="main">0</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">X</span><span class="main">#</span><span class="skolem">Xs</span><span class="main">)</span><span class="main">!</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">xs</span><span class="main">!</span><span class="bound">n</span> <span class="main">∈</span> <span class="skolem">Xs</span><span class="main">!</span><span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">X</span><span class="main">#</span><span class="skolem">Xs</span><span class="main">)</span><span class="main">!</span><span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">n</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">X</span><span class="main">#</span><span class="skolem">Xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">X</span><span class="main">#</span><span class="skolem">Xs</span><span class="main">)</span><span class="main">!</span><span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> listset <span class="free">Xs</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span><span class="main">!</span><span class="bound">n</span> <span class="main">∈</span> <span class="free">Xs</span><span class="main">!</span><span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> listset_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-set_listset_el_subset"><span class="command">lemma</span></span> set_listset_el_subset <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> listset <span class="free">Xs</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">X</span><span class="main">∈</span>set <span class="free">Xs</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> length <span class="free">xs</span> <span class="main">=</span> length <span class="free">Xs</span><span class="main">;</span> <span class="free">xs</span> <span class="main">∈</span> listset <span class="free">Xs</span><span class="main">;</span> <span class="main">∀</span><span class="bound">X</span><span class="main">∈</span>set <span class="free">Xs</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟧</span> 
              <span class="main">⟹</span> set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">Xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> listset_ConsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> listset <span class="free">Xs</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">X</span><span class="main">∈</span>set <span class="free">Xs</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> listset_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Functions›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous facts›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-sum_fun_apply"><span class="command">lemma</span></span> sum_fun_apply <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_single_nonzero"><span class="command">lemma</span></span> sum_single_nonzero <span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> sum <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">.</span> sum <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> insert<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> x insert <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-distrib_comp_sum_right"><span class="command">lemma</span></span> distrib_comp_sum_right <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T</span> <span class="main">+</span> <span class="free">T'</span><span class="main">)</span> <span class="main">∘</span> <span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="free">S</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">T'</span> <span class="main">∘</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Support of a function›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">supp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">supp</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-suppI"><span class="command">lemma</span></span> suppI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> supp <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> supp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-suppI_contra"><span class="command">lemma</span></span> suppI_contra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> supp <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> suppI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-suppD"><span class="command">lemma</span></span> suppD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> supp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-suppD_contra"><span class="command">lemma</span></span> suppD_contra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> supp <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> suppD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-zerofun_imp_empty_supp"><span class="command">lemma</span></span> zerofun_imp_empty_supp <span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> supp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-supp_zerofun_subset_any"><span class="command">lemma</span></span> supp_zerofun_subset_any <span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">0</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zerofun_imp_empty_supp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-supp_sum_subset_union_supp"><span class="command">lemma</span></span> supp_sum_subset_union_supp <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>     <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>monoid_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> supp <span class="free">f</span> <span class="main">∪</span> supp <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> supp_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-supp_neg_eq_supp"><span class="command">lemma</span></span> supp_neg_eq_supp <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>     <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>group_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> supp <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> supp_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-supp_diff_subset_union_supp"><span class="command">lemma</span></span> supp_diff_subset_union_supp <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>     <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>group_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="free">f</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> supp <span class="free">f</span> <span class="main">∪</span> supp <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> supp_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">restrict0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">↓</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">restrict0</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-supp_restrict0"><span class="command">lemma</span></span> supp_restrict0 <span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="free">f</span><span class="main">↓</span><span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∉</span> supp <span class="main">(</span><span class="free">f</span><span class="main">↓</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suppD_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">↓</span><span class="free">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-bij_betw_restrict0"><span class="command">lemma</span></span> bij_betw_restrict0 <span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> bij_betw <span class="main">(</span><span class="free">f</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>     bij_betw_imp_inj_on bij_betw_imp_surj_on
  <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def inj_on_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Convolution›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">convolution</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>group_add <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>times<span class="main">}</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">convolution</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span>
              <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">y</span></span><span class="main">|</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹More often than not, this definition will be used in the case that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"'b"</span><span class="antiquote">}</span></span> is of class
        <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"mult_zero"</span><span class="antiquote">}</span></span>, in which case the conditions <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">∈</span> supp <span class="free">f</span>"</span><span class="antiquote">}</span></span> and
        <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">y</span> <span class="main">∈</span> supp <span class="free">g</span>"</span><span class="antiquote">}</span></span> are obviously mathematically unnecessary. However, they also serve to
        ensure that the sum is taken over a finite set in the case that at least one of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">f</span></span><span class="antiquote">}</span></span>
        and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">g</span></span><span class="antiquote">}</span></span> is almost everywhere zero.›</span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_zero"><span class="command">lemma</span></span> convolution_zero <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>     <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">g</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> convolution <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> convolution_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_symm"><span class="command">lemma</span></span> convolution_symm <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>times<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="free">g</span>
              <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">y</span></span><span class="main">|</span><span class="bound">y</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">∧</span> <span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">∈</span> supp <span class="free">g</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">S1</span></span> <span class="skolem"><span class="skolem">S2</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S1</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="free">g</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S2</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">∧</span> <span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">∈</span> supp <span class="free">g</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">i</span> <span class="skolem">S2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">using</span></span> i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span><span class="skolem">i</span> <span class="main">`</span> <span class="skolem">S2</span><span class="main">)</span><span class="main">.</span> <span class="skolem">c1</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">S2</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">∘</span> <span class="skolem">i</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum.reindex <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> S1_iS2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S1</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">`</span> <span class="skolem">S2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> seteqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> y_S1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">S1</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> y_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">∈</span> supp <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_S1 S1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> supp <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z_def y_S1 S1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">S2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">i</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> y_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">i</span> <span class="main">`</span> <span class="skolem">S2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">i</span> <span class="main">`</span> <span class="skolem">S2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z_S2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">S2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> y_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> supp <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_eq z_S2 S2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">S1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">S1</span><span class="main">.</span> <span class="skolem">c1</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">S2</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">∘</span> <span class="skolem">i</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> i_def c1_def c2_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">S1</span><span class="main">.</span> <span class="skolem">c1</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">S2</span><span class="main">.</span> <span class="skolem">c2</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> diff_add_eq_diff_diff_swap<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="free">g</span> <span class="skolem">x</span>
              <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">y</span></span><span class="main">|</span><span class="bound">y</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">∧</span> <span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">∈</span> supp <span class="free">g</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> S1_def c1_def S2_def c2_def convolution_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="Rep_Fin_Groups-supp_convolution_subset_sum_supp"><span class="command">lemma</span></span> supp_convolution_subset_sum_supp <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>times<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>convolution <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> supp <span class="free">f</span> <span class="main">+</span> supp <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">SS</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">SS</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">-</span><span class="bound">y</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="free">g</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">SS</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SS_def convolution_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> supp <span class="free">f</span> <span class="main">+</span> supp <span class="free">g</span> <span class="main">⟹</span> <span class="skolem">SS</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">+</span> supp <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">SS</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">∈</span> supp <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> supp <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> SS_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> supp <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">from</span></span> z_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> diff_eq_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">with</span></span> z_F y_G <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">+</span> supp <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> supp <span class="free">f</span> <span class="main">+</span> supp <span class="free">g</span> <span class="main">⟹</span> <span class="skolem">SS</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> supp <span class="free">f</span> <span class="main">+</span> supp <span class="free">g</span>
                        <span class="main">⟹</span> convolution <span class="free">f</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> supp <span class="free">f</span> <span class="main">+</span> supp <span class="free">g</span> <span class="main">⟹</span> convolution <span class="free">f</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum.empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> supp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Almost-everywhere-zero functions›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definition and basic properties›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">aezfun_set</span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span><span class="main">::</span>zero<span class="main">.</span> finite <span class="main">(</span>supp <span class="bound">f</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setD"><span class="command">lemma</span></span> aezfun_setD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> aezfun_set <span class="main">⟹</span> finite <span class="main">(</span>supp <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setI"><span class="command">lemma</span></span> aezfun_setI<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>supp <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-zerofun_is_aezfun"><span class="command">lemma</span></span> zerofun_is_aezfun <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> supp_def aezfun_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_of_aezfun_is_aezfun"><span class="command">lemma</span></span> sum_of_aezfun_is_aezfun <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>     <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span><span class="main">::</span>monoid_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> aezfun_set <span class="main">⟹</span> <span class="free">g</span> <span class="main">∈</span> aezfun_set <span class="main">⟹</span> <span class="free">f</span> <span class="main">+</span> <span class="free">g</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword1"><span class="command">using</span></span>     supp_sum_subset_union_supp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> finite_subset<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"supp <span class="free">f</span> <span class="main">∪</span> supp <span class="free">g</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-neg_of_aezfun_is_aezfun"><span class="command">lemma</span></span> neg_of_aezfun_is_aezfun <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>     <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span><span class="main">::</span>group_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> aezfun_set <span class="main">⟹</span> <span class="main">-</span> <span class="free">f</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword1"><span class="command">using</span></span>     supp_neg_eq_supp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-diff_of_aezfun_is_aezfun"><span class="command">lemma</span></span> diff_of_aezfun_is_aezfun <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>     <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span><span class="main">::</span>group_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> aezfun_set <span class="main">⟹</span> <span class="free">g</span> <span class="main">∈</span> aezfun_set <span class="main">⟹</span> <span class="free">f</span> <span class="main">-</span> <span class="free">g</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword1"><span class="command">using</span></span>     supp_diff_subset_union_supp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> finite_subset<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"supp <span class="free">f</span> <span class="main">∪</span> supp <span class="free">g</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-restrict_and_extend0_aezfun_is_aezfun"><span class="command">lemma</span></span> restrict_and_extend0_aezfun_is_aezfun <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">↓</span><span class="free">A</span> <span class="main">∈</span> aezfun_set"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> aezfun_setI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∉</span> supp <span class="free">f</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∉</span> supp <span class="main">(</span><span class="free">f</span><span class="main">↓</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> supp <span class="free">f</span> <span class="main">∩</span> <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> supp <span class="main">(</span><span class="free">f</span><span class="main">↓</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> suppD_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">↓</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>supp <span class="main">(</span><span class="free">f</span><span class="main">↓</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aezfun_setD finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="free">f</span><span class="main">↓</span><span class="free">A</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Delta (impulse) functions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The notation is set up in the order output-input so that later when these are used to define
        the group ring RG, it will be in order ring-element-group-element.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deltafun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>zero <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">δ</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1"><span class="free">δ</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-deltafun_apply_eq"><span class="command">lemma</span></span> deltafun_apply_eq <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> deltafun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-deltafun_apply_neq"><span class="command">lemma</span></span> deltafun_apply_neq <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> deltafun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-deltafun0"><span class="command">lemma</span></span> deltafun0 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">δ</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> deltafun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-deltafun_plus"><span class="command">lemma</span></span> deltafun_plus <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>     <span class="free">b</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>monoid_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">+</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">δ</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> deltafun_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-supp_delta0fun"><span class="command">lemma</span></span> supp_delta0fun <span class="main">:</span>  <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">0</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> supp_def deltafun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-supp_deltafun"><span class="command">lemma</span></span> supp_deltafun <span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> supp <span class="main">(</span><span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> supp_def deltafun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-deltafun_is_aezfun"><span class="command">lemma</span></span> deltafun_is_aezfun <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span> <span class="main">∈</span> aezfun_set"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> supp_delta0fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> supp_deltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_common_supp_spanning_set'"><span class="command">lemma</span></span> aezfun_common_supp_spanning_set' <span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">as</span><span class="main">.</span> distinct <span class="bound">as</span> <span class="main">∧</span> set <span class="bound">as</span> <span class="main">=</span> <span class="free">A</span>
      <span class="main">∧</span> <span class="main">(</span> <span class="main">∀</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>semiring_1<span class="main">.</span> supp <span class="bound">f</span> <span class="main">⊆</span> <span class="free">A</span>
                   <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">bs</span><span class="main">.</span> length <span class="bound">bs</span> <span class="main">=</span> length <span class="bound">as</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">bs</span> <span class="bound">as</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δ</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> supp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">as</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">.</span> supp <span class="bound">f</span> <span class="main">⊆</span> <span class="skolem">A</span>
                    <span class="main">⟹</span> <span class="main">∃</span><span class="bound">bs</span><span class="main">.</span> length <span class="bound">bs</span> <span class="main">=</span> length <span class="skolem">as</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">bs</span> <span class="skolem">as</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> as<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> insert<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span> <span class="main">=</span> insert <span class="skolem">a</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>semiring_1<span class="main">.</span> supp <span class="bound">f</span> <span class="main">⊆</span> insert <span class="skolem">a</span> <span class="skolem">A</span>
                <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">bs</span><span class="main">.</span> length <span class="bound">bs</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">bs</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δ</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> supp_f <span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="skolem">f</span> <span class="main">⊆</span> insert <span class="skolem">a</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"supp <span class="skolem">g</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> supp <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> x supp_f g_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> supp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x g_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> supp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> as<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">bs</span> <span class="main">=</span> length <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="skolem">bs</span> <span class="skolem">as</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> bs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> g_def bs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> deltafun_apply_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> deltafun_apply_neq<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bs</span><span class="main">.</span> length <span class="bound">bs</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">bs</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span>   <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Convolution of almost-everywhere-zero functions›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_eq_sum_over_supp_right"><span class="command">lemma</span></span> convolution_eq_sum_over_supp_right <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">g</span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">g</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">SS</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">SS</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="free">g</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>supp <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">SS</span> <span class="main">⊆</span> supp <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> SS_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="free">g</span> <span class="main">-</span> <span class="skolem">SS</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SS_def <span class="keyword1"><span class="command">unfolding</span></span> supp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">g</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> convolution_def
    <span class="keyword1"><span class="command">using</span></span>     SS_def sum.mono_neutral_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"supp <span class="free">g</span>"</span></span> <span class="quoted"><span class="skolem">SS</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">y</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>        <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_symm_eq_sum_over_supp_left"><span class="command">lemma</span></span> convolution_symm_eq_sum_over_supp_left <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">f</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">SS</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">SS</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">∧</span> <span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">∈</span> supp <span class="free">g</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>supp <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">SS</span> <span class="main">⊆</span> supp <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SS_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> supp <span class="free">f</span> <span class="main">-</span> <span class="skolem">SS</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> SS_def <span class="keyword1"><span class="command">unfolding</span></span> supp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">SS</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">f</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> convolution_def
    <span class="keyword1"><span class="command">using</span></span>     SS_def sum.mono_neutral_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"supp <span class="free">f</span>"</span></span> <span class="quoted"><span class="skolem">SS</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>        <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">f</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> SS_def convolution_symm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_delta_left"><span class="command">lemma</span></span> convolution_delta_left <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convolution <span class="main">(</span><span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="main">(</span><span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="main">(</span><span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> convolution <span class="main">0</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> deltafun0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> arg_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">δ</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="keyword1">δ</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> convolution_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deltafun_is_aezfun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> convolution_symm_eq_sum_over_supp_left
          supp_deltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> deltafun_apply_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_delta_right"><span class="command">lemma</span></span> convolution_delta_right <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> convolution <span class="free">f</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> deltafun0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> arg_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">δ</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="keyword1">δ</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> convolution_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> deltafun_is_aezfun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> convolution_eq_sum_over_supp_right
          supp_deltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> deltafun_apply_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_delta_delta"><span class="command">lemma</span></span>   convolution_delta_delta <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b1</span> <span class="free">b2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">a1</span> <span class="free">a2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convolution <span class="main">(</span><span class="free">b1</span> <span class="keyword1">δ</span> <span class="free">a1</span><span class="main">)</span> <span class="main">(</span><span class="free">b2</span> <span class="keyword1">δ</span> <span class="free">a2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b1</span> <span class="main">*</span> <span class="free">b2</span><span class="main">)</span> <span class="keyword1">δ</span> <span class="main">(</span><span class="free">a1</span> <span class="main">+</span> <span class="free">a2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"convolution <span class="main">(</span><span class="free">b1</span> <span class="keyword1">δ</span> <span class="free">a1</span><span class="main">)</span> <span class="main">(</span><span class="free">b2</span> <span class="keyword1">δ</span> <span class="free">a2</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">b1</span> <span class="keyword1">δ</span> <span class="free">a1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">a2</span><span class="main">)</span> <span class="main">*</span> <span class="free">b2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> convolution_delta_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b1</span> <span class="keyword1">δ</span> <span class="free">a1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convolution <span class="main">(</span><span class="free">b1</span> <span class="keyword1">δ</span> <span class="free">a1</span><span class="main">)</span> <span class="main">(</span><span class="free">b2</span> <span class="keyword1">δ</span> <span class="free">a2</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">b1</span> <span class="main">*</span> <span class="free">b2</span><span class="main">)</span> <span class="keyword1">δ</span> <span class="main">(</span><span class="free">a1</span> <span class="main">+</span> <span class="free">a2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">a1</span> <span class="main">+</span> <span class="free">a2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="free">a2</span> <span class="main">=</span> <span class="free">a1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="main">(</span><span class="free">b1</span> <span class="keyword1">δ</span> <span class="free">a1</span><span class="main">)</span> <span class="main">(</span><span class="free">b2</span> <span class="keyword1">δ</span> <span class="free">a2</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">b1</span> <span class="main">*</span> <span class="free">b2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> deltafun_apply_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b1</span></span> <span class="quoted"><span class="free">a1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> deltafun_apply_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b1</span> <span class="main">*</span> <span class="free">b2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="main">+</span> <span class="free">a2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="free">a2</span> <span class="main">≠</span> <span class="free">a1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="main">(</span><span class="free">b1</span> <span class="keyword1">δ</span> <span class="free">a1</span><span class="main">)</span> <span class="main">(</span><span class="free">b2</span> <span class="keyword1">δ</span> <span class="free">a2</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> deltafun_apply_neq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="free">a2</span>"</span></span> <span class="quoted"><span class="free">a1</span></span> <span class="quoted"><span class="free">b1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> deltafun_apply_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_of_aezfun_is_aezfun"><span class="command">lemma</span></span> convolution_of_aezfun_is_aezfun <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>     <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>times<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> aezfun_set <span class="main">⟹</span> <span class="free">g</span> <span class="main">∈</span> aezfun_set <span class="main">⟹</span> convolution <span class="free">f</span> <span class="free">g</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword1"><span class="command">using</span></span>     supp_convolution_subset_sum_supp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
            finite_set_plus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"supp <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"supp <span class="free">g</span>"</span></span><span class="main">]</span> finite_subset
  <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_assoc"><span class="command">lemma</span></span> convolution_assoc <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">f</span> <span class="free">h</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_aez<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> aezfun_set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h_aez<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"convolution <span class="main">(</span>convolution <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> convolution <span class="free">f</span> <span class="main">(</span>convolution <span class="free">g</span> <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fg</span></span> <span class="skolem"><span class="skolem">gh</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fg</span> <span class="main">=</span> convolution <span class="free">f</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gh</span> <span class="main">=</span> convolution <span class="free">g</span> <span class="free">h</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="skolem">fg</span> <span class="free">h</span> <span class="skolem">x</span>
              <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span>supp <span class="free">h</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span><span class="main">)</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="skolem">fg</span> <span class="free">h</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span>supp <span class="free">h</span><span class="main">.</span> <span class="skolem">fg</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h_aez convolution_eq_sum_over_supp_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="skolem">fg</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">fg</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span>
                        <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">f</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fg</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">f</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fg_def f_aez convolution_symm_eq_sum_over_supp_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fg</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">f</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">z</span> <span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum_distrib_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fg</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">f</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="skolem">z</span> <span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> 
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"convolution <span class="skolem">fg</span> <span class="free">h</span> <span class="skolem">x</span>
                  <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span>supp <span class="free">h</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">f</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span><span class="main">)</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.cong
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sum.swap <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="skolem">gh</span> <span class="skolem">x</span>
                      <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span>supp <span class="free">h</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span><span class="main">)</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="skolem">gh</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="free">f</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">gh</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_aez convolution_symm_eq_sum_over_supp_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">gh</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">gh</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>
                        <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span>supp <span class="free">h</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> triple_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span><span class="main">)</span>
                              <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult.assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gh</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span>supp <span class="free">h</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> gh_def h_aez convolution_eq_sum_over_supp_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">gh</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span>supp <span class="free">h</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span>supp <span class="free">h</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> triple_cong sum.cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">gh</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">∈</span>supp <span class="free">h</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span>   <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sum.cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convolution <span class="skolem">fg</span> <span class="free">h</span> <span class="skolem">x</span> <span class="main">=</span> convolution <span class="free">f</span> <span class="skolem">gh</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_distrib_left"><span class="command">lemma</span></span> convolution_distrib_left <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">g</span> <span class="free">h</span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> aezfun_set"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">+</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> convolution <span class="free">f</span> <span class="free">g</span> <span class="main">+</span> convolution <span class="free">f</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">gh</span></span> <span class="skolem"><span class="skolem">GH</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gh</span> <span class="main">=</span> <span class="free">g</span> <span class="main">+</span> <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">GH</span> <span class="main">=</span> supp <span class="free">g</span> <span class="main">∪</span> supp <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fin_GH<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">GH</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> GH_def assms <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> gh_aezfun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gh</span> <span class="main">∈</span> aezfun_set"</span></span> <span class="keyword1"><span class="command">using</span></span> gh_def assms sum_of_aezfun_is_aezfun <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> zero_ext_g <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">GH</span> <span class="main">-</span> supp <span class="free">g</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  zero_ext_h <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">GH</span> <span class="main">-</span> supp <span class="free">h</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  zero_ext_gh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">GH</span> <span class="main">-</span> supp <span class="skolem">gh</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">gh</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> supp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="skolem">gh</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="skolem">gh</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">gh</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms gh_aezfun convolution_eq_sum_over_supp_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">gh</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gh_def GH_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">GH</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">gh</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_GH supp_sum_subset_union_supp zero_ext_gh
          sum.mono_neutral_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">GH</span></span> <span class="quoted"><span class="quoted">"supp <span class="skolem">gh</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">gh</span> <span class="bound">y</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gh_def
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">GH</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">GH</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum.distrib <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convolution <span class="free">f</span> <span class="skolem">gh</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>convolution <span class="free">f</span> <span class="free">g</span> <span class="main">+</span> convolution <span class="free">f</span> <span class="free">h</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms GH_def fin_GH zero_ext_g zero_ext_h
          sum.mono_neutral_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">GH</span></span> <span class="quoted"><span class="quoted">"supp <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">y</span><span class="main">)</span>"</span></span><span class="main">]</span>
          sum.mono_neutral_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">GH</span></span> <span class="quoted"><span class="quoted">"supp <span class="free">h</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="bound">y</span><span class="main">)</span>"</span></span><span class="main">]</span>
          convolution_eq_sum_over_supp_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
          convolution_eq_sum_over_supp_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_distrib_right"><span class="command">lemma</span></span> convolution_distrib_right <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">f</span> <span class="free">g</span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>group_add <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> aezfun_set"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"convolution <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> convolution <span class="free">f</span> <span class="free">h</span> <span class="main">+</span> convolution <span class="free">g</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fg</span></span> <span class="skolem"><span class="skolem">FG</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fg</span> <span class="main">=</span> <span class="free">f</span> <span class="main">+</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">FG</span> <span class="main">=</span> supp <span class="free">f</span> <span class="main">∪</span> supp <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fin_FG<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">FG</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FG_def assms <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> fg_aezfun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fg</span> <span class="main">∈</span> aezfun_set"</span></span> <span class="keyword1"><span class="command">using</span></span> fg_def assms sum_of_aezfun_is_aezfun <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> zero_ext_f <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">FG</span> <span class="main">-</span> supp <span class="free">f</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  zero_ext_g <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">FG</span> <span class="main">-</span> supp <span class="free">g</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  zero_ext_fg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">FG</span> <span class="main">-</span> supp <span class="skolem">fg</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">fg</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> supp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convolution <span class="skolem">fg</span> <span class="free">h</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>supp <span class="skolem">fg</span><span class="main">.</span> <span class="main">(</span><span class="skolem">fg</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fg_aezfun convolution_symm_eq_sum_over_supp_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">fg</span></span> <span class="quoted"><span class="free">h</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fg_def FG_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">FG</span><span class="main">.</span> <span class="main">(</span><span class="skolem">fg</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_FG supp_sum_subset_union_supp zero_ext_fg
          sum.mono_neutral_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">FG</span></span> <span class="quoted"><span class="quoted">"supp <span class="skolem">fg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="skolem">fg</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fg_def
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">FG</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">FG</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum.distrib <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convolution <span class="skolem">fg</span> <span class="free">h</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>convolution <span class="free">f</span> <span class="free">h</span> <span class="main">+</span> convolution <span class="free">g</span> <span class="free">h</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms FG_def fin_FG zero_ext_f zero_ext_g
          sum.mono_neutral_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">FG</span></span> <span class="quoted"><span class="quoted">"supp <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
          sum.mono_neutral_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">FG</span></span> <span class="quoted"><span class="quoted">"supp <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span><span class="main">-</span><span class="bound">y</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
          convolution_symm_eq_sum_over_supp_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">h</span></span><span class="main">]</span>
          convolution_symm_eq_sum_over_supp_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">h</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Type definition, instantiations, and instances›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="quoted">zero</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> aezfun <span class="main">=</span> <span class="quoted"><span class="quoted">"aezfun_set <span class="main">::</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">morphisms</span></span> aezfun Abs_aezfun
  <span class="keyword1"><span class="command">using</span></span>     zerofun_is_aezfun
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">fast</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_aezfun

<span class="keyword1" id="Rep_Fin_Groups-aezfun_finite_supp"><span class="command">lemma</span></span> aezfun_finite_supp <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>supp <span class="main">(</span>aezfun <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> aezfun.aezfun <span class="keyword1"><span class="command">unfolding</span></span> aezfun_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_transfer"><span class="command">lemma</span></span> aezfun_transfer <span class="main">:</span> <span class="quoted"><span class="quoted">"aezfun <span class="free">a</span> <span class="main">=</span> aezfun <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">instantiation</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">zero</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">zero_aezfun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span><span class="tfree">'b</span><span class="main">⇒</span><span class="tfree">'a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zerofun_is_aezfun <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Rep_Fin_Groups-zero_aezfun_transfer"><span class="command">lemma</span></span> zero_aezfun_transfer <span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_aezfun <span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> <span class="keyword1">δ</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zb</span></span> <span class="skolem"><span class="skolem">za</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zb</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">za</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zb</span> <span class="keyword1">δ</span> <span class="skolem">za</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> deltafun0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">za</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_aezfun.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zb</span> <span class="keyword1">δ</span> <span class="skolem">za</span> <span class="main">=</span> aezfun <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> zb_def za_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> aezfun_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-zero_aezfun_apply"><span class="command">lemma</span></span> zero_aezfun_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"aezfun <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instantiation</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">plus_aezfun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
    <span class="keyword2"><span class="keyword">is</span></span>    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">+</span> <span class="bound">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_of_aezfun_is_aezfun
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Rep_Fin_Groups-plus_aezfun_apply"><span class="command">lemma</span></span> plus_aezfun_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> aezfun <span class="free">a</span> <span class="free">x</span> <span class="main">+</span> aezfun <span class="free">b</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">semigroup_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> aezfun <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> aezfun <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> add.assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">a</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">monoid_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_aezfun_apply"><span class="command">lemma</span></span> sum_list_aezfun_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>sum_list <span class="free">as</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">←</span><span class="free">as</span><span class="main">.</span> aezfun <span class="bound">a</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_map_aezfun_apply"><span class="command">lemma</span></span> sum_list_map_aezfun_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">←</span><span class="free">as</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">←</span><span class="free">as</span><span class="main">.</span> aezfun <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_map_aezfun"><span class="command">lemma</span></span> sum_list_map_aezfun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">←</span><span class="free">as</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">←</span><span class="free">as</span><span class="main">.</span> aezfun <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_list_map_aezfun_apply<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> sum_list_fun_apply<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun <span class="main">∘</span> <span class="free">f</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_prod_map_aezfun_apply"><span class="command">lemma</span></span> sum_list_prod_map_aezfun_apply <span class="main">:</span>  
  <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> aezfun <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xys</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_prod_map_aezfun"><span class="command">lemma</span></span> sum_list_prod_map_aezfun <span class="main">:</span>
  <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> aezfun <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_list_prod_map_aezfun_apply<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
        sum_list_prod_fun_apply<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> aezfun <span class="main">(</span><span class="free">f</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword1"><span class="command">instance</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_monoid_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">comm_monoid_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> aezfun <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> aezfun <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> add.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">a</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-sum_aezfun_apply"><span class="command">lemma</span></span> sum_aezfun_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> aezfun <span class="main">(</span><span class="main">∑</span><span class="free">A</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> aezfun <span class="bound">a</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">instantiation</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">group_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">minus_aezfun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
    <span class="keyword2"><span class="keyword">is</span></span>    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">-</span> <span class="bound">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> diff_of_aezfun_is_aezfun
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Rep_Fin_Groups-minus_aezfun_apply"><span class="command">lemma</span></span> minus_aezfun_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> aezfun <span class="free">a</span> <span class="free">x</span> <span class="main">-</span> aezfun <span class="free">b</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instantiation</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">group_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">uminus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_aezfun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">-</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neg_of_aezfun_is_aezfun <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Rep_Fin_Groups-uminus_aezfun_apply"><span class="command">lemma</span></span> uminus_aezfun_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> aezfun <span class="free">a</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_left_minus"><span class="command">lemma</span></span> aezfun_left_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>group_add<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">a</span> <span class="main">+</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_diff_minus"><span class="command">lemma</span></span> aezfun_diff_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>group_add<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="main">-</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">instance</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">group_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">group_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>group_add<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">ab_group_add</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">ab_group_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ab_group_add<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">-</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aezfun_diff_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>one<span class="main">,</span>zero<span class="main">}</span>"</span></span><span class="main">,</span> <span class="quoted">zero</span><span class="main">)</span> <span class="quoted">one</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">one_aezfun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">δ</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> deltafun_is_aezfun <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Rep_Fin_Groups-one_aezfun_transfer"><span class="command">lemma</span></span> one_aezfun_transfer <span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_aezfun <span class="main">(</span><span class="main">1</span> <span class="keyword1">δ</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span>zero<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">1</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">δ</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> one_aezfun.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Abs_aezfun <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">δ</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> Abs_aezfun <span class="main">(</span>aezfun <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> z_def n_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> aezfun_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-one_aezfun_apply"><span class="command">lemma</span></span> one_aezfun_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"aezfun <span class="main">1</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δ</span> <span class="main">0</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">rule</span>

<span class="keyword1" id="Rep_Fin_Groups-one_aezfun_apply_eq"><span class="command">lemma</span></span> one_aezfun_apply_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"aezfun <span class="main">1</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deltafun_apply_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-one_aezfun_apply_neq"><span class="command">lemma</span></span> one_aezfun_apply_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> aezfun <span class="main">1</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deltafun_apply_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">zero_neq_one</span><span class="main">,</span> <span class="quoted">zero</span><span class="main">)</span> <span class="quoted">zero_neq_one</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">0</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> aezfun<span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zero_neq_one one_aezfun_apply_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> aezfun<span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zero_neq_one one_aezfun_apply_eq
          fun_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> aezfun<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>comm_monoid_add<span class="main">,</span>times<span class="main">}</span>"</span></span><span class="main">,</span> <span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">times</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">times_aezfun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
    <span class="keyword2"><span class="keyword">is</span></span>    <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> convolution <span class="bound">f</span> <span class="bound">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> convolution_of_aezfun_is_aezfun
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Rep_Fin_Groups-convolution_transfer"><span class="command">lemma</span></span> convolution_transfer <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> aezfun_set"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Abs_aezfun <span class="main">(</span>convolution <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> Abs_aezfun <span class="free">f</span> <span class="main">*</span> Abs_aezfun <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> aezfun_transfer<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>Abs_aezfun <span class="main">(</span>convolution <span class="free">f</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> convolution <span class="free">f</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> convolution_of_aezfun_is_aezfun Abs_aezfun_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>Abs_aezfun <span class="free">f</span> <span class="main">*</span> Abs_aezfun <span class="free">g</span><span class="main">)</span> <span class="main">=</span> convolution <span class="free">f</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> times_aezfun.rep_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Abs_aezfun <span class="free">f</span>"</span></span><span class="main">]</span> Abs_aezfun_inverse<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
          Abs_aezfun_inverse<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>Abs_aezfun <span class="main">(</span>convolution <span class="free">f</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">=</span> aezfun <span class="main">(</span>Abs_aezfun <span class="free">f</span> <span class="main">*</span> Abs_aezfun <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>comm_monoid_add<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span><span class="main">,</span> <span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">mult_zero</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> convolution_zero<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> convolution_zero<span class="main">[</span><span class="operator">of</span>   <span class="quoted"><span class="quoted">"aezfun <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">semiring_0</span><span class="main">,</span> <span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">semiring_0</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> convolution_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> convolution_distrib_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">c</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> convolution_distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">ring</span><span class="main">,</span> <span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">ring</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instance</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>semiring_0<span class="main">,</span>monoid_mult<span class="main">,</span>zero_neq_one<span class="main">}</span>"</span></span><span class="main">,</span> <span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">monoid_mult</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="main">1</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> convolution <span class="main">(</span><span class="main">1</span> <span class="keyword1">δ</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>aezfun <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="main">1</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>aezfun <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> one_neq_zero convolution_delta_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">a</span>"</span></span><span class="main">]</span> minus_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> convolution <span class="main">(</span>aezfun <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δ</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>aezfun <span class="skolem">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> one_neq_zero convolution_delta_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> aezfun <span class="main">::</span> <span class="main">(</span><span class="quoted">ring_1</span><span class="main">,</span> <span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">ring_1</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Transfer facts›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">aezdeltafun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>zero <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> aezfun"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">δδ</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1"><span class="free">δδ</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> Abs_aezfun <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">δ</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezdeltafun"><span class="command">lemma</span></span> aezdeltafun <span class="main">:</span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">δ</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deltafun_is_aezfun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> Abs_aezfun_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-aezdeltafun_plus"><span class="command">lemma</span></span> aezdeltafun_plus <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">+</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">δδ</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">+</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> deltafun_plus aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
        plus_aezfun.rep_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span>"</span></span><span class="main">]</span>
        aezfun_transfer<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">+</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">δδ</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-times_aezdeltafun_aezdeltafun"><span class="command">lemma</span></span>   times_aezdeltafun_aezdeltafun <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b1</span> <span class="free">b2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b1</span> <span class="keyword1">δδ</span> <span class="free">a1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b2</span> <span class="keyword1">δδ</span> <span class="free">a2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b1</span> <span class="main">*</span> <span class="free">b2</span><span class="main">)</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">a1</span> <span class="main">+</span> <span class="free">a2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deltafun_is_aezfun convolution_transfer<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b1</span> <span class="keyword1">δ</span> <span class="free">a1</span>"</span></span><span class="main">,</span> <span class="operator">THEN</span> sym<span class="main">]</span>
        convolution_delta_delta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b1</span></span> <span class="quoted"><span class="free">a1</span></span> <span class="quoted"><span class="free">b2</span></span> <span class="quoted"><span class="free">a2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_restrict_and_extend0"><span class="command">lemma</span></span> aezfun_restrict_and_extend0 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>aezfun <span class="free">x</span><span class="main">)</span><span class="main">↓</span><span class="free">A</span> <span class="main">∈</span> aezfun_set"</span></span>
  <span class="keyword1"><span class="command">using</span></span> aezfun.aezfun restrict_and_extend0_aezfun_is_aezfun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-aezdeltafun_decomp"><span class="command">lemma</span></span> aezdeltafun_decomp <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> convolution_delta_delta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> deltafun_is_aezfun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
        deltafun_is_aezfun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> convolution_transfer
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-aezdeltafun_decomp'"><span class="command">lemma</span></span> aezdeltafun_decomp' <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> convolution_delta_delta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> deltafun_is_aezfun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
        deltafun_is_aezfun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> convolution_transfer
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-supp_aezfun1"><span class="command">lemma</span></span> supp_aezfun1 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"supp <span class="main">(</span> aezfun <span class="main">(</span> <span class="main">1</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>zero_neq_one<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> aezfun <span class="main">)</span> <span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> supp_deltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span><span class="tfree">'b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-supp_aezfun_diff"><span class="command">lemma</span></span> supp_aezfun_diff <span class="main">:</span>
  <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> supp <span class="main">(</span>aezfun <span class="free">x</span><span class="main">)</span> <span class="main">∪</span> supp <span class="main">(</span>aezfun <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> supp <span class="main">(</span> <span class="main">(</span>aezfun <span class="free">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>aezfun <span class="free">y</span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> supp_diff_subset_union_supp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-supp_aezfun_times"><span class="command">lemma</span></span> supp_aezfun_times <span class="main">:</span>
  <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> supp <span class="main">(</span>aezfun <span class="free">x</span><span class="main">)</span> <span class="main">+</span> supp <span class="main">(</span>aezfun <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> supp <span class="main">(</span>convolution <span class="main">(</span>aezfun <span class="free">x</span><span class="main">)</span> <span class="main">(</span>aezfun <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> supp_convolution_subset_sum_supp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Almost-everywhere-zero functions with constrained support›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The name of the next definition anticipates <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>aezfun_common_supp_spanning_set›</span></span></span></span>
        below.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">aezfun_setspan</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>zero<span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">aezfun_setspan</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> supp <span class="main">(</span>aezfun <span class="bound">x</span><span class="main">)</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setspanD"><span class="command">lemma</span></span> aezfun_setspanD <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> aezfun_setspan <span class="free">A</span> <span class="main">⟹</span> supp <span class="main">(</span>aezfun <span class="free">x</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> aezfun_setspan_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setspanI"><span class="command">lemma</span></span> aezfun_setspanI <span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="free">x</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> aezfun_setspan <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> aezfun_setspan_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_common_supp_spanning_set"><span class="command">lemma</span></span> aezfun_common_supp_spanning_set <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as</span><span class="main">.</span> distinct <span class="bound">as</span> <span class="main">∧</span> set <span class="bound">as</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span>
                  <span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>semiring_1<span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> aezfun <span class="main">∈</span> aezfun_setspan <span class="free">A</span><span class="main">.</span>
                    <span class="main">∃</span><span class="bound">bs</span><span class="main">.</span> length <span class="bound">bs</span> <span class="main">=</span> length <span class="bound">as</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">bs</span> <span class="bound">as</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δδ</span> <span class="bound">a</span><span class="main">)</span>
          <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms aezfun_common_supp_spanning_set'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">as</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">.</span> supp <span class="bound">f</span> <span class="main">⊆</span> <span class="free">A</span>
                    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">bs</span><span class="main">.</span> length <span class="bound">bs</span> <span class="main">=</span> length <span class="skolem">as</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">bs</span> <span class="skolem">as</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δ</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> aezfun<span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> aezfun_setspan <span class="free">A</span> <span class="main">⟹</span>
             <span class="main">(</span><span class="main">∃</span><span class="bound">bs</span><span class="main">.</span> length <span class="bound">bs</span> <span class="main">=</span> length <span class="skolem">as</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">bs</span> <span class="skolem">as</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δδ</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> aezfun"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> aezfun_setspan <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> as<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">bs</span> <span class="main">=</span> length <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="skolem">bs</span> <span class="skolem">as</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> aezfun_setspanD
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="skolem">bs</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="keyword1">δ</span> <span class="bound">a</span> <span class="main">=</span> aezfun <span class="main">(</span><span class="bound">b</span> <span class="keyword1">δδ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="skolem">bs</span> <span class="skolem">as</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="keyword1">δ</span> <span class="skolem">a</span> <span class="main">=</span> aezfun <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">δδ</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> bs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bs</span><span class="main">.</span> length <span class="bound">bs</span> <span class="main">=</span> length <span class="skolem">as</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">bs</span> <span class="skolem">as</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δδ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_prod_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"zip <span class="skolem">bs</span> <span class="skolem">as</span>"</span></span> <span class="quoted">deltafun</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span> <span class="bound">a</span><span class="main">.</span> aezfun <span class="main">(</span><span class="bound">b</span> <span class="keyword1">δδ</span> <span class="bound">a</span><span class="main">)</span>"</span></span><span class="main">]</span>
            sum_list_prod_map_aezfun<span class="main">[</span><span class="operator">of</span> <span class="quoted">aezdeltafun</span> <span class="quoted"><span class="quoted">"zip <span class="skolem">bs</span> <span class="skolem">as</span>"</span></span><span class="main">]</span>
            aezfun_transfer<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> as<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_common_supp_spanning_set_decomp"><span class="command">lemma</span></span> aezfun_common_supp_spanning_set_decomp <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gs</span><span class="main">.</span> distinct <span class="bound">gs</span> <span class="main">∧</span> set <span class="bound">gs</span> <span class="main">=</span> <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span>
                  <span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>semiring_1<span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">∈</span> aezfun_setspan <span class="free">G</span><span class="main">.</span>
                    <span class="main">∃</span><span class="bound">rs</span><span class="main">.</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="bound">gs</span>
                      <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">rs</span> <span class="bound">gs</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>
          <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span>  aezfun_common_supp_spanning_set<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> gs<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">gs</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">gs</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">∈</span> aezfun_setspan <span class="free">G</span><span class="main">.</span>
                    <span class="main">∃</span><span class="bound">rs</span><span class="main">.</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="skolem">gs</span>
                      <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">rs</span> <span class="skolem">gs</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun<span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> aezfun_setspan <span class="free">G</span>
              <span class="main">⟹</span> <span class="main">∃</span><span class="bound">rs</span><span class="main">.</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="skolem">gs</span>
                <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">rs</span> <span class="skolem">gs</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> aezfun_setspan <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> gs<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">rs</span> <span class="main">=</span> length <span class="skolem">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span>zip <span class="skolem">rs</span> <span class="skolem">gs</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> aezfun_setspanD
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">rs</span><span class="main">.</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="skolem">gs</span>
                <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">rs</span> <span class="skolem">gs</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> aezdeltafun_decomp sum_list_prod_cong<span class="main">[</span>
              <span class="operator">of</span> <span class="quoted"><span class="quoted">"zip <span class="skolem">rs</span> <span class="skolem">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
            <span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> gs<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_decomp_aezdeltafun"><span class="command">lemma</span></span> aezfun_decomp_aezdeltafun <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>semiring_1<span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ras</span><span class="main">.</span> set <span class="main">(</span>map snd <span class="bound">ras</span><span class="main">)</span> <span class="main">=</span> supp <span class="main">(</span>aezfun <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span><span class="bound">ras</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> aezfun_finite_supp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">as</span> <span class="main">=</span> supp <span class="main">(</span>aezfun <span class="free">c</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> aezfun <span class="main">∈</span> aezfun_setspan <span class="main">(</span>supp <span class="main">(</span>aezfun <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
                    <span class="main">∃</span><span class="bound">bs</span><span class="main">.</span> length <span class="bound">bs</span> <span class="main">=</span> length <span class="skolem">as</span>
                      <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">bs</span> <span class="skolem">as</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δδ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aezfun_common_supp_spanning_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="free">c</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> as<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">bs</span> <span class="main">=</span> length <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="skolem">bs</span> <span class="skolem">as</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">δδ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aezfun_setspanI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="free">c</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> bs<span class="main">(</span>1<span class="main">)</span> as<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map snd <span class="main">(</span>zip <span class="skolem">bs</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> supp <span class="main">(</span>aezfun <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> bs<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setspan_el_decomp_aezdeltafun"><span class="command">lemma</span></span> aezfun_setspan_el_decomp_aezdeltafun <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>semiring_1<span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> aezfun_setspan <span class="free">A</span>
              <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ras</span><span class="main">.</span> set <span class="main">(</span>map snd <span class="bound">ras</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span><span class="bound">ras</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> aezfun_setspanD aezfun_decomp_aezdeltafun
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-aezdelta0fun_commutes'"><span class="command">lemma</span></span> aezdelta0fun_commutes' <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b1</span> <span class="free">b2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>comm_semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b1</span> <span class="keyword1">δδ</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">b2</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">b2</span> <span class="keyword1">δδ</span> <span class="main">0</span> <span class="main">*</span> <span class="main">(</span><span class="free">b1</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> times_aezdeltafun_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b1</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
        times_aezdeltafun_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b2</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">b1</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-aezdelta0fun_commutes"><span class="command">lemma</span></span> aezdelta0fun_commutes <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>comm_semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">δδ</span> <span class="main">0</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> aezfun_decomp_aezdeltafun <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ras</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span><span class="skolem">ras</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_list_mult_const_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">a</span>"</span></span> <span class="quoted"><span class="skolem">ras</span></span><span class="main">]</span> aezdelta0fun_commutes'
          sum_list_prod_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ras</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">a</span><span class="main">.</span> <span class="free">b</span> <span class="keyword1">δδ</span> <span class="main">0</span> <span class="main">*</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">a</span><span class="main">)</span>"</span></span><span class="main">]</span>
          sum_list_const_mult_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">δδ</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">a</span>"</span></span> <span class="quoted"><span class="skolem">ras</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following definition constrains the support of arbitrary almost-everywhere-zero functions, as
  a sort of projection onto a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>aezfun_setspan›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">aezfun_setspan_proj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>zero<span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>zero<span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> aezfun"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">aezfun_setspan_proj</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> Abs_aezfun <span class="main">(</span><span class="main">(</span>aezfun <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">↓</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setspan_projD1"><span class="command">lemma</span></span> aezfun_setspan_projD1 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="free">x</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> aezfun <span class="free">x</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>     aezfun_restrict_and_extend0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> Abs_aezfun_inverse<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>aezfun <span class="free">x</span><span class="main">)</span><span class="main">↓</span><span class="free">A</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> aezfun_setspan_proj_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setspan_projD2"><span class="command">lemma</span></span> aezfun_setspan_projD2 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="free">x</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>     aezfun_restrict_and_extend0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> Abs_aezfun_inverse<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>aezfun <span class="free">x</span><span class="main">)</span><span class="main">↓</span><span class="free">A</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> aezfun_setspan_proj_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setspan_proj_in_setspan"><span class="command">lemma</span></span> aezfun_setspan_proj_in_setspan <span class="main">:</span>
  <span class="quoted"><span class="quoted">"aezfun_setspan_proj <span class="free">A</span> <span class="free">x</span> <span class="main">∈</span> aezfun_setspan <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> aezfun_setspan_projD2<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
        suppD_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="free">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
        aezfun_setspanI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun_setspan_proj <span class="free">A</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setspan_proj_zero"><span class="command">lemma</span></span> aezfun_setspan_proj_zero <span class="main">:</span> <span class="quoted"><span class="quoted">"aezfun_setspan_proj <span class="free">A</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> aezfun <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> aezfun <span class="main">0</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> aezfun_setspan_projD1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> aezfun_setspan_projD2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> aezfun_transfer <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setspan_proj_aezdeltafun"><span class="command">lemma</span></span> aezfun_setspan_proj_aezdeltafun <span class="main">:</span>
  <span class="quoted"><span class="quoted">"aezfun_setspan_proj <span class="free">A</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> aezfun <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>
                      <span class="main">=</span> aezfun <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> aezfun_setspan_projD1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span>"</span></span><span class="main">]</span> aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
              deltafun_apply_neq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> aezfun_setspan_projD2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False
        <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> aezfun <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="keyword1">δδ</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> deltafun_apply_neq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> aezfun_transfer <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setspan_proj_add"><span class="command">lemma</span></span> aezfun_setspan_proj_add <span class="main">:</span>
  <span class="quoted"><span class="quoted">"aezfun_setspan_proj <span class="free">A</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>
        <span class="main">=</span> aezfun_setspan_proj <span class="free">A</span> <span class="free">x</span> <span class="main">+</span> aezfun_setspan_proj <span class="free">A</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span>
             <span class="main">=</span> aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="free">x</span> <span class="main">+</span> aezfun_setspan_proj <span class="free">A</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span>
                     <span class="main">=</span> aezfun <span class="main">(</span>aezfun_setspan_proj <span class="free">A</span> <span class="free">x</span> <span class="main">+</span> aezfun_setspan_proj <span class="free">A</span> <span class="free">y</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> aezfun_setspan_projD1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span>"</span></span><span class="main">]</span> aezfun_setspan_projD2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span>"</span></span><span class="main">]</span>
            aezfun_setspan_projD1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> aezfun_setspan_projD1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
            aezfun_setspan_projD2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> aezfun_setspan_projD2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> aezfun_transfer <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setspan_proj_sum_list"><span class="command">lemma</span></span> aezfun_setspan_proj_sum_list <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"aezfun_setspan_proj <span class="free">A</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> aezfun_setspan_proj <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> aezfun_setspan_proj_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> aezfun_setspan_proj_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-aezfun_setspan_proj_sum_list_prod"><span class="command">lemma</span></span> aezfun_setspan_proj_sum_list_prod <span class="main">:</span>
  <span class="quoted"><span class="quoted">"aezfun_setspan_proj <span class="free">A</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> aezfun_setspan_proj <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> aezfun_setspan_proj_sum_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xy</span><span class="main">.</span> case_prod <span class="free">f</span> <span class="bound">xy</span>"</span></span><span class="main">]</span>
        prod.case_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun_setspan_proj <span class="free">A</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomials›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-nonzero_coeffs_nonzero_poly"><span class="command">lemma</span></span> nonzero_coeffs_nonzero_poly <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> set <span class="free">as</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> Poly <span class="free">as</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> coeffs_Poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">as</span></span><span class="main">]</span> strip_while_0_nnil<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">as</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-const_poly_nonzero_coeff"><span class="command">lemma</span></span> const_poly_nonzero_coeff <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">from</span></span> z assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> coeff_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> poly_eqI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-pCons_induct2"><span class="command">lemma</span></span> pCons_induct2 <span class="main">[</span><span class="operator">case_names</span> 00 lpCons rpCons pCons2<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 00<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     lpCons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>pCons <span class="bound">a</span> <span class="bound">p</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     rpCons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">0</span> <span class="main">(</span>pCons <span class="bound">b</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     pCons2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">p</span> <span class="bound">b</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span> <span class="bound">q</span>
                                                                    <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>pCons <span class="bound">a</span> <span class="bound">p</span><span class="main">)</span> <span class="main">(</span>pCons <span class="bound">b</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">q'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> pCons <span class="skolem">b</span> <span class="skolem">q'</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> 00 rpCons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">q'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> pCons <span class="skolem">b</span> <span class="skolem">q'</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> pCons lpCons pCons2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Algebra of sets›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹General facts›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-zeroset_eqI"><span class="command">lemma</span></span> zeroset_eqI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_sets_single"><span class="command">lemma</span></span> sum_list_sets_single <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="main">[</span><span class="free">A</span><span class="main">]</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_0_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_sets_double"><span class="command">lemma</span></span> sum_list_sets_double <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="main">[</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">]</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">+</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_0_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Additive independence of sets›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">add_independentS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>monoid_add set list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_independentS</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
      <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">add_independentS</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">As</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="free">add_independentS</span> <span class="free"><span class="bound"><span class="entity">As</span></span></span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">∑</span><span class="bound">B</span><span class="main">←</span><span class="free"><span class="bound"><span class="entity">As</span></span></span><span class="main">.</span> <span class="bound">B</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-add_independentS_doubleI"><span class="command">lemma</span></span> add_independentS_doubleI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">b</span><span class="main">∈</span><span class="free">B</span> <span class="main">⟹</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sum_list_sets_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-add_independentS_doubleD"><span class="command">lemma</span></span> add_independentS_doubleD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">b</span><span class="main">∈</span><span class="free">B</span> <span class="main">⟹</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sum_list_sets_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-add_independentS_double_iff"><span class="command">lemma</span></span> add_independentS_double_iff <span class="main">:</span>
  <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_independentS_doubleI add_independentS_doubleD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-add_independentS_Cons_conv_sum_right"><span class="command">lemma</span></span> add_independentS_Cons_conv_sum_right <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"add_independentS <span class="main">(</span><span class="free">A</span><span class="main">#</span><span class="free">As</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span>add_independentS <span class="main">[</span><span class="free">A</span><span class="main">,</span><span class="main">∑</span><span class="bound">B</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">B</span><span class="main">]</span> <span class="main">∧</span> add_independentS <span class="free">As</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_independentS_double_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-add_independentS_double_sum_conv_append"><span class="command">lemma</span></span> add_independentS_double_sum_conv_append <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">X</span><span class="main">∈</span>set <span class="free">As</span><span class="main">.</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">;</span> add_independentS <span class="free">As</span><span class="main">;</span> add_independentS <span class="free">Bs</span><span class="main">;</span> 
        add_independentS <span class="main">[</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">,</span> <span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">]</span> <span class="main">⟧</span>
          <span class="main">⟹</span> add_independentS <span class="main">(</span><span class="free">As</span><span class="main">@</span><span class="free">Bs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">As</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">A</span> <span class="skolem">As</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">,</span> <span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_independentS_doubleI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> ba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> ba<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">A</span><span class="main">#</span><span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_plus_intro<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ba<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> Cons<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_independentS_doubleD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span>"</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">a</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">As</span><span class="main">@</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span><span class="main">;</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">;</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> 
                      <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> x_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">As</span><span class="main">@</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x_a<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xa</span></span> <span class="skolem"><span class="skolem">xb</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> xa_xb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">xa</span> <span class="main">+</span> <span class="skolem">xb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_plus_elim<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> x_a<span class="main">(</span>2<span class="main">)</span> xa_xb<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">xa</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_plus_intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span> xa_xb x_a<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_independentS_doubleD<span class="main">[</span>
              <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span>"</span></span> <span class="quoted"><span class="skolem">xb</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">+</span><span class="skolem">xa</span>"</span></span>
            <span class="main">]</span>
            add.assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> add_independentS_doubleD
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">(</span><span class="main">(</span><span class="skolem">A</span><span class="main">#</span><span class="skolem">As</span><span class="main">)</span><span class="main">@</span><span class="free">Bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-add_independentS_ConsI"><span class="command">lemma</span></span> add_independentS_ConsI <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="free">As</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">a</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span><span class="main">;</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">a</span><span class="main">+</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"add_independentS <span class="main">(</span><span class="free">A</span><span class="main">#</span><span class="free">As</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-add_independentS_append_reduce_right"><span class="command">lemma</span></span> add_independentS_append_reduce_right <span class="main">:</span>
  <span class="quoted"><span class="quoted">"add_independentS <span class="main">(</span><span class="free">As</span><span class="main">@</span><span class="free">Bs</span><span class="main">)</span> <span class="main">⟹</span> add_independentS <span class="free">Bs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">As</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-add_independentS_append_reduce_left"><span class="command">lemma</span></span> add_independentS_append_reduce_left <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"add_independentS <span class="main">(</span><span class="free">As</span><span class="main">@</span><span class="free">Bs</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⟹</span> add_independentS <span class="free">As</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">As</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">A</span> <span class="skolem">As</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">(</span><span class="skolem">A</span><span class="main">#</span><span class="skolem">As</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_independentS_ConsI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="skolem">As</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">+</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="main">0</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> a sum Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-add_independentS_append_conv_double_sum"><span class="command">lemma</span></span> add_independentS_append_conv_double_sum <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"add_independentS <span class="main">(</span><span class="free">As</span><span class="main">@</span><span class="free">Bs</span><span class="main">)</span> <span class="main">⟹</span> add_independentS <span class="main">[</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">,</span> <span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">As</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">A</span> <span class="skolem">As</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="main">(</span><span class="skolem">A</span><span class="main">#</span><span class="skolem">As</span><span class="main">)</span><span class="main">.</span> <span class="bound">X</span><span class="main">,</span> <span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_independentS_doubleI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> bx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">A</span> <span class="main">#</span> <span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> bx<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">as</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> a_as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">∈</span> listset <span class="skolem">As</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">←</span><span class="skolem">as</span><span class="main">.</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_sum_list_element_Cons
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="skolem">A</span><span class="main">,</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">As</span><span class="main">@</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_independentS_Cons_conv_sum_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">As</span><span class="main">@</span><span class="free">Bs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a_as<span class="main">(</span>2<span class="main">)</span> bx<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">z</span><span class="main">←</span><span class="skolem">as</span><span class="main">.</span> <span class="bound">z</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="main">(</span><span class="skolem">As</span><span class="main">@</span><span class="free">Bs</span><span class="main">)</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_listset set_plus_intro
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_as<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> bx<span class="main">(</span>3<span class="main">)</span> add_independentS_doubleD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> add.assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> a_as<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> bx<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_listset
            add_independentS_doubleD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">As</span><span class="main">.</span> <span class="bound">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span>"</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">z</span><span class="main">←</span><span class="skolem">as</span><span class="main">.</span> <span class="bound">z</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Inner direct sums›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inner_dirsum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>monoid_add set list <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inner_dirsum</span> <span class="free"><span class="bound"><span class="entity">As</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> add_independentS <span class="free"><span class="bound"><span class="entity">As</span></span></span> <span class="keyword1">then</span> <span class="main">∑</span><span class="bound">A</span><span class="main">←</span><span class="free"><span class="bound"><span class="entity">As</span></span></span><span class="main">.</span> <span class="bound">A</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some syntactic sugar for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>inner_dirsum›</span></span></span></span>, borrowed from theory <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="../../HOL/HOL/List.html"></a><a href="../../HOL/HOL/List.html">HOL.List</a><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">syntax</span></span> 
  <span class="quoted">"_inner_dirsum"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">=&gt;</span> <span class="tfree">'a</span> list <span class="main">=&gt;</span> <span class="tfree">'b</span> <span class="main">=&gt;</span> <span class="tfree">'b</span>"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨁</span>_<span class="keyword1">←</span>_<span class="keyword1">.</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 51<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="comment1">― ‹Beware of argument permutation!›</span>
  <span class="quoted">"<span class="main">⨁</span><span class="free">M</span><span class="main">←</span><span class="free">Ms</span><span class="main">.</span> <span class="free">b</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> inner_dirsum <span class="main">(</span><span class="keyword1">CONST</span> map <span class="main">(</span><span class="main">%</span><span class="free">M</span><span class="main">.</span> <span class="free">b</span><span class="main">)</span> <span class="free">Ms</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">inner_dirsum_double</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>monoid_add set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊕</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inner_dirsum_double</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> inner_dirsum <span class="main">[</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-inner_dirsumI"><span class="command">lemma</span></span> inner_dirsumI <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">N</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span> <span class="main">⟹</span> add_independentS <span class="free">Ns</span> <span class="main">⟹</span> <span class="free">M</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">N</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_dirsum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-inner_dirsum_doubleI"><span class="command">lemma</span></span> inner_dirsum_doubleI <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="free">A</span> <span class="main">+</span> <span class="free">B</span> <span class="main">⟹</span> add_independentS <span class="main">[</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">M</span> <span class="main">=</span> <span class="free">A</span> <span class="main">⊕</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_dirsumI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">]</span>"</span></span><span class="main">]</span> sum_list_sets_double<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-inner_dirsumD"><span class="command">lemma</span></span> inner_dirsumD <span class="main">:</span>
  <span class="quoted"><span class="quoted">"add_independentS <span class="free">Ms</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">M</span><span class="main">←</span><span class="free">Ms</span><span class="main">.</span> <span class="bound">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">M</span><span class="main">←</span><span class="free">Ms</span><span class="main">.</span> <span class="bound">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_dirsum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-inner_dirsumD2"><span class="command">lemma</span></span> inner_dirsumD2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> add_independentS <span class="free">Ms</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">M</span><span class="main">←</span><span class="free">Ms</span><span class="main">.</span> <span class="bound">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_dirsum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-inner_dirsum_Nil"><span class="command">lemma</span></span> inner_dirsum_Nil <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="bound">A</span><span class="main">←</span><span class="main">[]</span><span class="main">.</span> <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_dirsum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-inner_dirsum_singleD"><span class="command">lemma</span></span> inner_dirsum_singleD <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="bound">N</span><span class="main">←</span><span class="main">[</span><span class="free">M</span><span class="main">]</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_dirsumD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">M</span><span class="main">]</span>"</span></span><span class="main">]</span> sum_list_sets_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-inner_dirsum_doubleD"><span class="command">lemma</span></span> inner_dirsum_doubleD <span class="main">:</span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">M</span><span class="main">,</span><span class="free">N</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">M</span> <span class="main">⊕</span> <span class="free">N</span> <span class="main">=</span> <span class="free">M</span> <span class="main">+</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_dirsumD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">M</span><span class="main">,</span><span class="free">N</span><span class="main">]</span>"</span></span><span class="main">]</span> sum_list_sets_double<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-inner_dirsum_Cons"><span class="command">lemma</span></span> inner_dirsum_Cons <span class="main">:</span>
  <span class="quoted"><span class="quoted">"add_independentS <span class="main">(</span><span class="free">A</span> <span class="main">#</span> <span class="free">As</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">X</span><span class="main">←</span><span class="main">(</span><span class="free">A</span><span class="main">#</span><span class="free">As</span><span class="main">)</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">X</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_dirsumD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">#</span><span class="free">As</span>"</span></span><span class="main">]</span> add_independentS_Cons_conv_sum_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
        inner_dirsum_doubleD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> inner_dirsumD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">As</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-inner_dirsum_append"><span class="command">lemma</span></span> inner_dirsum_append <span class="main">:</span>
  <span class="quoted"><span class="quoted">"add_independentS <span class="main">(</span><span class="free">As</span><span class="main">@</span><span class="free">Bs</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>
        <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">X</span><span class="main">←</span><span class="main">(</span><span class="free">As</span><span class="main">@</span><span class="free">Bs</span><span class="main">)</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">X</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">X</span><span class="main">←</span><span class="free">Bs</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_dirsumD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">As</span><span class="main">@</span><span class="free">Bs</span>"</span></span><span class="main">]</span> add_independentS_append_reduce_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">As</span></span><span class="main">]</span>
        inner_dirsumD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">As</span></span><span class="main">]</span> inner_dirsumD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Bs</span></span><span class="main">]</span>
        add_independentS_append_reduce_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">As</span></span> <span class="quoted"><span class="free">Bs</span></span><span class="main">]</span>
        add_independentS_append_conv_double_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">As</span></span><span class="main">]</span>
        inner_dirsum_doubleD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">X</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-inner_dirsum_double_left0"><span class="command">lemma</span></span> inner_dirsum_double_left0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊕</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_independentS_doubleD inner_dirsum_doubleI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">+</span><span class="free">A</span>"</span></span><span class="main">]</span> add_0_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-add_independentS_Cons_conv_dirsum_right"><span class="command">lemma</span></span> add_independentS_Cons_conv_dirsum_right <span class="main">:</span>
  <span class="quoted"><span class="quoted">"add_independentS <span class="main">(</span><span class="free">A</span><span class="main">#</span><span class="free">As</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>add_independentS <span class="main">[</span><span class="free">A</span><span class="main">,</span><span class="main">⨁</span><span class="bound">B</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">B</span><span class="main">]</span>
        <span class="main">∧</span> add_independentS <span class="free">As</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_independentS_Cons_conv_sum_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">As</span></span><span class="main">]</span> inner_dirsumD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_listset_dirsum"><span class="command">lemma</span></span> sum_list_listset_dirsum <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"add_independentS <span class="free">As</span> <span class="main">⟹</span> <span class="free">as</span> <span class="main">∈</span> listset <span class="free">As</span> <span class="main">⟹</span> sum_list <span class="free">as</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">A</span><span class="main">←</span><span class="free">As</span><span class="main">.</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_dirsumD sum_list_listset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>




<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Groups›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Locales and basic facts›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locale <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Group›</span></span></span></span> and finite variant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FinGroup›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Define a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Group›</span></span></span></span> to be a closed subset of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>group_add›</span></span></span></span> class.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Group <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonempty   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     diff_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">g</span> <span class="main">-</span> <span class="bound">h</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-trivial_Group"><span class="command">lemma</span></span> trivial_Group <span class="main">:</span> <span class="quoted"><span class="quoted">"Group <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">locale</span></span> FinGroup <span class="main">=</span> Group <span class="quoted"><span class="free">G</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FinGroup<span class="main">)</span> Group <span class="main">:</span> <span class="quoted"><span class="quoted">"Group <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> FinGroupI <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">G</span> <span class="main">⟹</span> FinGroup <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">context</span></span> Group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Subgroup</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Subgroup</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">≡</span> Group <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-SubgroupD1"><span class="command">lemma</span></span> SubgroupD1 <span class="main">:</span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span> <span class="main">⟹</span> Group <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-zero_closed"><span class="command">lemma</span></span> zero_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> nonempty <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">-</span> <span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> diff_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-obtain_nonzero"><span class="command">lemma</span></span> obtain_nonzero<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-zeroS_closed"><span class="command">lemma</span></span> zeroS_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-neg_closed"><span class="command">lemma</span></span> neg_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_closed diff_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-add_closed"><span class="command">lemma</span></span> add_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">+</span> <span class="free">h</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> neg_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h</span></span><span class="main">]</span> diff_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">h</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-neg_add_closed"><span class="command">lemma</span></span> neg_add_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">g</span> <span class="main">+</span> <span class="free">h</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> neg_closed add_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_closed"><span class="command">lemma</span></span> sum_list_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map <span class="free">f</span> <span class="free">as</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">←</span><span class="free">as</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_closed add_closed <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_closed_prod"><span class="command">lemma</span></span> sum_list_closed_prod <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>map <span class="main">(</span>case_prod <span class="free">f</span><span class="main">)</span> <span class="free">xys</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_list_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-set_plus_closed"><span class="command">lemma</span></span> set_plus_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">+</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_plus_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> add_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-zip_add_closed"><span class="command">lemma</span></span> zip_add_closed <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">as</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> set <span class="free">bs</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> set <span class="main">[</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="free">as</span> <span class="free">bs</span><span class="main">]</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_closed <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-list_diff_closed"><span class="command">lemma</span></span> list_diff_closed <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">gs</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> set <span class="free">hs</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> set <span class="main">[</span><span class="bound">x</span><span class="main">-</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span><span class="main">←</span>zip <span class="free">gs</span> <span class="free">hs</span><span class="main">]</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> diff_closed <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">gs</span></span> <span class="quoted"><span class="free">hs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-add_closed_converse_right"><span class="command">lemma</span></span> add_closed_converse_right <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">+</span><span class="free">x</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> neg_add_closed add.assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">g</span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-add_closed_inverse_right"><span class="command">lemma</span></span> add_closed_inverse_right <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">g</span><span class="main">+</span><span class="free">x</span> <span class="main">∉</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_closed_converse_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-add_closed_converse_left"><span class="command">lemma</span></span> add_closed_converse_left <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">+</span><span class="free">x</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> diff_closed add.assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-add_closed_inverse_left"><span class="command">lemma</span></span> add_closed_inverse_left <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∉</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">g</span><span class="main">+</span><span class="free">x</span> <span class="main">∉</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_closed_converse_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-right_translate_bij"><span class="command">lemma</span></span> right_translate_bij <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="free">G</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">`</span> <span class="free">G</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">`</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms add_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">`</span> <span class="free">G</span> <span class="main">⊇</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> diff_closed diff_add_cancel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">`</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-right_translate_sum"><span class="command">lemma</span></span> right_translate_sum <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">h</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">f</span> <span class="bound">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">h</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> right_translate_bij<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> bij_betw_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">+</span> <span class="free">g</span>"</span></span><span class="main">]</span>
        sum.reindex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">+</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Group *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Abelian variant locale <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>AbGroup›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">locale</span></span> AbGroup <span class="main">=</span> Group <span class="quoted"><span class="free">G</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>ab_group_add set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> nonempty    <span class="main">=</span> nonempty
<span class="keyword1"><span class="command">lemmas</span></span> zero_closed <span class="main">=</span> zero_closed
<span class="keyword1"><span class="command">lemmas</span></span> diff_closed <span class="main">=</span> diff_closed
<span class="keyword1"><span class="command">lemmas</span></span> add_closed  <span class="main">=</span> add_closed
<span class="keyword1"><span class="command">lemmas</span></span> neg_closed  <span class="main">=</span> neg_closed

<span class="keyword1" id="Rep_Fin_Groups-sum_closed"><span class="command">lemma</span></span> sum_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> add_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-subset_plus_right"><span class="command">lemma</span></span> subset_plus_right <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">+</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_closed set_zero_plus2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-subset_plus_left"><span class="command">lemma</span></span> subset_plus_left <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">+</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subset_plus_right add.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context AbGroup *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Right cosets›</span></span>

<span class="keyword1"><span class="command">context</span></span> Group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rcoset_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'g</span><span class="main">×</span><span class="tfree">'g</span><span class="main">)</span> set"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rcoset_rel</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">g'</span><span class="main">)</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> <span class="bound">g'</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">-</span> <span class="bound">g'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> rcosets <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subgrp<span class="main">:</span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="free">g</span><span class="main">}</span> <span class="main">=</span> <span class="free">H</span> <span class="main">+</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> seteqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rcoset_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> subgrp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Group.neg_closed minus_diff_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> h<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">+</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">+</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">+</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">+</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> subgrp g <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> h<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> subgrp h<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Group.neg_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> g 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rcoset_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-rcoset_equiv"><span class="command">lemma</span></span> rcoset_equiv <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"equiv <span class="free">G</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equivI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">G</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> refl_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">×</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rcoset_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rcoset_rel_def Group.zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> symI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rcoset_rel_def Group.neg_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span>"</span></span><span class="main">]</span> minus_diff_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> transI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rcoset_rel_def Group.add_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> <span class="skolem">z</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-rcoset0"><span class="command">lemma</span></span> rcoset0 <span class="main">:</span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span> <span class="main">⟹</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_closed rcosets <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_rcoset_replist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="tfree">'g</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_rcoset_replist</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span>
              <span class="main">≡</span> set <span class="free"><span class="bound"><span class="entity">gs</span></span></span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">∧</span> distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span>
                <span class="main">∧</span> <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">g</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-is_rcoset_replistD_set"><span class="command">lemma</span></span> is_rcoset_replistD_set <span class="main">:</span> <span class="quoted"><span class="quoted">"is_rcoset_replist <span class="free">H</span> <span class="free">gs</span> <span class="main">⟹</span> set <span class="free">gs</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_rcoset_replist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-is_rcoset_replistD_distinct"><span class="command">lemma</span></span> is_rcoset_replistD_distinct <span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_rcoset_replist <span class="free">H</span> <span class="free">gs</span> <span class="main">⟹</span> distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_rcoset_replist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-is_rcoset_replistD_cosets"><span class="command">lemma</span></span> is_rcoset_replistD_cosets <span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_rcoset_replist <span class="free">H</span> <span class="free">gs</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">g</span><span class="main">∈</span>set <span class="free">gs</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_rcoset_replist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-group_eq_subgrp_rcoset_un"><span class="command">lemma</span></span> group_eq_subgrp_rcoset_un <span class="main">:</span>
  <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span> <span class="main">⟹</span> is_rcoset_replist <span class="free">H</span> <span class="free">gs</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">g</span><span class="main">∈</span>set <span class="free">gs</span><span class="main">.</span> <span class="free">H</span> <span class="main">+</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_rcoset_replistD_set is_rcoset_replistD_cosets rcosets
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">smt</span> UN_E subsetCE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-is_rcoset_replist_imp_nrelated_nth"><span class="command">lemma</span></span> is_rcoset_replist_imp_nrelated_nth <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"is_rcoset_replist <span class="free">H</span> <span class="free">gs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">gs</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">gs</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="free">gs</span><span class="main">!</span><span class="bound">i</span> <span class="main">-</span> <span class="free">gs</span><span class="main">!</span><span class="bound">j</span> <span class="main">∉</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≠</span><span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">-</span> <span class="free">gs</span><span class="main">!</span><span class="skolem">j</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> ij<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">gs</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="free">gs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> rcoset_rel <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_conv_nth is_rcoset_replistD_set rcoset_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> ij<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span>
                <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rcoset_equiv equiv_class_eq
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> ij<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> is_rcoset_replistD_distinct distinct_conv_nth<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-is_rcoset_replist_Cons"><span class="command">lemma</span></span> is_rcoset_replist_Cons <span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_rcoset_replist <span class="free">H</span> <span class="main">(</span><span class="free">g</span><span class="main">#</span><span class="free">gs</span><span class="main">)</span> <span class="main">⟷</span>
      <span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> set <span class="free">gs</span> <span class="main">⊆</span> <span class="free">G</span>
    <span class="main">∧</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="free">g</span><span class="main">}</span> <span class="main">∉</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span>
    <span class="main">∧</span> distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span>
    <span class="main">∧</span> <span class="free">G</span> <span class="main">=</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="free">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">gs</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_rcoset_replist_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">#</span><span class="free">gs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-rcoset_replist_Hrep"><span class="command">lemma</span></span> rcoset_replist_Hrep <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"is_rcoset_replist <span class="free">H</span> <span class="free">gs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">∈</span>set <span class="free">gs</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zero_closed is_rcoset_replistD_cosets <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> g<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rcoset_equiv equivE sym_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rcoset_rel <span class="free">H</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> g <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">∈</span>set <span class="free">gs</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rcoset0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-rcoset_replist_reorder"><span class="command">lemma</span></span> rcoset_replist_reorder <span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_rcoset_replist <span class="free">H</span> <span class="main">(</span><span class="free">gs</span> <span class="main">@</span> <span class="free">g</span> <span class="main">#</span> <span class="free">gs'</span><span class="main">)</span> <span class="main">⟹</span> is_rcoset_replist <span class="free">H</span> <span class="main">(</span><span class="free">g</span> <span class="main">#</span> <span class="free">gs</span> <span class="main">@</span> <span class="free">gs'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_rcoset_replist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-rcoset_replist_replacehd"><span class="command">lemma</span></span> rcoset_replist_replacehd <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"is_rcoset_replist <span class="free">H</span> <span class="main">(</span><span class="free">g</span> <span class="main">#</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"is_rcoset_replist <span class="free">H</span> <span class="main">(</span><span class="free">g'</span> <span class="main">#</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rcoset_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">gs</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_rcoset_replistD_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="free">g'</span><span class="main">}</span> <span class="main">∉</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">gs</span></span><span class="main">]</span> rcoset_equiv equiv_class_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> is_rcoset_replistD_distinct
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_rcoset_replistD_distinct <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="free">g'</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">gs</span><span class="main">.</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_rcoset_replistD_cosets<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">#</span><span class="free">gs</span>"</span></span><span class="main">]</span> rcoset_equiv equiv_class_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_rcoset_replist_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Group *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FinGroup<span class="main">)</span> ex_rcoset_replist <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gs</span><span class="main">.</span> is_rcoset_replist <span class="free">H</span> <span class="bound">gs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> rcoset_rel <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> equiv_r<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv <span class="free">G</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rcoset_equiv<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">G</span><span class="main">//</span><span class="skolem">r</span><span class="main">.</span> <span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span><span class="main">//</span><span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> quotient_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equiv_r equivE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> refl_onD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">G</span><span class="main">//</span><span class="skolem">r</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bchoice <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> r_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">×</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rcoset_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> finite <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">f</span><span class="main">`</span><span class="main">(</span><span class="free">G</span><span class="main">//</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_quotient <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="keyword2"><span class="keyword">where</span></span> gs<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">gs</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">gs</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">`</span><span class="main">(</span><span class="free">G</span><span class="main">//</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_distinct_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">gs</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set <span class="skolem">gs</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> gs<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span><span class="main">//</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> f <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equiv_r Union_quotient <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">gs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">;</span>
                <span class="bound">j</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">;</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟧</span>
                  <span class="main">⟹</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">≠</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> ij<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">gs</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span> length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">gs</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> ij<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">∈</span> set <span class="skolem">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span><span class="main">!</span><span class="skolem">j</span> <span class="main">∈</span> set <span class="skolem">gs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this gs<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span><span class="main">//</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">G</span><span class="main">//</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span><span class="main">!</span><span class="skolem">j</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> equiv_r x<span class="main">(</span>1<span class="main">)</span> y<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> quotient_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> ij<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="skolem">gs</span><span class="main">!</span><span class="skolem">i</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="skolem">gs</span><span class="main">!</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> ij<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">gs</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">gs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">r</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> eq_equiv_class_iff<span class="main">[</span><span class="operator">OF</span> equiv_r<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">from</span></span> x y f <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span><span class="main">!</span><span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>        
      <span class="keyword1"><span class="command">with</span></span> x<span class="main">(</span>2<span class="main">)</span> y<span class="main">(</span>2<span class="main">)</span> ij<span class="main">(</span>1-3<span class="main">)</span> gs<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> distinct_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> distinct_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">g</span><span class="main">∈</span>set <span class="skolem">gs</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subset_antisym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> rg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∈</span> <span class="free">G</span><span class="main">//</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotientI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> gs<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> g'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> set <span class="skolem">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> f g'<span class="main">(</span>2<span class="main">)</span> rg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="skolem">g'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equiv_r equivE sym_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> g'<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">g</span><span class="main">∈</span>set <span class="skolem">gs</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> r_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊇</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">g</span><span class="main">∈</span>set <span class="skolem">gs</span><span class="main">.</span> <span class="skolem">r</span><span class="main">``</span><span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rcoset_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> r_def <span class="keyword1"><span class="command">unfolding</span></span> is_rcoset_replist_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FinGroup<span class="main">)</span> ex_rcoset_replist_hd0 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gs</span><span class="main">.</span> is_rcoset_replist <span class="free">H</span> <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="bound">gs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"is_rcoset_replist <span class="free">H</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_rcoset_replist <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rcoset_replist_Hrep <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> x<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> rcoset_rel <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rcoset0<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rcoset_equiv<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> equivE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"rcoset_rel <span class="free">H</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">(</span>rcoset_rel <span class="free">H</span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> x<span class="main">(</span>1<span class="main">)</span> xs assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gs</span><span class="main">.</span> is_rcoset_replist <span class="free">H</span> <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="bound">gs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> split_list rcoset_replist_reorder rcoset_replist_replacehd <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Group homomorphisms›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ker</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ker</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-kerI"><span class="command">lemma</span></span> kerI <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> ker <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ker_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-kerD"><span class="command">lemma</span></span> kerD <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> ker <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ker_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-ker_im_iff"><span class="command">lemma</span></span> ker_im_iff <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">⊆</span> ker <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">⊆</span> ker <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> zeroset_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> kerD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">]</span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> kerD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> fA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> fA <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> ker <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> fA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ker <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> kerI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">⊆</span> ker <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locales›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>supp›</span></span></span></span> condition is not strictly necessary, but helps with equality
        and uniqueness arguments.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> GroupHom <span class="main">=</span> Group <span class="quoted"><span class="free">G</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>   <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'h</span><span class="main">::</span>group_add"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">g'</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">g'</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">+</span> <span class="bound">g'</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="bound">g</span> <span class="main">+</span> <span class="free">T</span> <span class="bound">g'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     supp<span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="free">T</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span> 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> GroupHom<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">Ker</span> <span class="main">≡</span> ker <span class="free">T</span> <span class="main">∩</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> GroupHom<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">ImG</span> <span class="main">≡</span> <span class="free">T</span> <span class="main">`</span> <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> GroupEnd <span class="main">=</span> GroupHom <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'g</span>"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> endomorph<span class="main">:</span> <span class="quoted"><span class="quoted">"ImG <span class="main">⊆</span> <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> GroupIso <span class="main">=</span> GroupHom <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>   <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'h</span><span class="main">::</span>group_add"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'h</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bijective<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">T</span> <span class="free">G</span> <span class="free">H</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> trivial_GroupHom <span class="main">:</span> <span class="quoted"><span class="quoted">"GroupHom <span class="free">G</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'g</span><span class="main">⇒</span><span class="tfree">'h</span><span class="main">::</span>group_add<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">g'</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">z_map</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'h</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z_map</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'g</span><span class="main">⇒</span><span class="tfree">'h</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z_map</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">+</span> <span class="skolem">g'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z_map</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">z_map</span> <span class="skolem">g'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> supp_zerofun_subset_any<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> GroupHom_idhom <span class="main">:</span> <span class="quoted"><span class="quoted">"GroupHom <span class="free">G</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_closed supp_restrict0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">context</span></span> GroupHom
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-im_zero"><span class="command">lemma</span></span> im_zero <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_closed hom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> add_diff_cancel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">0</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-zero_in_Ker"><span class="command">lemma</span></span> zero_in_Ker <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> Ker"</span></span>
  <span class="keyword1"><span class="command">using</span></span> im_zero kerI zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-comp_zero"><span class="command">lemma</span></span> comp_zero <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∘</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> im_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-im_neg"><span class="command">lemma</span></span> im_neg <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="free">T</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> im_zero hom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">g</span>"</span></span><span class="main">]</span> neg_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> minus_unique<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="free">g</span>"</span></span><span class="main">]</span>
        neg_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">g</span>"</span></span><span class="main">]</span> supp suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">g</span>"</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-im_diff"><span class="command">lemma</span></span> im_diff <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">g'</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="free">g</span> <span class="main">-</span> <span class="free">g'</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="free">g</span> <span class="main">-</span> <span class="free">T</span> <span class="free">g'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hom neg_closed hom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">g'</span>"</span></span><span class="main">]</span> im_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-eq_im_imp_diff_in_Ker"><span class="command">lemma</span></span> eq_im_imp_diff_in_Ker <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">h</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">T</span> <span class="free">g</span> <span class="main">=</span> <span class="free">T</span> <span class="free">h</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">-</span> <span class="free">h</span> <span class="main">∈</span> Ker"</span></span>
  <span class="keyword1"><span class="command">using</span></span> im_diff kerI diff_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">h</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-im_sum_list_prod"><span class="command">lemma</span></span> im_sum_list_prod <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>map <span class="main">(</span>case_prod <span class="free">f</span><span class="main">)</span> <span class="free">xys</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span>
        <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">T</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xys</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> im_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">xy</span> <span class="skolem">xys</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Tf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Tf</span> <span class="main">=</span> <span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>case_prod <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="main">(</span><span class="skolem">xy</span><span class="main">#</span><span class="skolem">xys</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="main">(</span> <span class="main">(</span>case_prod <span class="free">f</span><span class="main">)</span> <span class="skolem">xy</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="skolem">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>case_prod <span class="free">f</span><span class="main">)</span> <span class="skolem">xy</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map <span class="main">(</span>case_prod <span class="free">f</span><span class="main">)</span> <span class="skolem">xys</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="main">(</span><span class="skolem">xy</span><span class="main">#</span><span class="skolem">xys</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Tf</span> <span class="skolem">xy</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="skolem">xys</span><span class="main">.</span> <span class="skolem">Tf</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Tf_def sum_list_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"case_prod <span class="free">f</span>"</span></span><span class="main">]</span> hom Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="main">(</span><span class="skolem">xy</span><span class="main">#</span><span class="skolem">xys</span><span class="main">)</span><span class="main">.</span> <span class="skolem">Tf</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Tf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-distrib_comp_sum_left"><span class="command">lemma</span></span> distrib_comp_sum_left <span class="main">:</span>
  <span class="quoted"><span class="quoted">"range <span class="free">S</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> range <span class="free">S'</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∘</span> <span class="main">(</span><span class="free">S</span> <span class="main">+</span> <span class="free">S'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="free">S</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-Ker_Im_iff"><span class="command">lemma</span></span> Ker_Im_iff <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Ker <span class="main">=</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ImG <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nonempty ker_im_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-Ker0_imp_inj_on"><span class="command">lemma</span></span> Ker0_imp_inj_on <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ker <span class="main">⊆</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"inj_on <span class="free">T</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">T</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> im_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> xy<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">∈</span> Ker"</span></span> <span class="keyword1"><span class="command">using</span></span> diff_closed kerI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_in_Ker <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-inj_on_imp_Ker0"><span class="command">lemma</span></span> inj_on_imp_Ker0 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">T</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Ker <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   zero_in_Ker kerD zero_closed im_zero inj_onD<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-nonzero_Ker_el_imp_n_inj"><span class="command">lemma</span></span> nonzero_Ker_el_imp_n_inj <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">T</span> <span class="free">g</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¬</span> inj_on <span class="free">T</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inj_on_imp_Ker0 kerI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-Group_Ker"><span class="command">lemma</span></span> Group_Ker <span class="main">:</span> <span class="quoted"><span class="quoted">"Group Ker"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ker <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_in_Ker <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> Ker"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> Ker"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">-</span> <span class="skolem">h</span> <span class="main">∈</span> Ker"</span></span>
    <span class="keyword1"><span class="command">using</span></span> im_diff kerD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> kerD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> diff_closed kerI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Group_Im"><span class="command">lemma</span></span> Group_Im <span class="main">:</span> <span class="quoted"><span class="quoted">"Group ImG"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ImG <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g'</span> <span class="skolem">h'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> ImG"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">∈</span> ImG"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="free">T</span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">=</span> <span class="free">T</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">-</span> <span class="skolem">h'</span> <span class="main">∈</span> ImG"</span></span> <span class="keyword1"><span class="command">using</span></span> im_diff diff_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-GroupHom_restrict0_subgroup"><span class="command">lemma</span></span> GroupHom_restrict0_subgroup  <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"GroupHom <span class="free">H</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> SubgroupD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> supp_restrict0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">h'</span> <span class="keyword3"><span class="command">assume</span></span> hh'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">H</span><span class="main">)</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">+</span> <span class="skolem">h'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">h</span> <span class="main">+</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Group.add_closed hom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">h'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-im_subgroup"><span class="command">lemma</span></span> im_subgroup <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Group.Subgroup ImG <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Group <span class="main">(</span><span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">H</span><span class="main">)</span> <span class="main">`</span> <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GroupHom_restrict0_subgroup GroupHom.Group_Im <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">H</span><span class="main">)</span> <span class="main">`</span> <span class="free">H</span> <span class="main">=</span> <span class="free">T</span> <span class="main">`</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">H</span> <span class="main">⊆</span> ImG"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-GroupHom_composite_left"><span class="command">lemma</span></span> GroupHom_composite_left <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ImG <span class="main">⊆</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"GroupHom <span class="free">H</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"GroupHom <span class="free">G</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">g'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> hom assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">+</span> <span class="skolem">g'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">+</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="skolem">g'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GroupHom.hom<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> supp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∉</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suppI_contra GroupHom.im_zero<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suppD_contra <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-idhom_left"><span class="command">lemma</span></span> idhom_left <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span> <span class="main">⟹</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">H</span><span class="main">)</span> <span class="main">∘</span> <span class="free">T</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> supp suppI_contra <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context GroupHom *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts about endomorphisms›</span></span>

<span class="keyword1"><span class="command">context</span></span> GroupEnd
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> hom <span class="main">=</span> hom

<span class="keyword1" id="Rep_Fin_Groups-range"><span class="command">lemma</span></span> range <span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="free">T</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> endomorph <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> supp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> suppI_contra zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-proj_decomp"><span class="command">lemma</span></span> proj_decomp <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="free">T</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="bound">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> Ker <span class="main">⊕</span> ImG"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inner_dirsum_doubleI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subset_antisym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">-</span> <span class="free">T</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">+</span> <span class="free">T</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> diff_add_cancel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">-</span> <span class="free">T</span> <span class="skolem">g</span> <span class="main">∈</span> Ker"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> g endomorph assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">-</span> <span class="free">T</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> im_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">-</span> <span class="free">T</span> <span class="skolem">g</span> <span class="main">∈</span> ker <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> kerI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> g endomorph <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">-</span> <span class="free">T</span> <span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> diff_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">g</span> <span class="main">∈</span> ImG"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> Ker <span class="main">+</span> ImG"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_plus_intro<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">-</span> <span class="free">T</span> <span class="skolem">g</span>"</span></span> <span class="quoted">Ker</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">g</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> endomorph <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊇</span> Ker <span class="main">+</span> ImG"</span></span> <span class="keyword1"><span class="command">using</span></span> set_plus_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span>Ker<span class="main">,</span>ImG<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_independentS_doubleI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> ImG"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> Ker"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">+</span> <span class="skolem">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> gh<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="free">T</span> <span class="skolem">g'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> gh<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> endomorph assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> im_zero hom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">g'</span>"</span></span><span class="main">]</span> kerD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> gh<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context GroupEnd *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts about isomorphisms›</span></span>

<span class="keyword1"><span class="command">context</span></span> GroupIso
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">invT</span> <span class="main">≡</span> <span class="main">(</span>the_inv_into <span class="free">G</span> <span class="free">T</span><span class="main">)</span> <span class="main">↓</span> <span class="free">H</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-ImG"><span class="command">lemma</span></span> ImG <span class="main">:</span> <span class="quoted"><span class="quoted">"ImG <span class="main">=</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bijective bij_betw_imp_surj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-GroupH"><span class="command">lemma</span></span> GroupH <span class="main">:</span> <span class="quoted"><span class="quoted">"Group <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ImG Group_Im <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-invT_onto"><span class="command">lemma</span></span> invT_onto <span class="main">:</span> <span class="quoted"><span class="quoted">"invT <span class="main">`</span> <span class="free">H</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bijective bij_betw_imp_inj_on<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> ImG the_inv_into_onto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-inj_on_invT"><span class="command">lemma</span></span> inj_on_invT <span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on invT <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>     bijective bij_betw_imp_inj_on<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> ImG inj_on_the_inv_into<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-bijective_invT"><span class="command">lemma</span></span> bijective_invT <span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw invT <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inj_on_invT invT_onto <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-invT_into"><span class="command">lemma</span></span> invT_into <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> invT <span class="free">h</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bijective bij_betw_imp_inj_on ImG the_inv_into_into<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-T_invT"><span class="command">lemma</span></span> T_invT <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span>invT <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bijective bij_betw_imp_inj_on ImG f_the_inv_into_f<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-invT_eq"><span class="command">lemma</span></span> invT_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">T</span> <span class="free">g</span> <span class="main">=</span> <span class="free">h</span> <span class="main">⟹</span> invT <span class="free">h</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bijective bij_betw_imp_inj_on ImG the_inv_into_f_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-inv"><span class="command">lemma</span></span> inv <span class="main">:</span> <span class="quoted"><span class="quoted">"GroupIso <span class="free">H</span> invT <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> GroupH<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp invT <span class="main">⊆</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> supp_restrict0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw invT <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bijective_invT <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="skolem">h'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"invT <span class="main">(</span><span class="skolem">h</span> <span class="main">+</span> <span class="skolem">h'</span><span class="main">)</span> <span class="main">=</span> invT <span class="skolem">h</span> <span class="main">+</span> invT <span class="skolem">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> invT_into hom T_invT add_closed invT_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context GroupIso *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Hom-sets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">GroupHomSet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set <span class="main">⇒</span> <span class="tfree">'h</span><span class="main">::</span>group_add set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'h</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">GroupHomSet</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> GroupHom <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">T</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="bound">T</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-GroupHomSetI"><span class="command">lemma</span></span> GroupHomSetI <span class="main">:</span>
  <span class="quoted"><span class="quoted">"GroupHom <span class="free">G</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">`</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∈</span> GroupHomSet <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> GroupHomSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-GroupHomSetD_GroupHom"><span class="command">lemma</span></span> GroupHomSetD_GroupHom <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GroupHomSet <span class="free">G</span> <span class="free">H</span> <span class="main">⟹</span> GroupHom <span class="free">G</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> GroupHomSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-GroupHomSetD_Im"><span class="command">lemma</span></span> GroupHomSetD_Im <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GroupHomSet <span class="free">G</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">`</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> GroupHomSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> Group_GroupHomSet <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'h</span><span class="main">::</span>ab_group_add set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Group <span class="main">(</span>GroupHomSet <span class="free">G</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupHomSet <span class="free">G</span> <span class="free">H</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trivial_GroupHom AbGroup.zero_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> GroupHomSetI
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="skolem">T</span> <span class="keyword3"><span class="command">assume</span></span> ST<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> GroupHomSet <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> GroupHomSet <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span> <span class="main">∈</span> GroupHomSet <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> GroupHomSetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> ST <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> GroupHomSetD_GroupHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> GroupHomSetD_GroupHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">]</span>
            GroupHom.supp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> GroupHom.supp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">T</span></span><span class="main">]</span>
            supp_diff_subset_union_supp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quoted"><span class="skolem">T</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">`</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> ST <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">g</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="skolem">g</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> GroupHomSetD_Im<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> GroupHomSetD_Im<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AbGroup.diff_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">g'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> ST <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">+</span> <span class="skolem">g'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span><span class="main">)</span> <span class="skolem">g'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> GroupHomSetD_GroupHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> GroupHom.hom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span>
            GroupHomSetD_GroupHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">]</span> GroupHom.hom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">T</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Facts about collections of groups›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-listset_Group_plus_closed"><span class="command">lemma</span></span> listset_Group_plus_closed <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span><span class="main">∈</span>set <span class="free">Gs</span><span class="main">.</span> Group <span class="bound">G</span><span class="main">;</span> <span class="free">as</span> <span class="main">∈</span> listset <span class="free">Gs</span><span class="main">;</span> <span class="free">bs</span> <span class="main">∈</span> listset <span class="free">Gs</span><span class="main">⟧</span>
                                                <span class="main">⟹</span> <span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="free">as</span> <span class="free">bs</span><span class="main">]</span> <span class="main">∈</span> listset <span class="free">Gs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> length <span class="free">as</span> <span class="main">=</span> length <span class="free">bs</span><span class="main">;</span> length <span class="free">bs</span> <span class="main">=</span> length <span class="free">Gs</span><span class="main">;</span>
                <span class="free">as</span> <span class="main">∈</span> listset <span class="free">Gs</span><span class="main">;</span> <span class="free">bs</span> <span class="main">∈</span> listset <span class="free">Gs</span><span class="main">;</span> <span class="main">∀</span><span class="bound">G</span><span class="main">∈</span>set <span class="free">Gs</span><span class="main">.</span> Group <span class="bound">G</span><span class="main">⟧</span>
                                                <span class="main">⟹</span> <span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="free">as</span> <span class="free">bs</span><span class="main">]</span> <span class="main">∈</span> listset <span class="free">Gs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">Gs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct3<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span> <span class="skolem">b</span> <span class="skolem">bs</span> <span class="skolem">G</span> <span class="skolem">Gs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span><span class="main">)</span><span class="main">]</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> listset_ConsD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> listset_ConsD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> Group.add_closed
            listset_ConsI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span><span class="main">∈</span>set <span class="free">Gs</span><span class="main">.</span> Group <span class="bound">G</span><span class="main">;</span> <span class="free">as</span> <span class="main">∈</span> listset <span class="free">Gs</span><span class="main">;</span> <span class="free">bs</span> <span class="main">∈</span> listset <span class="free">Gs</span><span class="main">⟧</span>
                                                <span class="main">⟹</span> <span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="free">as</span> <span class="free">bs</span><span class="main">]</span> <span class="main">∈</span> listset <span class="free">Gs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> listset_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">Gs</span></span><span class="main">]</span> listset_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">Gs</span></span><span class="main">,</span> <span class="operator">THEN</span> sym<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_set_plus"><span class="command">lemma</span></span> AbGroup_set_plus <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"AbGroup <span class="main">(</span><span class="free">H</span> <span class="main">+</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">+</span> <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AbGroup.nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">+</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">+</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xh</span></span> <span class="skolem"><span class="skolem">xg</span></span> <span class="skolem"><span class="skolem">yh</span></span> <span class="skolem"><span class="skolem">yg</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xh</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xg</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">xh</span> <span class="main">+</span> <span class="skolem">xg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yh</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yg</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">yh</span> <span class="main">+</span> <span class="skolem">yg</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xh</span> <span class="main">-</span> <span class="skolem">yh</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">xg</span> <span class="main">-</span> <span class="skolem">yg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">+</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms xy<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> AbGroup.diff_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_sum_list"><span class="command">lemma</span></span> AbGroup_sum_list <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">G</span><span class="main">∈</span>set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span><span class="main">)</span> <span class="main">⟹</span> AbGroup <span class="main">(</span><span class="main">∑</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> trivial_Group AbGroup.intro AbGroup_set_plus
  <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Gs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_subset_sum_list"><span class="command">lemma</span></span> AbGroup_subset_sum_list <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span> <span class="main">⟹</span> <span class="free">H</span> <span class="main">∈</span> set <span class="free">Gs</span> <span class="main">⟹</span> <span class="free">H</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">∑</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Gs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">H</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">G</span> <span class="skolem">Gs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="skolem">G</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> AbGroup_sum_list AbGroup.subset_plus_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">∑</span><span class="bound">G</span><span class="main">←</span><span class="skolem">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> AbGroup.subset_plus_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-independent_AbGroups_pairwise_int0"><span class="command">lemma</span></span> independent_AbGroups_pairwise_int0 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span><span class="main">∈</span>set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span><span class="main">;</span> add_independentS <span class="free">Gs</span><span class="main">;</span> <span class="free">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">;</span> <span class="free">G'</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">;</span>
        <span class="free">G</span> <span class="main">≠</span> <span class="free">G'</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">∩</span> <span class="free">G'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Gs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">G'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">H</span> <span class="skolem">Hs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">A</span> <span class="main">∈</span> set <span class="skolem">Hs</span><span class="main">;</span> <span class="bound">B</span> <span class="main">∈</span> set <span class="skolem">Hs</span><span class="main">;</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟧</span> 
                            <span class="main">⟹</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> set <span class="skolem">Hs</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">≠</span> <span class="skolem">H</span> <span class="main">⟹</span>  <span class="bound">A</span> <span class="main">∩</span> <span class="skolem">H</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> set <span class="skolem">Hs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> A<span class="main">(</span>1<span class="main">)</span> g Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">g</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">Hs</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AbGroup.neg_closed AbGroup_subset_sum_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">A</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">H</span><span class="main">#</span><span class="skolem">Hs</span><span class="main">)</span><span class="main">;</span> <span class="bound">B</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">H</span><span class="main">#</span><span class="skolem">Hs</span><span class="main">)</span><span class="main">;</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟧</span>
                        <span class="main">⟹</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>4-6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∩</span> <span class="skolem">G'</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊆</span> <span class="skolem">G</span> <span class="main">∩</span> <span class="skolem">G'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AbGroup.zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-independent_AbGroups_pairwise_int0_double"><span class="command">lemma</span></span> independent_AbGroups_pairwise_int0_double <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">G'</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">G</span><span class="main">,</span><span class="free">G'</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∩</span> <span class="free">G'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> AbGroup.zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> independent_AbGroups_pairwise_int0<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span><span class="main">∈</span>set <span class="main">[</span><span class="free">G</span><span class="main">,</span><span class="free">G'</span><span class="main">]</span><span class="main">.</span> AbGroup <span class="bound">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">G</span><span class="main">,</span><span class="free">G'</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> set <span class="main">[</span><span class="free">G</span><span class="main">,</span><span class="free">G'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G'</span> <span class="main">∈</span> set <span class="main">[</span><span class="free">G</span><span class="main">,</span><span class="free">G'</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≠</span> <span class="free">G'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> GG'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> <span class="free">G'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> False assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AbGroup.nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> GG' g<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">g</span> <span class="main">∈</span> <span class="free">G'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AbGroup.neg_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Inner direct sums of Abelian groups›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹General facts›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum"><span class="command">lemma</span></span> AbGroup_inner_dirsum <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span><span class="main">∈</span>set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span> <span class="main">⟹</span> AbGroup <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_dirsumD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Gs</span></span><span class="main">]</span> inner_dirsumD2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Gs</span></span><span class="main">]</span> AbGroup_sum_list AbGroup.intro
        trivial_Group
  <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"add_independentS <span class="free">Gs</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-inner_dirsum_double_leftfull_imp_right0"><span class="command">lemma</span></span> inner_dirsum_double_leftfull_imp_right0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Group <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">A</span> <span class="main">⊕</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">A</span> <span class="main">+</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inner_dirsum_doubleD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Group.nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> b 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="skolem">a'</span><span class="main">+</span><span class="skolem">a</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> True a a'<span class="main">(</span>1<span class="main">)</span> b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Group.neg_add_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> add_independentS_doubleD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">a'</span><span class="main">+</span><span class="skolem">a</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊕</span> <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inner_dirsum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> inner_dirsum_double_left0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_subset_inner_dirsum"><span class="command">lemma</span></span> AbGroup_subset_inner_dirsum <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span><span class="main">;</span> add_independentS <span class="free">Gs</span><span class="main">;</span> <span class="free">H</span> <span class="main">∈</span> set <span class="free">Gs</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="free">H</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> AbGroup_subset_sum_list inner_dirsumD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_nth_subset_inner_dirsum"><span class="command">lemma</span></span> AbGroup_nth_subset_inner_dirsum <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span><span class="main">;</span> add_independentS <span class="free">Gs</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">Gs</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="free">Gs</span><span class="main">!</span><span class="free">n</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> AbGroup_subset_inner_dirsum <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_el_decomp_ex1_double"><span class="command">lemma</span></span> AbGroup_inner_dirsum_el_decomp_ex1_double <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">G</span><span class="main">,</span><span class="free">H</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⊕</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">gh</span><span class="main">.</span> fst <span class="bound">gh</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> snd <span class="bound">gh</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> fst <span class="bound">gh</span> <span class="main">+</span> snd <span class="bound">gh</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex_ex1I<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">h</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_dirsum_doubleD set_plus_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">)</span> <span class="main">+</span> snd <span class="main">(</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gh</span><span class="main">.</span> fst <span class="bound">gh</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> snd <span class="bound">gh</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> fst <span class="bound">gh</span> <span class="main">+</span> snd <span class="bound">gh</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">gh</span> <span class="skolem">gh'</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span>
    <span class="quoted"><span class="quoted">"fst <span class="skolem">gh</span>  <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> snd <span class="skolem">gh</span>  <span class="main">∈</span> <span class="free">H</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> fst <span class="skolem">gh</span>  <span class="main">+</span> snd <span class="skolem">gh</span> "</span></span>
    <span class="quoted"><span class="quoted">"fst <span class="skolem">gh'</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> snd <span class="skolem">gh'</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> fst <span class="skolem">gh'</span> <span class="main">+</span> snd <span class="skolem">gh'</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gh</span> <span class="main">=</span> <span class="skolem">gh'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> A assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">gh</span> <span class="main">-</span> fst <span class="skolem">gh'</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">gh</span> <span class="main">-</span> snd <span class="skolem">gh'</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AbGroup.diff_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">gh</span> <span class="main">-</span> fst <span class="skolem">gh'</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>snd <span class="skolem">gh</span> <span class="main">-</span> snd <span class="skolem">gh'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">gh</span> <span class="main">=</span> fst <span class="skolem">gh'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
            add_independentS_doubleD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">gh</span> <span class="main">-</span> snd <span class="skolem">gh'</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">gh</span> <span class="main">-</span> fst <span class="skolem">gh'</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> z <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">gh</span> <span class="main">=</span> snd <span class="skolem">gh'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_el_decomp_ex1"><span class="command">lemma</span></span> AbGroup_inner_dirsum_el_decomp_ex1 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span><span class="main">;</span> add_independentS <span class="free">Gs</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span><span class="main">.</span> <span class="main">∃!</span><span class="bound"><span class="bound">gs</span></span><span class="main">∈</span>listset <span class="free">Gs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> sum_list <span class="bound">gs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Gs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="main">[]</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound"><span class="bound">gs</span></span><span class="main">∈</span>listset <span class="main">[]</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> sum_list <span class="bound">gs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="main">[]</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∈</span> listset <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> sum_list <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inner_dirsum_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">gs</span>
    <span class="keyword3"><span class="command">assume</span></span>  x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="main">[]</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    gs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">∈</span> listset <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> sum_list <span class="skolem">gs</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="main">[]</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span><span class="main">.</span> <span class="main">∃!</span><span class="bound"><span class="bound">gs</span></span><span class="main">∈</span>listset <span class="main">[]</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> sum_list <span class="bound">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">G</span> <span class="skolem">Gs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> prevcase<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="skolem">Gs</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span><span class="main">.</span> <span class="main">∃!</span><span class="bound"><span class="bound">gs</span></span><span class="main">∈</span>listset <span class="skolem">Gs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> sum_list <span class="bound">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> grps<span class="main">:</span> <span class="quoted"><span class="quoted">"AbGroup <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="skolem">Gs</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AbGroup_inner_dirsum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="skolem">G</span><span class="main">,</span> <span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="skolem">Gs</span><span class="main">.</span> <span class="bound">H</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_independentS_Cons_conv_dirsum_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound"><span class="bound">gs</span></span><span class="main">∈</span>listset <span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> sum_list <span class="bound">gs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex_ex1I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="skolem">Gs</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inner_dirsum_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> grps ind <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gh</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">gh</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">gh</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="skolem">Gs</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> fst <span class="skolem">gh</span> <span class="main">+</span> snd <span class="skolem">gh</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AbGroup_inner_dirsum_el_decomp_ex1_double
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> gh<span class="main">(</span>2<span class="main">)</span> prevcase <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="keyword2"><span class="keyword">where</span></span> gs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">∈</span> listset <span class="skolem">Gs</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">gh</span> <span class="main">=</span> sum_list <span class="skolem">gs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> gh<span class="main">(</span>1<span class="main">)</span> gs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">gh</span> <span class="main">#</span> <span class="skolem">gs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_Cons_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> gh<span class="main">(</span>3<span class="main">)</span> gs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> sum_list <span class="main">(</span>fst <span class="skolem">gh</span> <span class="main">#</span> <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gs</span><span class="main">.</span> <span class="bound">gs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> sum_list <span class="bound">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">gs</span> <span class="skolem">hs</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> gs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> sum_list <span class="skolem">gs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> hs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> sum_list <span class="skolem">hs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">∈</span> set_Cons <span class="skolem">G</span> <span class="main">(</span>listset <span class="skolem">Gs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hs</span> <span class="main">∈</span> set_Cons <span class="skolem">G</span> <span class="main">(</span>listset <span class="skolem">Gs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">bs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span>     a_as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">#</span><span class="skolem">as</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">∈</span> listset <span class="skolem">Gs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>       b_bs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hs</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">#</span><span class="skolem">bs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">∈</span> listset <span class="skolem">Gs</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_Cons_def
      <span class="keyword1"><span class="command">by</span></span>        <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> a_as<span class="main">(</span>3<span class="main">)</span> b_bs<span class="main">(</span>3<span class="main">)</span> Cons<span class="main">(</span>3<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span>  as<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">as</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="skolem">Gs</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">bs</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="skolem">Gs</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_listset_dirsum
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> a_as<span class="main">(</span>2<span class="main">)</span> b_bs<span class="main">(</span>2<span class="main">)</span> grps
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">as</span> <span class="main">-</span> sum_list <span class="skolem">bs</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="skolem">Gs</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AbGroup.diff_closed
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> gs hs a_as<span class="main">(</span>1<span class="main">)</span> b_bs<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>sum_list <span class="skolem">as</span> <span class="main">-</span> sum_list <span class="skolem">bs</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ind add_independentS_doubleD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> z <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="skolem">as</span> <span class="main">=</span> sum_list <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> z' prevcase as a_as<span class="main">(</span>3<span class="main">)</span> bs b_bs<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 a_as<span class="main">(</span>1<span class="main">)</span> b_bs<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">=</span> <span class="skolem">hs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span><span class="main">.</span> <span class="main">∃!</span><span class="bound">gs</span><span class="main">.</span> <span class="bound">gs</span> <span class="main">∈</span> listset <span class="main">(</span><span class="skolem">G</span><span class="main">#</span><span class="skolem">Gs</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> sum_list <span class="bound">gs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_pairwise_int0"><span class="command">lemma</span></span> AbGroup_inner_dirsum_pairwise_int0 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span><span class="main">;</span> add_independentS <span class="free">Gs</span><span class="main">;</span> <span class="free">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">;</span> <span class="free">G'</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">;</span>
        <span class="free">G</span> <span class="main">≠</span> <span class="free">G'</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">∩</span> <span class="free">G'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Gs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">G'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">H</span> <span class="skolem">Hs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">A</span> <span class="main">∈</span> set <span class="skolem">Hs</span><span class="main">;</span> <span class="bound">B</span> <span class="main">∈</span> set <span class="skolem">Hs</span><span class="main">;</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟧</span> 
                            <span class="main">⟹</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> set <span class="skolem">Hs</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">≠</span> <span class="skolem">H</span> <span class="main">⟹</span>  <span class="bound">A</span> <span class="main">∩</span> <span class="skolem">H</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> set <span class="skolem">Hs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="skolem">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> A<span class="main">(</span>1<span class="main">)</span> g Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">g</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">Hs</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AbGroup.neg_closed AbGroup_subset_sum_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">A</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">H</span><span class="main">#</span><span class="skolem">Hs</span><span class="main">)</span><span class="main">;</span> <span class="bound">B</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">H</span><span class="main">#</span><span class="skolem">Hs</span><span class="main">)</span><span class="main">;</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟧</span> 
                        <span class="main">⟹</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>4-6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∩</span> <span class="skolem">G'</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊆</span> <span class="skolem">G</span> <span class="main">∩</span> <span class="skolem">G'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AbGroup.zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_pairwise_int0_double"><span class="command">lemma</span></span> AbGroup_inner_dirsum_pairwise_int0_double <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">G'</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">G</span><span class="main">,</span><span class="free">G'</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∩</span> <span class="free">G'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> AbGroup.zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> AbGroup_inner_dirsum_pairwise_int0<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span><span class="main">∈</span>set <span class="main">[</span><span class="free">G</span><span class="main">,</span><span class="free">G'</span><span class="main">]</span><span class="main">.</span> AbGroup <span class="bound">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">G</span><span class="main">,</span><span class="free">G'</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> set <span class="main">[</span><span class="free">G</span><span class="main">,</span><span class="free">G'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G'</span> <span class="main">∈</span> set <span class="main">[</span><span class="free">G</span><span class="main">,</span><span class="free">G'</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≠</span> <span class="free">G'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> GG'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> <span class="free">G'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> False assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AbGroup.nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> GG' g<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">g</span> <span class="main">∈</span> <span class="free">G'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> AbGroup.neg_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Element decomposition and projection›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inner_dirsum_el_decomp</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>ab_group_add set list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'g</span> list<span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⨁</span>_<span class="keyword1">←</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⨁</span></span><span class="free"><span class="bound"><span class="entity">Gs</span></span></span><span class="main"><span class="free">←</span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free"><span class="bound"><span class="entity">Gs</span></span></span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>
              <span class="keyword1">then</span> <span class="keyword1">THE</span> <span class="bound">gs</span><span class="main">.</span> <span class="bound">gs</span> <span class="main">∈</span> listset <span class="free"><span class="bound"><span class="entity">Gs</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> sum_list <span class="bound">gs</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">inner_dirsum_el_decomp_double</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>ab_group_add set <span class="main">⇒</span> <span class="tfree">'g</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'g</span> list<span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">⊕</span>_<span class="keyword1">←</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main"><span class="free">⊕</span></span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main"><span class="free">←</span></span> <span class="main">≡</span> <span class="main">⨁</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">]</span><span class="main">←</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">inner_dirsum_el_decomp_nth</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>ab_group_add set list <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'g</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⨁</span>_<span class="keyword1">↓</span>_"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⨁</span></span><span class="free"><span class="bound"><span class="entity">Gs</span></span></span><span class="main"><span class="free">↓</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> restrict0 <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">⨁</span><span class="free"><span class="bound"><span class="entity">Gs</span></span></span><span class="main">←</span><span class="bound">x</span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free"><span class="bound"><span class="entity">Gs</span></span></span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_el_decompI"><span class="command">lemma</span></span> AbGroup_inner_dirsum_el_decompI <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span><span class="main">;</span> add_independentS <span class="free">Gs</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> listset <span class="free">Gs</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> sum_list <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>     AbGroup_inner_dirsum_el_decomp_ex1 theI'<span class="main">[</span>
              <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">gs</span><span class="main">.</span> <span class="bound">gs</span> <span class="main">∈</span> listset <span class="free">Gs</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> sum_list <span class="bound">gs</span>"</span></span>
            <span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_dirsum_el_decomp_def
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> AbGroup<span class="main">)</span> abSubgroup_inner_dirsum_el_decomp_set <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">H</span> <span class="main">∈</span> set <span class="free">Hs</span><span class="main">.</span> Subgroup <span class="bound">H</span><span class="main">;</span> add_independentS <span class="free">Hs</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">H</span><span class="main">←</span><span class="free">Hs</span><span class="main">.</span> <span class="bound">H</span><span class="main">)</span> <span class="main">⟧</span>
    <span class="main">⟹</span> set <span class="main">(</span><span class="main">⨁</span><span class="free">Hs</span><span class="main">←</span><span class="free">x</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> AbGroup.intro AbGroup_inner_dirsum_el_decompI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Hs</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
        set_listset_el_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Hs</span><span class="main">←</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">Hs</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_el_decomp_eq"><span class="command">lemma</span></span> AbGroup_inner_dirsum_el_decomp_eq <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span><span class="main">;</span> add_independentS <span class="free">Gs</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span><span class="main">;</span>
        <span class="free">gs</span> <span class="main">∈</span> listset <span class="free">Gs</span><span class="main">;</span> <span class="free">x</span> <span class="main">=</span> sum_list <span class="free">gs</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">gs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> AbGroup_inner_dirsum_el_decomp_ex1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Gs</span></span><span class="main">]</span>
        inner_dirsum_el_decomp_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Gs</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_el_decomp_plus"><span class="command">lemma</span></span> AbGroup_inner_dirsum_el_decomp_plus <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="free">Gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="free">y</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
    <span class="keyword1"><span class="command">have</span></span>  xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> listset <span class="free">Gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> sum_list <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> listset <span class="free">Gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> sum_list <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AbGroup_inner_dirsum_el_decompI
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> xy<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">]</span> <span class="main">∈</span> listset <span class="free">Gs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AbGroup.axioms listset_Group_plus_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> sum_list <span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> listset_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="free">Gs</span></span><span class="main">]</span> listset_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ys</span></span> <span class="quoted"><span class="free">Gs</span></span><span class="main">,</span> <span class="operator">THEN</span> sym<span class="main">]</span> sum_list_plus
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms AbGroup_inner_dirsum AbGroup.add_closed
          AbGroup_inner_dirsum_el_decomp_eq
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_length_inner_dirsum_el_decomp"><span class="command">lemma</span></span> AbGroup_length_inner_dirsum_el_decomp <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span><span class="main">;</span> add_independentS <span class="free">Gs</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span> <span class="main">⟧</span>
        <span class="main">⟹</span> length <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> length <span class="free">Gs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> AbGroup_inner_dirsum_el_decompI listset_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_el_decomp_in_nth"><span class="command">lemma</span></span> AbGroup_inner_dirsum_el_decomp_in_nth <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="free">Gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">Gs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">Gs</span><span class="main">!</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="free">Gs</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">[</span><span class="free">n</span> <span class="main">:=</span> <span class="free">x</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AbGroup_nth_subset_inner_dirsum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xgs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xgs</span> <span class="main">=</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="free">Gs</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">n</span> <span class="main">:=</span> <span class="free">x</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xgs</span> <span class="main">=</span> length <span class="free">Gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span>length <span class="skolem">xgs</span><span class="main">.</span> <span class="skolem">xgs</span><span class="main">!</span><span class="bound">k</span> <span class="main">∈</span> <span class="free">Gs</span><span class="main">!</span><span class="bound">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> length <span class="skolem">xgs</span> <span class="main">⟹</span> <span class="skolem">xgs</span><span class="main">!</span><span class="bound">k</span> <span class="main">∈</span> <span class="free">Gs</span><span class="main">!</span><span class="bound">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">xgs</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> xgs_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xgs</span><span class="main">!</span><span class="skolem">k</span> <span class="main">∈</span> <span class="free">Gs</span><span class="main">!</span><span class="skolem">k</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> AbGroup.zero_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Gs</span><span class="main">!</span><span class="skolem">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="free">n</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xgs</span> <span class="main">∈</span> listset <span class="free">Gs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> listsetI_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> xgs_def assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> sum_list <span class="skolem">xgs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_list_update<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"replicate <span class="main">(</span>length <span class="free">Gs</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> nth_replicate sum_list_replicate0
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xgs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> x xgs_def AbGroup_inner_dirsum_el_decomp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_el_decomp_nth_in_nth"><span class="command">lemma</span></span> AbGroup_inner_dirsum_el_decomp_nth_in_nth <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span><span class="main">;</span> add_independentS <span class="free">Gs</span><span class="main">;</span> <span class="free">k</span> <span class="main">&lt;</span> length <span class="free">Gs</span><span class="main">;</span>
        <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">Gs</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">Gs</span><span class="main">!</span><span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">k</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> AbGroup_nth_subset_inner_dirsum
        AbGroup_inner_dirsum_el_decomp_in_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Gs</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_el_decomp_nth_id_on_nth"><span class="command">lemma</span></span> AbGroup_inner_dirsum_el_decomp_nth_id_on_nth <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span><span class="main">;</span> add_independentS <span class="free">Gs</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">Gs</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">Gs</span><span class="main">!</span><span class="free">n</span> <span class="main">⟧</span> 
        <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> AbGroup_inner_dirsum_el_decomp_nth_in_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_el_decomp_nth_onto_nth"><span class="command">lemma</span></span> AbGroup_inner_dirsum_el_decomp_nth_onto_nth <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="free">Gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">Gs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span> <span class="main">=</span> <span class="free">Gs</span><span class="main">!</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span> <span class="main">⊇</span> <span class="free">Gs</span><span class="main">!</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AbGroup_nth_subset_inner_dirsum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Gs</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
          AbGroup_inner_dirsum_el_decomp_nth_id_on_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Gs</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Gs</span><span class="main">!</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AbGroup_inner_dirsum_el_decompI listset_length listsetD_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup_inner_dirsum_subset_proj_eq_0"><span class="command">lemma</span></span> AbGroup_inner_dirsum_subset_proj_eq_0 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="free">Gs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">Gs</span><span class="main">.</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="bound">i</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2-4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span> length <span class="free">Gs</span><span class="main">.</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AbGroup_inner_dirsum_el_decompI sum_list_sum_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="skolem">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
            AbGroup_length_inner_dirsum_el_decomp
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">Gs</span><span class="main">.</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-GroupEnd_inner_dirsum_el_decomp_nth"><span class="command">lemma</span></span> GroupEnd_inner_dirsum_el_decomp_nth <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span> <span class="main">∈</span> set <span class="free">Gs</span><span class="main">.</span> AbGroup <span class="bound">G</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="free">Gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">Gs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"GroupEnd <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> grp<span class="main">:</span> <span class="quoted"><span class="quoted">"Group <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AbGroup_inner_dirsum AbGroup.axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupHom_axioms <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span> <span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> supp_restrict0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AbGroup_inner_dirsum_el_decomp_plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span>case_prod <span class="main">(+)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> concat_map_split_eq_map_split_zip <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms xy
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="main">(</span>zip <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">←</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AbGroup_length_inner_dirsum_el_decomp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Gs</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
            AbGroup_length_inner_dirsum_el_decomp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Gs</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy assms<span class="main">(</span>1<span class="main">)</span> AbGroup_inner_dirsum
            AbGroup.add_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupEnd_axioms <span class="main">(</span><span class="main">⨁</span><span class="bound">G</span><span class="main">←</span><span class="free">Gs</span><span class="main">.</span> <span class="bound">G</span><span class="main">)</span> <span class="main">⨁</span><span class="free">Gs</span><span class="main">↓</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms AbGroup_inner_dirsum_el_decomp_nth_onto_nth AbGroup_nth_subset_inner_dirsum
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">unfold_locales</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Rings›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_1<span class="main">)</span> map_times_neg1_eq_map_uminus <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="bound">r</span><span class="main">.</span> r<span class="main">←</span><span class="free">rs</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">-</span><span class="bound">r</span><span class="main">.</span> r<span class="main">←</span><span class="free">rs</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> map_eq_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locale and basic facts›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Define a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Ring1›</span></span></span></span> to be a multiplicatively closed additive subgroup of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for
        the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ring_1›</span></span></span></span> class.›</span></span>

<span class="comment1">(* Don't need to use AbGroup for R because ring_1 already assumes add_commute *)</span>
<span class="keyword1"><span class="command">locale</span></span> Ring1 <span class="main">=</span> Group <span class="quoted"><span class="free">R</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 set"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> one_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     mult_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup"><span class="command">lemma</span></span> AbGroup <span class="main">:</span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ring1_axioms Ring1.axioms<span class="main">(</span>1<span class="main">)</span> AbGroup.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemmas</span></span> zero_closed         <span class="main">=</span> zero_closed
<span class="keyword1"><span class="command">lemmas</span></span> add_closed          <span class="main">=</span> add_closed
<span class="keyword1"><span class="command">lemmas</span></span> neg_closed          <span class="main">=</span> neg_closed
<span class="keyword1"><span class="command">lemmas</span></span> diff_closed         <span class="main">=</span> diff_closed
<span class="keyword1"><span class="command">lemmas</span></span> zip_add_closed      <span class="main">=</span> zip_add_closed
<span class="keyword1"><span class="command">lemmas</span></span> sum_closed       <span class="main">=</span> AbGroup.sum_closed<span class="main">[</span><span class="operator">OF</span> AbGroup<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> sum_list_closed      <span class="main">=</span> sum_list_closed
<span class="keyword1"><span class="command">lemmas</span></span> sum_list_closed_prod <span class="main">=</span> sum_list_closed_prod
<span class="keyword1"><span class="command">lemmas</span></span> list_diff_closed    <span class="main">=</span> list_diff_closed

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Subring1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Subring1</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> Ring1 <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Subring1D1"><span class="command">lemma</span></span> Subring1D1 <span class="main">:</span> <span class="quoted"><span class="quoted">"Subring1 <span class="free">S</span> <span class="main">⟹</span> Ring1 <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Ring1 *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_1<span class="main">)</span> full_Ring1 <span class="main">:</span> <span class="quoted"><span class="quoted">"Ring1 UNIV"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The group ring›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definition and basic facts›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Realize the group ring as the set of almost-every-zero functions from group to ring. One can
  recover the usual notion of group ring element by considering such a function to send group
  elements to their coefficients. Here the codomain of such functions is not restricted to some
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Ring1›</span></span></span></span> subset since we will not be interested in having the ability to change the ring of
  scalars for a group ring.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> Group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">group_ring</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>zero<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">group_ring</span> <span class="main">≡</span> aezfun_setspan <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> group_ringD <span class="main">=</span> aezfun_setspan_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-RG_one_closed"><span class="command">lemma</span></span> RG_one_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>zero_neq_one<span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun<span class="main">)</span> <span class="main">∈</span> group_ring"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun<span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> supp_aezfun1 zeroS_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> group_ringD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RG_zero_closed"><span class="command">lemma</span></span> RG_zero_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>zero<span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun<span class="main">)</span> <span class="main">∈</span> group_ring"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aezfun <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'g</span><span class="main">⇒</span><span class="tfree">'r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_aezfun.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun<span class="main">)</span><span class="main">)</span> <span class="main">=</span> supp <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'g</span><span class="main">⇒</span><span class="tfree">'r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'g</span><span class="main">⇒</span><span class="tfree">'r</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> supp_zerofun_subset_any <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> group_ringD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RG_n0"><span class="command">lemma</span></span> RG_n0 <span class="main">:</span> <span class="quoted"><span class="quoted">"group_ring <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>zero_neq_one<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RG_one_closed zero_neq_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-RG_mult_closed"><span class="command">lemma</span></span> RG_mult_closed <span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> RG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">RG</span> <span class="main">≡</span> group_ring <span class="main">::</span> <span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">RG</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">RG</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">RG</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   RG supp_aezfun_times<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
          set_plus_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="free">y</span><span class="main">)</span>"</span></span><span class="main">]</span>
          group_ringD
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">blast</span>

<span class="keyword1" id="Rep_Fin_Groups-Ring1_RG"><span class="command">lemma</span></span> Ring1_RG <span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> RG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">RG</span> <span class="main">≡</span> group_ring <span class="main">::</span> <span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Ring1 <span class="free">RG</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> RG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">RG</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> <span class="free">RG</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">RG</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">RG</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">RG</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RG_one_closed RG_mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">RG</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">RG</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> RG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">RG</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> supp_aezfun_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> group_ringD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RG_aezdeltafun_closed"><span class="command">lemma</span></span> RG_aezdeltafun_closed <span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> RG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">RG</span> <span class="main">≡</span> group_ring <span class="main">::</span> <span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">RG</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> supp<span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> supp <span class="main">(</span><span class="free">r</span> <span class="keyword1">δ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aezdeltafun arg_cong<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"supp"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>aezfun <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> supp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> supp_delta0fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> assms supp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> supp_deltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> RG <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> group_ringD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RG_aezdelta0fun_closed"><span class="command">lemma</span></span> RG_aezdelta0fun_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">::</span><span class="tfree">'r</span><span class="main">::</span>ring_1<span class="main">)</span> <span class="keyword1">δδ</span> <span class="main">0</span> <span class="main">∈</span> group_ring"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_closed RG_aezdeltafun_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-RG_sum_list_rddg_closed"><span class="command">lemma</span></span> RG_sum_list_rddg_closed <span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> RG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">RG</span> <span class="main">≡</span> group_ring <span class="main">::</span> <span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map snd <span class="free">rgs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span><span class="free">rgs</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∈</span> <span class="free">RG</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Ring1.sum_list_closed_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> RG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ring1 <span class="free">RG</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ring1_RG <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map <span class="main">(</span>case_prod aezdeltafun<span class="main">)</span> <span class="free">rgs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">RG</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RG_aezdeltafun_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> RG_el_decomp_aezdeltafun <span class="main">=</span> aezfun_setspan_el_decomp_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-Subgroup_imp_Subring"><span class="command">lemma</span></span> Subgroup_imp_Subring <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">H</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">FH</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>ring_1<span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">FG</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">FH</span> <span class="main">≡</span> Group.group_ring <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">FG</span> <span class="main">≡</span> group_ring"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Subgroup <span class="free">H</span> <span class="main">⟹</span> Ring1.Subring1 <span class="free">FG</span> <span class="free">FH</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   assms Group.Ring1_RG Group.RG_el_decomp_aezdeltafun RG_sum_list_rddg_closed
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Group *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FinGroup<span class="main">)</span> group_ring_spanning_set <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gs</span><span class="main">.</span> distinct <span class="bound">gs</span> <span class="main">∧</span> set <span class="bound">gs</span> <span class="main">=</span> <span class="free">G</span>
        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span><span class="main">∈</span> <span class="main">(</span>group_ring <span class="main">::</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>semiring_1<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set<span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">bs</span><span class="main">.</span>
          length <span class="bound">bs</span> <span class="main">=</span> length <span class="bound">gs</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">bs</span> <span class="bound">gs</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>     finite aezfun_common_supp_spanning_set_decomp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> group_ringD
  <span class="keyword1"><span class="command">by</span></span>        <span class="operator">fast</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Projecting almost-everywhere-zero functions onto a group ring›</span></span>

<span class="keyword1"><span class="command">context</span></span> Group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">RG_proj</span> <span class="main">≡</span> aezfun_setspan_proj <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> RG_proj_in_RG        <span class="main">=</span> aezfun_setspan_proj_in_setspan
<span class="keyword1"><span class="command">lemmas</span></span> RG_proj_sum_list_prod <span class="main">=</span> aezfun_setspan_proj_sum_list_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-RG_proj_mult_leftdelta'"><span class="command">lemma</span></span> RG_proj_mult_leftdelta' <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">r</span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> RG_proj <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">δδ</span> <span class="free">g'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span> <span class="main">*</span> RG_proj <span class="main">(</span><span class="free">s</span> <span class="keyword1">δδ</span> <span class="free">g'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   add_closed add_closed_inverse_right times_aezdeltafun_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
          aezfun_setspan_proj_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">*</span><span class="free">s</span>"</span></span><span class="main">]</span>
          aezfun_setspan_proj_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-RG_proj_mult_leftdelta"><span class="command">lemma</span></span> RG_proj_mult_leftdelta <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RG_proj <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span> <span class="main">*</span> RG_proj <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>                                                                                
  <span class="keyword1"><span class="command">from</span></span> aezfun_decomp_aezdeltafun <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rgs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> rgs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">rgs</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RG_el_decomp_aezdeltafun
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"RG_proj <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">rgs</span><span class="main">.</span> RG_proj <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_list_const_mult_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span>"</span></span><span class="main">]</span> RG_proj_sum_list_prod
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms rgs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main">*</span> RG_proj <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RG_proj_mult_leftdelta'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
          sum_list_const_mult_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">h</span><span class="main">.</span> RG_proj <span class="main">(</span><span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span><span class="main">]</span>
          RG_proj_sum_list_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span>"</span></span> <span class="quoted"><span class="skolem">rgs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RG_proj_mult_rightdelta'"><span class="command">lemma</span></span> RG_proj_mult_rightdelta' <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">r</span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RG_proj <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">δδ</span> <span class="free">g'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> RG_proj <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">δδ</span> <span class="free">g'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   assms times_aezdeltafun_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
          aezfun_setspan_proj_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">*</span><span class="free">s</span>"</span></span><span class="main">]</span>
          add_closed add_closed_inverse_left aezfun_setspan_proj_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-RG_proj_mult_rightdelta"><span class="command">lemma</span></span> RG_proj_mult_rightdelta <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RG_proj <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>RG_proj <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> aezfun_decomp_aezdeltafun <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rgs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> rgs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">rgs</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RG_el_decomp_aezdeltafun
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"RG_proj <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">rgs</span><span class="main">.</span> RG_proj <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_list_mult_const_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span>"</span></span> <span class="quoted"><span class="skolem">rgs</span></span><span class="main">]</span> RG_proj_sum_list_prod
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms rgs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> RG_proj_mult_rightdelta'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
          sum_list_prod_cong<span class="main">[</span><span class="operator">of</span>
            <span class="quoted"><span class="skolem">rgs</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">h</span><span class="main">.</span> RG_proj <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">h</span><span class="main">.</span> RG_proj <span class="main">(</span><span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
          <span class="main">]</span>
          sum_list_mult_const_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">h</span><span class="main">.</span> RG_proj <span class="main">(</span><span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">rgs</span></span><span class="main">]</span>
          RG_proj_sum_list_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span>"</span></span> <span class="quoted"><span class="skolem">rgs</span></span><span class="main">]</span>
          sum_list_mult_const_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">h</span><span class="main">.</span> RG_proj <span class="main">(</span><span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">rgs</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">g</span>"</span></span><span class="main">]</span>
          RG_proj_sum_list_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">δδ</span> <span class="bound">h</span>"</span></span> <span class="quoted"><span class="skolem">rgs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RG_proj_mult_right"><span class="command">lemma</span></span> RG_proj_mult_right <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>group_ring <span class="main">::</span> <span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set<span class="main">)</span>
        <span class="main">⟹</span> RG_proj <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> RG_proj <span class="free">y</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RG_el_decomp_aezdeltafun sum_list_const_mult_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">g</span>"</span></span><span class="main">]</span>
        RG_proj_sum_list_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">g</span><span class="main">.</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span>"</span></span><span class="main">]</span> RG_proj_mult_rightdelta<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
        sum_list_prod_cong<span class="main">[</span>
          <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">g</span><span class="main">.</span> RG_proj <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">g</span><span class="main">.</span> RG_proj <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
        <span class="main">]</span>
        sum_list_const_mult_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"RG_proj <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">g</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Group *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Modules›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Locales and basic facts›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locales›</span></span>

<span class="keyword1"><span class="command">locale</span></span> scalar_mult <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> R_scalar_mult <span class="main">=</span> scalar_mult <span class="quoted"><span class="free">smult</span></span> <span class="main">+</span> Ring1 <span class="quoted"><span class="free">R</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> scalar_mult<span class="main">)</span> R_scalar_mult <span class="main">:</span> <span class="quoted"><span class="quoted">"R_scalar_mult UNIV"</span></span>
  <span class="keyword1"><span class="command">using</span></span> full_Ring1 R_scalar_mult.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> R_scalar_mult<span class="main">)</span> Ring1 <span class="main">:</span> <span class="quoted"><span class="quoted">"Ring1 <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">locale</span></span> RModule <span class="main">=</span> R_scalars<span class="main">?</span><span class="main">:</span> R_scalar_mult <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="main">+</span> VecGroup<span class="main">?</span><span class="main">:</span> Group <span class="quoted"><span class="free">M</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> smult_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> smult_distrib_left  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span>
                                          <span class="main">⟹</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> smult_distrib_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span>
                                          <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">+</span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> smult_assoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span>
                                  <span class="main">⟹</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">*</span> <span class="free">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> one_smult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> RModuleI <span class="main">=</span> RModule.intro<span class="main">[</span><span class="operator">OF</span> R_scalar_mult.intro<span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> Module <span class="main">=</span> RModule <span class="quoted">UNIV</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">M</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> ModuleI <span class="main">=</span> RModuleI<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">,</span> <span class="operator">OF</span> full_Ring1<span class="main">,</span> <span class="operator">THEN</span> Module.intro<span class="main">]</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-trivial_RModule"><span class="command">lemma</span></span> trivial_RModule <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ring1 <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">∈</span><span class="free">R</span><span class="main">.</span> <span class="free">smult</span> <span class="bound">r</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'m</span><span class="main">::</span>ab_group_add<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RModule <span class="free">R</span> <span class="free">smult</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'m</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModuleI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> trivial_Group<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'m</span> set<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> rsmn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rsmn<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> Z_def assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> rsmn<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> Z_def assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> rsmn<span class="main">(</span>1-3<span class="main">)</span> Z_def assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ring1.add_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> rsmn<span class="main">(</span>1-3<span class="main">)</span> Z_def assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ring1.mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'m</span> set<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> Z_def assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ring1.one_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> RModule
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">RSubmodule</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">RSubmodule</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">≡</span> RModule <span class="free">R</span> <span class="free">smult</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Group"><span class="command">lemma</span></span> Group <span class="main">:</span> <span class="quoted"><span class="quoted">"Group <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RModule_axioms RModule.axioms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-Subgroup_RSubmodule"><span class="command">lemma</span></span> Subgroup_RSubmodule <span class="main">:</span> <span class="quoted"><span class="quoted">"RSubmodule <span class="free">N</span> <span class="main">⟹</span> Subgroup <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RModule.Group <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-AbGroup"><span class="command">lemma</span></span> AbGroup <span class="main">:</span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> AbGroup.intro Group <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemmas</span></span> zero_closed     <span class="main">=</span> zero_closed
<span class="keyword1"><span class="command">lemmas</span></span> diff_closed     <span class="main">=</span> diff_closed
<span class="keyword1"><span class="command">lemmas</span></span> set_plus_closed <span class="main">=</span> set_plus_closed
<span class="keyword1"><span class="command">lemmas</span></span> sum_closed   <span class="main">=</span> AbGroup.sum_closed<span class="main">[</span><span class="operator">OF</span> AbGroup<span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-map_smult_closed"><span class="command">lemma</span></span> map_smult_closed <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> set <span class="main">(</span>map <span class="main">(</span><span class="main"><span class="free">(⋅)</span></span> <span class="free">r</span><span class="main">)</span> <span class="free">ms</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> smult_closed <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-zero_smult"><span class="command">lemma</span></span> zero_smult <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> R_scalars.zero_closed smult_distrib_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> add_left_imp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-smult_zero"><span class="command">lemma</span></span> smult_zero <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_closed smult_distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-neg_smult"><span class="command">lemma</span></span> neg_smult <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> R_scalars.neg_closed smult_distrib_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">r</span>"</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span>
        zero_smult minus_unique<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-neg_eq_neg1_smult"><span class="command">lemma</span></span> neg_eq_neg1_smult <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">=</span> <span class="main">-</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> one_closed neg_smult one_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-smult_neg"><span class="command">lemma</span></span> smult_neg <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> neg_eq_neg1_smult one_closed R_scalars.neg_closed smult_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span>
        smult_closed
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-smult_distrib_left_diff"><span class="command">lemma</span></span> smult_distrib_left_diff <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">-</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> neg_closed smult_distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">n</span>"</span></span><span class="main">]</span> smult_neg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-smult_distrib_right_diff"><span class="command">lemma</span></span> smult_distrib_right_diff <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">-</span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> R_scalars.neg_closed smult_distrib_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">s</span>"</span></span><span class="main">]</span> neg_smult
  <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-smult_sum_distrib"><span class="command">lemma</span></span> smult_sum_distrib <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> smult_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> sum_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-sum_smult_distrib"><span class="command">lemma</span></span> sum_smult_distrib <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span> <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> R_scalars.sum_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-smult_sum_list_distrib"><span class="command">lemma</span></span> smult_sum_list_distrib <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>sum_list <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">←</span><span class="free">ms</span><span class="main">.</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> smult_zero sum_list_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted">id</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_prod_map_smult_distrib"><span class="command">lemma</span></span> sum_list_prod_map_smult_distrib <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> set <span class="main">(</span>map <span class="main">(</span>case_prod <span class="free">f</span><span class="main">)</span> <span class="free">xys</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>
        <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free">xys</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_smult R_scalars.sum_list_closed_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xys</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-RSubmoduleI"><span class="command">lemma</span></span> RSubmoduleI <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subgroup <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RSubmodule <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule <span class="free">R</span> <span class="free">smult</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> SubgroupD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">N</span><span class="main">;</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="bound">m</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">+</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> smult_distrib_left
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">s</span> <span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">r</span> <span class="main">+</span> <span class="bound">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">+</span> <span class="bound">s</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> smult_distrib_right
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">s</span> <span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">s</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">=</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> smult_assoc
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">=</span> <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> one_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context RModule *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> R_scalar_mult<span class="main">)</span> listset_RModule_Rsmult_closed <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">M</span><span class="main">∈</span>set <span class="free">Ms</span><span class="main">.</span> RModule <span class="free">R</span> <span class="free">smult</span> <span class="bound">M</span><span class="main">;</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">ms</span> <span class="main">∈</span> listset <span class="free">Ms</span> <span class="main">⟧</span> 
        <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">.</span> m<span class="main">←</span><span class="free">ms</span><span class="main">]</span> <span class="main">∈</span> listset <span class="free">Ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> length <span class="free">ms</span> <span class="main">=</span> length <span class="free">Ms</span><span class="main">;</span> <span class="free">ms</span> <span class="main">∈</span> listset <span class="free">Ms</span><span class="main">;</span>
              <span class="main">∀</span><span class="bound">M</span><span class="main">∈</span>set <span class="free">Ms</span><span class="main">.</span> RModule <span class="free">R</span> <span class="free">smult</span> <span class="bound">M</span><span class="main">;</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟧</span>
                <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">.</span> m<span class="main">←</span><span class="free">ms</span><span class="main">]</span> <span class="main">∈</span> listset <span class="free">Ms</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span> <span class="quoted"><span class="free">Ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span> <span class="skolem">M</span> <span class="skolem">Ms</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> listset_ConsD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> RModule.smult_closed listset_ConsI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">M</span><span class="main">∈</span>set <span class="free">Ms</span><span class="main">.</span> RModule <span class="free">R</span> <span class="free">smult</span> <span class="bound">M</span><span class="main">;</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">ms</span> <span class="main">∈</span> listset <span class="free">Ms</span> <span class="main">⟧</span> 
              <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">.</span> m<span class="main">←</span><span class="free">ms</span><span class="main">]</span> <span class="main">∈</span> listset <span class="free">Ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> listset_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ms</span></span> <span class="quoted"><span class="free">Ms</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> Module
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Submodule</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Submodule</span> <span class="main">≡</span> RModule.RSubmodule UNIV <span class="free">smult</span> <span class="free">M</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> AbGroup    <span class="main">=</span> AbGroup
<span class="keyword1"><span class="command">lemmas</span></span> SubmoduleI <span class="main">=</span> RSubmoduleI

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Module *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Module and submodule instances›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> R_scalar_mult<span class="main">)</span> trivial_RModule <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> RModule <span class="free">R</span> <span class="free">smult</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> trivial_Group add_closed mult_closed one_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> RModule
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-trivial_RSubmodule"><span class="command">lemma</span></span> trivial_RSubmodule <span class="main">:</span> <span class="quoted"><span class="quoted">"RSubmodule <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zeroS_closed smult_zero trivial_RModule <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-RSubmodule_set_plus"><span class="command">lemma</span></span> RSubmodule_set_plus <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"RSubmodule <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"RSubmodule <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RSubmodule <span class="main">(</span><span class="free">L</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RSubmoduleI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Group <span class="main">(</span><span class="free">L</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModule.AbGroup AbGroup_set_plus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">L</span></span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> AbGroup.axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">+</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Group Group.set_plus_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Subgroup <span class="main">(</span><span class="free">L</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> rx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">L</span> <span class="main">+</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rx<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_plus_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">L</span></span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> assms rx<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">L</span> <span class="main">+</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModule.smult_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">L</span></span><span class="main">]</span> RModule.smult_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span>
          smult_distrib_left set_plus_def
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSubmodule_sum_list"><span class="command">lemma</span></span> RSubmodule_sum_list <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">N</span><span class="main">∈</span>set <span class="free">Ns</span><span class="main">.</span> RSubmodule <span class="bound">N</span><span class="main">)</span> <span class="main">⟹</span> RSubmodule <span class="main">(</span><span class="main">∑</span><span class="bound">N</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> trivial_RSubmodule RSubmodule_set_plus
  <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Ns</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-RSubmodule_inner_dirsum"><span class="command">lemma</span></span> RSubmodule_inner_dirsum <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">N</span><span class="main">∈</span>set <span class="free">Ns</span><span class="main">.</span> RSubmodule <span class="bound">N</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RSubmodule <span class="main">(</span><span class="main">⨁</span><span class="bound">N</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"add_independentS <span class="free">Ns</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> RSubmodule_sum_list inner_dirsumD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_dirsumD2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Ns</span></span><span class="main">]</span> trivial_RSubmodule <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RModule_inner_dirsum"><span class="command">lemma</span></span> RModule_inner_dirsum <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">N</span><span class="main">∈</span>set <span class="free">Ns</span><span class="main">.</span> RSubmodule <span class="bound">N</span><span class="main">)</span> <span class="main">⟹</span> RModule <span class="free">R</span> <span class="free">smult</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">N</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSubmodule_inner_dirsum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-SModule_restrict_scalars"><span class="command">lemma</span></span> SModule_restrict_scalars <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subring1 <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RModule <span class="free">S</span> <span class="free">smult</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModuleI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Subring1D1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Group<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="bound">m</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">+</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">n</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">=</span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_closed smult_distrib_left
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms
    <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">s</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">r</span> <span class="main">+</span> <span class="bound">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">+</span> <span class="bound">s</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ring1.add_closed smult_distrib_right
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms
    <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">s</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">s</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">=</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ring1.mult_closed smult_assoc
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context RModule *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Linear algebra in modules›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Linear combinations: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>lincomb›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">context</span></span> scalar_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lincomb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> list <span class="main">⇒</span> <span class="tfree">'m</span> list <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∙⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">rs</span></span></span> <span class="main"><span class="free">∙⋅</span></span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">m</span><span class="main">)</span><span class="main">←</span>zip <span class="free"><span class="bound"><span class="entity">rs</span></span></span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">.</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>zip›</span></span></span></span> will truncate if lengths of coefficient and vector lists differ.›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_Nil"><span class="command">lemma</span></span> lincomb_Nil <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_singles"><span class="command">lemma</span></span> lincomb_singles <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_Cons"><span class="command">lemma</span></span> lincomb_Cons <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">#</span> <span class="free">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">m</span> <span class="main">#</span> <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">+</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_append"><span class="command">lemma</span></span> lincomb_append <span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">rs</span> <span class="main">=</span> length <span class="free">ms</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">rs</span><span class="main">@</span><span class="free">ss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">ms</span><span class="main">@</span><span class="free">ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">+</span> <span class="free">ss</span> <span class="main">∙⋅</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_append_left"><span class="command">lemma</span></span> lincomb_append_left <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">rs</span> <span class="main">@</span> <span class="free">ss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">+</span> <span class="free">ss</span> <span class="main">∙⋅</span> drop <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zip_append_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ss</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_append_right"><span class="command">lemma</span></span> lincomb_append_right <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">rs</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">ms</span><span class="main">@</span><span class="free">ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">+</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="free">ms</span><span class="main">)</span> <span class="free">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ns</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zip_append_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_conv_take_right"><span class="command">lemma</span></span> lincomb_conv_take_right <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">rs</span> <span class="main">∙⋅</span> take <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_Nil lincomb_Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context scalar_mult *)</span>

<span class="keyword1"><span class="command">context</span></span> RModule
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> lincomb_Nil  <span class="main">=</span> lincomb_Nil
<span class="keyword1"><span class="command">lemmas</span></span> lincomb_Cons <span class="main">=</span> lincomb_Cons

<span class="keyword1" id="Rep_Fin_Groups-lincomb_closed"><span class="command">lemma</span></span> lincomb_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">rs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Nil zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> Cons1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="skolem">ms</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Nil zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword1"><span class="command">with</span></span> Cons1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_Cons smult_closed add_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-smult_lincomb"><span class="command">lemma</span></span> smult_lincomb <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">s</span><span class="main">*</span><span class="bound">r</span><span class="main">.</span> r<span class="main">←</span><span class="free">rs</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_Nil smult_zero lincomb_Cons smult_closed lincomb_closed
  <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-neg_lincomb"><span class="command">lemma</span></span> neg_lincomb <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">-</span> <span class="main">(</span><span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">-</span><span class="bound">r</span><span class="main">.</span> r<span class="main">←</span><span class="free">rs</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_closed neg_eq_neg1_smult one_closed R_scalars.neg_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
        smult_lincomb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> map_times_neg1_eq_map_uminus
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_sum_left"><span class="command">lemma</span></span> lincomb_sum_left <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span> set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">;</span> length <span class="free">rs</span> <span class="main">≤</span> length <span class="free">ss</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="main">[</span><span class="bound">r</span> <span class="main">+</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>r<span class="main">,</span>s<span class="main">)</span><span class="main">←</span>zip <span class="free">rs</span> <span class="free">ss</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">+</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ss</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">r</span> <span class="skolem">rs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ms</span><span class="main">.</span> length <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">[]</span>
              <span class="main">⟹</span> <span class="main">[</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">[]</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="bound">ms</span>
                <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="bound">ms</span> <span class="main">+</span> <span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="bound">ms</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">r</span> <span class="skolem">rs</span> <span class="skolem">s</span> <span class="skolem">ss</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="skolem">ms</span>
              <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="skolem">ms</span> <span class="main">+</span> <span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="skolem">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_Nil lincomb_Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_sum"><span class="command">lemma</span></span> lincomb_sum <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">rs</span> <span class="main">≤</span> length <span class="free">ss</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">+</span> <span class="free">ss</span> <span class="main">∙⋅</span> <span class="free">ms</span>
                <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="free">rs</span> <span class="free">ss</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="skolem"><span class="skolem">fss</span></span> <span class="skolem"><span class="skolem">bss</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">[</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="free">rs</span> <span class="free">ss</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fss</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="free">ss</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bss</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="free">ss</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> zs_def fss_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">zs</span> <span class="main">=</span> length <span class="free">rs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">fss</span> <span class="main">=</span> length <span class="free">rs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> length_concat_map_split_zip<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span>"</span></span> <span class="quoted"><span class="free">rs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">zs</span> <span class="main">@</span> <span class="skolem">bss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">fss</span> <span class="main">@</span> <span class="skolem">bss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> zs_def fss_def lincomb_sum_left lincomb_append_left
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fss_def bss_def zs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_diff_left"><span class="command">lemma</span></span> lincomb_diff_left <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span> set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">;</span> length <span class="free">rs</span> <span class="main">≤</span> length <span class="free">ss</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="main">[</span><span class="bound">r</span> <span class="main">-</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>r<span class="main">,</span>s<span class="main">)</span><span class="main">←</span>zip <span class="free">rs</span> <span class="free">ss</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">-</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ss</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">r</span> <span class="skolem">rs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ms</span><span class="main">.</span> length <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">[]</span>
              <span class="main">⟹</span> <span class="main">[</span><span class="bound">a</span> <span class="main">-</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">[]</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="bound">ms</span>
                <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="bound">ms</span> <span class="main">-</span> <span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="bound">ms</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">r</span> <span class="skolem">rs</span> <span class="skolem">s</span> <span class="skolem">ss</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">a</span><span class="main">-</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="skolem">ms</span>
              <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="skolem">ms</span> <span class="main">-</span> <span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="skolem">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_Nil lincomb_Cons smult_distrib_right_diff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_replicate_left"><span class="command">lemma</span></span> lincomb_replicate_left <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">(</span>replicate <span class="free">k</span> <span class="free">r</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span> <span class="main">∑</span><span class="bound">m</span><span class="main">←</span><span class="main">(</span>take <span class="free">k</span> <span class="free">ms</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Nil smult_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Nil smult_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span> <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_Cons set_take_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">]</span> sum_list_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted">id</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_replicate0_left"><span class="command">lemma</span></span> lincomb_replicate0_left <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">(</span>replicate <span class="free">k</span> <span class="main">0</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> ms<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>replicate <span class="free">k</span> <span class="main">0</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">0</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">←</span><span class="main">(</span>take <span class="free">k</span> <span class="free">ms</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> R_scalars.zero_closed lincomb_replicate_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">←</span><span class="main">(</span>take <span class="free">k</span> <span class="free">ms</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_take_subset sum_list_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>replicate <span class="free">k</span> <span class="main">0</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_0coeffs"><span class="command">lemma</span></span> lincomb_0coeffs <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">s</span><span class="main">∈</span>set <span class="free">rs</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_Nil lincomb_Cons zero_smult
  <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-delta_scalars_lincomb_eq_nth"><span class="command">lemma</span></span> delta_scalars_lincomb_eq_nth <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">ms</span>
        <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>replicate <span class="main">(</span>length <span class="free">ms</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">[</span><span class="free">n</span> <span class="main">:=</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">ms</span><span class="main">!</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_Cons lincomb_replicate0_left zero_smult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_obtain_same_length_Rcoeffs"><span class="command">lemma</span></span> lincomb_obtain_same_length_Rcoeffs <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span>
        <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ss</span><span class="main">.</span> set <span class="bound">ss</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">ss</span> <span class="main">=</span> length <span class="free">ms</span>
          <span class="main">∧</span> take <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="bound">ss</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">ms</span><span class="main">)</span> <span class="free">rs</span> <span class="main">∧</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="bound">ss</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span> <span class="main">=</span> replicate <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">ms</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>2<span class="main">)</span> ss_def
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ss</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_scalars.zero_closed lincomb_Nil
          lincomb_replicate0_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">ms</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">r</span> <span class="skolem">rs</span> <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ss</span> <span class="main">=</span> length <span class="skolem">ms</span>"</span></span>
              <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="skolem">rs</span><span class="main">)</span> <span class="skolem">ss</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">ms</span><span class="main">)</span> <span class="skolem">rs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="skolem">ms</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">∙⋅</span> <span class="skolem">ms</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span>  <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>2<span class="main">)</span> ss <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>length <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_Cons
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_concat"><span class="command">lemma</span></span> lincomb_concat <span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">rs</span> <span class="bound">ms</span><span class="main">.</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="bound">ms</span><span class="main">)</span> <span class="free">rss</span> <span class="free">mss</span>
        <span class="main">⟹</span> <span class="main">(</span>concat <span class="free">rss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span>concat <span class="free">mss</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">rs</span><span class="main">,</span><span class="bound">ms</span><span class="main">)</span><span class="main">←</span>zip <span class="free">rss</span> <span class="free">mss</span><span class="main">.</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="bound">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_Nil lincomb_append <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rss</span></span> <span class="quoted"><span class="free">mss</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_snoc0"><span class="command">lemma</span></span> lincomb_snoc0 <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">as</span><span class="main">@</span><span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">as</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_append_left set_drop_subset lincomb_replicate0_left<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-lincomb_strip_while_0coeffs"><span class="command">lemma</span></span> lincomb_strip_while_0coeffs <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>strip_while <span class="main">(</span><span class="main">(=)</span> <span class="main">0</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">as</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> caseassm<span class="main">:</span> <span class="quoted"><span class="quoted">"strip_while <span class="main">(</span><span class="main">(=)</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">as</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">as</span><span class="main">@</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_snoc0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strip_while <span class="main">(</span><span class="main">(=)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">as</span><span class="main">@</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> caseassm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context RModule *)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Module<span class="main">)</span> lincomb_obtain_same_length_coeffs <span class="main">=</span> lincomb_obtain_same_length_Rcoeffs
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Module<span class="main">)</span> lincomb_concat                    <span class="main">=</span> lincomb_concat

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Spanning: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>RSpan›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Span›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">context</span></span> R_scalar_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">RSpan</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> list <span class="main">⇒</span> <span class="tfree">'m</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">RSpan</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">RSpan</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">|</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">}</span> <span class="main">+</span> <span class="free">RSpan</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_single"><span class="command">lemma</span></span> RSpan_single <span class="main">:</span> <span class="quoted"><span class="quoted">"RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">|</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_0_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">|</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_Cons"><span class="command">lemma</span></span> RSpan_Cons <span class="main">:</span> <span class="quoted"><span class="quoted">"RSpan <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">=</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">+</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpan_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-in_RSpan_obtain_same_length_coeffs"><span class="command">lemma</span></span> in_RSpan_obtain_same_length_coeffs <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> RSpan <span class="free">ms</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="free">ms</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">rs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_plus_def<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"RSpan <span class="skolem">ms</span>"</span></span><span class="main">]</span> lincomb_Cons
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-in_RSpan_Cons_obtain_same_length_coeffs"><span class="command">lemma</span></span> in_RSpan_Cons_obtain_same_length_coeffs <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> RSpan <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">r</span> <span class="bound">rs</span><span class="main">.</span> set <span class="main">(</span><span class="bound">r</span><span class="main">#</span><span class="bound">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="free">ms</span> 
        <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">+</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> RSpan <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RSpan_Cons set_plus_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="bound">rs</span><span class="main">.</span> set <span class="main">(</span><span class="bound">r</span> <span class="main">#</span> <span class="bound">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="free">ms</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">+</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RSpan_single in_RSpan_obtain_same_length_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSpanD_lincomb"><span class="command">lemma</span></span> RSpanD_lincomb <span class="main">:</span>
  <span class="quoted"><span class="quoted">"RSpan <span class="free">ms</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">|</span> <span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="free">ms</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RSpan <span class="free">ms</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">|</span><span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="free">ms</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_RSpan_obtain_same_length_coeffs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">|</span><span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="free">ms</span><span class="main">}</span> <span class="main">⊆</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">|</span><span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span>  <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="free">ms</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">rs</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> rs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> <span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_Nil lincomb_Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">rs</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> rs<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_append"><span class="command">lemma</span></span> RSpan_append <span class="main">:</span> <span class="quoted"><span class="quoted">"RSpan <span class="main">(</span><span class="free">ms</span> <span class="main">@</span> <span class="free">ns</span><span class="main">)</span> <span class="main">=</span> RSpan <span class="free">ms</span> <span class="main">+</span> RSpan <span class="free">ns</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> add_0_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"RSpan <span class="free">ns</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> RSpan_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span><span class="main">@</span><span class="free">ns</span>"</span></span><span class="main">]</span> add.assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context R_scalar_mult *)</span>

<span class="keyword1"><span class="command">context</span></span> scalar_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Span</span> <span class="main">≡</span> R_scalar_mult.RSpan UNIV <span class="free">smult</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Span_append <span class="main">=</span> R_scalar_mult.RSpan_append<span class="main">[</span><span class="operator">OF</span> R_scalar_mult<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> SpanD_lincomb
          <span class="main">=</span> R_scalar_mult.RSpanD_lincomb <span class="main">[</span><span class="operator">OF</span> R_scalar_mult<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> in_Span_obtain_same_length_coeffs
          <span class="main">=</span> R_scalar_mult.in_RSpan_obtain_same_length_coeffs<span class="main">[</span>
              <span class="operator">OF</span> R_scalar_mult<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">smult</span></span>
            <span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context scalar_mult *)</span>

<span class="keyword1"><span class="command">context</span></span> RModule
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_contains_spanset_single"><span class="command">lemma</span></span> RSpan_contains_spanset_single <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">∈</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> one_closed RSpan_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_single_nonzero"><span class="command">lemma</span></span> RSpan_single_nonzero <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpan_contains_spanset_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-Group_RSpan_single"><span class="command">lemma</span></span> Group_RSpan_single <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Group <span class="main">(</span>RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RSpan_contains_spanset_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RSpan_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> smult_distrib_right_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> rs<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">∈</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_scalars.diff_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> RSpan_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Group_RSpan"><span class="command">lemma</span></span> Group_RSpan <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> Group <span class="main">(</span>RSpan <span class="free">ms</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> trivial_Group <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Group <span class="main">(</span>RSpan <span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Group <span class="main">(</span>RSpan <span class="skolem">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Group_RSpan_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> RSpan_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">]</span> AbGroup.intro AbGroup_set_plus AbGroup.axioms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSpanD_lincomb_arb_len_coeffs"><span class="command">lemma</span></span> RSpanD_lincomb_arb_len_coeffs <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> RSpan <span class="free">ms</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">|</span> <span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RSpan <span class="free">ms</span> <span class="main">⊆</span> <span class="main">{</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">|</span> <span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RSpanD_lincomb <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> RSpan <span class="free">ms</span> <span class="main">⊇</span> <span class="main">{</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">|</span> <span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">|</span> <span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> RSpan <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lincomb_Nil Group_RSpan<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span>"</span></span><span class="main">]</span> Group.zero_closed lincomb_Cons
        <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rs</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSpanI_lincomb_arb_len_coeffs"><span class="command">lemma</span></span> RSpanI_lincomb_arb_len_coeffs <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpanD_lincomb_arb_len_coeffs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_contains_RSpans_Cons_left"><span class="command">lemma</span></span> RSpan_contains_RSpans_Cons_left <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊆</span> RSpan <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpan_Cons Group_RSpan AbGroup.intro AbGroup.subset_plus_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_contains_RSpans_Cons_right"><span class="command">lemma</span></span> RSpan_contains_RSpans_Cons_right <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> RSpan <span class="free">ms</span> <span class="main">⊆</span> RSpan <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpan_Cons Group_RSpan_single AbGroup.intro AbGroup.subset_plus_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_contains_RSpans_append_left"><span class="command">lemma</span></span> RSpan_contains_RSpans_append_left <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ns</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> RSpan <span class="free">ms</span> <span class="main">⊆</span> RSpan <span class="main">(</span><span class="free">ms</span><span class="main">@</span><span class="free">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpan_append Group_RSpan AbGroup.intro AbGroup.subset_plus_left
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_contains_spanset"><span class="command">lemma</span></span> RSpan_contains_spanset <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> set <span class="free">ms</span> <span class="main">⊆</span> RSpan <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> RSpan_contains_spanset_single
          RSpan_contains_RSpans_Cons_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ms</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span>
          RSpan_contains_RSpans_Cons_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_contains_spanset_append_left"><span class="command">lemma</span></span> RSpan_contains_spanset_append_left <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> set <span class="free">ns</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> set <span class="free">ms</span> <span class="main">⊆</span> RSpan <span class="main">(</span><span class="free">ms</span><span class="main">@</span><span class="free">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpan_contains_spanset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">ms</span><span class="main">@</span><span class="free">ns</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_contains_spanset_append_right"><span class="command">lemma</span></span> RSpan_contains_spanset_append_right <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> set <span class="free">ns</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> set <span class="free">ns</span> <span class="main">⊆</span> RSpan <span class="main">(</span><span class="free">ms</span><span class="main">@</span><span class="free">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpan_contains_spanset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">ms</span><span class="main">@</span><span class="free">ns</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_zero_closed"><span class="command">lemma</span></span> RSpan_zero_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Group_RSpan Group.zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_single_closed"><span class="command">lemma</span></span> RSpan_single_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpan_single smult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_closed"><span class="command">lemma</span></span> RSpan_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> RSpan <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> RSpan_single_closed RSpan_Cons Group Group.set_plus_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_smult_closed"><span class="command">lemma</span></span> RSpan_smult_closed <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">n</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RSpanD_lincomb_arb_len_coeffs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_lincomb<span class="main">[</span><span class="operator">OF</span> rs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> mult_closed
          RSpanI_lincomb_arb_len_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">*</span><span class="bound">a</span><span class="main">.</span> a<span class="main">←</span><span class="skolem">rs</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_add_closed"><span class="command">lemma</span></span> RSpan_add_closed <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">n'</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="skolem"><span class="skolem">ss</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">rs</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ss</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RSpanD_lincomb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">n'</span> <span class="main">=</span> <span class="main">[</span><span class="bound">r</span> <span class="main">+</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>r<span class="main">,</span>s<span class="main">)</span><span class="main">←</span>zip <span class="skolem">rs</span> <span class="skolem">ss</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_sum_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rs<span class="main">(</span>1<span class="main">)</span> ss<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="bound">r</span> <span class="main">+</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>r<span class="main">,</span>s<span class="main">)</span><span class="main">←</span>zip <span class="skolem">rs</span> <span class="skolem">ss</span><span class="main">]</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_zip_leftD<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">rs</span></span> <span class="quoted"><span class="skolem">ss</span></span><span class="main">]</span> set_zip_rightD<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">rs</span></span> <span class="quoted"><span class="skolem">ss</span></span><span class="main">]</span>  
          R_scalars.add_closed R_scalars.zip_add_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">n'</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> RSpanI_lincomb_arb_len_coeffs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_lincomb_closed"><span class="command">lemma</span></span> RSpan_lincomb_closed <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">;</span> set <span class="free">ns</span> <span class="main">⊆</span> RSpan <span class="free">ms</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ns</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_Nil RSpan_zero_closed lincomb_Cons RSpan_smult_closed RSpan_add_closed
  <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpanI"><span class="command">lemma</span></span> RSpanI <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">M</span> <span class="main">⊆</span> RSpan <span class="free">ms</span> <span class="main">⟹</span> <span class="free">M</span> <span class="main">=</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpan_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_contains_RSpan_take"><span class="command">lemma</span></span> RSpan_contains_RSpan_take <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> RSpan <span class="main">(</span>take <span class="free">k</span> <span class="free">ms</span><span class="main">)</span> <span class="main">⊆</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> append_take_drop_id set_drop_subset
        RSpan_contains_RSpans_append_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"drop <span class="free">k</span> <span class="free">ms</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-RSubmodule_RSpan_single"><span class="command">lemma</span></span> RSubmodule_RSpan_single <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RSubmodule <span class="main">(</span>RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RSubmoduleI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Subgroup <span class="main">(</span>RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Group_RSpan_single RSpan_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> rn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rn<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RSpan_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> assms rn<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">n</span> <span class="main">∈</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RSpan_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSubmodule_RSpan"><span class="command">lemma</span></span> RSubmodule_RSpan <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> RSubmodule <span class="main">(</span>RSpan <span class="free">ms</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> trivial_RSubmodule <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"RSubmodule <span class="main">(</span>RSpan <span class="main">[</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"RSubmodule <span class="main">(</span>RSpan <span class="skolem">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RSubmodule_RSpan_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> RSpan_Cons RSubmodule_set_plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_RSpan_closed"><span class="command">lemma</span></span> RSpan_RSpan_closed <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> set <span class="free">ns</span> <span class="main">⊆</span> RSpan <span class="free">ms</span> <span class="main">⟹</span> RSpan <span class="free">ns</span> <span class="main">⊆</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpanD_lincomb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ns</span></span><span class="main">]</span> RSpan_lincomb_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-spanset_reduce_Cons"><span class="command">lemma</span></span> spanset_reduce_Cons <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">∈</span> RSpan <span class="free">ms</span> <span class="main">⟹</span> RSpan <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">=</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RSpan_Cons RSpan_RSpan_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ms</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span><span class="main">]</span>
        RSpan_contains_RSpans_Cons_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span>
        RSubmodule_RSpan<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span>
        RModule.set_plus_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="quoted">"RSpan <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"RSpan <span class="free">ms</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-RSpan_replace_hd"><span class="command">lemma</span></span> RSpan_replace_hd <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> RSpan <span class="main">(</span><span class="free">n</span> <span class="main">#</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RSpan <span class="main">(</span><span class="free">m</span> <span class="main">#</span> <span class="free">ms</span><span class="main">)</span> <span class="main">⊆</span> RSpan <span class="main">(</span><span class="free">n</span> <span class="main">#</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> RSpan <span class="main">(</span><span class="free">m</span> <span class="main">#</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">ss</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> r_rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">rs</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">+</span> <span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   s_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ss</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">n</span> <span class="main">+</span> <span class="skolem">ss</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_RSpan_Cons_obtain_same_length_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span>
          in_RSpan_Cons_obtain_same_length_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> r_rs<span class="main">(</span>1<span class="main">)</span> s_ss<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> set1<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="skolem">r</span><span class="main">*</span><span class="bound">a</span><span class="main">.</span> a<span class="main">←</span><span class="skolem">ss</span><span class="main">]</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">#</span> <span class="main">[</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="main">[</span><span class="skolem">r</span><span class="main">*</span><span class="bound">a</span><span class="main">.</span> a<span class="main">←</span><span class="skolem">ss</span><span class="main">]</span> <span class="skolem">rs</span><span class="main">]</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">n</span> <span class="main">#</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> r_rs<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> s_ss<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">r</span><span class="main">*</span><span class="bound">a</span><span class="main">.</span> a<span class="main">←</span><span class="skolem">ss</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">+</span> <span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span>
                  <span class="main">=</span> <span class="main">[</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="main">[</span><span class="skolem">r</span><span class="main">*</span><span class="bound">a</span><span class="main">.</span> a<span class="main">←</span><span class="skolem">ss</span><span class="main">]</span> <span class="skolem">rs</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set1 lincomb_sum
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> r_rs<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> s_ss<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">[</span><span class="skolem">r</span><span class="main">*</span><span class="bound">a</span><span class="main">.</span> a<span class="main">←</span><span class="skolem">ss</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">+</span> <span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> smult_closed lincomb_closed smult_lincomb mult_closed lincomb_sum
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">#</span> <span class="main">[</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="main">[</span><span class="skolem">r</span><span class="main">*</span><span class="bound">a</span><span class="main">.</span> a<span class="main">←</span><span class="skolem">ss</span><span class="main">]</span> <span class="skolem">rs</span><span class="main">]</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> r_rs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="main">[</span><span class="skolem">r</span><span class="main">*</span><span class="bound">a</span><span class="main">.</span> a<span class="main">←</span><span class="skolem">ss</span><span class="main">]</span> <span class="skolem">rs</span><span class="main">]</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> set1 R_scalars.zip_add_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> r_rs<span class="main">(</span>1<span class="main">)</span> s_ss<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> RSpan <span class="main">(</span><span class="free">n</span> <span class="main">#</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> RSpanI_lincomb_arb_len_coeffs<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">#</span><span class="free">ms</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context RModule *)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> scalar_mult<span class="main">)</span>
  Span_Cons <span class="main">=</span> R_scalar_mult.RSpan_Cons<span class="main">[</span><span class="operator">OF</span> R_scalar_mult<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">context</span></span> Module
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> SpanD_lincomb_arb_len_coeffs       <span class="main">=</span> RSpanD_lincomb_arb_len_coeffs
<span class="keyword1"><span class="command">lemmas</span></span> SpanI                              <span class="main">=</span> RSpanI
<span class="keyword1"><span class="command">lemmas</span></span> SpanI_lincomb_arb_len_coeffs       <span class="main">=</span> RSpanI_lincomb_arb_len_coeffs
<span class="keyword1"><span class="command">lemmas</span></span> Span_contains_Spans_Cons_right     <span class="main">=</span> RSpan_contains_RSpans_Cons_right
<span class="keyword1"><span class="command">lemmas</span></span> Span_contains_spanset              <span class="main">=</span> RSpan_contains_spanset
<span class="keyword1"><span class="command">lemmas</span></span> Span_contains_spanset_append_left  <span class="main">=</span> RSpan_contains_spanset_append_left
<span class="keyword1"><span class="command">lemmas</span></span> Span_contains_spanset_append_right <span class="main">=</span> RSpan_contains_spanset_append_right
<span class="keyword1"><span class="command">lemmas</span></span> Span_closed                        <span class="main">=</span> RSpan_closed
<span class="keyword1"><span class="command">lemmas</span></span> Span_smult_closed                  <span class="main">=</span> RSpan_smult_closed
<span class="keyword1"><span class="command">lemmas</span></span> Span_contains_Span_take            <span class="main">=</span> RSpan_contains_RSpan_take
<span class="keyword1"><span class="command">lemmas</span></span> Span_replace_hd                    <span class="main">=</span> RSpan_replace_hd
<span class="keyword1"><span class="command">lemmas</span></span> Submodule_Span                     <span class="main">=</span> RSubmodule_RSpan

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Module *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Finitely generated modules›</span></span>

<span class="keyword1"><span class="command">context</span></span> R_scalar_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">R_fingen</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ms</span><span class="main">.</span> set <span class="bound">ms</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∧</span> RSpan <span class="bound">ms</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Similar to definition of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>card›</span></span></span></span> for finite sets, we default <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>dim›</span></span></span></span> to 0 if no finite
  spanning set exists. Note that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"RSpan <span class="main"><span class="main">[]</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> implies that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">dim_R</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dim_R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dim_R</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> R_fingen <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="keyword1">then</span> <span class="main">(</span>
                <span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ms</span><span class="main">.</span> length <span class="bound">ms</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">∧</span> set <span class="bound">ms</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∧</span> RSpan <span class="bound">ms</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>
              <span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-dim_R_nonzero"><span class="command">lemma</span></span> dim_R_nonzero <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_R <span class="free">M</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dim_R <span class="free">M</span>
              <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ms</span><span class="main">.</span> length <span class="bound">ms</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">∧</span> set <span class="bound">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">∧</span> RSpan <span class="bound">ms</span> <span class="main">=</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dim_R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> M <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> set <span class="main">[]</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">∧</span> RSpan <span class="main">[]</span> <span class="main">=</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context R_scalar_mult *)</span>


<span class="keyword1"><span class="command">hide_const</span></span> real_vector.dim
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Real_Vector_Spaces.dim

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> scalar_mult<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">fingen</span> <span class="main">≡</span> R_scalar_mult.R_fingen UNIV <span class="free">smult</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> scalar_mult<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">dim</span>    <span class="main">≡</span> R_scalar_mult.dim_R UNIV <span class="free">smult</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Module<span class="main">)</span> dim_nonzero <span class="main">=</span> dim_R_nonzero

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">R</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-linear independence›</span></span>

<span class="keyword1"><span class="command">context</span></span> R_scalar_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">R_lin_independent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  R_lin_independent_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R_lin_independent</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  R_lin_independent_Cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">R_lin_independent</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">R_lin_independent</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span>
        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="bound">rs</span><span class="main">.</span> <span class="main">(</span>set <span class="main">(</span><span class="bound">r</span><span class="main">#</span><span class="bound">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">r</span><span class="main">#</span><span class="bound">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_ConsI"><span class="command">lemma</span></span> R_lin_independent_ConsI <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"R_lin_independent <span class="free">ms</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">rs</span><span class="main">.</span> set <span class="main">(</span><span class="bound">r</span><span class="main">#</span><span class="bound">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">r</span><span class="main">#</span><span class="bound">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"R_lin_independent <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   assms R_lin_independent_Cons
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_ConsD1"><span class="command">lemma</span></span> R_lin_independent_ConsD1 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"R_lin_independent <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">⟹</span> R_lin_independent <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_ConsD2"><span class="command">lemma</span></span> R_lin_independent_ConsD2 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> R_lin_independent <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span><span class="main">;</span> set <span class="main">(</span><span class="free">r</span><span class="main">#</span><span class="free">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span> <span class="main">(</span><span class="free">r</span><span class="main">#</span><span class="free">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> 
        <span class="main">⟹</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context R_scalar_mult *)</span>

<span class="keyword1"><span class="command">context</span></span> RModule
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_imp_same_scalars"><span class="command">lemma</span></span> R_lin_independent_imp_same_scalars <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> length <span class="free">rs</span> <span class="main">=</span> length <span class="free">ss</span><span class="main">;</span> length <span class="free">rs</span> <span class="main">≤</span> length <span class="free">ms</span><span class="main">;</span> set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span> set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span>
        set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">;</span> R_lin_independent <span class="free">ms</span><span class="main">;</span> <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="free">ss</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">rs</span> <span class="main">=</span> <span class="free">ss</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ss</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">r</span> <span class="skolem">rs</span> <span class="skolem">s</span> <span class="skolem">ss</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">#</span><span class="skolem">ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neq_Nil_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="main">[</span><span class="bound">a</span><span class="main">-</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ring1 Ring1.list_diff_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">#</span><span class="main">[</span><span class="bound">a</span><span class="main">-</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="skolem">rs</span> <span class="skolem">ss</span><span class="main">]</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">,</span>4-6<span class="main">,</span>8<span class="main">)</span> ms
    <span class="keyword1"><span class="command">have</span></span>  1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">s</span><span class="main">)</span><span class="main">#</span><span class="main">[</span><span class="bound">a</span><span class="main">-</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="skolem">rs</span> <span class="skolem">ss</span><span class="main">]</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">n</span><span class="main">#</span><span class="skolem">ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_diff_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">#</span><span class="skolem">ss</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">-</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>7<span class="main">)</span> ms R_lin_independent_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> 1 Cons<span class="main">(</span>1<span class="main">,</span>4-6<span class="main">)</span> ms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="skolem">ns</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">∙⋅</span> <span class="skolem">ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_Cons zero_smult lincomb_diff_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2-7<span class="main">)</span> ms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">=</span> <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_obtain_unique_scalars"><span class="command">lemma</span></span> R_lin_independent_obtain_unique_scalars <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">;</span> R_lin_independent <span class="free">ms</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> RSpan <span class="free">ms</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="main">(</span><span class="main">∃!</span> <span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="free">ms</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> in_RSpan_obtain_same_length_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span>
        R_lin_independent_imp_same_scalars<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independentI_all_scalars"><span class="command">lemma</span></span> R_lin_independentI_all_scalars <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="free">ms</span> <span class="main">∧</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="main">0</span><span class="main">)</span>
          <span class="main">⟹</span> R_lin_independent <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> R_lin_independent_ConsI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">rs</span><span class="main">.</span> <span class="main">⟦</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="skolem">ms</span><span class="main">;</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="skolem">ms</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rs</span> <span class="keyword3"><span class="command">assume</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">rs</span> <span class="main">=</span> length <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="skolem">ms</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span>
                              <span class="main">=</span> length <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> R_scalars.zero_closed lincomb_Cons zero_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"R_lin_independent <span class="skolem">ms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">rs</span> <span class="keyword3"><span class="command">assume</span></span> r_rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> r_rs<span class="main">(</span>1<span class="main">)</span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ss</span> <span class="main">=</span> length <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="skolem">ms</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">∙⋅</span> <span class="skolem">ms</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_obtain_same_length_Rcoeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">rs</span></span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> r_rs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> r_rs<span class="main">(</span>1<span class="main">)</span> ss<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ss<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independentI_concat_all_scalars"><span class="command">lemma</span></span> R_lin_independentI_concat_all_scalars <span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> eq_len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eq_len</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> length <span class="bound">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>concat <span class="free">mss</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">rss</span><span class="main">.</span> set <span class="main">(</span>concat <span class="bound">rss</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> list_all2 <span class="free">eq_len</span> <span class="bound">rss</span> <span class="free">mss</span>
              <span class="main">⟹</span> <span class="main">(</span>concat <span class="bound">rss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span>concat <span class="free">mss</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">rs</span> <span class="main">∈</span> set <span class="bound">rss</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"R_lin_independent <span class="main">(</span>concat <span class="free">mss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> R_lin_independentI_all_scalars<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">rs</span><span class="main">.</span> <span class="main">⟦</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="main">(</span>concat <span class="free">mss</span><span class="main">)</span><span class="main">;</span> <span class="bound">rs</span> <span class="main">∙⋅</span> concat <span class="free">mss</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span>
              <span class="main">⟹</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rs</span>
    <span class="keyword3"><span class="command">assume</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">rs</span> <span class="main">=</span> length <span class="main">(</span>concat <span class="free">mss</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∙⋅</span> concat <span class="free">mss</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> rs<span class="main">(</span>2<span class="main">)</span> eq_len <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">=</span> concat <span class="skolem">rss</span>"</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">eq_len</span> <span class="skolem">rss</span> <span class="free">mss</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> match_concat <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> rs<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="main">(</span>concat <span class="free">mss</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">rs</span> <span class="main">∙⋅</span> concat <span class="free">mss</span> <span class="main">=</span> <span class="main">0</span>
              <span class="main">⟶</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independentD_all_scalars"><span class="command">lemma</span></span> R_lin_independentD_all_scalars <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span><span class="main">;</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">;</span> length <span class="free">rs</span> <span class="main">≤</span> length <span class="free">ms</span><span class="main">;</span> R_lin_independent <span class="free">ms</span><span class="main">;</span>
        <span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> set <span class="free">rs</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">r</span> <span class="skolem">rs</span> <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>2<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_Cons zero_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independentD_all_scalars_nth"><span class="command">lemma</span></span> R_lin_independentD_all_scalars_nth <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"R_lin_independent <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> min <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="main">(</span>length <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">rs</span><span class="main">!</span><span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ss</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span>
              <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="skolem">ss</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">ms</span><span class="main">)</span> <span class="free">rs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_obtain_same_length_Rcoeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> ss<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_lin_independentD_all_scalars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> ss<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rs</span><span class="main">!</span><span class="free">k</span> <span class="main">=</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="skolem">ss</span><span class="main">)</span><span class="main">!</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> ss<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> length <span class="main">(</span>take <span class="main">(</span>length <span class="free">rs</span><span class="main">)</span> <span class="skolem">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> in_set_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_dependent_dependence_relation"><span class="command">lemma</span></span> R_lin_dependent_dependence_relation <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">¬</span> R_lin_independent <span class="free">ms</span>
        <span class="main">⟹</span> <span class="main">∃</span><span class="bound">rs</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> set <span class="bound">rs</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="free">ms</span> <span class="main">∧</span> <span class="bound">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"R_lin_independent <span class="skolem">ms</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="bound">rs</span><span class="main">.</span> <span class="main">(</span>set <span class="main">(</span><span class="bound">r</span><span class="main">#</span><span class="bound">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">r</span><span class="main">#</span><span class="bound">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span>   <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">rs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> r_rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> r_rs<span class="main">(</span>1<span class="main">)</span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span>  
      <span class="keyword2"><span class="keyword">where</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ss</span> <span class="main">=</span> length <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="skolem">ms</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">∙⋅</span> <span class="skolem">ms</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_obtain_same_length_Rcoeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">rs</span></span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ss r_rs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>
                            <span class="main">∧</span> length <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_Cons
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rs</span></span>  
      <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">rs</span> <span class="main">=</span> length <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="skolem">ms</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> False rs Cons<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∧</span> set <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> length <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ring1.zero_closed<span class="main">[</span><span class="operator">OF</span> Ring1<span class="main">]</span> lincomb_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">rs</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">]</span>
            zero_smult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> empty_set_diff_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_imp_distinct"><span class="command">lemma</span></span> R_lin_independent_imp_distinct <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> R_lin_independent <span class="free">ms</span> <span class="main">⟹</span> distinct <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">ms</span> <span class="main">⟹</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> n<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">n</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> split_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> n<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">#</span> replicate <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">0</span> <span class="main">@</span> <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_Cons lincomb_append lincomb_replicate0_left lincomb_Nil neg_eq_neg1_smult
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> R_scalars.zero_closed one_closed R_scalars.neg_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> one_neq_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_imp_independent_take"><span class="command">lemma</span></span> R_lin_independent_imp_independent_take <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> R_lin_independent <span class="free">ms</span> <span class="main">⟹</span> R_lin_independent <span class="main">(</span>take <span class="free">n</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">n</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">#</span> take <span class="skolem">k</span> <span class="skolem">ms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R_lin_independent <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> take <span class="skolem">k</span> <span class="skolem">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> R_lin_independent_ConsI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"R_lin_independent <span class="main">(</span>take <span class="skolem">k</span> <span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">rs</span> <span class="keyword3"><span class="command">assume</span></span> r_rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span><span class="main">∙⋅</span><span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> take <span class="skolem">k</span> <span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> r_rs<span class="main">(</span>1<span class="main">)</span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ss</span> <span class="main">=</span> length <span class="main">(</span>take <span class="skolem">k</span> <span class="skolem">ms</span><span class="main">)</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∙⋅</span> take <span class="skolem">k</span> <span class="skolem">ms</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">∙⋅</span> take <span class="skolem">k</span> <span class="skolem">ms</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_take_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">]</span> lincomb_obtain_same_length_Rcoeffs
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> r_rs<span class="main">(</span>1<span class="main">)</span> ss<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> r_rs<span class="main">(</span>2<span class="main">)</span> ss <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lincomb_Cons lincomb_Nil
              lincomb_append_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ss</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">k</span> <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"drop <span class="skolem">k</span> <span class="skolem">ms</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_Cons_imp_independent_RSpans"><span class="command">lemma</span></span> R_lin_independent_Cons_imp_independent_RSpans <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"R_lin_independent <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span>RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span><span class="main">,</span> RSpan <span class="free">ms</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_independentS_doubleI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> RSpan <span class="main">[</span><span class="free">m</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> xy<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> r_rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RSpan_single RSpanD_lincomb <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> xy<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms r_rs<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-hd0_imp_R_lin_dependent"><span class="command">lemma</span></span> hd0_imp_R_lin_dependent <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> R_lin_independent <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span> lincomb_Nil<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span> smult_zero one_closed 
        R_lin_independent_Cons
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_imp_hd_n0"><span class="command">lemma</span></span> R_lin_independent_imp_hd_n0 <span class="main">:</span> <span class="quoted"><span class="quoted">"R_lin_independent <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hd0_imp_R_lin_dependent <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_imp_hd_independent_from_RSpan"><span class="command">lemma</span></span> R_lin_independent_imp_hd_independent_from_RSpan <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"R_lin_independent <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∉</span> RSpan <span class="free">ms</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">∈</span> RSpan <span class="free">ms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RSubmodule_RSpan<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ms</span></span><span class="main">]</span>
          RModule.smult_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="quoted">"RSpan <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span>
          one_closed R_scalars.neg_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neg_eq_neg1_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> RSpan_contains_spanset_single assms R_lin_independent_Cons_imp_independent_RSpans
          add_independentS_doubleD R_lin_independent_imp_hd_n0
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_reduce"><span class="command">lemma</span></span> R_lin_independent_reduce <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> R_lin_independent <span class="main">(</span><span class="free">ms</span> <span class="main">@</span> <span class="free">n</span> <span class="main">#</span> <span class="free">ns</span><span class="main">)</span>
                <span class="main">⟹</span> R_lin_independent <span class="main">(</span><span class="free">ms</span> <span class="main">@</span> <span class="free">ns</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">rs</span><span class="main">.</span> set <span class="main">(</span><span class="bound">r</span><span class="main">#</span><span class="bound">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">r</span><span class="main">#</span><span class="bound">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">@</span><span class="free">ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>
                      <span class="main">⟹</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">rs</span> <span class="keyword3"><span class="command">assume</span></span> r_rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">ms</span> <span class="main">@</span> <span class="free">ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> r_rs<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ss</span> <span class="main">=</span> length <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="skolem">ms</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">∙⋅</span> <span class="skolem">ms</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_obtain_same_length_Rcoeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">rs</span></span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms ss<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> r_rs<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">ss</span> <span class="main">@</span> <span class="main">0</span> <span class="main">#</span> drop <span class="main">(</span>length <span class="skolem">ms</span><span class="main">)</span> <span class="skolem">rs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">ms</span> <span class="main">@</span> <span class="free">n</span> <span class="main">#</span> <span class="free">ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_Cons
            lincomb_append_right add.assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main"><span class="free">⋅</span></span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span><span class="main">∙⋅</span><span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">ms</span><span class="main">)</span> <span class="skolem">rs</span><span class="main">)</span><span class="main">∙⋅</span><span class="free">ns</span>"</span></span><span class="main">]</span>
            zero_smult lincomb_append
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> r_rs<span class="main">(</span>1<span class="main">)</span> ss<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">ss</span> <span class="main">@</span> <span class="main">0</span> <span class="main">#</span> drop <span class="main">(</span>length <span class="skolem">ms</span><span class="main">)</span> <span class="skolem">rs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> R_scalars.zero_closed set_drop_subset<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">rs</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>3<span class="main">)</span>
            R_lin_independent_ConsD2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span> <span class="main">@</span> <span class="main">0</span> <span class="main">#</span> drop <span class="main">(</span>length <span class="skolem">ms</span><span class="main">)</span> <span class="skolem">rs</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"R_lin_independent <span class="main">(</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span> <span class="main">@</span> <span class="free">ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_vs_lincomb0"><span class="command">lemma</span></span> R_lin_independent_vs_lincomb0 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ms</span><span class="main">@</span><span class="free">n</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"R_lin_independent <span class="main">(</span><span class="free">ms</span> <span class="main">@</span> <span class="free">n</span> <span class="main">#</span> <span class="free">ns</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">rs</span><span class="main">@</span><span class="free">s</span><span class="main">#</span><span class="free">ss</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">rs</span> <span class="main">=</span> length <span class="free">ms</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">rs</span><span class="main">@</span><span class="free">s</span><span class="main">#</span><span class="free">ss</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">ms</span><span class="main">@</span><span class="free">n</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> length <span class="free">rs</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">rs</span><span class="main">@</span><span class="free">s</span><span class="main">#</span><span class="free">ss</span><span class="main">)</span><span class="main">!</span><span class="skolem">k</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> k_def assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> min <span class="main">(</span>length <span class="main">(</span><span class="free">rs</span><span class="main">@</span><span class="free">s</span><span class="main">#</span><span class="free">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="free">ms</span><span class="main">@</span><span class="free">n</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> R_lin_independentD_all_scalars_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">rs</span><span class="main">@</span><span class="free">s</span><span class="main">#</span><span class="free">ss</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ms</span><span class="main">@</span><span class="free">n</span><span class="main">#</span><span class="free">ns</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-R_lin_independent_append_imp_independent_RSpans"><span class="command">lemma</span></span> R_lin_independent_append_imp_independent_RSpans <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> R_lin_independent <span class="main">(</span><span class="free">ms</span><span class="main">@</span><span class="free">ns</span><span class="main">)</span>
        <span class="main">⟹</span> add_independentS <span class="main">[</span>RSpan <span class="free">ms</span><span class="main">,</span> RSpan <span class="free">ns</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_independentS_doubleI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> RSpan <span class="free">ns</span>"</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> RSpan <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">ms</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> xy<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> x1_x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> RSpan <span class="main">[</span><span class="skolem">m</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> RSpan <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x1</span> <span class="main">+</span> <span class="skolem">x2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RSpan_Cons set_plus_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"RSpan <span class="main">[</span><span class="skolem">m</span><span class="main">]</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> x1_x2<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> xy<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="skolem"><span class="skolem">ss</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> r_rs_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="main">(</span><span class="skolem">rs</span><span class="main">@</span><span class="skolem">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">rs</span> <span class="main">=</span> length <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span>"</span></span>
                     <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> <span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">∙⋅</span> <span class="free">ns</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RSpan_single in_RSpan_obtain_same_length_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x2</span></span> <span class="quoted"><span class="skolem">ms</span></span><span class="main">]</span>
            RSpanD_lincomb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ns</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> x1_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> xy<span class="main">(</span>3<span class="main">)</span> x1_x2<span class="main">(</span>3<span class="main">)</span> r_rs_ss<span class="main">(</span>2-5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="main">(</span><span class="skolem">rs</span><span class="main">@</span><span class="skolem">ss</span><span class="main">)</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="main">(</span><span class="skolem">ms</span><span class="main">@</span><span class="free">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lincomb_append lincomb_Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> r_rs_ss<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> Cons<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> R_lin_independent_ConsD2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span><span class="main">@</span><span class="free">ns</span>"</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span><span class="main">@</span><span class="skolem">ss</span>"</span></span><span class="main">]</span> zero_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> x1_0 xy<span class="main">(</span>3<span class="main">)</span> x1_x2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> xy<span class="main">(</span>1<span class="main">)</span> x1_x2<span class="main">(</span>2<span class="main">)</span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> add_independentS_doubleD <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1_x2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context RModule *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Linear independence over <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>UNIV›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">context</span></span> scalar_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">lin_independent</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span>
                    <span class="main">≡</span> R_scalar_mult.R_lin_independent UNIV <span class="free">smult</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> lin_independent_ConsI
              <span class="main">=</span> R_scalar_mult.R_lin_independent_ConsI <span class="main">[</span><span class="operator">OF</span> R_scalar_mult<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> lin_independent_ConsD1
              <span class="main">=</span> R_scalar_mult.R_lin_independent_ConsD1<span class="main">[</span><span class="operator">OF</span> R_scalar_mult<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context scalar_mult *)</span>

<span class="keyword1"><span class="command">context</span></span> Module
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> lin_independent_imp_independent_take <span class="main">=</span> R_lin_independent_imp_independent_take
<span class="keyword1"><span class="command">lemmas</span></span> lin_independent_reduce               <span class="main">=</span> R_lin_independent_reduce
<span class="keyword1"><span class="command">lemmas</span></span> lin_independent_vs_lincomb0          <span class="main">=</span> R_lin_independent_vs_lincomb0
<span class="keyword1"><span class="command">lemmas</span></span> lin_dependent_dependence_relation    <span class="main">=</span> R_lin_dependent_dependence_relation
<span class="keyword1"><span class="command">lemmas</span></span> lin_independent_imp_distinct         <span class="main">=</span> R_lin_independent_imp_distinct

<span class="keyword1"><span class="command">lemmas</span></span> lin_independent_imp_hd_independent_from_Span
                                                <span class="main">=</span> R_lin_independent_imp_hd_independent_from_RSpan
<span class="keyword1"><span class="command">lemmas</span></span> lin_independent_append_imp_independent_Spans
                                                <span class="main">=</span> R_lin_independent_append_imp_independent_RSpans

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Module *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Rank›</span></span>

<span class="keyword1"><span class="command">context</span></span> R_scalar_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">R_finrank</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">R_finrank</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ms</span><span class="main">.</span> set <span class="bound">ms</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>
              <span class="main">∧</span> R_lin_independent <span class="bound">ms</span> <span class="main">⟶</span> length <span class="bound">ms</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-R_finrankI"><span class="command">lemma</span></span> R_finrankI <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">ms</span><span class="main">.</span> set <span class="bound">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> R_lin_independent <span class="bound">ms</span> <span class="main">⟹</span> length <span class="bound">ms</span> <span class="main">≤</span> <span class="free">n</span><span class="main">)</span> 
        <span class="main">⟹</span> R_finrank <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> R_finrank_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rep_Fin_Groups-R_finrankD"><span class="command">lemma</span></span> R_finrankD <span class="main">:</span>
  <span class="quoted"><span class="quoted">"R_finrank <span class="free">M</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ms</span><span class="main">.</span> set <span class="bound">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">∧</span> R_lin_independent <span class="bound">ms</span> 
        <span class="main">⟶</span> length <span class="bound">ms</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> R_finrank_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-submodule_R_finrank"><span class="command">lemma</span></span> submodule_R_finrank <span class="main">:</span> <span class="quoted"><span class="quoted">"R_finrank <span class="free">M</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> R_finrank <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> R_finrank_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context R_scalar_mult *)</span>

<span class="keyword1"><span class="command">context</span></span> scalar_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">finrank</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">finrank</span> <span class="main">≡</span> R_scalar_mult.R_finrank UNIV <span class="free">smult</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> finrankI <span class="main">=</span> R_scalar_mult.R_finrankI<span class="main">[</span><span class="operator">OF</span> R_scalar_mult<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> finrankD <span class="main">=</span> R_scalar_mult.R_finrankD<span class="main">[</span><span class="operator">OF</span> R_scalar_mult<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> submodule_finrank
              <span class="main">=</span> R_scalar_mult.submodule_R_finrank <span class="main">[</span><span class="operator">OF</span> R_scalar_mult<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context scalar_mult *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Module homomorphisms›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locales›</span></span>

<span class="keyword1"><span class="command">locale</span></span> RModuleHom <span class="main">=</span> Domain<span class="main">?</span><span class="main">:</span> RModule <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">M</span></span>
<span class="main">+</span> Codomain<span class="main">?</span><span class="main">:</span> scalar_mult <span class="quoted"><span class="free">smult'</span></span>
<span class="main">+</span> GroupHom<span class="main">?</span><span class="main">:</span> GroupHom <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'n</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> <span class="main">⇒</span> <span class="tfree">'n</span>"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> R_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="bound">m</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RModuleHom<span class="main">)</span> <span class="entity">lincomb'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> list <span class="main">⇒</span> <span class="tfree">'n</span> list <span class="main">⇒</span> <span class="tfree">'n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∙⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lincomb'</span> <span class="main">≡</span> Codomain.lincomb"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RModule<span class="main">)</span> RModuleHomI <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"GroupHom <span class="free">M</span> <span class="free">T</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">smult'</span> <span class="bound">r</span> <span class="main">(</span><span class="free">T</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RModuleHom <span class="free">R</span> <span class="free">smult</span> <span class="free">M</span> <span class="free">smult'</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span>      <span class="main">(</span>
            <span class="operator">rule</span> RModuleHom.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> RModule_axioms<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
          <span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> RModuleEnd <span class="main">=</span> RModuleHom <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> endomorph<span class="main">:</span> <span class="quoted"><span class="quoted">"ImG <span class="main">⊆</span> <span class="free">M</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> ModuleHom <span class="main">=</span> RModuleHom <span class="quoted">UNIV</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">smult</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'n</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> <span class="main">⇒</span> <span class="tfree">'n</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ModuleHom<span class="main">)</span> hom <span class="main">=</span> hom

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Module<span class="main">)</span> ModuleHomI <span class="main">=</span> RModuleHomI<span class="main">[</span><span class="operator">THEN</span> ModuleHom.intro<span class="main">]</span>

<span class="keyword1"><span class="command">locale</span></span> ModuleEnd <span class="main">=</span> ModuleHom <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> endomorph<span class="main">:</span> <span class="quoted"><span class="quoted">"ImG <span class="main">⊆</span> <span class="free">M</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> RModuleIso <span class="main">=</span> RModuleHom <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>   <span class="free">R</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">smult</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">M</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">smult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'n</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">T</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'m</span> <span class="main">⇒</span> <span class="tfree">'n</span>"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'n</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bijective<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">T</span> <span class="free">M</span> <span class="free">N</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RModule<span class="main">)</span> RModuleIsoI <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"GroupIso <span class="free">M</span> <span class="free">T</span> <span class="free">N</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">smult'</span> <span class="bound">r</span> <span class="main">(</span><span class="free">T</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RModuleIso <span class="free">R</span> <span class="free">smult</span> <span class="free">M</span> <span class="free">smult'</span> <span class="free">T</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModuleIso.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleHom <span class="free">R</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">M</span> <span class="free">smult'</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GroupIso.axioms<span class="main">(</span>1<span class="main">)</span> RModuleHomI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleIso_axioms <span class="free">M</span> <span class="free">T</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GroupIso.bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RModule<span class="main">)</span> trivial_RModuleHom <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">∈</span><span class="free">R</span><span class="main">.</span> <span class="free">smult'</span> <span class="bound">r</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> RModuleHom <span class="free">R</span> <span class="free">smult</span> <span class="free">M</span> <span class="free">smult'</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> trivial_GroupHom RModuleHomI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RModule<span class="main">)</span> RModHom_idhom <span class="main">:</span> <span class="quoted"><span class="quoted">"RModuleHom <span class="free">R</span> <span class="free">smult</span> <span class="free">M</span> <span class="free">smult</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RModule_axioms GroupHom_idhom
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModuleHom.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleHom_axioms <span class="free">R</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">M</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main">(</span>id <span class="main">↓</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> RModuleHom
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> additive        <span class="main">=</span> hom
<span class="keyword1"><span class="command">lemmas</span></span> supp            <span class="main">=</span> supp
<span class="keyword1"><span class="command">lemmas</span></span> im_zero         <span class="main">=</span> im_zero
<span class="keyword1"><span class="command">lemmas</span></span> im_diff         <span class="main">=</span> im_diff
<span class="keyword1"><span class="command">lemmas</span></span> Ker_Im_iff      <span class="main">=</span> Ker_Im_iff
<span class="keyword1"><span class="command">lemmas</span></span> Ker0_imp_inj_on <span class="main">=</span> Ker0_imp_inj_on

<span class="keyword1" id="Rep_Fin_Groups-GroupHom"><span class="command">lemma</span></span> GroupHom <span class="main">:</span> <span class="quoted"><span class="quoted">"GroupHom <span class="free">M</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Rep_Fin_Groups-codomain_smult_zero"><span class="command">lemma</span></span> codomain_smult_zero <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main"><span class="free">⋆</span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> im_zero smult_zero zero_closed R_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-RSubmodule_Ker"><span class="command">lemma</span></span> RSubmodule_Ker <span class="main">:</span> <span class="quoted"><span class="quoted">"Domain.RSubmodule Ker"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Domain.RSubmoduleI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Group_Ker<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> Ker"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span> <span class="main">∈</span> Ker"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> kerD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> codomain_smult_zero kerI Domain.smult_closed
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-RModule_Im"><span class="command">lemma</span></span> RModule_Im <span class="main">:</span> <span class="quoted"><span class="quoted">"RModule <span class="free">R</span> <span class="free">smult'</span> ImG"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ring1 Group_Im
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModuleI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">`</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main"><span class="free">⋆</span></span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> one_closed R_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">`</span> <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">`</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> m n <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="skolem"><span class="skolem">n'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="free">T</span> <span class="skolem">m'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">T</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> m' r R_map <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">T</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> r m'<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">m</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">`</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> smult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> r m' n' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋆</span></span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">r</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom add_closed R_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span><span class="main">+</span><span class="skolem">n'</span>"</span></span><span class="main">]</span> smult_closed R_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> r s m' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">s</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_scalars.add_closed R_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">+</span><span class="skolem">s</span>"</span></span><span class="main">]</span> smult_closed hom R_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> r s m' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">s</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_closed R_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> R_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m'</span>"</span></span><span class="main">]</span> mult_closed R_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-im_submodule"><span class="command">lemma</span></span> im_submodule <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"RSubmodule <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RModule.RSubmodule <span class="free">R</span> <span class="free">smult'</span> ImG <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModule.RSubmoduleI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> RModule_Im<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group.Subgroup <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> im_subgroup Subgroup_RSubmodule <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms R_map  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">`</span> <span class="free">N</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main"><span class="free">⋆</span></span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">`</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModule.smult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RModHom_composite_left"><span class="command">lemma</span></span> RModHom_composite_left <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">M</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"RModuleHom <span class="free">R</span> <span class="free">smult'</span> <span class="free">N</span> <span class="free">smult''</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RModuleHom <span class="free">R</span> <span class="free">smult</span> <span class="free">M</span> <span class="free">smult''</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModule.RModuleHomI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> RModule_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupHom <span class="free">M</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModuleHom.GroupHom<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> GroupHom_composite_left
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span><span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">smult''</span> <span class="bound">r</span> <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_map RModuleHom.R_map<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RModuleHom_restrict0_submodule"><span class="command">lemma</span></span> RModuleHom_restrict0_submodule <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"RSubmodule <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RModuleHom <span class="free">R</span> <span class="free">smult</span> <span class="free">N</span> <span class="free">smult'</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModuleHom.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule <span class="free">R</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupHom <span class="free">N</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModule.Group GroupHom_restrict0_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleHom_axioms <span class="free">R</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">N</span> <span class="main"><span class="free">(⋆)</span></span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">N</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋆</span></span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">N</span><span class="main">)</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RModule.smult_closed R_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-distrib_lincomb"><span class="command">lemma</span></span> distrib_lincomb <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">rs</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="free">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="free">rs</span> <span class="main">∙⋆</span> map <span class="free">T</span> <span class="free">ms</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Domain.lincomb_Nil im_zero Codomain.lincomb_Nil R_map Domain.lincomb_Cons
        Domain.smult_closed Domain.lincomb_closed additive Codomain.lincomb_Cons
  <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rs</span></span> <span class="quoted"><span class="free">ms</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-same_image_on_RSpanset_imp_same_hom"><span class="command">lemma</span></span> same_image_on_RSpanset_imp_same_hom <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"RModuleHom <span class="free">R</span> <span class="free">smult</span> <span class="free">M</span> <span class="free">smult'</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ms</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> Domain.R_scalars.RSpan <span class="free">ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">ms</span><span class="main">.</span> <span class="free">S</span> <span class="bound">m</span> <span class="main">=</span> <span class="free">T</span> <span class="bound">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">T</span> <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Domain.RSpanD_lincomb_arb_len_coeffs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> rs<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">(</span><span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">rs</span> <span class="main">∙⋆</span> <span class="main">(</span>map <span class="free">S</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RModuleHom.distrib_lincomb<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rs<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">rs</span> <span class="main">∙⋅</span> <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">rs</span> <span class="main">∙⋆</span> <span class="main">(</span>map <span class="free">T</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> distrib_lincomb <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> map_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ms</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> rs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> supp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> RModuleHom.supp suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context RModuleHom *)</span>

<span class="keyword1" id="Rep_Fin_Groups-RSubmodule_eigenspace"><span class="command">lemma</span></span> RSubmodule_eigenspace <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'m</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> RModHom<span class="main">:</span> <span class="quoted"><span class="quoted">"RModuleHom <span class="free">R</span> <span class="free">smult</span> <span class="free">M</span> <span class="free">smult</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">=</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">s</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">m</span></span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> <span class="free">T</span> <span class="bound">m</span> <span class="main">=</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RModule.RSubmodule <span class="free">R</span> <span class="free">smult</span> <span class="free">M</span> <span class="free">E</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModule.RSubmoduleI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> RModHom <span class="keyword3"><span class="command">show</span></span> rmod<span class="main">:</span> <span class="quoted"><span class="quoted">"RModule <span class="free">R</span> <span class="free">smult</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModuleHom.axioms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Group <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> r<span class="main">(</span>1<span class="main">)</span> E <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RModule.zero_closed<span class="main">[</span><span class="operator">OF</span> rmod<span class="main">]</span> RModuleHom.im_zero<span class="main">[</span><span class="operator">OF</span> RModHom<span class="main">]</span>
            RModule.smult_zero<span class="main">[</span><span class="operator">OF</span> rmod<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> r<span class="main">(</span>1<span class="main">)</span> E <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RModule.diff_closed<span class="main">[</span><span class="operator">OF</span> rmod<span class="main">]</span> RModuleHom.im_diff<span class="main">[</span><span class="operator">OF</span> RModHom<span class="main">]</span> 
            RModule.smult_distrib_left_diff<span class="main">[</span><span class="operator">OF</span> rmod<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> E <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group.Subgroup <span class="free">M</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> E r RModuleHom.R_map<span class="main">[</span><span class="operator">OF</span> RModHom<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RModule.smult_closed<span class="main">[</span><span class="operator">OF</span> rmod<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts about endomorphisms›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RModule<span class="main">)</span> Rmap_endomorph_is_RModuleEnd <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> grpend<span class="main">:</span> <span class="quoted"><span class="quoted">"GroupEnd <span class="free">M</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     Rmap  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">T</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RModuleEnd <span class="free">R</span> <span class="free">smult</span> <span class="free">M</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModuleEnd.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> RModuleHomI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> grpend <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupHom <span class="free">M</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> GroupEnd.axioms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> grpend <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleEnd_axioms <span class="free">M</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GroupEnd.endomorph <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> Rmap<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RModuleEnd<span class="main">)</span> GroupEnd <span class="main">:</span> <span class="quoted"><span class="quoted">"GroupEnd <span class="free">M</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> GroupEnd.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> endomorph <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupEnd_axioms <span class="free">M</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RModuleEnd<span class="main">)</span> proj_decomp    <span class="main">=</span> GroupEnd.proj_decomp<span class="main">[</span><span class="operator">OF</span> GroupEnd<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ModuleEnd<span class="main">)</span> RModuleEnd <span class="main">:</span> <span class="quoted"><span class="quoted">"RModuleEnd UNIV <span class="free">smult</span> <span class="free">M</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> endomorph RModuleEnd.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ModuleEnd<span class="main">)</span> GroupEnd <span class="main">=</span> RModuleEnd.GroupEnd<span class="main">[</span><span class="operator">OF</span> RModuleEnd<span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-RModuleEnd_over_UNIV_is_ModuleEnd"><span class="command">lemma</span></span> RModuleEnd_over_UNIV_is_ModuleEnd <span class="main">:</span>
  <span class="quoted"><span class="quoted">"RModuleEnd UNIV <span class="free">rsmult</span> <span class="free">M</span> <span class="free">T</span> <span class="main">⟹</span> ModuleEnd <span class="free">rsmult</span> <span class="free">M</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ModuleEnd.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ModuleHom.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> endo<span class="main">:</span> <span class="quoted"><span class="quoted">"RModuleEnd UNIV <span class="free">rsmult</span> <span class="free">M</span> <span class="free">T</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"RModuleHom UNIV <span class="free">rsmult</span> <span class="free">M</span> <span class="free">rsmult</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModuleEnd.axioms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> endo <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ModuleEnd_axioms <span class="free">M</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModuleEnd.endomorph <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts about isomorphisms›</span></span>

<span class="keyword1"><span class="command">context</span></span> RModuleIso
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">invT</span> <span class="main">≡</span> <span class="main">(</span>the_inv_into <span class="free">M</span> <span class="free">T</span><span class="main">)</span> <span class="main">↓</span> <span class="free">N</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-GroupIso"><span class="command">lemma</span></span> GroupIso <span class="main">:</span> <span class="quoted"><span class="quoted">"GroupIso <span class="free">M</span> <span class="free">T</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> GroupIso.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupHom <span class="free">M</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> bijective <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupIso_axioms <span class="free">M</span> <span class="free">T</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> ImG           <span class="main">=</span> GroupIso.ImG         <span class="main">[</span><span class="operator">OF</span> GroupIso<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> GroupHom_inv <span class="main">=</span> GroupIso.inv        <span class="main">[</span><span class="operator">OF</span> GroupIso<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> invT_into    <span class="main">=</span> GroupIso.invT_into  <span class="main">[</span><span class="operator">OF</span> GroupIso<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> T_invT       <span class="main">=</span> GroupIso.T_invT     <span class="main">[</span><span class="operator">OF</span> GroupIso<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> invT_eq      <span class="main">=</span> GroupIso.invT_eq    <span class="main">[</span><span class="operator">OF</span> GroupIso<span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-RModuleN"><span class="command">lemma</span></span> RModuleN <span class="main">:</span> <span class="quoted"><span class="quoted">"RModule <span class="free">R</span> <span class="free">smult'</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RModule_Im ImG <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-inv"><span class="command">lemma</span></span> inv <span class="main">:</span> <span class="quoted"><span class="quoted">"RModuleIso <span class="free">R</span> <span class="free">smult'</span> <span class="free">N</span> <span class="free">smult</span> invT <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RModuleN GroupHom_inv
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModule.RModuleIsoI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> rn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"invT <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> invT <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> invT_into smult_closed R_map T_invT invT_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context RModuleIso *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Inner direct sums of RModules›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RModule<span class="main">)</span> RModule_inner_dirsum_el_decomp_Rsmult <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N</span><span class="main">∈</span>set <span class="free">Ns</span><span class="main">.</span> RSubmodule <span class="bound">N</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="free">Ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">N</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Ns</span><span class="main">←</span><span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">.</span> m<span class="main">←</span><span class="main">(</span><span class="main">⨁</span><span class="free">Ns</span><span class="main">←</span><span class="free">x</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Ns</span><span class="main">←</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> listset <span class="free">Ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> sum_list <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModule.AbGroup<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span> AbGroup_inner_dirsum_el_decompI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Ns</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> xs_def <span class="keyword1"><span class="command">have</span></span> xs_M<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Subgroup_RSubmodule
          AbGroup.abSubgroup_inner_dirsum_el_decomp_set<span class="main">[</span><span class="operator">OF</span> AbGroup<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> x<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">.</span> m<span class="main">←</span><span class="skolem">xs</span><span class="main">]</span> <span class="main">∈</span> listset <span class="free">Ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> listset_RModule_Rsmult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x assms<span class="main">(</span>3<span class="main">)</span> xs_M <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span> <span class="main">=</span> sum_list <span class="main">[</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">.</span> m<span class="main">←</span><span class="skolem">xs</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_sum_list_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">M</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">M</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> RModule_inner_dirsum RModule.smult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Ns</span><span class="main">←</span><span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">.</span> m<span class="main">←</span><span class="skolem">xs</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> RModule.AbGroup AbGroup_inner_dirsum_el_decomp_eq
     <span class="keyword1"><span class="command">by</span></span>   <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RModule<span class="main">)</span> RModuleEnd_inner_dirsum_el_decomp_nth <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">N</span> <span class="main">∈</span> set <span class="free">Ns</span><span class="main">.</span> RSubmodule <span class="bound">N</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="free">Ns</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">Ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RModuleEnd <span class="free">R</span> <span class="free">smult</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">N</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Ns</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModule.Rmap_endomorph_is_RModuleEnd<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule <span class="free">R</span> <span class="free">smult</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">N</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RSubmodule_inner_dirsum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupEnd <span class="main">(</span><span class="main">⨁</span><span class="bound">N</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span> <span class="main">⨁</span><span class="free">Ns</span><span class="main">↓</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModule.AbGroup GroupEnd_inner_dirsum_el_decomp_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Ns</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">N</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span>
              <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Ns</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">(</span><span class="main">⨁</span><span class="free">Ns</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">N</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">M</span><span class="main">←</span><span class="free">Ns</span><span class="main">.</span> <span class="bound">M</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> RModule_inner_dirsum RModule.smult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Ns</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">⨁</span><span class="free">Ns</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms RModule.AbGroup<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>
            AbGroup_length_inner_dirsum_el_decomp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Ns</span></span><span class="main">]</span>
            RModule_inner_dirsum_el_decomp_Rsmult
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Vector Spaces›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Locales and basic facts›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we don't care about being able to switch scalars.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> fscalar_mult <span class="main">=</span> scalar_mult <span class="quoted"><span class="free">smult</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span><span class="main">::</span>field <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fscalar_mult<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">findim</span> <span class="main">≡</span> fingen"</span></span>

<span class="keyword1"><span class="command">locale</span></span> VectorSpace <span class="main">=</span> Module <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span><span class="main">::</span>field <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> VectorSpaceI <span class="main">=</span> ModuleI<span class="main">[</span><span class="operator">THEN</span> VectorSpace.intro<span class="main">]</span>

<span class="keyword1"><span class="command">sublocale</span></span> VectorSpace <span class="main">&lt;</span> fscalar_mult <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> FinDimVectorSpace <span class="main">=</span> VectorSpace
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> findim<span class="main">:</span> <span class="quoted"><span class="quoted">"findim <span class="free">V</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpace<span class="main">)</span> FinDimVectorSpaceI <span class="main">:</span>
  <span class="quoted"><span class="quoted">"findim <span class="free">V</span> <span class="main">⟹</span> FinDimVectorSpace <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">context</span></span> VectorSpace
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Subspace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Subspace</span> <span class="main">≡</span> Submodule"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-SubspaceD1"><span class="command">lemma</span></span> SubspaceD1 <span class="main">:</span> <span class="quoted"><span class="quoted">"Subspace <span class="free">U</span> <span class="main">⟹</span> VectorSpace <span class="free">smult</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VectorSpace.intro Module.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemmas</span></span> AbGroup                           <span class="main">=</span> AbGroup
<span class="keyword1"><span class="command">lemmas</span></span> add_closed                        <span class="main">=</span> add_closed
<span class="keyword1"><span class="command">lemmas</span></span> smult_closed                      <span class="main">=</span> smult_closed
<span class="keyword1"><span class="command">lemmas</span></span> one_smult                         <span class="main">=</span> one_smult
<span class="keyword1"><span class="command">lemmas</span></span> smult_assoc                       <span class="main">=</span> smult_assoc
<span class="keyword1"><span class="command">lemmas</span></span> smult_distrib_left                <span class="main">=</span> smult_distrib_left
<span class="keyword1"><span class="command">lemmas</span></span> smult_distrib_right               <span class="main">=</span> smult_distrib_right
<span class="keyword1"><span class="command">lemmas</span></span> zero_closed                       <span class="main">=</span> zero_closed
<span class="keyword1"><span class="command">lemmas</span></span> zero_smult                        <span class="main">=</span> zero_smult
<span class="keyword1"><span class="command">lemmas</span></span> smult_zero                        <span class="main">=</span> smult_zero
<span class="keyword1"><span class="command">lemmas</span></span> smult_lincomb                     <span class="main">=</span> smult_lincomb
<span class="keyword1"><span class="command">lemmas</span></span> smult_distrib_left_diff           <span class="main">=</span> smult_distrib_left_diff
<span class="keyword1"><span class="command">lemmas</span></span> smult_sum_distrib              <span class="main">=</span> smult_sum_distrib
<span class="keyword1"><span class="command">lemmas</span></span> sum_smult_distrib              <span class="main">=</span> sum_smult_distrib
<span class="keyword1"><span class="command">lemmas</span></span> lincomb_sum                       <span class="main">=</span> lincomb_sum
<span class="keyword1"><span class="command">lemmas</span></span> lincomb_closed                    <span class="main">=</span> lincomb_closed
<span class="keyword1"><span class="command">lemmas</span></span> lincomb_concat                    <span class="main">=</span> lincomb_concat
<span class="keyword1"><span class="command">lemmas</span></span> lincomb_replicate0_left           <span class="main">=</span> lincomb_replicate0_left
<span class="keyword1"><span class="command">lemmas</span></span> delta_scalars_lincomb_eq_nth      <span class="main">=</span> delta_scalars_lincomb_eq_nth
<span class="keyword1"><span class="command">lemmas</span></span> SpanI                             <span class="main">=</span> SpanI
<span class="keyword1"><span class="command">lemmas</span></span> Span_closed                       <span class="main">=</span> Span_closed
<span class="keyword1"><span class="command">lemmas</span></span> SpanD_lincomb_arb_len_coeffs      <span class="main">=</span> SpanD_lincomb_arb_len_coeffs
<span class="keyword1"><span class="command">lemmas</span></span> SpanI_lincomb_arb_len_coeffs      <span class="main">=</span> SpanI_lincomb_arb_len_coeffs
<span class="keyword1"><span class="command">lemmas</span></span> in_Span_obtain_same_length_coeffs <span class="main">=</span> in_Span_obtain_same_length_coeffs
<span class="keyword1"><span class="command">lemmas</span></span> SubspaceI                         <span class="main">=</span> SubmoduleI
<span class="keyword1"><span class="command">lemmas</span></span> subspace_finrank                  <span class="main">=</span> submodule_finrank

<span class="keyword1" id="Rep_Fin_Groups-cancel_scalar"><span class="command">lemma</span></span> cancel_scalar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">V</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">;</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">u</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> smult_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context VectorSpace *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Linear algebra in vector spaces›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Linear independence and spanning›</span></span>

<span class="keyword1"><span class="command">context</span></span> VectorSpace
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Subspace_Span                         <span class="main">=</span> Submodule_Span
<span class="keyword1"><span class="command">lemmas</span></span> lin_independent_Nil                   <span class="main">=</span> R_lin_independent_Nil
<span class="keyword1"><span class="command">lemmas</span></span> lin_independentI_concat_all_scalars   <span class="main">=</span> R_lin_independentI_concat_all_scalars
<span class="keyword1"><span class="command">lemmas</span></span> lin_independentD_all_scalars          <span class="main">=</span> R_lin_independentD_all_scalars
<span class="keyword1"><span class="command">lemmas</span></span> lin_independent_obtain_unique_scalars <span class="main">=</span> R_lin_independent_obtain_unique_scalars

<span class="keyword1" id="Rep_Fin_Groups-lincomb_Cons_0_imp_in_Span"><span class="command">lemma</span></span> lincomb_Cons_0_imp_in_Span <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">;</span> set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">as</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">v</span><span class="main">#</span><span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> Span <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_Cons eq_neg_iff_add_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span><span class="main">]</span>
        neg_lincomb smult_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> smult_lincomb SpanD_lincomb_arb_len_coeffs
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-lin_independent_Cons_conditions"><span class="command">lemma</span></span> lin_independent_Cons_conditions <span class="main">:</span>  
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">;</span> set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span><span class="main">;</span> <span class="free">v</span> <span class="main">∉</span> Span <span class="free">vs</span><span class="main">;</span> lin_independent <span class="free">vs</span> <span class="main">⟧</span>
        <span class="main">⟹</span> lin_independent <span class="main">(</span><span class="free">v</span><span class="main">#</span><span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_Cons_0_imp_in_Span lin_independent_ConsI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-coeff_n0_imp_in_Span_others"><span class="command">lemma</span></span> coeff_n0_imp_in_Span_others <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> length <span class="free">us</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">us</span> <span class="main">@</span> <span class="free">v</span> <span class="main">#</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> Span <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">#</span> <span class="main">[</span><span class="main">-</span> <span class="bound">c</span><span class="main">.</span> c<span class="main">←</span><span class="free">as</span><span class="main">@</span><span class="free">bs</span><span class="main">]</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>4-6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">b</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span> <span class="main">(</span> <span class="main">(</span><span class="free">as</span><span class="main">@</span><span class="free">bs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_append lincomb_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">b</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_def assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> neg_lincomb<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">us</span><span class="main">@</span><span class="free">vs</span>"</span></span><span class="main">]</span> lincomb_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="main">_</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> x_def w assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> SpanD_lincomb_arb_len_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">#</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span>"</span></span><span class="main">]</span>
          Span_smult_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">#</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-lin_independent_replace1_by_lincomb"><span class="command">lemma</span></span> lin_independent_replace1_by_lincomb <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span><span class="free">us</span> <span class="main">@</span> <span class="free">v</span> <span class="main">#</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> length <span class="free">us</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span> <span class="main">(</span><span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">us</span> <span class="main">@</span> <span class="free">v</span> <span class="main">#</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">us</span> <span class="main">@</span> <span class="free">v</span> <span class="main">#</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span><span class="free">us</span> <span class="main">@</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lin_independent_reduce <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lin_independent_ConsI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">cs</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">#</span><span class="skolem">cs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ds</span></span> <span class="skolem"><span class="skolem">es</span></span> <span class="skolem"><span class="skolem">fs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> dsesfs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ds</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">∙⋅</span> <span class="free">vs</span> <span class="main">=</span> <span class="skolem">ds</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
                    <span class="quoted"><span class="quoted">"length <span class="skolem">es</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>drop <span class="main">(</span>length <span class="free">us</span><span class="main">)</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">vs</span> <span class="main">=</span> <span class="skolem">es</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
                    <span class="quoted"><span class="quoted">"length <span class="skolem">fs</span> <span class="main">=</span> length <span class="free">us</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">∙⋅</span> <span class="free">us</span> <span class="main">=</span> <span class="skolem">fs</span> <span class="main">∙⋅</span> <span class="free">us</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_obtain_same_length_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
            lincomb_obtain_same_length_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="free">us</span><span class="main">)</span> <span class="skolem">cs</span>"</span></span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
            lincomb_obtain_same_length_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">cs</span></span> <span class="quoted"><span class="free">us</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span><span class="main">←</span>zip <span class="main">[</span><span class="skolem">c</span><span class="main">*</span><span class="bound">a</span><span class="main">.</span> a<span class="main">←</span><span class="free">as</span><span class="main">]</span> <span class="skolem">fs</span><span class="main">]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span><span class="main">←</span>zip <span class="skolem">es</span> <span class="main">[</span><span class="skolem">c</span><span class="main">*</span><span class="bound">d</span><span class="main">.</span> d<span class="main">←</span><span class="skolem">ds</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>5<span class="main">)</span> dsesfs<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> len_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="free">us</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> length_concat_map_split_zip<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c</span><span class="main">*</span><span class="bound">a</span><span class="main">.</span> a<span class="main">←</span><span class="free">as</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">fs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> A w_def assms<span class="main">(</span>1-3<span class="main">,</span>5<span class="main">)</span> dsesfs<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>6<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main"><span class="free">⋅</span></span> <span class="free">as</span> <span class="main">∙⋅</span> <span class="free">us</span> <span class="main">+</span> <span class="skolem">fs</span> <span class="main">∙⋅</span> <span class="free">us</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span> <span class="main">+</span> <span class="skolem">es</span> <span class="main">∙⋅</span> <span class="free">vs</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">ds</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_Cons lincomb_append_right lincomb_append add_closed smult_closed
            lincomb_closed
      <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> dsesfs<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> xs_def ys_def len_xs
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">us</span> <span class="main">@</span> <span class="free">v</span> <span class="main">#</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> smult_lincomb lincomb_sum lincomb_Cons lincomb_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">us</span> <span class="main">@</span> <span class="free">v</span> <span class="main">#</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1-3<span class="main">,</span>4<span class="main">,</span>6<span class="main">)</span> len_xs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lin_independent_vs_lincomb0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> w_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-build_lin_independent_seq"><span class="command">lemma</span></span> build_lin_independent_seq <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> us_V<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     indep_us<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_independent <span class="free">us</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ws</span><span class="main">.</span> set <span class="bound">ws</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">∧</span> lin_independent <span class="main">(</span><span class="bound">ws</span> <span class="main">@</span> <span class="free">us</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>Span <span class="main">(</span><span class="bound">ws</span> <span class="main">@</span> <span class="free">us</span><span class="main">)</span> <span class="main">=</span> <span class="free">V</span>
                <span class="main">∨</span> length <span class="bound">ws</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">from</span></span> indep_us <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> ws<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">us</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"Span <span class="main">(</span><span class="skolem">ws</span><span class="main">@</span><span class="free">us</span><span class="main">)</span> <span class="main">=</span> <span class="free">V</span> <span class="main">∨</span> length <span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> Span <span class="main">(</span><span class="skolem">ws</span><span class="main">@</span><span class="free">us</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> ws <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ws<span class="main">(</span>1<span class="main">)</span> us_V <span class="keyword1"><span class="command">have</span></span> ws_us_V<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="free">us</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Span <span class="main">(</span><span class="skolem">ws</span><span class="main">@</span><span class="free">us</span><span class="main">)</span> <span class="main">⊂</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Span_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> Span <span class="main">(</span><span class="skolem">ws</span><span class="main">@</span><span class="free">us</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> w ws_us_V ws<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="free">us</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="free">us</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lin_independent_Cons_conditions<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span><span class="main">@</span><span class="free">us</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context VectorSpace *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basis for a vector space: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>basis_for›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fscalar_mult<span class="main">)</span> <span class="entity">basis_for</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set <span class="main">⇒</span> <span class="tfree">'v</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis_for</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">≡</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> Span <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">∧</span> lin_independent <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> VectorSpace
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-spanset_contains_basis"><span class="command">lemma</span></span> spanset_contains_basis <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">us</span><span class="main">.</span> set <span class="bound">us</span> <span class="main">⊆</span> set <span class="free">vs</span> <span class="main">∧</span> basis_for <span class="main">(</span>Span <span class="free">vs</span><span class="main">)</span> <span class="bound">us</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">vs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lin_independent_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> set <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"basis_for <span class="main">(</span>Span <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">ws</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> Span <span class="skolem">vs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> ws<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basis_for <span class="main">(</span>Span <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ws</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> spanset_reduce_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> ws<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> ws
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">ws</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">ws</span><span class="main">)</span> <span class="main">⊆</span> Span <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"Span <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">vs</span><span class="main">)</span> <span class="main">=</span> Span <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">ws</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Span_contains_spanset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">#</span><span class="skolem">vs</span>"</span></span><span class="main">]</span>
            Span_contains_Spans_Cons_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">]</span> Span_Cons
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">ws</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lin_independent_Cons_conditions<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> ws<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> ws<span class="main">(</span>2<span class="main">)</span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> Span <span class="skolem">ws</span>"</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="skolem">ws</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-basis_for_Span_ex"><span class="command">lemma</span></span> basis_for_Span_ex <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">us</span><span class="main">.</span> basis_for <span class="main">(</span>Span <span class="free">vs</span><span class="main">)</span> <span class="bound">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> spanset_contains_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-replace_basis_one_step"><span class="command">lemma</span></span> replace_basis_one_step <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> closed<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> indep<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     new_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> Span <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span> <span class="main">-</span> Span <span class="free">us</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span> <span class="bound">y</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">vs</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">ys</span>
                <span class="main">∧</span> basis_for <span class="main">(</span>Span <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="free">us</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> new_w <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> Span <span class="free">us</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> Span <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Span_append set_plus_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Span <span class="free">us</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> uv<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> new_w <span class="keyword1"><span class="command">have</span></span> v_n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> uv<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> as_bs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">as</span> <span class="main">=</span> length <span class="free">us</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">∙⋅</span> <span class="free">us</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">bs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
                 <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">bs</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_Span_obtain_same_length_coeffs
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> v_n0 as_bs<span class="main">(</span>4<span class="main">)</span> closed<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="skolem">bs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_0coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> b<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="skolem"><span class="skolem">ds</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs_ds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> <span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">ds</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> split_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> length <span class="skolem">cs</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fvs</span> <span class="main">=</span> take <span class="skolem">n</span> <span class="free">vs</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">vs</span><span class="main">!</span><span class="skolem">n</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bvs</span> <span class="main">=</span> drop <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">vs</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ufvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ufvs</span> <span class="main">=</span> <span class="free">us</span> <span class="main">@</span> <span class="skolem">fvs</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">acs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">acs</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="skolem">cs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> as_bs<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> cs_ds n_def acs_def ufvs_def fvs_def
    <span class="keyword1"><span class="command">have</span></span> n_len_vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="free">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len_acs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">acs</span> <span class="main">=</span> length <span class="skolem">ufvs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>   <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> n_len_vs fvs_def y_def bvs_def <span class="keyword1"><span class="command">have</span></span> vs_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> <span class="skolem">fvs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">bvs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> id_take_nth_drop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> uv<span class="main">(</span>3<span class="main">)</span> as_bs<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> cs_ds acs_def ufvs_def
    <span class="keyword1"><span class="command">have</span></span>  w_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">acs</span> <span class="main">@</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">ds</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="skolem">ufvs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">bvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_append
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> closed<span class="main">(</span>1<span class="main">)</span> vs_decomp
    <span class="keyword1"><span class="command">have</span></span> y_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fvs_V<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">fvs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bvs_V<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">bvs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>   <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ufvs_def fvs_V closed<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ufvs_V<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ufvs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> w_decomp ufvs_V y_V bvs_V <span class="keyword1"><span class="command">have</span></span> w_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Span <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span> <span class="main">=</span> Span <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="skolem">ufvs</span> <span class="main">@</span> <span class="skolem">bvs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> vs_decomp ufvs_def <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Span <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span> <span class="main">=</span> Span <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ufvs</span> <span class="main">@</span> <span class="skolem">bvs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Span_append Span_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">bvs</span></span><span class="main">]</span> Span_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">ufvs</span></span><span class="main">]</span>
            Span_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">#</span><span class="skolem">ufvs</span>"</span></span> <span class="quoted"><span class="skolem">bvs</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> new_w y_V ufvs_V bvs_V <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Span <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="skolem">ufvs</span> <span class="main">@</span> <span class="skolem">bvs</span><span class="main">)</span> <span class="main">⊆</span> Span <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Span_replace_hd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> len_acs w_decomp y_V ufvs_V bvs_V <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Span <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="skolem">ufvs</span> <span class="main">@</span> <span class="skolem">bvs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b<span class="main">(</span>2<span class="main">)</span> coeff_n0_imp_in_Span_others <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> w_V ufvs_V bvs_V <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Span <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ufvs</span> <span class="main">@</span> <span class="skolem">bvs</span><span class="main">)</span> <span class="main">⊆</span> Span <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="skolem">ufvs</span> <span class="main">@</span> <span class="skolem">bvs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Span_replace_hd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Span <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span> <span class="main">⊆</span> Span <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="skolem">ufvs</span> <span class="main">@</span> <span class="skolem">bvs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ufvs_V y_V bvs_V ufvs_def indep vs_decomp w_decomp len_acs b<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="skolem">ufvs</span> <span class="main">@</span> <span class="skolem">bvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lin_independent_replace1_by_lincomb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ufvs</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">bvs</span></span> <span class="quoted"><span class="skolem">acs</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">ds</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="skolem">fvs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">bvs</span><span class="main">)</span> <span class="main">⊆</span> Span <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> new_w <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> Span <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> closed <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> Span <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Span_contains_spanset_append_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> closed fvs_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">fvs</span> <span class="main">⊆</span> Span <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Span_contains_spanset_append_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">us</span></span><span class="main">]</span> set_take_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> closed bvs_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">bvs</span> <span class="main">⊆</span> Span <span class="main">(</span><span class="free">us</span><span class="main">@</span><span class="free">vs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Span_contains_spanset_append_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">us</span></span><span class="main">]</span> set_drop_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ufvs_def vs_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-replace_basis"><span class="command">lemma</span></span> replace_basis <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> closed<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> indep_vs<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_independent <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> length <span class="free">us</span> <span class="main">≤</span> length <span class="free">vs</span><span class="main">;</span> set <span class="free">us</span> <span class="main">⊆</span> Span <span class="free">vs</span><span class="main">;</span> lin_independent <span class="free">us</span> <span class="main">⟧</span>
                <span class="main">⟹</span> <span class="main">∃</span><span class="bound">pvs</span><span class="main">.</span> length <span class="bound">pvs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> set <span class="bound">pvs</span> <span class="main">=</span> set <span class="free">vs</span>
                  <span class="main">∧</span> basis_for <span class="main">(</span>Span <span class="free">vs</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="main">(</span><span class="free">us</span> <span class="main">@</span> <span class="bound">pvs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">us</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">from</span></span> closed indep_vs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Span_contains_spanset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">u</span> <span class="skolem">us</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ppvs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> ppvs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ppvs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ppvs</span> <span class="main">=</span> set <span class="free">vs</span>"</span></span>
                <span class="quoted"><span class="quoted">"basis_for <span class="main">(</span>Span <span class="free">vs</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">us</span> <span class="main">@</span> <span class="skolem">ppvs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lin_independent_ConsD1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">us</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fppvs</span></span> <span class="skolem"><span class="skolem">bppvs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fppvs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">vs</span> <span class="main">-</span> length <span class="skolem">us</span><span class="main">)</span> <span class="skolem">ppvs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bppvs</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">vs</span> <span class="main">-</span> length <span class="skolem">us</span><span class="main">)</span> <span class="skolem">ppvs</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> ppvs<span class="main">(</span>1<span class="main">)</span> Cons<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ppvs_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ppvs</span> <span class="main">=</span> <span class="skolem">fppvs</span> <span class="main">@</span> <span class="skolem">bppvs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  len_fppvs  <span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">fppvs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">-</span> length <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> closed Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> uus_V<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Span_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> closed ppvs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ppvs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> fppvs_def <span class="keyword1"><span class="command">have</span></span> fppvs_V<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">fppvs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_take_subset<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">ppvs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> fppvs_def Cons<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> prev_basis_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">us</span> <span class="main">@</span> <span class="skolem">ppvs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">us</span> <span class="main">@</span> <span class="skolem">fppvs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>   <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> ppvs<span class="main">(</span>3<span class="main">)</span> fppvs_V uus_V <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> xs_y_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fppvs</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="quoted">"basis_for <span class="main">(</span>Span <span class="free">vs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">#</span> <span class="skolem">us</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lin_independent_imp_hd_independent_from_Span
          replace_basis_one_step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">fppvs</span></span> <span class="quoted"><span class="skolem">us</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pvs</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">bppvs</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> xs_y_ys len_fppvs ppvs_decomp ppvs<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">pvs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">pvs</span> <span class="main">=</span> set <span class="free">vs</span>"</span></span> 
         <span class="quoted"><span class="quoted">"basis_for <span class="main">(</span>Span <span class="free">vs</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">u</span> <span class="main">#</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">pvs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> take_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">#</span> <span class="skolem">us</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-replace_basis_completely"><span class="command">lemma</span></span> replace_basis_completely <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span><span class="main">;</span> lin_independent <span class="free">vs</span><span class="main">;</span> length <span class="free">us</span> <span class="main">=</span> length <span class="free">vs</span><span class="main">;</span>
        set <span class="free">us</span> <span class="main">⊆</span> Span <span class="free">vs</span><span class="main">;</span> lin_independent <span class="free">us</span> <span class="main">⟧</span> <span class="main">⟹</span> basis_for <span class="main">(</span>Span <span class="free">vs</span><span class="main">)</span> <span class="free">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> replace_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">us</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-basis_for_obtain_unique_scalars"><span class="command">lemma</span></span> basis_for_obtain_unique_scalars <span class="main">:</span>
  <span class="quoted"><span class="quoted">"basis_for <span class="free">V</span> <span class="free">vs</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">∃!</span> <span class="bound">as</span><span class="main">.</span> length <span class="bound">as</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">as</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lin_independent_obtain_unique_scalars <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-add_unique_scalars"><span class="command">lemma</span></span> add_unique_scalars <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_for <span class="free">V</span> <span class="free">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">ds</span><span class="main">.</span> length <span class="bound">ds</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">ds</span> <span class="main">∙⋅</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     bs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">ds</span><span class="main">.</span> length <span class="bound">ds</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v'</span> <span class="main">=</span> <span class="bound">ds</span> <span class="main">∙⋅</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">ds</span><span class="main">.</span> length <span class="bound">ds</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v</span><span class="main">+</span><span class="free">v'</span> <span class="main">=</span> <span class="bound">ds</span> <span class="main">∙⋅</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="free">as</span> <span class="free">bs</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> vs v v' as bs
    <span class="keyword1"><span class="command">have</span></span>  as'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="free">as</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   bs'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">bs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v'</span> <span class="main">=</span> <span class="free">bs</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> basis_for_obtain_unique_scalars theI'<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ds</span><span class="main">.</span> length <span class="bound">ds</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">ds</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
          <span class="main">]</span>
          theI'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ds</span><span class="main">.</span> length <span class="bound">ds</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v'</span> <span class="main">=</span> <span class="bound">ds</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="free">as</span> <span class="free">bs</span><span class="main">]</span> <span class="main">=</span> length <span class="main">(</span>zip <span class="free">as</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> vs as' bs'
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="bound">a</span><span class="main">+</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="free">as</span> <span class="free">bs</span><span class="main">]</span>
                <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">+</span> <span class="free">v'</span> <span class="main">=</span> <span class="main">[</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>a<span class="main">,</span>b<span class="main">)</span><span class="main">←</span>zip <span class="free">as</span> <span class="free">bs</span><span class="main">]</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_sum
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> vs v v' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">ds</span><span class="main">.</span> length <span class="bound">ds</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v</span><span class="main">+</span><span class="free">v'</span> <span class="main">=</span> <span class="bound">ds</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_closed basis_for_obtain_unique_scalars <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cs the1_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-smult_unique_scalars"><span class="command">lemma</span></span> smult_unique_scalars <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_for <span class="free">V</span> <span class="free">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">cs</span><span class="main">.</span> length <span class="bound">cs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">∙⋅</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     bs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">cs</span><span class="main">.</span> length <span class="bound">cs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">∙⋅</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(*)</span> <span class="free">a</span><span class="main">)</span> <span class="free">as</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> vs v as <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="free">as</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> basis_for_obtain_unique_scalars theI'<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">cs</span><span class="main">.</span> length <span class="bound">cs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> vs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>map <span class="main">(</span><span class="main">(*)</span> <span class="free">a</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span>
                      <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">(*)</span> <span class="free">a</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_lincomb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> vs v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">cs</span><span class="main">.</span> length <span class="bound">cs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_closed basis_for_obtain_unique_scalars <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> bs the1_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-max_lin_independent_set_in_Span"><span class="command">lemma</span></span> max_lin_independent_set_in_Span <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> Span <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="free">us</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"length <span class="free">us</span> <span class="main">≤</span> length <span class="free">vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">us</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> spanset_contains_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bvs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> bvs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">bvs</span> <span class="main">⊆</span> set <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"basis_for <span class="main">(</span>Span <span class="free">vs</span><span class="main">)</span> <span class="skolem">bvs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> len_bvs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">bvs</span> <span class="main">≤</span> length <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lin_independent_imp_distinct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">bvs</span></span><span class="main">]</span> distinct_card finite_set 
          card_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">bvs</span>"</span></span><span class="main">]</span> card_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">&gt;</span> length <span class="skolem">bvs</span> <span class="main">⟹</span> <span class="main">¬</span> lin_independent <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">&gt;</span> length <span class="skolem">bvs</span>"</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">bvs</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Cons assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> xxs_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Span_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ws_def A<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="skolem">bvs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Cons assms<span class="main">(</span>2<span class="main">)</span> bvs<span class="main">(</span>2<span class="main">)</span> ws_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> Span <span class="skolem">bvs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_take_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basis_for <span class="main">(</span>Span <span class="free">vs</span><span class="main">)</span> <span class="skolem">ws</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A<span class="main">(</span>2<span class="main">)</span> ws_def assms<span class="main">(</span>1<span class="main">)</span> bvs xxs_V lin_independent_ConsD1
            lin_independent_imp_independent_take replace_basis_completely<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">bvs</span></span> <span class="quoted"><span class="skolem">ws</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> Cons assms<span class="main">(</span>2<span class="main">)</span> ws_def A<span class="main">(</span>2<span class="main">)</span> xxs_V <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> Span_contains_Span_take<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span>
            lin_independent_imp_hd_independent_from_Span<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-finrank_Span"><span class="command">lemma</span></span> finrank_Span <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟹</span> finrank <span class="main">(</span>Span <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> max_lin_independent_set_in_Span finrankI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context VectorSpace *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finite dimensional spaces›</span></span>

<span class="keyword1"><span class="command">context</span></span> VectorSpace
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-dim_eq_size_basis"><span class="command">lemma</span></span> dim_eq_size_basis <span class="main">:</span> <span class="quoted"><span class="quoted">"basis_for <span class="free">V</span> <span class="free">vs</span> <span class="main">⟹</span> length <span class="free">vs</span> <span class="main">=</span> dim <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> max_lin_independent_set_in_Span
        Least_equality<span class="main">[</span>
          <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">∃</span><span class="bound">us</span><span class="main">.</span> length <span class="bound">us</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">∧</span> set <span class="bound">us</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">∧</span> RSpan <span class="bound">us</span> <span class="main">=</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span>"</span></span>
        <span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> dim_R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-finrank_imp_findim"><span class="command">lemma</span></span> finrank_imp_findim <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finrank <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"findim <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">vs</span><span class="main">.</span> set <span class="bound">vs</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">∧</span> lin_independent <span class="bound">vs</span> <span class="main">⟶</span> length <span class="bound">vs</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finrankD
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> build_lin_independent_seq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="skolem">ws</span>"</span></span> <span class="quoted"><span class="quoted">"Span <span class="skolem">ws</span> <span class="main">=</span> <span class="free">V</span> <span class="main">∨</span> length <span class="skolem">ws</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-subspace_Span_is_findim"><span class="command">lemma</span></span> subspace_Span_is_findim <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span><span class="main">;</span> Subspace <span class="free">W</span><span class="main">;</span> <span class="free">W</span> <span class="main">⊆</span> Span <span class="free">vs</span> <span class="main">⟧</span> <span class="main">⟹</span> findim <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finrank_Span subspace_finrank<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Span <span class="free">vs</span>"</span></span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span> SubspaceD1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span>
        VectorSpace.finrank_imp_findim
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context VectorSpace *)</span>

<span class="keyword1"><span class="command">context</span></span> FinDimVectorSpace
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Subspace_is_findim"><span class="command">lemma</span></span> Subspace_is_findim <span class="main">:</span> <span class="quoted"><span class="quoted">"Subspace <span class="free">U</span> <span class="main">⟹</span> findim <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> findim subspace_Span_is_findim <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-basis_ex"><span class="command">lemma</span></span> basis_ex <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">vs</span><span class="main">.</span> basis_for <span class="free">V</span> <span class="bound">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> findim basis_for_Span_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-lin_independent_length_le_dim"><span class="command">lemma</span></span> lin_independent_length_le_dim <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟹</span> lin_independent <span class="free">us</span> <span class="main">⟹</span> length <span class="free">us</span> <span class="main">≤</span> dim <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> basis_ex max_lin_independent_set_in_Span dim_eq_size_basis
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-too_long_lin_dependent"><span class="command">lemma</span></span> too_long_lin_dependent <span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟹</span> length <span class="free">us</span> <span class="main">&gt;</span> dim <span class="free">V</span> <span class="main">⟹</span> <span class="main">¬</span> lin_independent <span class="free">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lin_independent_length_le_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-extend_lin_independent_to_basis"><span class="command">lemma</span></span> extend_lin_independent_to_basis <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="free">us</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">vs</span><span class="main">.</span> basis_for <span class="free">V</span> <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="free">us</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="main">(</span>dim <span class="free">V</span> <span class="main">-</span> length <span class="free">us</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="free">us</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"Span <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="free">us</span><span class="main">)</span> <span class="main">=</span> <span class="free">V</span> <span class="main">∨</span> length <span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> build_lin_independent_seq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">us</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> assms n_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> set_append lin_independent_length_le_dim<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">@</span> <span class="free">us</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-extend_Subspace_basis"><span class="command">lemma</span></span> extend_Subspace_basis <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟹</span> basis_for <span class="free">U</span> <span class="free">us</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">vs</span><span class="main">.</span> basis_for <span class="free">V</span> <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="free">us</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Span_contains_spanset extend_lin_independent_to_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-Subspace_dim_le"><span class="command">lemma</span></span> Subspace_dim_le <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subspace <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dim <span class="free">U</span> <span class="main">≤</span> dim <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   assms findim 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"basis_for <span class="free">U</span> <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Subspace_is_findim SubspaceD1
          VectorSpace.FinDimVectorSpaceI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span>
          FinDimVectorSpace.basis_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> RSpan_contains_spanset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">us</span></span><span class="main">]</span> lin_independent_length_le_dim<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">us</span></span><span class="main">]</span>
          SubspaceD1 VectorSpace.dim_eq_size_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="skolem">us</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Subspace_eqdim_imp_equal"><span class="command">lemma</span></span> Subspace_eqdim_imp_equal <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subspace <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"dim <span class="free">U</span> <span class="main">=</span> dim <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_for <span class="free">U</span> <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Subspace_is_findim SubspaceD1
          VectorSpace.FinDimVectorSpaceI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span>
          FinDimVectorSpace.basis_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_for <span class="free">V</span> <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="skolem">us</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> extend_Subspace_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="skolem">us</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms us vs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> SubspaceD1 VectorSpace.dim_eq_size_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span>
          dim_eq_size_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span><span class="main">@</span><span class="skolem">us</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Subspace_dim_lt"><span class="command">lemma</span></span> Subspace_dim_lt <span class="main">:</span> <span class="quoted"><span class="quoted">"Subspace <span class="free">U</span> <span class="main">⟹</span> <span class="free">U</span> <span class="main">≠</span> <span class="free">V</span> <span class="main">⟹</span> dim <span class="free">U</span> <span class="main">&lt;</span> dim <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Subspace_dim_le Subspace_eqdim_imp_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-semisimple"><span class="command">lemma</span></span> semisimple <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Subspace <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> Subspace <span class="bound">W</span> <span class="main">∧</span> <span class="main">(</span><span class="free">V</span> <span class="main">=</span> <span class="bound">W</span> <span class="main">⊕</span> <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_for <span class="free">U</span> <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> SubspaceD1 Subspace_is_findim VectorSpace.FinDimVectorSpaceI
          FinDimVectorSpace.basis_ex<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> basis<span class="main">:</span> <span class="quoted"><span class="quoted">"basis_for <span class="free">V</span> <span class="main">(</span><span class="skolem">ws</span><span class="main">@</span><span class="skolem">us</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> extend_Subspace_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> ws_V<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ind_ws_us<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_independent <span class="main">(</span><span class="skolem">ws</span><span class="main">@</span><span class="skolem">us</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> V_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> Span <span class="main">(</span><span class="skolem">ws</span><span class="main">@</span><span class="skolem">us</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>  <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> Span <span class="skolem">ws</span> <span class="main">⊕</span> Span <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inner_dirsum_doubleI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> V_eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> Span <span class="skolem">ws</span> <span class="main">+</span> Span <span class="skolem">us</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Span_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> ws_V ind_ws_us <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span>Span <span class="skolem">ws</span><span class="main">,</span> Span <span class="skolem">us</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lin_independent_append_imp_independent_Spans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> us ws_V <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Subspace <span class="main">(</span>Span <span class="skolem">ws</span><span class="main">)</span> <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="main">(</span>Span <span class="skolem">ws</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Subspace_Span <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FinDimVectorSpace *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Vector space homomorphisms›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locales›</span></span>

<span class="keyword1"><span class="command">locale</span></span> VectorSpaceHom <span class="main">=</span> ModuleHom <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">smult</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span><span class="main">::</span>field <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> VectorSpaceHom <span class="main">&lt;</span> VectorSpace <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpace<span class="main">)</span>
  VectorSpaceHomI <span class="main">=</span> ModuleHomI<span class="main">[</span><span class="operator">THEN</span> VectorSpaceHom.intro<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpace<span class="main">)</span> VectorSpaceHomI_fromaxioms <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">g'</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="bound">g'</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">+</span> <span class="bound">g'</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="bound">g</span> <span class="main">+</span> <span class="free">T</span> <span class="bound">g'</span>"</span></span>
          <span class="quoted"><span class="quoted">"supp <span class="free">T</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> UNIV <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">smult'</span> <span class="bound">r</span> <span class="main">(</span><span class="free">T</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   assms
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">locale</span></span> VectorSpaceEnd <span class="main">=</span> VectorSpaceHom <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span><span class="main">::</span>field <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> endomorph<span class="main">:</span> <span class="quoted"><span class="quoted">"ImG <span class="main">⊆</span> <span class="free">V</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpace<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">VEnd</span> <span class="main">≡</span> VectorSpaceEnd <span class="free">smult</span> <span class="free">V</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpaceEndI"><span class="command">lemma</span></span> VectorSpaceEndI <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span><span class="main">::</span>field <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"VectorSpaceEnd <span class="free">smult</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span>      <span class="main">(</span><span class="operator">rule</span> VectorSpaceEnd.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpaceEnd<span class="main">)</span> VectorSpaceHom<span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpaceEnd<span class="main">)</span> ModuleEnd <span class="main">:</span> <span class="quoted"><span class="quoted">"ModuleEnd <span class="free">smult</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> endomorph ModuleEnd.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">locale</span></span> VectorSpaceIso <span class="main">=</span> VectorSpaceHom <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>   <span class="free">smult</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span><span class="main">::</span>field <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">V</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">smult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">T</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">W</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'w</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bijective<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">T</span> <span class="free">V</span> <span class="free">W</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpace<span class="main">)</span> <span class="entity">isomorphic</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'w</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">isomorphic</span> <span class="free"><span class="bound"><span class="entity">smult'</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">T</span><span class="main">.</span> VectorSpaceIso <span class="free">smult</span> <span class="free">V</span> <span class="free"><span class="bound"><span class="entity">smult'</span></span></span> <span class="bound">T</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpace<span class="main">)</span> trivial_VectorSpaceHom <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="free">smult'</span> <span class="bound">a</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> VectorSpaceHom <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> trivial_RModuleHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult'</span></span><span class="main">]</span> ModuleHom.intro VectorSpaceHom.intro
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpace<span class="main">)</span> VectorSpaceHom_idhom <span class="main">:</span>
  <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> smult_zero RModHom_idhom ModuleHom.intro VectorSpaceHom.intro
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>

<span class="keyword1"><span class="command">context</span></span> VectorSpaceHom
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> hom             <span class="main">=</span> hom
<span class="keyword1"><span class="command">lemmas</span></span> supp            <span class="main">=</span> supp
<span class="keyword1"><span class="command">lemmas</span></span> f_map           <span class="main">=</span> R_map
<span class="keyword1"><span class="command">lemmas</span></span> im_zero         <span class="main">=</span> im_zero
<span class="keyword1"><span class="command">lemmas</span></span> im_sum_list_prod <span class="main">=</span> im_sum_list_prod
<span class="keyword1"><span class="command">lemmas</span></span> additive        <span class="main">=</span> additive
<span class="keyword1"><span class="command">lemmas</span></span> GroupHom        <span class="main">=</span> GroupHom
<span class="keyword1"><span class="command">lemmas</span></span> distrib_lincomb <span class="main">=</span> distrib_lincomb

<span class="keyword1"><span class="command">lemmas</span></span> same_image_on_spanset_imp_same_hom
  <span class="main">=</span> same_image_on_RSpanset_imp_same_hom<span class="main">[</span>
      <span class="operator">OF</span> ModuleHom.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">OF</span> VectorSpaceHom.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
    <span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpace_Im"><span class="command">lemma</span></span> VectorSpace_Im <span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpace <span class="free">smult'</span> ImG"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RModule_Im VectorSpace.intro Module.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpaceHom_scalar_mul"><span class="command">lemma</span></span> VectorSpaceHom_scalar_mul <span class="main">:</span>
  <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">a</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="bound">v'</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="main">(</span><span class="bound">v</span> <span class="main">+</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="bound">v</span> <span class="main">+</span> <span class="free">a</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="bound">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> additive VectorSpace.smult_distrib_left<span class="main">[</span><span class="operator">OF</span> VectorSpace_Im<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">V</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∉</span> supp <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">a</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> supp suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> codomain_smult_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> supp <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">a</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suppD_contra <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">a</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="main">(</span><span class="bound">c</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">c</span> <span class="main"><span class="free">⋆</span></span> <span class="free">a</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_map VectorSpace.smult_assoc<span class="main">[</span><span class="operator">OF</span> VectorSpace_Im<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpaceHom_composite_left"><span class="command">lemma</span></span> VectorSpaceHom_composite_left <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ImG <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="free">smult'</span> <span class="free">W</span> <span class="free">smult''</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="free">smult</span> <span class="free">V</span> <span class="free">smult''</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"RModuleHom UNIV <span class="free">smult'</span> <span class="free">W</span> <span class="free">smult''</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceHom.axioms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> ModuleHom.axioms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"RModuleHom UNIV <span class="free">smult</span> <span class="free">V</span> <span class="free">smult''</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModHom_composite_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ModuleHom.intro VectorSpaceHom.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-findim_domain_findim_image"><span class="command">lemma</span></span> findim_domain_findim_image <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"findim <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fscalar_mult.findim <span class="free">smult'</span> ImG"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"scalar_mult.Span <span class="free">smult</span> <span class="skolem">vs</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> map <span class="free">T</span> <span class="skolem">vs</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> vs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> ImG"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Span <span class="skolem">ws</span> <span class="main">=</span> ImG"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Span <span class="skolem">ws</span> <span class="main">⊆</span> ImG"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 VectorSpace.Span_closed<span class="main">[</span><span class="operator">OF</span> VectorSpace_Im<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> vs ws_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Span <span class="skolem">ws</span> <span class="main">⊇</span> ImG"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 SpanD_lincomb_arb_len_coeffs distrib_lincomb
            VectorSpace.SpanD_lincomb_arb_len_coeffs<span class="main">[</span><span class="operator">OF</span> VectorSpace_Im<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context VectorSpaceHom *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpace<span class="main">)</span> basis_im_defines_hom <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult'</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">lincomb'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> list <span class="main">⇒</span> <span class="tfree">'w</span> list <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∙⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> lincomb'  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lincomb'</span> <span class="main">≡</span> scalar_mult.lincomb <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> VSpW      <span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpace <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     basisV    <span class="main">:</span> <span class="quoted"><span class="quoted">"basis_for <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     basisV_im <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ws</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ws</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">T</span><span class="main">.</span> VectorSpaceHom <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="bound">T</span> <span class="main">∧</span> map <span class="bound">T</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">ws</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex_ex1I<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> restrict0 <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">as</span><span class="main">.</span> length <span class="bound">as</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">as</span> <span class="main">∙⋅</span> <span class="free">vs</span><span class="main">)</span> <span class="main"><span class="free">∙⋆</span></span> <span class="free">ws</span><span class="main">)</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="free">smult'</span> <span class="skolem">T</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">v'</span> <span class="keyword3"><span class="command">assume</span></span> vv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> T_def lincomb' basisV basisV_im<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">T</span> <span class="skolem">v</span> <span class="main">+</span> <span class="skolem">T</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> basis_for_obtain_unique_scalars theI'<span class="main">[</span>
              <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ds</span><span class="main">.</span> length <span class="bound">ds</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">=</span> <span class="bound">ds</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span>
            <span class="main">]</span>
            theI'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ds</span><span class="main">.</span> length <span class="bound">ds</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="bound">ds</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span><span class="main">]</span> add_closed
            add_unique_scalars VectorSpace.lincomb_sum<span class="main">[</span><span class="operator">OF</span> VSpW<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> T_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="skolem">T</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> supp_restrict0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> basisV basisV_im<span class="main">(</span>1<span class="main">)</span> T_def lincomb' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">⋆</span></span> <span class="skolem">T</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> smult_closed smult_unique_scalars VectorSpace.smult_lincomb<span class="main">[</span><span class="operator">OF</span> VSpW<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="skolem">T</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">ws</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> basisV_im<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>map <span class="skolem">T</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> length <span class="free">ws</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>length <span class="main">(</span>map <span class="skolem">T</span> <span class="free">vs</span><span class="main">)</span> <span class="main">⟹</span> map <span class="skolem">T</span> <span class="free">vs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="skolem">T</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="skolem">i</span><span class="main">:=</span><span class="main">1</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> basisV i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">zs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">zs</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> delta_scalars_lincomb_eq_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> basisV i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="skolem">T</span> <span class="free">vs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">ws</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> basisV basisV_im T_def lincomb' zs_def i
              basis_for_obtain_unique_scalars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">!</span><span class="skolem">i</span>"</span></span><span class="main">]</span>
              the1_equality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">zs</span><span class="main">.</span> length <span class="bound">zs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="bound">zs</span> <span class="main">∙⋅</span> <span class="free">vs</span>"</span></span><span class="main">]</span>
              VectorSpace.delta_scalars_lincomb_eq_nth<span class="main">[</span><span class="operator">OF</span> VSpW<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">ws</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="skolem">T</span> <span class="free">vs</span><span class="main">)</span> <span class="main">⟹</span> map <span class="skolem">T</span> <span class="free">vs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ws</span> <span class="main">!</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="free">smult'</span> <span class="skolem">T</span> <span class="main">∧</span> map <span class="skolem">T</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">ws</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> VectorSpaceHom <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="free">smult'</span> <span class="bound">T</span> <span class="main">∧</span> map <span class="bound">T</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">ws</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="skolem">T</span> <span class="keyword3"><span class="command">assume</span></span>
    <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="free">smult'</span> <span class="skolem">S</span> <span class="main">∧</span> map <span class="skolem">S</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">ws</span>"</span></span> 
    <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="free">smult'</span> <span class="skolem">T</span> <span class="main">∧</span> map <span class="skolem">T</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">ws</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> basisV <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceHom.same_image_on_spanset_imp_same_hom map_eq_conv
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>  <span class="comment1">(* slow *)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Hom-sets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">VectorSpaceHomSet</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'v</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span>
        <span class="main">⇒</span> <span class="tfree">'w</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">VectorSpaceHomSet</span> <span class="free"><span class="bound"><span class="entity">fsmult</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">fsmult'</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span>
              <span class="main">≡</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> VectorSpaceHom <span class="free"><span class="bound"><span class="entity">fsmult</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">fsmult'</span></span></span> <span class="bound">T</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="bound">T</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpace<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">VectorSpaceEndSet</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> VEnd <span class="bound">S</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpaceHomSetI"><span class="command">lemma</span></span> VectorSpaceHomSetI <span class="main">:</span>
  <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="free">fsmult</span> <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>
        <span class="main">⟹</span> <span class="free">T</span> <span class="main">∈</span> VectorSpaceHomSet <span class="free">fsmult</span> <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> VectorSpaceHomSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpaceHomSetD_VectorSpaceHom"><span class="command">lemma</span></span> VectorSpaceHomSetD_VectorSpaceHom <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> VectorSpaceHomSet <span class="free">fsmult</span> <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">N</span>
        <span class="main">⟹</span> VectorSpaceHom <span class="free">fsmult</span> <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> VectorSpaceHomSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpaceHomSetD_Im"><span class="command">lemma</span></span> VectorSpaceHomSetD_Im <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> VectorSpaceHomSet <span class="free">fsmult</span> <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">W</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> VectorSpaceHomSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">context</span></span> VectorSpace
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpaceHomSet_is_fmaps_in_GroupHomSet"><span class="command">lemma</span></span> VectorSpaceHomSet_is_fmaps_in_GroupHomSet <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">smult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>
              <span class="main">=</span> <span class="main">(</span>GroupHomSet <span class="free">V</span> <span class="free">W</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span> <span class="main"><span class="free">⋆</span></span> <span class="main">(</span><span class="bound">T</span> <span class="bound">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>
              <span class="main">⊆</span> <span class="main">(</span>GroupHomSet <span class="free">V</span> <span class="free">W</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span> <span class="main"><span class="free">⋆</span></span> <span class="main">(</span><span class="bound">T</span> <span class="bound">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_VectorSpaceHom<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>
          VectorSpaceHomSetD_Im<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>
          VectorSpaceHom.GroupHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span> GroupHomSetI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">V</span></span> <span class="main">_</span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span>
          VectorSpaceHom.f_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>
              <span class="main">⊇</span> <span class="main">(</span>GroupHomSet <span class="free">V</span> <span class="free">W</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span> <span class="main"><span class="free">⋆</span></span> <span class="main">(</span><span class="bound">T</span> <span class="bound">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T</span> <span class="keyword3"><span class="command">assume</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> <span class="main">(</span>GroupHomSet <span class="free">V</span> <span class="free">W</span><span class="main">)</span>
                          <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span> <span class="main"><span class="free">⋆</span></span> <span class="main">(</span><span class="bound">T</span> <span class="bound">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="skolem">T</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> VectorSpaceHom.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ModuleHom.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> RModuleHom.intro<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule UNIV <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> T <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupHom <span class="free">V</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> GroupHomSetD_GroupHom <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">from</span></span> T <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleHom_axioms UNIV <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="skolem">T</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> T <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> GroupHomSetD_Im<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">]</span> VectorSpaceHomSetI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Group_VectorSpaceHomSet"><span class="command">lemma</span></span> Group_VectorSpaceHomSet <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"VectorSpace <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Group <span class="main">(</span>VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpace.smult_zero<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> VectorSpace.zero_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
          trivial_VectorSpaceHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult'</span></span><span class="main">]</span> VectorSpaceHomSetI
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="skolem">T</span>
  <span class="keyword3"><span class="command">assume</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> S T
    <span class="keyword1"><span class="command">have</span></span>  ST<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="main">(</span>GroupHomSet <span class="free">V</span> <span class="free">W</span><span class="main">)</span>
                    <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span> <span class="main"><span class="free">⋆</span></span> <span class="main">(</span><span class="bound">T</span> <span class="bound">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> <span class="main">(</span>GroupHomSet <span class="free">V</span> <span class="free">W</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span> <span class="main"><span class="free">⋆</span></span> <span class="main">(</span><span class="bound">T</span> <span class="bound">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSet_is_fmaps_in_GroupHomSet
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span> <span class="main">∈</span> GroupHomSet <span class="free">V</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpace.AbGroup<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> Group_GroupHomSet Group.diff_closed
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span> <span class="main"><span class="free">⋆</span></span> <span class="main">(</span><span class="main">(</span><span class="skolem">S</span><span class="main">-</span><span class="skolem">T</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> ST <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">⋆</span></span> <span class="main">(</span><span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span><span class="main">)</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> GroupHomSetD_Im
            VectorSpace.smult_distrib_left_diff<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="skolem">v</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span> <span class="main">∈</span> VectorSpaceHomSet <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSet_is_fmaps_in_GroupHomSet<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpace_VectorSpaceHomSet"><span class="command">lemma</span></span> VectorSpace_VectorSpaceHomSet <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult'</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">hom_smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> hom_smult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom_smult</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">a</span> <span class="bound">T</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⋆</span></span> <span class="bound">T</span> <span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> VSpW<span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpace <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"VectorSpace <span class="free">hom_smult</span> <span class="main">(</span>VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> VectorSpace.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Module.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> RModule.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> R_scalar_mult<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> VSpW <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group <span class="main">(</span>VectorSpaceHomSet <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Group_VectorSpaceHomSet <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule_axioms UNIV <span class="free">hom_smult</span> <span class="main">(</span>VectorSpaceHomSet <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">S</span> <span class="skolem">T</span>
    <span class="keyword3"><span class="command">assume</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> VectorSpaceHomSet <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>  T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> VectorSpaceHomSet <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span> <span class="main">∈</span> VectorSpaceHomSet <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> VectorSpaceHomSetI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms T <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_VectorSpaceHom VectorSpaceHomSetD_Im
              VectorSpaceHom.VectorSpaceHom_scalar_mul
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
      <span class="keyword1"><span class="command">from</span></span> hom_smult <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span><span class="main">)</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_Im<span class="main">[</span><span class="operator">OF</span> T<span class="main">]</span> VectorSpace.smult_closed<span class="main">[</span><span class="operator">OF</span> VSpW<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="main">(</span><span class="skolem">S</span> <span class="main">+</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">S</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="main">(</span><span class="skolem">S</span> <span class="main">+</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">S</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_Im<span class="main">[</span><span class="operator">OF</span> S<span class="main">]</span> VectorSpaceHomSetD_Im<span class="main">[</span><span class="operator">OF</span> T<span class="main">]</span>
              VectorSpace.smult_distrib_left<span class="main">[</span><span class="operator">OF</span> VSpW<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="skolem">v</span>"</span></span><span class="main">]</span>
              VectorSpaceHomSetD_VectorSpaceHom<span class="main">[</span><span class="operator">OF</span> S<span class="main">]</span>
              VectorSpaceHomSetD_VectorSpaceHom<span class="main">[</span><span class="operator">OF</span> S<span class="main">]</span>
              VectorSpaceHom.supp suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">T</span></span><span class="main">]</span>
              VectorSpace.smult_zero
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_Im<span class="main">[</span><span class="operator">OF</span> T<span class="main">]</span> VectorSpace.smult_distrib_right
              VectorSpaceHomSetD_VectorSpaceHom<span class="main">[</span><span class="operator">OF</span> T<span class="main">]</span> VectorSpaceHom.supp
              suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> VectorSpace.smult_zero
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">b</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">b</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_Im<span class="main">[</span><span class="operator">OF</span> T<span class="main">]</span> VectorSpace.smult_assoc
              VectorSpaceHomSetD_VectorSpaceHom<span class="main">[</span><span class="operator">OF</span> T<span class="main">]</span>
              VectorSpaceHom.supp suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
              VectorSpace.smult_zero<span class="main">[</span><span class="operator">OF</span> VSpW<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
              VectorSpace.smult_zero<span class="main">[</span><span class="operator">OF</span> VSpW<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
              VectorSpace.smult_zero<span class="main">[</span><span class="operator">OF</span> VSpW<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">from</span></span> assms T <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main"><span class="free">⋆⋅</span></span> <span class="skolem">T</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">T</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_Im VectorSpace.one_smult
              VectorSpaceHomSetD_VectorSpaceHom VectorSpaceHom.supp
              suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> VectorSpace.smult_zero
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context VectorSpace *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts about endomorphisms›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-ModuleEnd_over_field_is_VectorSpaceEnd"><span class="command">lemma</span></span> ModuleEnd_over_field_is_VectorSpaceEnd <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span><span class="main">::</span>field <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ModuleEnd <span class="free">smult</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"VectorSpaceEnd <span class="free">smult</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> VectorSpaceEndI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> VectorSpaceHom.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ModuleHom <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ModuleEnd.axioms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span>  <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ModuleEnd.endomorph <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> VectorSpace
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> VectorSpaceEnd_inner_dirsum_el_decomp_nth <span class="main">=</span>
  RModuleEnd_inner_dirsum_el_decomp_nth<span class="main">[</span>
    <span class="operator">THEN</span> RModuleEnd_over_UNIV_is_ModuleEnd<span class="main">,</span>
    <span class="operator">THEN</span> ModuleEnd_over_field_is_VectorSpaceEnd
  <span class="main">]</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">end_smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅⋅</span>"</span> 70<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">⋅⋅</span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="bound">v</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">end_lincomb</span>
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∙⋅⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">end_lincomb</span> <span class="main">≡</span> scalar_mult.lincomb end_smult"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-end_smult0"><span class="command">lemma</span></span> end_smult0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> smult_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-end_0smult"><span class="command">lemma</span></span> end_0smult<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="free">T</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">⋅⋅</span> <span class="free">T</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-end_smult_distrib_left"><span class="command">lemma</span></span> end_smult_distrib_left <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"range <span class="free">S</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"range <span class="free">T</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">+</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="free">S</span> <span class="main">+</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">+</span> <span class="free">T</span><span class="main">)</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">⋅⋅</span> <span class="free">S</span>  <span class="main">+</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="free">T</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-end_smult_distrib_right"><span class="command">lemma</span></span> end_smult_distrib_right <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"range <span class="free">T</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">⋅⋅</span> <span class="free">T</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="free">T</span> <span class="main">+</span> <span class="free">b</span> <span class="main">⋅⋅</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">⋅⋅</span> <span class="free">T</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">⋅⋅</span> <span class="free">T</span> <span class="main">+</span> <span class="free">b</span> <span class="main">⋅⋅</span> <span class="free">T</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_distrib_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-end_smult_assoc"><span class="command">lemma</span></span> end_smult_assoc <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"range <span class="free">T</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⋅⋅</span> <span class="free">b</span> <span class="main">⋅⋅</span> <span class="free">T</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">⋅⋅</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⋅⋅</span> <span class="free">b</span> <span class="main">⋅⋅</span> <span class="free">T</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">⋅⋅</span> <span class="free">T</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-end_smult_comp_comm_left"><span class="command">lemma</span></span> end_smult_comp_comm_left <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⋅⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">∘</span> <span class="free">S</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-end_idhom"><span class="command">lemma</span></span> end_idhom <span class="main">:</span> <span class="quoted"><span class="quoted">"VEnd <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> VectorSpaceEnd.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> VectorSpaceHom_idhom<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpaceEndSet_is_VectorSpaceHomSet"><span class="command">lemma</span></span> VectorSpaceEndSet_is_VectorSpaceHomSet <span class="main">:</span>
  <span class="quoted"><span class="quoted">"VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> VEnd <span class="bound">T</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="free">V</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> VEnd <span class="bound">T</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_VectorSpaceHom VectorSpaceHomSetD_Im
          VectorSpaceEndI
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHomSet <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="free">V</span> <span class="main">⊇</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> VEnd <span class="bound">T</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.VectorSpaceHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span>
          VectorSpaceEnd.endomorph<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span>
          VectorSpaceHomSetI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="main">_</span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpace_VectorSpaceEndSet"><span class="command">lemma</span></span> VectorSpace_VectorSpaceEndSet <span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpace end_smult VectorSpaceEndSet"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VectorSpace_axioms VectorSpace_VectorSpaceHomSet
        VectorSpaceEndSet_is_VectorSpaceHomSet
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context VectorSpace *)</span>

<span class="keyword1"><span class="command">context</span></span> VectorSpaceEnd
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> f_map                         <span class="main">=</span> R_map
<span class="keyword1"><span class="command">lemmas</span></span> supp                          <span class="main">=</span> supp
<span class="keyword1"><span class="command">lemmas</span></span> GroupEnd                      <span class="main">=</span> ModuleEnd.GroupEnd<span class="main">[</span><span class="operator">OF</span> ModuleEnd<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> idhom_left                    <span class="main">=</span> idhom_left
<span class="keyword1"><span class="command">lemmas</span></span> range                         <span class="main">=</span> GroupEnd.range<span class="main">[</span><span class="operator">OF</span> GroupEnd<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> Ker0_imp_inj_on               <span class="main">=</span> Ker0_imp_inj_on
<span class="keyword1"><span class="command">lemmas</span></span> inj_on_imp_Ker0               <span class="main">=</span> inj_on_imp_Ker0
<span class="keyword1"><span class="command">lemmas</span></span> nonzero_Ker_el_imp_n_inj      <span class="main">=</span> nonzero_Ker_el_imp_n_inj
<span class="keyword1"><span class="command">lemmas</span></span> VectorSpaceHom_composite_left
              <span class="main">=</span> VectorSpaceHom_composite_left<span class="main">[</span><span class="operator">OF</span> endomorph<span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-in_VEndSet"><span class="command">lemma</span></span> in_VEndSet <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> VectorSpaceEndSet"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-end_smult_comp_comm_right"><span class="command">lemma</span></span> end_smult_comp_comm_right <span class="main">:</span>
  <span class="quoted"><span class="quoted">"range <span class="free">S</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">∘</span> <span class="main">(</span><span class="free">a</span> <span class="main">⋅⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> f_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-VEnd_end_smult_VEnd"><span class="command">lemma</span></span> VEnd_end_smult_VEnd <span class="main">:</span> <span class="quoted"><span class="quoted">"VEnd <span class="main">(</span><span class="free">a</span> <span class="main">⋅⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> in_VEndSet VectorSpace.smult_closed<span class="main">[</span><span class="operator">OF</span> VectorSpace_VectorSpaceEndSet<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-VEnd_composite_left"><span class="command">lemma</span></span> VEnd_composite_left <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"VEnd <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"VEnd <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> endomorph VectorSpaceEnd.axioms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> VectorSpaceHom_composite_left
        VectorSpaceEnd.endomorph<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> VectorSpaceEndI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∘</span> <span class="free">T</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-VEnd_composite_right"><span class="command">lemma</span></span> VEnd_composite_right <span class="main">:</span> <span class="quoted"><span class="quoted">"VEnd <span class="free">S</span> <span class="main">⟹</span> VEnd <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd_axioms VectorSpaceEnd.VEnd_composite_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context VectorSpaceEnd *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpace<span class="main">)</span> inj_comp_end <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"VEnd <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">S</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"VEnd <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">T</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ker <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> ker <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> kerD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∘</span> <span class="free">T</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.endomorph<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> kerI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span>
            VectorSpaceEnd.inj_on_imp_Ker0<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> kerI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> VectorSpaceEnd.inj_on_imp_Ker0<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.VEnd_composite_right VectorSpaceEnd.Ker0_imp_inj_on
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> VectorSpace<span class="main">)</span> n_inj_comp_end <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> VEnd <span class="free">S</span><span class="main">;</span> VEnd <span class="free">T</span><span class="main">;</span> <span class="main">¬</span> inj_on <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="free">V</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> inj_on <span class="free">S</span> <span class="free">V</span> <span class="main">∨</span> <span class="main">¬</span> inj_on <span class="free">T</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inj_comp_end <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomials of endomorphisms›</span></span>

<span class="keyword1"><span class="command">context</span></span> VectorSpaceEnd
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">endpow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">⇒</span><span class="tfree">'v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> endpow0<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">endpow</span> <span class="main">0</span> <span class="main">=</span> id<span class="main">↓</span><span class="free">V</span>"</span></span>
  <span class="main">|</span>     endpowSuc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">endpow</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="main">∘</span> <span class="main">(</span><span class="free">endpow</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">polymap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> poly <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">⇒</span><span class="tfree">'v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">polymap</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span>coeffs <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∙⋅⋅</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-VEnd_endpow"><span class="command">lemma</span></span> VEnd_endpow <span class="main">:</span> <span class="quoted"><span class="quoted">"VEnd <span class="main">(</span>endpow <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> end_idhom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"VEnd <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"VEnd <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>endpow <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> VEnd_composite_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"endpow <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>endpow <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VEnd <span class="main">(</span>endpow <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-endpow_list_apply_closed"><span class="command">lemma</span></span> endpow_list_apply_closed <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VEnd_endpow VectorSpaceEnd.endomorph <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-map_endpow_Suc"><span class="command">lemma</span></span> map_endpow_Suc <span class="main">:</span>
  <span class="quoted"><span class="quoted">"map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> id <span class="main">↓</span> <span class="free">V</span>
              <span class="main">#</span> map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span> <span class="main">[</span>endpow <span class="skolem">k</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> id <span class="main">↓</span> <span class="free">V</span> <span class="main">#</span> map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-T_endpow_list_apply_commute"><span class="command">lemma</span></span> T_endpow_list_apply_commute <span class="main">:</span>
  <span class="quoted"><span class="quoted">"map <span class="free">T</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-polymap0"><span class="command">lemma</span></span> polymap0 <span class="main">:</span> <span class="quoted"><span class="quoted">"polymap <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polymap_def scalar_mult.lincomb_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-VEnd_polymap"><span class="command">lemma</span></span> VEnd_polymap <span class="main">:</span> <span class="quoted"><span class="quoted">"VEnd <span class="main">(</span>polymap <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> VEnd <span class="bound">S</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VEnd_endpow <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> polymap_def VectorSpace_VectorSpaceEndSet VectorSpace.lincomb_closed
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-polymap_pCons"><span class="command">lemma</span></span> polymap_pCons <span class="main">:</span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>polymap <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> polymap0 VectorSpace_VectorSpaceEndSet VectorSpace.zero_smult end_idhom
            comp_zero
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zmap</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zmap</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'v</span><span class="main">⇒</span><span class="tfree">'v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>endpow <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> polymap_def scalar_mult.lincomb_singles <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>polymap <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p polymap0 comp_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span>
              <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∙⋅⋅</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> polymap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">∙⋅⋅</span> <span class="main">(</span><span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> map_endpow_Suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>
                  <span class="main">∙⋅⋅</span> <span class="main">(</span>map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> scalar_mult.lincomb_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">S</span><span class="main">)</span>
                  <span class="main">←</span>zip <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
                      <span class="bound">c</span> <span class="main">⋅⋅</span> <span class="bound">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> scalar_mult.lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> calc<span class="main">:</span>
    <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span>
      <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">←</span>zip <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> <span class="bound">c</span> <span class="main">⋅⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>endpow <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_list_prod_map2<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">c</span> <span class="main">⋅⋅</span> <span class="bound">S</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∘)</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="main">]</span>
          sum_list_prod_map2<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">c</span> <span class="main">⋅⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="bound">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span>"</span></span> <span class="quoted">endpow</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>polymap <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> calc
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span>
                    <span class="main">←</span>zip <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> <span class="bound">c</span> <span class="main"><span class="free">⋅</span></span> <span class="free">T</span> <span class="main">(</span>endpow <span class="bound">k</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum_list_prod_fun_apply<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">c</span> <span class="main">⋅⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>endpow <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span> <span class="main">+</span> <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span>map <span class="free">T</span>
                  <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum_list_prod_map2<span class="main">[</span>
                <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">c</span> <span class="main"><span class="free">⋅</span></span> <span class="free">T</span> <span class="main">(</span><span class="bound">S</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span>"</span></span> <span class="quoted">endpow</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span>"</span></span>
              <span class="main">]</span>
              sum_list_prod_map2<span class="main">[</span>
                <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">c</span> <span class="main"><span class="free">⋅</span></span> <span class="free">T</span> <span class="bound">u</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span>"</span></span>
              <span class="main">]</span>
              sum_list_prod_map2<span class="main">[</span>
                <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">c</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">u</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">T</span></span>
                   <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="main">]</span>
              lincomb_def
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> True
        <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span> <span class="main">+</span> <span class="free">T</span> <span class="main">(</span> <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>
                    <span class="main">∙⋅</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> endpow_list_apply_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">]</span> distrib_lincomb
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> True lincomb_def
              sum_list_prod_map2<span class="main">[</span>
                <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">c</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">u</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span>"</span></span>
              <span class="main">]</span>
              sum_list_prod_fun_apply<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">c</span> <span class="main">⋅⋅</span> <span class="bound">S</span>"</span></span><span class="main">]</span> polymap_def 
              scalar_mult.lincomb_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">end_smult</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> VEnd_polymap VectorSpaceEnd.supp suppI_contra <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>polymap <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> smult_zero VEnd_polymap<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> VectorSpaceEnd.supp suppI_contra
              im_zero
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-polymap_plus"><span class="command">lemma</span></span> polymap_plus <span class="main">:</span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> polymap <span class="free">p</span> <span class="main">+</span> polymap <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> pCons_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 00 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> polymap0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">case</span></span> lpCons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> polymap0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">case</span></span> rpCons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> polymap0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons2 <span class="skolem">a</span> <span class="skolem">p</span> <span class="skolem">b</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">+</span> pCons <span class="skolem">b</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span>
              <span class="main">+</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>polymap <span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> polymap_pCons end_idhom end_smult_distrib_right<span class="main">[</span><span class="operator">OF</span> VectorSpaceEnd.range<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> pCons2<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>polymap <span class="skolem">p</span> <span class="main">+</span> polymap <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>   <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> pCons2<span class="main">(</span>3<span class="main">)</span> distrib_comp_sum_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"polymap <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"polymap <span class="skolem">q</span>"</span></span><span class="main">]</span> VEnd_polymap
          VectorSpaceEnd.range polymap_pCons
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-polymap_polysmult"><span class="command">lemma</span></span> polymap_polysmult <span class="main">:</span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>Polynomial.smult <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> polymap <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>Polynomial.smult <span class="free">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> polymap <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> polymap0 end_smult0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>Polynomial.smult <span class="free">a</span> <span class="main">(</span>pCons <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="skolem">b</span> <span class="main">⋅⋅</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> polymap <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> polymap_pCons VectorSpaceEnd.range<span class="main">[</span><span class="operator">OF</span> VEnd_polymap<span class="main">]</span>
          end_smult_comp_comm_right VectorSpaceEnd.range<span class="main">[</span><span class="operator">OF</span> end_idhom<span class="main">]</span> end_smult_assoc
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>Polynomial.smult <span class="free">a</span> <span class="main">(</span>pCons <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅⋅</span> <span class="main">(</span>polymap <span class="main">(</span>pCons <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.VEnd_end_smult_VEnd<span class="main">[</span><span class="operator">OF</span> end_idhom<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
          VEnd_composite_right<span class="main">[</span><span class="operator">OF</span> VEnd_polymap<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
          end_smult_distrib_left<span class="main">[</span>
            <span class="operator">OF</span> VectorSpaceEnd.range VectorSpaceEnd.range<span class="main">,</span>
            <span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span> <span class="main">_</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∘</span> polymap <span class="skolem">p</span>"</span></span>
          <span class="main">]</span>
          polymap_pCons
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-polymap_times"><span class="command">lemma</span></span> polymap_times <span class="main">:</span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>polymap <span class="free">p</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>polymap <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> polymap0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⋅⋅</span> polymap <span class="free">q</span> <span class="main">+</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>polymap <span class="main">(</span><span class="skolem">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> polymap_plus polymap_polysmult polymap_pCons end_idhom
          end_0smult<span class="main">[</span><span class="operator">OF</span> VectorSpaceEnd.range<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> pCons<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⋅⋅</span> <span class="main">(</span><span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">∘</span> polymap <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> polymap <span class="skolem">p</span> <span class="main">∘</span> polymap <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.endomorph<span class="main">[</span><span class="operator">OF</span> VEnd_polymap<span class="main">]</span>
          VectorSpaceEnd.idhom_left<span class="main">[</span><span class="operator">OF</span> VEnd_polymap<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>polymap <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span>polymap <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> end_smult_comp_comm_left
          distrib_comp_sum_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⋅⋅</span> id <span class="main">↓</span> <span class="free">V</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"polymap <span class="free">q</span>"</span></span><span class="main">]</span>
          polymap_pCons
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-polymap_apply"><span class="command">lemma</span></span> polymap_apply <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"polymap <span class="free">p</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>
                <span class="main">∙⋅</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_Nil scalar_mult.lincomb_Nil<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted">end_smult</span><span class="main">]</span> polymap_def
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> pCons<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⋅⋅</span> id<span class="main">↓</span><span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> polymap_pCons polymap0 comp_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms pCons<span class="main">(</span>1<span class="main">)</span> lincomb_singles <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> assms pCons<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span>
                  <span class="main">+</span> <span class="free">T</span> <span class="main">(</span>coeffs <span class="skolem">p</span> <span class="main">∙⋅</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> polymap_pCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms pCons<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  1<span class="main">:</span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>coeffs <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">v</span> <span class="main">#</span>
                      map <span class="free">T</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> endpow_list_apply_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main">]</span> distrib_lincomb lincomb_Cons
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="free">T</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T_endpow_list_apply_commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 1 2
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>coeffs <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">v</span> <span class="main">#</span>
                  map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subst<span class="main">[</span>
              <span class="operator">OF</span> 2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> polymap <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>coeffs <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span><span class="free">v</span> <span class="main">#</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"polymap <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>coeffs <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∙⋅</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span> <span class="main">#</span> map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span>
                      <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span>   <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> False pCons<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  4<span class="main">:</span> <span class="quoted"><span class="quoted">"id <span class="main">↓</span> <span class="free">V</span> <span class="main">#</span> map <span class="main">(</span><span class="main">(∘)</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span>map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>
                      <span class="main">=</span> map endpow <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> map_endpow_Suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">THEN</span> sym<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> subst<span class="main">[</span>
              <span class="operator">OF</span> 4<span class="main">,</span>
              <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> polymap <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">v</span>
                        <span class="main">=</span> <span class="main">(</span>coeffs <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="free">v</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-polymap_apply_linear"><span class="command">lemma</span></span> polymap_apply_linear <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> polymap <span class="main">[:</span><span class="main">-</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="free">v</span> <span class="main">=</span> <span class="free">T</span> <span class="free">v</span> <span class="main">-</span> <span class="free">c</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polymap_apply lincomb_def neg_smult endomorph <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-polymap_const_inj"><span class="command">lemma</span></span> polymap_const_inj <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>polymap <span class="free">p</span><span class="main">)</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"polymap <span class="free">p</span> <span class="skolem">u</span> <span class="main">=</span> polymap <span class="free">p</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span> <span class="main">=</span> <span class="main">[</span>coeff <span class="free">p</span> <span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeffs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> uv assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>coeff <span class="free">p</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> polymap_apply lincomb_singles <span class="keyword1"><span class="command">unfolding</span></span> coeffs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms uv<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> const_poly_nonzero_coeff cancel_scalar <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-n_inj_polymap_times"><span class="command">lemma</span></span> n_inj_polymap_times <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> inj_on <span class="main">(</span>polymap <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span>
        <span class="main">⟹</span> <span class="main">¬</span> inj_on <span class="main">(</span>polymap <span class="free">p</span><span class="main">)</span> <span class="free">V</span> <span class="main">∨</span> <span class="main">¬</span> inj_on <span class="main">(</span>polymap <span class="free">q</span><span class="main">)</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polymap_times VEnd_polymap n_inj_comp_end <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the following lemma, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[:</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">:]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the linear polynomial <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">c</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-n_inj_polymap_findlinear"><span class="command">lemma</span></span> n_inj_polymap_findlinear <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'f</span> poly<span class="main">.</span> degree <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¬</span> inj_on <span class="main">(</span>polymap <span class="free">p</span><span class="main">)</span> <span class="free">V</span>
                <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">¬</span> inj_on <span class="main">(</span>polymap <span class="main">[:</span><span class="main">-</span><span class="bound">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="skolem">n</span> <span class="main"><span class="main">≡</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> polymap_const_inj <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> alg_closed <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> synthetic_div <span class="skolem">p</span> <span class="skolem">c</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> p_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> synthetic_div_correct'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>polymap <span class="skolem">q</span><span class="main">)</span> <span class="free">V</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> Suc<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> p_decomp n_inj_polymap_times <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> degree <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> degree_synthetic_div <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> q_def <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">=</span> degree <span class="skolem">p</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> p_decomp
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context VectorSpaceEnd *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of eigenvectors of endomorphisms of finite-dimensional vector spaces›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FinDimVectorSpace<span class="main">)</span> endomorph_has_eigenvector <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'a</span> poly<span class="main">.</span> degree <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     dim       <span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="free">V</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     endo      <span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpaceEnd <span class="free">smult</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">T</span> <span class="bound">u</span> <span class="main">=</span> <span class="bound">c</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Tpolymap</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Tpolymap</span> <span class="main">=</span> VectorSpaceEnd.polymap <span class="free">smult</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> dim <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dim_nonzero nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Tpows</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Tpows</span> <span class="main">=</span> map <span class="main">(</span>VectorSpaceEnd.endpow <span class="free">V</span> <span class="free">T</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>dim <span class="free">V</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Tpows_v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Tpows_v</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">Tpows</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> endo Tpows_def v<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Tpows_v_V<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Tpows_v</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.endpow_list_apply_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Tpows_v_def Tpows_def Tpows_v_V <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lin_independent <span class="skolem">Tpows_v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> too_long_lin_dependent <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">as</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">as</span> <span class="main">=</span> length <span class="skolem">Tpows_v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">∙⋅</span> <span class="skolem">Tpows_v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lin_dependent_dependence_relation
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Poly <span class="skolem">as</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> dim Tpows_def Tpows_v_def as<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> p_n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nonzero_coeffs_nonzero_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">as</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Tpows'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Tpows'</span> <span class="main">=</span> map <span class="main">(</span>VectorSpaceEnd.endpow <span class="free">V</span> <span class="free">T</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Tpows_v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Tpows_v'</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">Tpows'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Tpows'</span> <span class="main">=</span> take <span class="main">(</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Tpows</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> Tpows_def
      <span class="keyword1"><span class="command">have</span></span>  1<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Tpows</span> <span class="main">=</span> map <span class="main">(</span>VectorSpaceEnd.endpow <span class="free">V</span> <span class="free">T</span><span class="main">)</span>
                      <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>dim <span class="free">V</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> take_map<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>dim <span class="free">V</span><span class="main">)</span><span class="main">]</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> p_n0 p_def as<span class="main">(</span>2<span class="main">)</span> Tpows_v_def Tpows_def
      <span class="keyword1"><span class="command">have</span></span>  2<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>dim <span class="free">V</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> length_coeffs_degree<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> length_strip_while_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(=)</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="skolem">as</span></span><span class="main">]</span>
            take_upt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>dim <span class="free">V</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 1 Tpows'_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Tpows</span> <span class="main">=</span> <span class="skolem">Tpows'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subst<span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> Tpows_v_def Tpows_v'_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Tpows_v'</span> <span class="main">=</span> take <span class="main">(</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Tpows_v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> take_map<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="skolem">Tpows</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p_def Tpows_v_V as<span class="main">(</span>3<span class="main">)</span> Tpows_v'_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>coeffs <span class="skolem">p</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="skolem">Tpows_v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_strip_while_0coeffs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>coeffs <span class="skolem">p</span><span class="main">)</span> <span class="main">∙⋅</span> <span class="skolem">Tpows_v'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p_n0 lincomb_conv_take_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"coeffs <span class="skolem">p</span>"</span></span><span class="main">]</span> length_coeffs_degree<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Tpolymap_def v<span class="main">(</span>1<span class="main">)</span> Tpows_v'_def Tpows'_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Tpolymap</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.polymap_apply<span class="main">[</span><span class="operator">OF</span> endo<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> alg_closed Tpolymap_def v endo p_n0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inj_on <span class="main">(</span><span class="skolem">Tpolymap</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.VEnd_polymap VectorSpaceEnd.nonzero_Ker_el_imp_n_inj
          VectorSpaceEnd.n_inj_polymap_findlinear<span class="main">[</span><span class="operator">OF</span> endo<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> Tpolymap_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>GroupHom.Ker <span class="free">V</span> <span class="main">(</span><span class="skolem">Tpolymap</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.VEnd_polymap<span class="main">[</span><span class="operator">OF</span> endo<span class="main">]</span> VectorSpaceEnd.Ker0_imp_inj_on
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Tpolymap</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kerD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> Tpolymap_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.polymap_apply_linear<span class="main">[</span><span class="operator">OF</span> endo<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Modules Over a Group Ring›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Almost-everywhere-zero functions as scalars›</span></span>

<span class="keyword1"><span class="command">locale</span></span> aezfun_scalar_mult <span class="main">=</span> scalar_mult <span class="quoted"><span class="free">smult</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">smult</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'r</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'g</span><span class="main">::</span>group_add<span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fsmult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">♯⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">♯⋅</span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">flincomb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'r</span> list <span class="main">⇒</span> <span class="tfree">'v</span> list <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∙♯⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main"><span class="free">∙♯⋅</span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">≡</span> scalar_mult.lincomb fsmult <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">f_lin_independent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f_lin_independent</span> <span class="main">≡</span> scalar_mult.lin_independent fsmult"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">fSpan</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list <span class="main">⇒</span> <span class="tfree">'v</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fSpan</span> <span class="main">≡</span> scalar_mult.Span fsmult"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gmult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">*⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">*⋅</span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> R_scalar_mult <span class="main">=</span> R_scalar_mult

<span class="keyword1" id="Rep_Fin_Groups-fsmultD"><span class="command">lemma</span></span> fsmultD <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">♯⋅</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fsmult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-GmultD"><span class="command">lemma</span></span> GmultD <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">*⋅</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Gmult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">negGorbit_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'v</span> list list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">negGorbit_list</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> map <span class="main">(</span>Gmult <span class="main">(</span><span class="main">-</span><span class="bound">g</span><span class="main">)</span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-negGorbit_Cons"><span class="command">lemma</span></span> negGorbit_Cons <span class="main">:</span>
  <span class="quoted"><span class="quoted">"negGorbit_list <span class="main">(</span><span class="free">g</span><span class="main">#</span><span class="free">gs</span><span class="main">)</span> <span class="free">T</span> <span class="free">as</span>
        <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span>Gmult <span class="main">(</span><span class="main">-</span><span class="free">g</span><span class="main">)</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="main">#</span> negGorbit_list <span class="free">gs</span> <span class="free">T</span> <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> negGorbit_list_def<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">as</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-length_negGorbit_list"><span class="command">lemma</span></span> length_negGorbit_list <span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>negGorbit_list <span class="free">gs</span> <span class="free">T</span> <span class="free">as</span><span class="main">)</span> <span class="main">=</span> length <span class="free">gs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> negGorbit_list_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">gs</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-length_negGorbit_list_sublist"><span class="command">lemma</span></span> length_negGorbit_list_sublist <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">∈</span> set <span class="main">(</span>negGorbit_list <span class="free">gs</span> <span class="free">T</span> <span class="free">as</span><span class="main">)</span> <span class="main">⟹</span> length <span class="free">fs</span> <span class="main">=</span> length <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> negGorbit_list_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">gs</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-length_concat_negGorbit_list"><span class="command">lemma</span></span> length_concat_negGorbit_list <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>concat <span class="main">(</span>negGorbit_list <span class="free">gs</span> <span class="free">T</span> <span class="free">as</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">gs</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>length <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> length_concat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"negGorbit_list <span class="free">gs</span> <span class="free">T</span> <span class="free">as</span>"</span></span><span class="main">]</span>
        length_negGorbit_list_sublist<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">gs</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">as</span></span><span class="main">]</span>
        const_sum_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"negGorbit_list <span class="free">gs</span> <span class="free">T</span> <span class="free">as</span>"</span></span> <span class="quoted">length</span> <span class="quoted"><span class="quoted">"length <span class="free">as</span>"</span></span><span class="main">]</span> length_negGorbit_list
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-negGorbit_list_nth"><span class="command">lemma</span></span> negGorbit_list_nth <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">gs</span> <span class="main">⟹</span> <span class="main">(</span>negGorbit_list <span class="free">gs</span> <span class="free">T</span> <span class="free">as</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> map <span class="main">(</span>Gmult <span class="main">(</span><span class="main">-</span><span class="free">gs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="free">as</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">gs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">g</span> <span class="skolem">gs</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> negGorbit_Cons<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context aezfun_scalar_mult *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Locale and basic facts›</span></span>

<span class="keyword1"><span class="command">locale</span></span> FGModule <span class="main">=</span> ActingGroup<span class="main">?</span><span class="main">:</span> Group <span class="quoted"><span class="free">G</span></span>
<span class="main">+</span> FGMod<span class="main">?</span><span class="main">:</span> RModule <span class="quoted">ActingGroup.group_ring</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> FGModule <span class="main">&lt;</span> aezfun_scalar_mult <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> trivial_FGModule <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> smult_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>group_ring<span class="main">.</span> <span class="free">smult</span> <span class="bound">a</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'v</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModule.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule group_ring  <span class="free">smult</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ring1_RG trivial_RModule <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> FGModule
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">FG</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">FG</span> <span class="main">≡</span> ActingGroup.group_ring"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">FGSubmodule</span> <span class="main">≡</span> RSubmodule"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">FG_proj</span>     <span class="main">≡</span> ActingGroup.RG_proj"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-GroupG"><span class="command">lemma</span></span> GroupG<span class="main">:</span> <span class="quoted"><span class="quoted">"Group <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> zero_closed            <span class="main">=</span> zero_closed
<span class="keyword1"><span class="command">lemmas</span></span> neg_closed             <span class="main">=</span> neg_closed
<span class="keyword1"><span class="command">lemmas</span></span> diff_closed            <span class="main">=</span> diff_closed
<span class="keyword1"><span class="command">lemmas</span></span> zero_smult             <span class="main">=</span> zero_smult
<span class="keyword1"><span class="command">lemmas</span></span> smult_zero             <span class="main">=</span> smult_zero
<span class="keyword1"><span class="command">lemmas</span></span> AbGroup                <span class="main">=</span> AbGroup
<span class="keyword1"><span class="command">lemmas</span></span> sum_closed          <span class="main">=</span> AbGroup.sum_closed<span class="main">[</span><span class="operator">OF</span> AbGroup<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> FGSubmoduleI           <span class="main">=</span> RSubmoduleI
<span class="keyword1"><span class="command">lemmas</span></span> FG_proj_mult_leftdelta <span class="main">=</span> ActingGroup.RG_proj_mult_leftdelta
<span class="keyword1"><span class="command">lemmas</span></span> FG_proj_mult_right     <span class="main">=</span> ActingGroup.RG_proj_mult_right
<span class="keyword1"><span class="command">lemmas</span></span> FG_el_decomp           <span class="main">=</span> ActingGroup.RG_el_decomp_aezdeltafun

<span class="keyword1" id="Rep_Fin_Groups-FG_n0"><span class="command">lemma</span></span> FG_n0<span class="main">:</span> <span class="quoted"><span class="quoted">"FG <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ActingGroup.RG_n0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-FG_proj_in_FG"><span class="command">lemma</span></span> FG_proj_in_FG <span class="main">:</span> <span class="quoted"><span class="quoted">"FG_proj <span class="free">x</span> <span class="main">∈</span> FG"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ActingGroup.RG_proj_in_RG <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-FG_fddg_closed"><span class="command">lemma</span></span> FG_fddg_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">δδ</span> <span class="free">g</span> <span class="main">∈</span> FG"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ActingGroup.RG_aezdeltafun_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-FG_fdd0_closed"><span class="command">lemma</span></span> FG_fdd0_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">δδ</span> <span class="main">0</span> <span class="main">∈</span> FG"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ActingGroup.RG_aezdelta0fun_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-Gmult_closed"><span class="command">lemma</span></span> Gmult_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FG_fddg_closed smult_closed GmultD <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-map_Gmult_closed"><span class="command">lemma</span></span> map_Gmult_closed <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟹</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">(*⋅)</span> <span class="free">g</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Gmult_def FG_fddg_closed map_smult_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-Gmult0"><span class="command">lemma</span></span> Gmult0 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*⋅</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*⋅</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> GmultD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> one_aezfun_transfer <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*⋅</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun<span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> one_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Gmult_assoc"><span class="command">lemma</span></span> Gmult_assoc <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">*⋅</span> <span class="free">h</span> <span class="main">*⋅</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">+</span> <span class="free">h</span><span class="main">)</span> <span class="main">*⋅</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">*⋅</span> <span class="free">h</span> <span class="main">*⋅</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">δδ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FG_fddg_closed GmultD <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> n_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">δδ</span> <span class="free">g</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">δδ</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">g</span> <span class="main">+</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> times_aezdeltafun_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">h</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n_def GmultD <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Gmult_distrib_left"><span class="command">lemma</span></span> Gmult_distrib_left <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">;</span> <span class="free">v'</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="main">(</span><span class="free">v</span> <span class="main">+</span> <span class="free">v'</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="free">v</span> <span class="main">+</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> GmultD FG_fddg_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-neg_Gmult"><span class="command">lemma</span></span> neg_Gmult <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="main">(</span><span class="main">-</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">g</span> <span class="main">*⋅</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> GmultD FG_fddg_closed smult_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-Gmult_neg_left"><span class="command">lemma</span></span> Gmult_neg_left <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">*⋅</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ActingGroup.neg_closed Gmult_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> Gmult0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-fddg_smult_decomp"><span class="command">lemma</span></span> fddg_smult_decomp <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span> <span class="main">=</span> <span class="free">f</span> <span class="main">♯⋅</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> aezdeltafun_decomp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> FG_fddg_closed FG_fdd0_closed GmultD
        fsmult_def
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-sum_list_aezdeltafun_smult_distrib"><span class="command">lemma</span></span> sum_list_aezdeltafun_smult_distrib <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map snd <span class="free">fgs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span><span class="free">fgs</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span><span class="free">fgs</span><span class="main">.</span> <span class="bound">f</span> <span class="main">♯⋅</span> <span class="bound">g</span> <span class="main">*⋅</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map <span class="main">(</span>case_prod aezdeltafun<span class="main">)</span> <span class="free">fgs</span><span class="main">)</span> <span class="main">⊆</span> FG"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FG_fddg_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span><span class="free">fgs</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span><span class="free">fgs</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_list_prod_map_smult_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span><span class="free">fgs</span><span class="main">.</span> <span class="bound">f</span> <span class="main">♯⋅</span> <span class="bound">g</span> <span class="main">*⋅</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms fddg_smult_decomp
          sum_list_prod_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">fgs</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">♯⋅</span> <span class="bound">g</span> <span class="main">*⋅</span> <span class="free">v</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">GSubspace</span> <span class="main">≡</span> RSubmodule"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">GSpan</span>     <span class="main">≡</span> RSpan"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">G_fingen</span>  <span class="main">≡</span> R_fingen"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-GSubspaceI"><span class="command">lemma</span></span> GSubspaceI <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult</span> <span class="free">U</span> <span class="main">⟹</span> <span class="free">U</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">⟹</span> GSubspace <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FGModule.axioms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-GSubspace_is_FGModule"><span class="command">lemma</span></span> GSubspace_is_FGModule <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModule.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> GroupG<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule FG <span class="main"><span class="free">(⋅)</span></span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-restriction_to_subgroup_is_module"><span class="command">lemma</span></span> restriction_to_subgroup_is_module <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">H</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subgrp<span class="main">:</span> <span class="quoted"><span class="quoted">"Group.Subgroup <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModule <span class="free">H</span> <span class="free">smult</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModule.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> subgrp <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule <span class="main">(</span>Group.group_ring <span class="free">H</span><span class="main">)</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ActingGroup.Subgroup_imp_Subring SModule_restrict_scalars <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-negGorbit_list_V"><span class="command">lemma</span></span> negGorbit_list_V <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">gs</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">as</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set <span class="main">(</span>concat <span class="main">(</span>negGorbit_list <span class="free">gs</span> <span class="free">T</span> <span class="free">as</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"set <span class="main">(</span>concat <span class="main">(</span>negGorbit_list <span class="free">gs</span> <span class="free">T</span> <span class="free">as</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">g</span><span class="main">∈</span>set <span class="free">gs</span><span class="main">.</span> <span class="main">(</span>Gmult <span class="main">(</span><span class="main">-</span><span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_concat negGorbit_list_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">gs</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">as</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> set <span class="free">gs</span> <span class="main">⟹</span> <span class="main">(</span>Gmult <span class="main">(</span><span class="main">-</span><span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ActingGroup.neg_closed Gmult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>    
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-negGorbit_list_Cons0"><span class="command">lemma</span></span> negGorbit_list_Cons0 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">as</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>
        <span class="main">⟹</span> negGorbit_list <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="free">gs</span><span class="main">)</span> <span class="free">T</span> <span class="free">as</span> <span class="main">=</span> <span class="main">(</span>map <span class="free">T</span> <span class="free">as</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>negGorbit_list <span class="free">gs</span> <span class="free">T</span> <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> negGorbit_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">gs</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">as</span></span><span class="main">]</span> Gmult0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FGModule *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Modules over a group ring as a vector spaces›</span></span>

<span class="keyword1"><span class="command">context</span></span> FGModule
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-fVectorSpace"><span class="command">lemma</span></span> fVectorSpace <span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpace fsmult <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> VectorSpaceI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="main">♯⋅</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fsmult_def smult_closed FG_fdd0_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="main">♯⋅</span> <span class="main">(</span><span class="bound">u</span> <span class="main">+</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">♯⋅</span> <span class="bound">u</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">♯⋅</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fsmult_def FG_fdd0_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'v</span></span></span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span> <span class="main">♯⋅</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">δδ</span> <span class="main">0</span> <span class="main">+</span> <span class="skolem">b</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aezdeltafun_plus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> arg_cong<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span>"</span></span><span class="main">]</span> fsmult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> v <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span> <span class="main">♯⋅</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">♯⋅</span> <span class="skolem">v</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">♯⋅</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fsmult_def FG_fdd0_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="main">♯⋅</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">♯⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">♯⋅</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> times_aezdeltafun_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> arg_cong fsmult_def FG_fdd0_closed
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'v</span></span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">♯⋅</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_aezfun_transfer arg_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span>"</span></span><span class="main">]</span> fsmult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">fSubspace</span>  <span class="main">≡</span> VectorSpace.Subspace fsmult <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">fbasis_for</span> <span class="main">≡</span> fscalar_mult.basis_for fsmult"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">fdim</span>       <span class="main">≡</span> scalar_mult.dim fsmult <span class="free">V</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpace_fSubspace"><span class="command">lemma</span></span> VectorSpace_fSubspace <span class="main">:</span> <span class="quoted"><span class="quoted">"fSubspace <span class="free">W</span> <span class="main">⟹</span> VectorSpace fsmult <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Module.intro VectorSpace.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-fsmult_closed"><span class="command">lemma</span></span> fsmult_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">♯⋅</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FG_fdd0_closed smult_closed fsmult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> one_fsmult          <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> VectorSpace.one_smult   <span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> fsmult_assoc        <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> VectorSpace.smult_assoc <span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> fsmult_zero         <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> VectorSpace.smult_zero  <span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> fsmult_distrib_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> VectorSpace.smult_distrib_left
                                          <span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> flincomb_closed       <span class="main">=</span> VectorSpace.lincomb_closed       <span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> fsmult_sum_distrib <span class="main">=</span> VectorSpace.smult_sum_distrib <span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> sum_fsmult_distrib <span class="main">=</span> VectorSpace.sum_smult_distrib <span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> flincomb_concat       <span class="main">=</span> VectorSpace.lincomb_concat       <span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> fSpan_closed          <span class="main">=</span> VectorSpace.Span_closed          <span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> flin_independentD_all_scalars
              <span class="main">=</span> VectorSpace.lin_independentD_all_scalars<span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> in_fSpan_obtain_same_length_coeffs
              <span class="main">=</span> VectorSpace.in_Span_obtain_same_length_coeffs <span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-fsmult_smult_comm"><span class="command">lemma</span></span> fsmult_smult_comm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> FG <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">♯⋅</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span> <span class="main">=</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">♯⋅</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fsmultD FG_fdd0_closed smult_assoc aezdelta0fun_commutes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-fsmult_Gmult_comm"><span class="command">lemma</span></span> fsmult_Gmult_comm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">♯⋅</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="free">v</span> <span class="main">=</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="free">a</span> <span class="main">♯⋅</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> aezdeltafun_decomp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> aezdeltafun_decomp'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> FG_fddg_closed
        FG_fdd0_closed fsmult_def GmultD
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-Gmult_flincomb_comm"><span class="command">lemma</span></span> Gmult_flincomb_comm <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">*⋅</span> <span class="free">as</span> <span class="main">∙♯⋅</span> <span class="free">vs</span> <span class="main">=</span> <span class="free">as</span> <span class="main">∙♯⋅</span> <span class="main">(</span>map <span class="main">(</span>Gmult <span class="free">g</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">*⋅</span> <span class="free">as</span> <span class="main">∙♯⋅</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">←</span>zip <span class="free">as</span> <span class="free">vs</span><span class="main">.</span> <span class="bound">a</span> <span class="main">♯⋅</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Gmult_def scalar_mult.lincomb_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">fsmult</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">*⋅</span> <span class="free">as</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>
                        <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main"><span class="free">(⋅)</span></span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">♯⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">as</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_zip_rightD fsmult_closed FG_fddg_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'f</span>"</span></span><span class="main">]</span>
          smult_sum_list_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>case_prod <span class="main">(♯⋅)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">as</span> <span class="free">vs</span><span class="main">)</span>"</span></span><span class="main">]</span>
          map_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"case_prod <span class="main">(♯⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"zip <span class="free">as</span> <span class="free">vs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">♯⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="bound">x</span> <span class="main">♯⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">*⋅</span> <span class="free">as</span> <span class="main">∙♯⋅</span> <span class="free">vs</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="bound">x</span> <span class="main">♯⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">as</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Gmult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">as</span> <span class="free">vs</span><span class="main">)</span><span class="main">.</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="bound">x</span> <span class="main">♯⋅</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">♯⋅</span> <span class="free">g</span> <span class="main">*⋅</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_zip_rightD fsmult_Gmult_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">*⋅</span> <span class="free">as</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>
                        <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">♯⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">as</span> <span class="main">(</span>map <span class="main">(</span>Gmult <span class="free">g</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_list_prod_cong sum_list_prod_map2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">♯⋅</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="quoted">"Gmult <span class="free">g</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> scalar_mult.lincomb_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">fsmult</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-GSubspace_is_Subspace"><span class="command">lemma</span></span> GSubspace_is_Subspace <span class="main">:</span>
  <span class="quoted"><span class="quoted">"GSubspace <span class="free">U</span> <span class="main">⟹</span> VectorSpace.Subspace fsmult <span class="free">V</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> GSubspace_is_FGModule FGModule.fVectorSpace VectorSpace.axioms
        Module.axioms
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FGModule *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Homomorphisms of modules over a group ring›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locales›</span></span>

<span class="keyword1"><span class="command">locale</span></span> FGModuleHom <span class="main">=</span> ActingGroup<span class="main">?</span><span class="main">:</span> Group <span class="quoted"><span class="free">G</span></span>
<span class="main">+</span> RModHom<span class="main">?</span><span class="main">:</span> RModuleHom <span class="quoted">ActingGroup.group_ring</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> FGModuleHom <span class="main">&lt;</span> FGModule <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FGModule<span class="main">)</span> FGModuleHomI_fromaxioms <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="bound">v'</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">v</span> <span class="main">+</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="bound">v</span> <span class="main">+</span> <span class="free">T</span> <span class="bound">v'</span>"</span></span>
          <span class="quoted"><span class="quoted">"supp <span class="free">T</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> FG <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">smult'</span> <span class="bound">r</span> <span class="main">(</span><span class="free">T</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   assms
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">locale</span></span> FGModuleEnd <span class="main">=</span> FGModuleHom <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">FG</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> endomorph<span class="main">:</span> <span class="quoted"><span class="quoted">"ImG <span class="main">⊆</span> <span class="free">V</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> FGModuleIso <span class="main">=</span> FGModuleHom <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>   <span class="free">G</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">smult</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">V</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">smult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">T</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">W</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'w</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bijective<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">T</span> <span class="free">V</span> <span class="free">W</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FGModule<span class="main">)</span> <span class="entity">isomorphic</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'w</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">isomorphic</span> <span class="free"><span class="bound"><span class="entity">smult'</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">T</span><span class="main">.</span> FGModuleIso <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free"><span class="bound"><span class="entity">smult'</span></span></span> <span class="bound">T</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts›</span></span>

<span class="keyword1"><span class="command">context</span></span> FGModule
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-trivial_FGModuleHom"><span class="command">lemma</span></span> trivial_FGModuleHom <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> FG <span class="main">⟹</span> <span class="free">smult'</span> <span class="bound">r</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleHom.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleHom FG <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="free">smult'</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trivial_RModuleHom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-FGModHom_idhom"><span class="command">lemma</span></span> FGModHom_idhom <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleHom.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleHom FG <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RModHom_idhom <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-VecHom_GMap_is_FGModuleHom"><span class="command">lemma</span></span> VecHom_GMap_is_FGModuleHom <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult'</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">fsmult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">♯⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">Gmult'</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">*⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> fsmult'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fsmult'</span> <span class="main">≡</span> aezfun_scalar_mult.fsmult <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     Gmult' <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Gmult'</span> <span class="main">≡</span> aezfun_scalar_mult.Gmult <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom  <span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpaceHom fsmult <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     Im_W <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     G_map <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="main">(</span><span class="free">T</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="bound">v'</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">v</span> <span class="main">+</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="bound">v</span> <span class="main">+</span> <span class="free">T</span> <span class="bound">v'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceHom.GroupHom<span class="main">[</span><span class="operator">OF</span> hom<span class="main">]</span> GroupHom.hom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> hom <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="free">T</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> VectorSpaceHom.supp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> FG <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="bound">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> FG"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> r <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fgs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> fgs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map snd <span class="skolem">fgs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span><span class="skolem">fgs</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FG_el_decomp
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> fgs v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span><span class="skolem">fgs</span><span class="main">.</span> <span class="bound">f</span> <span class="main">♯⋅</span> <span class="bound">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_aezdeltafun_smult_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> v fgs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="main">♯⋅</span> <span class="bound">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">fgs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Gmult_closed fsmult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span><span class="skolem">fgs</span><span class="main">.</span> <span class="free">T</span> <span class="main">(</span><span class="bound">f</span> <span class="main">♯⋅</span> <span class="bound">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hom VectorSpaceHom.im_sum_list_prod <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> hom G_map fgs<span class="main">(</span>1<span class="main">)</span> v
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">fgs</span><span class="main">.</span> <span class="free">T</span> <span class="main">(</span><span class="bound">f</span> <span class="main">♯⋅</span> <span class="bound">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main"><span class="free">♯⋆</span></span> <span class="bound">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="free">T</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Gmult_closed VectorSpaceHom.f_map<span class="main">[</span><span class="operator">of</span> <span class="quoted">fsmult</span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">fsmult'</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span><span class="skolem">fgs</span><span class="main">.</span> <span class="bound">f</span> <span class="main"><span class="free">♯⋆</span></span> <span class="bound">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="free">T</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_prod_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> v fgs fsmult' Gmult' Im_W<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋆</span></span> <span class="main">(</span><span class="free">T</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FGModule.sum_list_aezdeltafun_smult_distrib<span class="main">[</span><span class="operator">OF</span> Im_W<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-VecHom_GMap_on_fbasis_is_FGModuleHom"><span class="command">lemma</span></span> VecHom_GMap_on_fbasis_is_FGModuleHom <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult'</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">fsmult'</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">♯⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">Gmult'</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">*⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">flincomb'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> list <span class="main">⇒</span> <span class="tfree">'w</span> list <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∙♯⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> fsmult'    <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fsmult'</span> <span class="main">≡</span> aezfun_scalar_mult.fsmult <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     Gmult'     <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Gmult'</span> <span class="main">≡</span> aezfun_scalar_mult.Gmult <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     flincomb'  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">flincomb'</span> <span class="main">≡</span> aezfun_scalar_mult.flincomb <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fbasis     <span class="main">:</span> <span class="quoted"><span class="quoted">"fbasis_for <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     hom        <span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpaceHom fsmult <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     Im_W       <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     G_map      <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="free">vs</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="main">(</span><span class="free">T</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> VecHom_GMap_is_FGModuleHom<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fsmult' hom
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="main">(♯⋅)</span> <span class="free">V</span> <span class="main">(</span>aezfun_scalar_mult.fsmult <span class="main"><span class="free">(⋆)</span></span><span class="main">)</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>   <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> v fbasis <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">cs</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> VectorSpace.in_Span_obtain_same_length_coeffs<span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> g<span class="main">(</span>1<span class="main">)</span> fbasis fsmult' flincomb'
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">cs</span> <span class="main"><span class="free">∙♯⋆</span></span> <span class="main">(</span>map <span class="main">(</span><span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>Gmult <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Gmult_flincomb_comm map_Gmult_closed
          VectorSpaceHom.distrib_lincomb<span class="main">[</span><span class="operator">OF</span> hom<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∘</span> <span class="main">(</span>Gmult <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">T</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">cs</span> <span class="main"><span class="free">∙♯⋆</span></span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="main">(</span><span class="free">T</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fbasis g<span class="main">(</span>1<span class="main">)</span> G_map map_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">T</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="main">(</span><span class="free">T</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Gmult'</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∘</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="skolem">cs</span> <span class="main"><span class="free">∙♯⋆</span></span> <span class="main">(</span>map <span class="free">T</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g<span class="main">(</span>1<span class="main">)</span> fbasis Im_W<span class="main">(</span>2<span class="main">)</span> Gmult' flincomb' 
          FGModule.Gmult_flincomb_comm<span class="main">[</span><span class="operator">OF</span> Im_W<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"map <span class="free">T</span> <span class="free">vs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> aezfun_scalar_mult.Gmult <span class="main"><span class="free">(⋆)</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="free">T</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fbasis fsmult' Gmult' flincomb' cs
          VectorSpaceHom.distrib_lincomb<span class="main">[</span><span class="operator">OF</span> hom<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> Im_W<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Im_W<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FGModule *)</span>

<span class="keyword1"><span class="command">context</span></span> FGModuleHom
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">fsmult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">♯⋆</span>"</span> 70<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fsmult'</span> <span class="main">≡</span> aezfun_scalar_mult.fsmult <span class="free">smult'</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Gmult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">*⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gmult'</span> <span class="main">≡</span> aezfun_scalar_mult.Gmult <span class="free">smult'</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> supp                     <span class="main">=</span> supp
<span class="keyword1"><span class="command">lemmas</span></span> additive                 <span class="main">=</span> additive
<span class="keyword1"><span class="command">lemmas</span></span> FG_map                   <span class="main">=</span> R_map
<span class="keyword1"><span class="command">lemmas</span></span> FG_fdd0_closed           <span class="main">=</span> FG_fdd0_closed
<span class="keyword1"><span class="command">lemmas</span></span> fsmult_smult_domain_comm <span class="main">=</span> fsmult_smult_comm
<span class="keyword1"><span class="command">lemmas</span></span> GSubspace_Ker            <span class="main">=</span> RSubmodule_Ker
<span class="keyword1"><span class="command">lemmas</span></span> Ker_Im_iff               <span class="main">=</span> Ker_Im_iff
<span class="keyword1"><span class="command">lemmas</span></span> Ker0_imp_inj_on          <span class="main">=</span> Ker0_imp_inj_on
<span class="keyword1"><span class="command">lemmas</span></span> eq_im_imp_diff_in_Ker    <span class="main">=</span> eq_im_imp_diff_in_Ker
<span class="keyword1"><span class="command">lemmas</span></span> im_submodule             <span class="main">=</span> im_submodule
<span class="keyword1"><span class="command">lemmas</span></span> fsmultD'                 <span class="main">=</span> aezfun_scalar_mult.fsmultD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult'</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> GmultD'                  <span class="main">=</span> aezfun_scalar_mult.GmultD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult'</span></span><span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-f_map"><span class="command">lemma</span></span> f_map <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="free">a</span> <span class="main">♯⋅</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">♯⋆</span> <span class="free">T</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fsmultD ActingGroup.RG_aezdelta0fun_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> FG_map fsmultD'
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-G_map"><span class="command">lemma</span></span> G_map <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="free">g</span> <span class="main">*⋅</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">*⋆</span> <span class="free">T</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> GmultD ActingGroup.RG_aezdeltafun_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> FG_map GmultD'
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpaceHom"><span class="command">lemma</span></span> VectorSpaceHom <span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpaceHom fsmult <span class="free">V</span> fsmult' <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span>
        <span class="operator">rule</span> VectorSpace.VectorSpaceHomI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fVectorSpace<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">rule</span> f_map
      <span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> distrib_flincomb <span class="main">=</span> VectorSpaceHom.distrib_lincomb<span class="main">[</span><span class="operator">OF</span> VectorSpaceHom<span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-FGModule_Im"><span class="command">lemma</span></span> FGModule_Im <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult'</span> ImG"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> FGModule.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> GroupG<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> RModule_Im<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-FGModHom_composite_left"><span class="command">lemma</span></span> FGModHom_composite_left <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span> <span class="free">smult''</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult''</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleHom.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleHom FG <span class="free">smult</span> <span class="free">V</span> <span class="free">smult''</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleHom.axioms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> RModHom_composite_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> GroupG<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-restriction_to_subgroup_is_hom"><span class="command">lemma</span></span> restriction_to_subgroup_is_hom <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">H</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subgrp<span class="main">:</span> <span class="quoted"><span class="quoted">"Group.Subgroup <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">H</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModule.FGModuleHomI_fromaxioms<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModule <span class="free">H</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModule.restriction_to_subgroup_is_module <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> supp <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="free">T</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms
    <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">r</span> <span class="main">∈</span> <span class="main">(</span>Group.group_ring <span class="free">H</span><span class="main">)</span><span class="main">;</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋆</span></span> <span class="free">T</span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FG_map ActingGroup.Subgroup_imp_Subring <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> hom<span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-FGModuleHom_restrict0_GSubspace"><span class="command">lemma</span></span> FGModuleHom_restrict0_GSubspace <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">U</span> <span class="free">smult'</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleHom.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleHom FG <span class="main"><span class="free">(⋅)</span></span> <span class="free">U</span> <span class="main"><span class="free">(⋆)</span></span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModuleHom_restrict0_submodule <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-FGModuleHom_fscalar_mul"><span class="command">lemma</span></span> FGModuleHom_fscalar_mul <span class="main">:</span>
  <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">a</span> <span class="main">♯⋆</span> <span class="free">T</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> vsphom<span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpaceHom fsmult <span class="free">V</span> fsmult' <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">a</span> <span class="main">♯⋆</span> <span class="free">T</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceHom.VectorSpaceHom_scalar_mul<span class="main">[</span><span class="operator">OF</span> VectorSpaceHom<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="bound">v'</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">♯⋆</span> <span class="free">T</span> <span class="main">(</span><span class="bound">v</span> <span class="main">+</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">♯⋆</span> <span class="free">T</span> <span class="bound">v</span> <span class="main">+</span> <span class="free">a</span> <span class="main">♯⋆</span> <span class="free">T</span> <span class="bound">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceHom.additive<span class="main">[</span><span class="operator">of</span> <span class="quoted">fsmult</span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> vsphom <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="free">a</span> <span class="main">♯⋆</span> <span class="free">T</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceHom.supp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> rv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> FG"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">♯⋆</span> <span class="free">T</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋆</span></span> <span class="free">a</span> <span class="main">♯⋆</span> <span class="free">T</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FG_map FGModule.fsmult_smult_comm<span class="main">[</span><span class="operator">OF</span> FGModule_Im<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FGModuleHom *)</span>

<span class="keyword1" id="Rep_Fin_Groups-GSubspace_eigenspace"><span class="command">lemma</span></span> GSubspace_eigenspace <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">e</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span><span class="main">::</span>field"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">E</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span><span class="main">::</span>ab_group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">::</span>group_add<span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> FGModHom<span class="main">:</span> <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> E       <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">T</span> <span class="bound">v</span> <span class="main">=</span> aezfun_scalar_mult.fsmult <span class="free">smult</span> <span class="free">e</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModule.GSubspace <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">E</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"FGModule.GSubspace <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">T</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">e</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleHom.axioms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> FGModHom<span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RSubmodule_eigenspace<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="keyword1">δδ</span> <span class="main">0</span> <span class="main">∈</span> FGModule.FG <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FGModuleHom.FG_fdd0_closed<span class="main">[</span><span class="operator">OF</span> FGModHom<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> FGModule.FG <span class="free">G</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">e</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">e</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">s</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FGModuleHom.fsmult_smult_domain_comm<span class="main">[</span><span class="operator">OF</span> FGModHom<span class="main">]</span>
            aezfun_scalar_mult.fsmultD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> E <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> aezfun_scalar_mult.fsmultD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts about endomorphisms›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RModuleEnd_over_group_ring_is_FGModuleEnd"><span class="command">lemma</span></span> RModuleEnd_over_group_ring_is_FGModuleEnd <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">G</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> G <span class="main">:</span> <span class="quoted"><span class="quoted">"Group <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> endo<span class="main">:</span> <span class="quoted"><span class="quoted">"RModuleEnd <span class="main">(</span>Group.group_ring <span class="free">G</span><span class="main">)</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleEnd <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleEnd.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> FGModuleHom.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> G<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> endo <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleHom <span class="main">(</span>Group.group_ring <span class="free">G</span><span class="main">)</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModuleEnd.axioms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> endo <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleEnd_axioms <span class="free">V</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModuleEnd.endomorph <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FGModule<span class="main">)</span> VecEnd_GMap_is_FGModuleEnd <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> endo <span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpaceEnd fsmult <span class="free">V</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     G_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main">*⋅</span> <span class="main">(</span><span class="free">T</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleEnd <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleEnd.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> VecHom_GMap_is_FGModuleHom<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> endo <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="main">(♯⋅)</span> <span class="free">V</span> <span class="main">(♯⋅)</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.axioms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> endo <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.endomorph <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> endo <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleEnd_axioms <span class="free">V</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpaceEnd.endomorph <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> G_map<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FGModule<span class="main">)</span> GEnd_inner_dirsum_el_decomp_nth <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">U</span><span class="main">∈</span>set <span class="free">Us</span><span class="main">.</span> GSubspace <span class="bound">U</span><span class="main">;</span> add_independentS <span class="free">Us</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">Us</span> <span class="main">⟧</span>
        <span class="main">⟹</span> FGModuleEnd <span class="free">G</span> <span class="free">smult</span>  <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="free">Us</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> GroupG RModuleEnd_inner_dirsum_el_decomp_nth
        RModuleEnd_over_group_ring_is_FGModuleEnd
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>

<span class="keyword1"><span class="command">context</span></span> FGModuleEnd
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RModuleEnd"><span class="command">lemma</span></span> RModuleEnd <span class="main">:</span> <span class="quoted"><span class="quoted">"RModuleEnd ActingGroup.group_ring <span class="free">smult</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> endomorph <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpaceEnd"><span class="command">lemma</span></span> VectorSpaceEnd <span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpaceEnd fsmult <span class="free">V</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span>
        <span class="operator">rule</span> VectorSpaceEnd.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> VectorSpaceHom<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">rule</span> endomorph
      <span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> proj_decomp                     <span class="main">=</span> RModuleEnd.proj_decomp<span class="main">[</span><span class="operator">OF</span> RModuleEnd<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> GSubspace_Ker                   <span class="main">=</span> GSubspace_Ker
<span class="keyword1"><span class="command">lemmas</span></span> FGModuleHom_restrict0_GSubspace <span class="main">=</span> FGModuleHom_restrict0_GSubspace

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FGModuleEnd *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts about isomorphisms›</span></span>

<span class="keyword1"><span class="command">context</span></span> FGModuleIso
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> VectorSpaceHom <span class="main">=</span> VectorSpaceHom

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">invT</span> <span class="main">≡</span> <span class="main">(</span>the_inv_into <span class="free">V</span> <span class="free">T</span><span class="main">)</span> <span class="main">↓</span> <span class="free">W</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RModuleIso"><span class="command">lemma</span></span> RModuleIso <span class="main">:</span> <span class="quoted"><span class="quoted">"RModuleIso FG <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">T</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModuleIso.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleHom FG <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleIso_axioms FGModuleIso.axioms<span class="main">(</span>1<span class="main">)</span> FGModuleHom.axioms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bijective<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> ImG <span class="main">=</span> RModuleIso.ImG<span class="main">[</span><span class="operator">OF</span> RModuleIso<span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-FGModuleIso_restrict0_GSubspace"><span class="command">lemma</span></span> FGModuleIso_restrict0_GSubspace <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleIso <span class="free">G</span> <span class="free">smult</span> <span class="free">U</span> <span class="free">smult'</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleIso.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">U</span> <span class="main"><span class="free">(⋆)</span></span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleHom_restrict0_GSubspace <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleIso_axioms <span class="free">U</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms bijective <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">T</span> <span class="free">U</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subset_inj_on <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="free">U</span><span class="main">)</span> <span class="free">U</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-inv"><span class="command">lemma</span></span> inv <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModuleIso <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span> <span class="free">smult</span> invT <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleIso.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> FGModuleHom.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModuleHom FG <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span> <span class="main"><span class="free">(⋅)</span></span> invT"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModuleIso.inv<span class="main">[</span><span class="operator">OF</span> RModuleIso<span class="main">]</span> RModuleIso.axioms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleIso_axioms <span class="free">W</span> invT <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> RModuleIso.inv<span class="main">[</span><span class="operator">OF</span> RModuleIso<span class="main">]</span> RModuleIso.bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-FGModIso_composite_left"><span class="command">lemma</span></span> FGModIso_composite_left <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"FGModuleIso <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span> <span class="free">smult''</span> <span class="free">S</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleIso <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult''</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleIso.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="free">smult''</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleIso.axioms<span class="main">(</span>1<span class="main">)</span> ImG FGModHom_composite_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleIso_axioms <span class="free">V</span> <span class="main">(</span><span class="free">S</span> <span class="main">∘</span> <span class="free">T</span><span class="main">)</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bijective FGModuleIso.bijective<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> bij_betw_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-isomorphic_sym"><span class="command">lemma</span></span> isomorphic_sym <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule.isomorphic <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span> <span class="free">smult</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-isomorphic_trans"><span class="command">lemma</span></span> isomorphic_trans <span class="main">:</span>
  <span class="quoted"><span class="quoted">"FGModule.isomorphic <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span> <span class="free">smult''</span> <span class="free">X</span>
        <span class="main">⟹</span> FGModule.isomorphic <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult''</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FGModIso_composite_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-isomorphic_to_zero_left"><span class="command">lemma</span></span> isomorphic_to_zero_left <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bijective bij_betw_imp_surj_on im_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Rep_Fin_Groups-isomorphic_to_zero_right"><span class="command">lemma</span></span> isomorphic_to_zero_right <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">V</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isomorphic_sym FGModuleIso.isomorphic_to_zero_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-isomorphic_to_irr_right'"><span class="command">lemma</span></span> isomorphic_to_irr_right' <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> FGModule.GSubspace <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="bound">U</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">U</span> <span class="main">=</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> GSubspace <span class="bound">U</span> <span class="main">⟹</span> <span class="bound">U</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">U</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="keyword3"><span class="command">assume</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"GSubspace <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="free">V</span> <span class="main">⟹</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> UV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> U bijective <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="skolem">U</span> <span class="main">=</span> <span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⟹</span> <span class="skolem">U</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bij_betw_imp_inj_on<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span> inj_onD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> UV bijective <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="skolem">U</span> <span class="main">≠</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_betw_imp_surj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"FGModule.GSubspace <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ImG im_submodule <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms U FGModuleIso_restrict0_GSubspace
            FGModuleIso.isomorphic_to_zero_right
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">U</span> <span class="main">=</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FGModuleIso *)</span>

<span class="keyword1"><span class="command">context</span></span> FGModule
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-isomorphic_sym"><span class="command">lemma</span></span> isomorphic_sym <span class="main">:</span>
  <span class="quoted"><span class="quoted">"isomorphic <span class="free">smult'</span> <span class="free">W</span> <span class="main">⟹</span> FGModule.isomorphic <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span> <span class="free">smult</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FGModuleIso.inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-isomorphic_trans"><span class="command">lemma</span></span> isomorphic_trans <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"isomorphic <span class="free">smult'</span> <span class="free">W</span> <span class="main">⟹</span> FGModule.isomorphic <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span> <span class="free">smult''</span> <span class="free">X</span>
        <span class="main">⟹</span> isomorphic <span class="free">smult''</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FGModuleIso.FGModIso_composite_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-isomorphic_to_zero_left"><span class="command">lemma</span></span> isomorphic_to_zero_left <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> isomorphic <span class="free">smult'</span> <span class="free">W</span> <span class="main">⟹</span> <span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FGModuleIso.isomorphic_to_zero_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-isomorphic_to_zero_right"><span class="command">lemma</span></span> isomorphic_to_zero_right <span class="main">:</span> <span class="quoted"><span class="quoted">"isomorphic <span class="free">smult'</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">V</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FGModuleIso.isomorphic_to_zero_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-FGModIso_idhom"><span class="command">lemma</span></span> FGModIso_idhom <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModuleIso <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FGModHom_idhom
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleIso.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleIso_axioms <span class="free">V</span> <span class="main">(</span>id<span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_id bij_betw_restrict0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-isomorphic_refl"><span class="command">lemma</span></span> isomorphic_refl <span class="main">:</span> <span class="quoted"><span class="quoted">"isomorphic <span class="free">smult</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FGModIso_idhom <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FGModule *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Hom-sets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FGModuleHomSet</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'v</span> set
        <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'w</span> set
        <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">FGModuleHomSet</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">fgsmult</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">fgsmult'</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span>
              <span class="main">≡</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> FGModuleHom <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">fgsmult</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">fgsmult'</span></span></span> <span class="bound">T</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="bound">T</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-FGModuleHomSetI"><span class="command">lemma</span></span> FGModuleHomSetI <span class="main">:</span>
  <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">fgsmult</span> <span class="free">V</span> <span class="free">fgsmult'</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>
        <span class="main">⟹</span> <span class="free">T</span> <span class="main">∈</span> FGModuleHomSet <span class="free">G</span> <span class="free">fgsmult</span> <span class="free">V</span> <span class="free">fgsmult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FGModuleHomSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-FGModuleHomSetD_FGModuleHom"><span class="command">lemma</span></span> FGModuleHomSetD_FGModuleHom <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> FGModuleHomSet <span class="free">G</span> <span class="free">fgsmult</span> <span class="free">V</span> <span class="free">fgsmult'</span> <span class="free">W</span>
        <span class="main">⟹</span> FGModuleHom <span class="free">G</span> <span class="free">fgsmult</span> <span class="free">V</span> <span class="free">fgsmult'</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FGModuleHomSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-FGModuleHomSetD_Im"><span class="command">lemma</span></span> FGModuleHomSetD_Im <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> FGModuleHomSet <span class="free">G</span> <span class="free">fgsmult</span> <span class="free">V</span> <span class="free">fgsmult'</span> <span class="free">W</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FGModuleHomSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">context</span></span> FGModule
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-FGModuleHomSet_is_Gmaps_in_VectorSpaceHomSet"><span class="command">lemma</span></span> FGModuleHomSet_is_Gmaps_in_VectorSpaceHomSet <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult'</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">fsmult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">♯⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">Gmult'</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">*⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> fsmult'  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fsmult'</span> <span class="main">≡</span> aezfun_scalar_mult.fsmult <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     Gmult'   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Gmult'</span> <span class="main">≡</span> aezfun_scalar_mult.Gmult <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> FGModW   <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleHomSet <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>
                <span class="main">=</span> <span class="main">(</span>VectorSpaceHomSet fsmult <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">W</span><span class="main">)</span>
                  <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="main">(</span><span class="bound">T</span> <span class="bound">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> fsmult' Gmult'
    <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"FGModuleHomSet <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>
                <span class="main">⊆</span> <span class="main">(</span>VectorSpaceHomSet fsmult <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">W</span><span class="main">)</span>
                  <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="bound">T</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleHomSetD_FGModuleHom<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span><span class="main">]</span>
          FGModuleHom.VectorSpaceHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span><span class="main">]</span> 
          FGModuleHomSetD_Im<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span><span class="main">]</span>
          VectorSpaceHomSetI<span class="main">[</span><span class="operator">of</span> <span class="quoted">fsmult</span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">fsmult'</span></span><span class="main">]</span>
          FGModuleHom.G_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleHomSet <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>
              <span class="main">⊇</span> <span class="main">(</span>VectorSpaceHomSet fsmult <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">W</span><span class="main">)</span>
                <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="bound">T</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T</span>
    <span class="keyword3"><span class="command">assume</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> <span class="main">(</span>VectorSpaceHomSet fsmult <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">W</span><span class="main">)</span>
                    <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="bound">T</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> FGModuleHomSet <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleHomSetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> VecHom_GMap_is_FGModuleHom<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> T fsmult'
        <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"VectorSpaceHom <span class="main">(♯⋅)</span> <span class="free">V</span> <span class="main">(</span>aezfun_scalar_mult.fsmult <span class="free">smult'</span><span class="main">)</span> <span class="skolem">T</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_VectorSpaceHom
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
      <span class="keyword1"><span class="command">from</span></span> T <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_Im <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">from</span></span> T Gmult' 
        <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span>
                    <span class="main">⟹</span> <span class="skolem">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> aezfun_scalar_mult.Gmult <span class="main"><span class="free">(⋆)</span></span> <span class="bound">g</span> <span class="main">(</span><span class="skolem">T</span> <span class="bound">v</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
      <span class="keyword1"><span class="command">from</span></span> T <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_Im <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> FGModW<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Group_FGModuleHomSet"><span class="command">lemma</span></span> Group_FGModuleHomSet <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult'</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">fsmult'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">♯⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">Gmult'</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">*⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> fsmult'  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fsmult'</span> <span class="main">≡</span> aezfun_scalar_mult.fsmult <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     Gmult'   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Gmult'</span> <span class="main">≡</span> aezfun_scalar_mult.Gmult <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> FGModW   <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Group <span class="main">(</span>FGModuleHomSet <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> FGModW <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleHomSet <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModule.smult_zero trivial_FGModuleHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult'</span></span><span class="main">]</span> FGModule.zero_closed
          FGModuleHomSetI
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="skolem">T</span>
  <span class="keyword3"><span class="command">assume</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> FGModuleHomSet <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> FGModuleHomSet <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
    <span class="keyword1"><span class="command">have</span></span>  ST<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="main">(</span>VectorSpaceHomSet fsmult <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">W</span><span class="main">)</span>
                    <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="bound">T</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> <span class="main">(</span>VectorSpaceHomSet fsmult <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">W</span><span class="main">)</span>
                    <span class="main">∩</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="bound">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="bound">T</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleHomSet_is_Gmaps_in_VectorSpaceHomSet
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> fsmult' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span> <span class="main">∈</span> VectorSpaceHomSet fsmult <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModule.fVectorSpace<span class="main">[</span><span class="operator">OF</span> FGModW<span class="main">]</span>
          VectorSpace.Group_VectorSpaceHomSet<span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span> Group.diff_closed
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">g</span><span class="main">∈</span><span class="free">G</span> <span class="main">⟹</span> <span class="bound">v</span><span class="main">∈</span><span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">S</span><span class="main">-</span><span class="skolem">T</span><span class="main">)</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="main">(</span><span class="main">(</span><span class="skolem">S</span><span class="main">-</span><span class="skolem">T</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> ST <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">T</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> VectorSpaceHomSetD_Im<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quoted">fsmult</span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">fsmult'</span></span><span class="main">]</span>
            VectorSpaceHomSetD_Im<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T</span></span> <span class="quoted">fsmult</span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">fsmult'</span></span><span class="main">]</span>
            FGModule.neg_closed<span class="main">[</span><span class="operator">OF</span> FGModW<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S</span><span class="main">-</span><span class="skolem">T</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main"><span class="free">*⋆</span></span> <span class="main">(</span><span class="main">(</span><span class="skolem">S</span><span class="main">-</span><span class="skolem">T</span><span class="main">)</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ST Gmult' FGModule.neg_Gmult<span class="main">[</span><span class="operator">OF</span> FGModW<span class="main">]</span>
            FGModule.Gmult_distrib_left<span class="main">[</span><span class="operator">OF</span> FGModW<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">T</span> <span class="skolem">v</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">-</span> <span class="skolem">T</span> <span class="main">∈</span> FGModuleHomSet <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fsmult' Gmult'
          FGModuleHomSet_is_Gmaps_in_VectorSpaceHomSet<span class="main">[</span><span class="operator">OF</span> FGModW<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Subspace_FGModuleHomSet"><span class="command">lemma</span></span> Subspace_FGModuleHomSet <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult'</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">fsmult'</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">♯⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">Gmult'</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">*⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">hom_fsmult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">♯⋆⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> fsmult'     <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fsmult'</span> <span class="main">≡</span> aezfun_scalar_mult.fsmult <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     Gmult'      <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Gmult'</span> <span class="main">≡</span> aezfun_scalar_mult.Gmult <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> hom_fsmult  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom_fsmult</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">a</span> <span class="bound">T</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">♯⋆</span></span> <span class="bound">T</span> <span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> FGModW      <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"VectorSpace.Subspace <span class="free">hom_fsmult</span>
                <span class="main">(</span>VectorSpaceHomSet fsmult <span class="free">V</span> <span class="free">fsmult'</span> <span class="free">W</span><span class="main">)</span>
                  <span class="main">(</span>FGModuleHomSet <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> VectorSpace.SubspaceI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> hom_fsmult fsmult'
    <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"VectorSpace <span class="main"><span class="free">(♯⋆⋅)</span></span> <span class="main">(</span>VectorSpaceHomSet <span class="main">(♯⋅)</span> <span class="free">V</span> <span class="main"><span class="free">(♯⋆)</span></span> <span class="free">W</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModule.fVectorSpace<span class="main">[</span><span class="operator">OF</span> FGModW<span class="main">]</span>
          VectorSpace.VectorSpace_VectorSpaceHomSet<span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> fsmult' Gmult' FGModW
    <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"Group <span class="main">(</span>FGModuleHomSet <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span>
                <span class="main">∧</span> FGModuleHomSet <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>
                  <span class="main">⊆</span> VectorSpaceHomSet <span class="main">(♯⋅)</span> <span class="free">V</span> <span class="main"><span class="free">(♯⋆)</span></span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Group_FGModuleHomSet FGModuleHomSet_is_Gmaps_in_VectorSpaceHomSet
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">T</span> <span class="keyword3"><span class="command">assume</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> FGModuleHomSet <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> hom_fsmult fsmult' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">♯⋆⋅</span></span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleHomSetD_FGModuleHom<span class="main">[</span><span class="operator">OF</span> T<span class="main">]</span>
          FGModuleHomSetD_Im<span class="main">[</span><span class="operator">OF</span> T<span class="main">]</span> 
          FGModuleHom.FGModuleHom_fscalar_mul
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> hom_fsmult fsmult' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">♯⋆⋅</span></span> <span class="skolem">T</span><span class="main">)</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleHomSetD_Im<span class="main">[</span><span class="operator">OF</span> T<span class="main">]</span> FGModule.fsmult_closed<span class="main">[</span><span class="operator">OF</span> FGModW<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">♯⋆⋅</span></span> <span class="skolem">T</span> <span class="main">∈</span> FGModuleHomSet <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleHomSetI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpace_FGModuleHomSet"><span class="command">lemma</span></span> VectorSpace_FGModuleHomSet <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult'</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">fsmult'</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">♯⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">hom_fsmult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">♯⋆⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">fsmult'</span> <span class="main">≡</span> aezfun_scalar_mult.fsmult <span class="free">smult'</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom_fsmult</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">a</span> <span class="bound">T</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">♯⋆</span></span> <span class="bound">T</span> <span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"VectorSpace <span class="free">hom_fsmult</span> <span class="main">(</span>FGModuleHomSet <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">smult'</span> <span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   assms Subspace_FGModuleHomSet Module.intro VectorSpace.intro
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FGModule *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Induced modules›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Additive function spaces›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">addfunset</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>monoid_add set <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>monoid_add set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">addfunset</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> supp <span class="bound">f</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> range <span class="bound">f</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-addfunsetI"><span class="command">lemma</span></span> addfunsetI <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> supp <span class="free">f</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> range <span class="free">f</span> <span class="main">⊆</span> <span class="free">M</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> addfunset <span class="free">A</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> addfunset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-addfunsetD_supp"><span class="command">lemma</span></span> addfunsetD_supp <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> addfunset <span class="free">A</span> <span class="free">M</span> <span class="main">⟹</span> supp  <span class="free">f</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> addfunset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-addfunsetD_range"><span class="command">lemma</span></span> addfunsetD_range <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> addfunset <span class="free">A</span> <span class="free">M</span> <span class="main">⟹</span> range <span class="free">f</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> addfunset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-addfunsetD_range'"><span class="command">lemma</span></span> addfunsetD_range' <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> addfunset <span class="free">A</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> addfunsetD_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-addfunsetD_add"><span class="command">lemma</span></span> addfunsetD_add <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">f</span> <span class="main">∈</span> addfunset <span class="free">A</span> <span class="free">M</span><span class="main">;</span> <span class="free">x</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="free">y</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">+</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> addfunset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-addfunset0"><span class="command">lemma</span></span> addfunset0 <span class="main">:</span> <span class="quoted"><span class="quoted">"addfunset <span class="free">A</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'m</span><span class="main">::</span>monoid_add set<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"addfunset <span class="free">A</span> <span class="main">0</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> addfunsetD_range' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'m</span><span class="main">)</span> <span class="main">∈</span> addfunset <span class="free">A</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> supp_zerofun_subset_any <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> addfunsetI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"addfunset <span class="free">A</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'m</span><span class="main">::</span>monoid_add set<span class="main">)</span> <span class="main">⊇</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Group_addfunset"><span class="command">lemma</span></span> Group_addfunset <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">M</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>ab_group_add set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Group <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Group <span class="main">(</span>addfunset <span class="free">R</span> <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"addfunset <span class="free">R</span> <span class="free">M</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> addfunsetI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> supp_zerofun_subset_any Group.zero_closed
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> addfunset <span class="free">R</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> addfunset <span class="free">R</span> <span class="free">M</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">-</span> <span class="skolem">h</span> <span class="main">∈</span> addfunset <span class="free">R</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> addfunsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> gh <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="skolem">g</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> addfunsetD_supp supp_diff_subset_union_supp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> gh <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="skolem">g</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> addfunsetD_range Group.diff_closed <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addfunsetD_range' image_subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">R</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">R</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> addfunsetD_add<span class="main">[</span><span class="operator">OF</span> gh<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> addfunsetD_add<span class="main">[</span><span class="operator">OF</span> gh<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Spaces of functions which transform under scalar multiplication by
                 almost-everywhere-zero functions›</span></span>

<span class="keyword1"><span class="command">context</span></span> aezfun_scalar_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">smultfunset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">smultfunset</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">FH</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">FH</span></span></span><span class="main">.</span>
              <span class="bound">f</span> <span class="main">(</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-smultfunsetD"><span class="command">lemma</span></span> smultfunsetD <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="main">∈</span> smultfunset <span class="free">G</span> <span class="free">FH</span><span class="main">;</span> <span class="free">g</span><span class="main">∈</span><span class="free">G</span><span class="main">;</span> <span class="free">x</span><span class="main">∈</span><span class="free">FH</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span> <span class="free">a</span> <span class="keyword1">δδ</span> <span class="free">g</span> <span class="main">*</span> <span class="free">x</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> smultfunset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-smultfunsetI"><span class="command">lemma</span></span> smultfunsetI <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>
        <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> smultfunset <span class="free">G</span> <span class="free">FH</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> smultfunset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context aezfun_scalar_mult *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹General induced spaces of functions on a group ring›</span></span>

<span class="keyword1"><span class="command">context</span></span> aezfun_scalar_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">indspace</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set <span class="main">⇒</span> <span class="tfree">'v</span> set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'r</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">indspace</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">FH</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> addfunset <span class="free"><span class="bound"><span class="entity">FH</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∩</span> smultfunset <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">FH</span></span></span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-indspaceD"><span class="command">lemma</span></span> indspaceD <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> addfunset <span class="free">FH</span> <span class="free">V</span> <span class="main">∩</span> smultfunset <span class="free">G</span> <span class="free">FH</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indspace_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-indspaceD_supp"><span class="command">lemma</span></span> indspaceD_supp <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span> <span class="main">⟹</span> supp  <span class="free">f</span> <span class="main">⊆</span> <span class="free">FH</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indspace_def addfunsetD_supp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-indspaceD_supp'"><span class="command">lemma</span></span> indspaceD_supp' <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">FH</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indspaceD_supp suppI_contra <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-indspaceD_range"><span class="command">lemma</span></span> indspaceD_range <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span> <span class="main">⟹</span> range <span class="free">f</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indspace_def addfunsetD_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-indspaceD_range'"><span class="command">lemma</span></span> indspaceD_range'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indspaceD_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-indspaceD_add"><span class="command">lemma</span></span> indspaceD_add <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">f</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span><span class="main">;</span> <span class="free">x</span><span class="main">∈</span><span class="free">FH</span><span class="main">;</span> <span class="free">y</span><span class="main">∈</span><span class="free">FH</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">+</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indspace_def addfunsetD_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-indspaceD_transform"><span class="command">lemma</span></span> indspaceD_transform <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span><span class="main">;</span> <span class="free">g</span><span class="main">∈</span><span class="free">G</span><span class="main">;</span> <span class="free">x</span><span class="main">∈</span><span class="free">FH</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span> <span class="free">a</span> <span class="keyword1">δδ</span> <span class="free">g</span> <span class="main">*</span> <span class="free">x</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">δδ</span> <span class="free">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indspace_def smultfunsetD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-indspaceI"><span class="command">lemma</span></span> indspaceI <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> addfunset <span class="free">FH</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> smultfunset <span class="free">G</span> <span class="free">FH</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indspace_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-indspaceI'"><span class="command">lemma</span></span> indspaceI' <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> supp <span class="free">f</span> <span class="main">⊆</span> <span class="free">FH</span><span class="main">;</span> range <span class="free">f</span> <span class="main">⊆</span> <span class="free">V</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">y</span><span class="main">;</span>
                <span class="main">∀</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟧</span>
                  <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> smultfunsetI addfunsetI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> indspaceI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-mono_indspace"><span class="command">lemma</span></span> mono_indspace <span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>indspace <span class="free">G</span> <span class="free">FH</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> monoI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span> <span class="keyword3"><span class="command">assume</span></span> U_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="skolem">V</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indspace <span class="free">G</span> <span class="free">FH</span> <span class="skolem">U</span> <span class="main">⊆</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="skolem">V</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indspaceD_supp<span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> indspaceI'<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> f U_V <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">f</span> <span class="main">⊆</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indspaceD_range<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">FH</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> f <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">f</span> <span class="bound">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> indspaceD_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> f <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> indspaceD_transform <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context aezfun_scalar_mult *)</span>

<span class="keyword1"><span class="command">context</span></span> FGModule
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-zero_transforms"><span class="command">lemma</span></span> zero_transforms <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> smultfunset <span class="free">G</span> <span class="free">FH</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> smultfunsetI FG_fddg_closed smult_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-indspace0"><span class="command">lemma</span></span> indspace0 <span class="main">:</span> <span class="quoted"><span class="quoted">"indspace <span class="free">G</span> <span class="free">FH</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_transforms addfunset0 indspace_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-Group_indspace"><span class="command">lemma</span></span> Group_indspace <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ring1 <span class="free">FH</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Group <span class="main">(</span>indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> zero_closed <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> mono_indspace <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">FH</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"indspace <span class="free">G</span> <span class="free">FH</span> <span class="main">0</span> <span class="main">⊆</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> monoD <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">V</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indspace0 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">FH</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f1</span> <span class="skolem">f2</span> <span class="keyword3"><span class="command">assume</span></span> ff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">-</span> <span class="skolem">f2</span> <span class="main">∈</span> addfunset <span class="free">FH</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms indspaceD indspaceD Group Group_addfunset Group.diff_closed
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ff <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">-</span> <span class="skolem">f2</span> <span class="main">∈</span> smultfunset <span class="free">G</span> <span class="free">FH</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indspaceD_transform FG_fddg_closed indspaceD_range' smult_distrib_left_diff
          smultfunsetI
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">-</span> <span class="skolem">f2</span> <span class="main">∈</span> indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indspaceI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FGModule *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The right regular action›</span></span>

<span class="keyword1"><span class="command">context</span></span> Ring1
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rightreg_scalar_mult</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'r</span><span class="main">::</span>ring_1 <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">::</span>ab_group_add<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'m</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">¤</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rightreg_scalar_mult</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-rightreg_scalar_multD1"><span class="command">lemma</span></span> rightreg_scalar_multD1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span> <span class="main">¤</span> <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rightreg_scalar_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-rightreg_scalar_multD2"><span class="command">lemma</span></span> rightreg_scalar_multD2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span> <span class="main">¤</span> <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rightreg_scalar_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-rrsmult_supp"><span class="command">lemma</span></span> rrsmult_supp <span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="free">r</span> <span class="main">¤</span> <span class="free">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rightreg_scalar_multD2 suppD_contra <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-rrsmult_range"><span class="command">lemma</span></span> rrsmult_range <span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="free">r</span> <span class="main">¤</span> <span class="free">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∪</span> range <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">¤</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∪</span> range <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rightreg_scalar_multD1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> image_eqI
          rightreg_scalar_multD2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-rrsmult_distrib_left"><span class="command">lemma</span></span> rrsmult_distrib_left <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">¤</span> <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main">¤</span> <span class="free">f</span> <span class="main">+</span> <span class="free">r</span> <span class="main">¤</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">¤</span> <span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">¤</span> <span class="free">f</span> <span class="main">+</span> <span class="free">r</span> <span class="main">¤</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rightreg_scalar_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-rrsmult_distrib_right"><span class="command">lemma</span></span> rrsmult_distrib_right <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">¤</span> <span class="free">f</span> <span class="main">=</span> <span class="free">r</span> <span class="main">¤</span> <span class="free">f</span> <span class="main">+</span> <span class="free">s</span> <span class="main">¤</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">¤</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">¤</span> <span class="free">f</span> <span class="main">+</span> <span class="free">s</span> <span class="main">¤</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>     assms mult_closed
    <span class="keyword1"><span class="command">unfolding</span></span> rightreg_scalar_mult_def
    <span class="keyword1"><span class="command">by</span></span>        <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-RModule_addfunset"><span class="command">lemma</span></span> RModule_addfunset <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">M</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>ab_group_add set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Group <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"RModule <span class="free">R</span> rightreg_scalar_mult <span class="main">(</span>addfunset <span class="free">R</span> <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RModuleI<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group <span class="main">(</span>addfunset <span class="free">R</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Group_addfunset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule_axioms <span class="free">R</span> <span class="main">(¤)</span> <span class="main">(</span>addfunset <span class="free">R</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> addfunset <span class="free">R</span> <span class="free">M</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">¤</span> <span class="skolem">f</span> <span class="main">∈</span> addfunset <span class="free">R</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> addfunsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="skolem">r</span> <span class="main">¤</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rightreg_scalar_multD2 suppD_contra <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="skolem">r</span> <span class="main">¤</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>     addfunsetD_range<span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span> Group.zero_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> rightreg_scalar_mult_def
        <span class="keyword1"><span class="command">by</span></span>        <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> r <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">R</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">R</span><span class="main">.</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">¤</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">¤</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">¤</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>     mult_closed add_closed addfunsetD_add<span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> rightreg_scalar_mult_def
        <span class="keyword1"><span class="command">by</span></span>        <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">r</span> <span class="main">¤</span> <span class="main">(</span><span class="bound">f</span> <span class="main">+</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">¤</span> <span class="bound">f</span> <span class="main">+</span> <span class="bound">r</span> <span class="main">¤</span> <span class="bound">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rrsmult_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> addfunset <span class="free">R</span> <span class="free">M</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">¤</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">¤</span> <span class="skolem">f</span> <span class="main">+</span> <span class="skolem">s</span> <span class="main">¤</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> addfunsetD_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> rrsmult_distrib_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> addfunset <span class="free">R</span> <span class="free">M</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">¤</span> <span class="skolem">s</span> <span class="main">¤</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">¤</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">from</span></span> r <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">¤</span> <span class="skolem">s</span> <span class="main">¤</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">¤</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_closed <span class="keyword1"><span class="command">unfolding</span></span> rightreg_scalar_mult_def
        <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> addfunset <span class="free">R</span> <span class="free">M</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">¤</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">¤</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rightreg_scalar_mult_def 
        <span class="keyword1"><span class="command">using</span></span>     addfunsetD_supp<span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span> suppI_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span>
                  contra_subsetD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"supp <span class="skolem">f</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>        <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Ring1 *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locale and basic facts›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In the following locale, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a subgroup of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">V</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a module over the
  group ring for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and the induced space <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">indV</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> will be shown to be a module over the
  group ring for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> under the right regular scalar multiplication <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">rrsmult</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> InducedFHModule <span class="main">=</span> Supgroup<span class="main">?</span><span class="main">:</span> Group <span class="quoted"><span class="free">H</span></span>
<span class="main">+</span> BaseFGMod<span class="main">?</span>    <span class="main">:</span> FGModule <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span>
<span class="main">+</span> induced_smult<span class="main">?</span><span class="main">:</span> aezfun_scalar_mult <span class="quoted"><span class="free">rrsmult</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>   <span class="free">H</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">G</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">FG</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">smult</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">V</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">rrsmult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span>"</span></span>
                                                                                    <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">¤</span>"</span> 70<span class="main">)</span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">FH</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">indV</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> FH      <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FH</span> <span class="main">≡</span> Supgroup.group_ring"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     indV    <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indV</span> <span class="main">≡</span> BaseFGMod.indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rrsmult <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rrsmult</span> <span class="main">=</span> Ring1.rightreg_scalar_mult <span class="free">FH</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     Subgroup<span class="main">:</span> <span class="quoted"><span class="quoted">"Supgroup.Subgroup <span class="free">G</span>"</span></span>  <span class="comment1">(* G is a subgroup of H *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">indfsmult</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">¤¤</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">indfsmult</span> <span class="main">≡</span> induced_smult.fsmult"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">indflincomb</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∙¤¤</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">indflincomb</span> <span class="main">≡</span> induced_smult.flincomb"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Hmult</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">*¤</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hmult</span> <span class="main">≡</span> induced_smult.Gmult"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Ring1_FH"><span class="command">lemma</span></span> Ring1_FH <span class="main">:</span> <span class="quoted"><span class="quoted">"Ring1 <span class="free">FH</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FH Supgroup.Ring1_RG <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-FG_subring_FH"><span class="command">lemma</span></span> FG_subring_FH <span class="main">:</span> <span class="quoted"><span class="quoted">"Ring1.Subring1 <span class="free">FH</span> BaseFGMod.FG"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FH Supgroup.Subgroup_imp_Subring<span class="main">[</span><span class="operator">OF</span> Subgroup<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-rrsmultD1"><span class="command">lemma</span></span> rrsmultD1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">FH</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">¤</span></span> <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ring1.rightreg_scalar_multD1<span class="main">[</span><span class="operator">OF</span> Ring1_FH<span class="main">]</span> rrsmult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-rrsmultD2"><span class="command">lemma</span></span> rrsmultD2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FH</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">¤</span></span> <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ring1.rightreg_scalar_multD2<span class="main">[</span><span class="operator">OF</span> Ring1_FH<span class="main">]</span> rrsmult <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-rrsmult_supp"><span class="command">lemma</span></span> rrsmult_supp <span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">¤</span></span> <span class="free">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">FH</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ring1.rrsmult_supp<span class="main">[</span><span class="operator">OF</span> Ring1_FH<span class="main">]</span> rrsmult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-rrsmult_range"><span class="command">lemma</span></span> rrsmult_range <span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">¤</span></span> <span class="free">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">∪</span> range <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ring1.rrsmult_range<span class="main">[</span><span class="operator">OF</span> Ring1_FH<span class="main">]</span> rrsmult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-FHModule_addfunset"><span class="command">lemma</span></span> FHModule_addfunset <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">H</span> <span class="free">rrsmult</span> <span class="main">(</span>addfunset <span class="free">FH</span> <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModule.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> FH rrsmult <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule Supgroup.group_ring <span class="main"><span class="free">(¤)</span></span> <span class="main">(</span>addfunset <span class="free">FH</span> <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Group Supgroup.Ring1_RG Ring1.RModule_addfunset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-FHSubmodule_indspace"><span class="command">lemma</span></span> FHSubmodule_indspace <span class="main">:</span>
  <span class="quoted"><span class="quoted">"FGModule.FGSubmodule <span class="free">H</span> <span class="free">rrsmult</span> <span class="main">(</span>addfunset <span class="free">FH</span> <span class="free">V</span><span class="main">)</span> <span class="free">indV</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModule.FGSubmoduleI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> FHModule_addfunset<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Ring1_FH indV <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group <span class="free">indV</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Group_indspace <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> indV <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">indV</span> <span class="main">⊆</span> addfunset <span class="free">FH</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> BaseFGMod.indspaceD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> rf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">(</span>Supgroup.group_ring <span class="main">::</span> <span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rf<span class="main">(</span>2<span class="main">)</span> indV <span class="keyword1"><span class="command">have</span></span> rf2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> BaseFGMod.indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">¤</span></span> <span class="skolem">f</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> indV
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> BaseFGMod.indspaceI'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rrsmult_supp<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">¤</span></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rrsmult_range BaseFGMod.indspaceD_range<span class="main">[</span><span class="operator">OF</span> rf2'<span class="main">]</span> zero_closed
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> FH rf<span class="main">(</span>1<span class="main">)</span> rf2'
      <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">¤</span></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">¤</span></span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">¤</span></span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ring1.add_closed<span class="main">[</span><span class="operator">OF</span> Ring1_FH<span class="main">]</span> rrsmultD1<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span>
            Ring1.mult_closed<span class="main">[</span><span class="operator">OF</span> Ring1_FH<span class="main">]</span> BaseFGMod.indspaceD_add
      <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> gx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">∈</span><span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">FH</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> FH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">δδ</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">FH</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> FG_fddg_closed FG_subring_FH Ring1.mult_closed<span class="main">[</span><span class="operator">OF</span> Ring1_FH<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
      <span class="keyword1"><span class="command">with</span></span> FH rf<span class="main">(</span>1<span class="main">)</span> gx<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">¤</span></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">δδ</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="keyword1">δδ</span> <span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">¤</span></span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rrsmultD1<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> Ring1.mult_closed<span class="main">[</span><span class="operator">OF</span> Ring1_FH<span class="main">]</span> 
              BaseFGMod.indspaceD_transform<span class="main">[</span><span class="operator">OF</span> rf2' gx<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">¤</span></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">¤</span></span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-FHModule_indspace"><span class="command">lemma</span></span> FHModule_indspace <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">H</span> <span class="free">rrsmult</span> <span class="free">indV</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModule.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule Supgroup.group_ring <span class="main"><span class="free">(¤)</span></span> <span class="free">indV</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FHSubmodule_indspace <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> fVectorSpace_indspace <span class="main">=</span> FGModule.fVectorSpace<span class="main">[</span><span class="operator">OF</span> FHModule_indspace<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> restriction_is_FGModule
              <span class="main">=</span> FGModule.restriction_to_subgroup_is_module<span class="main">[</span><span class="operator">OF</span> FHModule_indspace<span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">induced_vector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">induced_vector</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">V</span>
              <span class="keyword1">then</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">FH</span> <span class="keyword1">then</span> <span class="main">(</span>FG_proj <span class="bound">y</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-induced_vector_apply1"><span class="command">lemma</span></span> induced_vector_apply1 <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">FH</span> <span class="main">⟹</span> induced_vector <span class="free">v</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>FG_proj <span class="free">x</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> induced_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-induced_vector_apply2"><span class="command">lemma</span></span> induced_vector_apply2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">FH</span> <span class="main">⟹</span> induced_vector <span class="free">v</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> induced_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-induced_vector_indV"><span class="command">lemma</span></span> induced_vector_indV <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"induced_vector <span class="free">v</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> indV 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> BaseFGMod.indspaceI'<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="main">(</span>induced_vector <span class="free">v</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">FH</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> induced_vector_def supp_restrict0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">FH</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>FG_proj <span class="bound">y</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>induced_vector <span class="free">v</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">from</span></span> v <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>induced_vector <span class="free">v</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>     induced_vector_def zero_closed aezfun_setspan_proj_in_setspan<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
                smult_closed ActingGroup.group_ringD
      <span class="keyword1"><span class="command">by</span></span>        <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">FH</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">FH</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>induced_vector <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span>
                      <span class="main">=</span> <span class="main">(</span>induced_vector <span class="free">v</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>induced_vector <span class="free">v</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ring1_FH Ring1.add_closed aezfun_setspan_proj_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> FG_proj_in_FG
            smult_distrib_left induced_vector_def
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> induced_vector <span class="free">v</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span>
              <span class="main">=</span> induced_vector <span class="free">v</span> <span class="bound">x</span> <span class="main">+</span> induced_vector <span class="free">v</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">FH</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> v FH
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>induced_vector <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">δδ</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="keyword1">δδ</span> <span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>induced_vector <span class="free">v</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FG_subring_FH FG_fddg_closed Ring1_FH
            Ring1.mult_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">FH</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">δδ</span> <span class="skolem">g</span>"</span></span><span class="main">]</span> FG_proj_mult_leftdelta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
            FG_fddg_closed FG_proj_in_FG smult_assoc induced_vector_def
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">FH</span><span class="main">.</span> induced_vector <span class="free">v</span> <span class="main">(</span><span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>
              <span class="main">=</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">g</span> <span class="main"><span class="free">⋅</span></span> induced_vector <span class="free">v</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-induced_vector_additive"><span class="command">lemma</span></span> induced_vector_additive <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">v'</span> <span class="main">∈</span> <span class="free">V</span>
        <span class="main">⟹</span> induced_vector <span class="main">(</span><span class="free">v</span><span class="main">+</span><span class="free">v'</span><span class="main">)</span> <span class="main">=</span> induced_vector <span class="free">v</span> <span class="main">+</span> induced_vector <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_closed induced_vector_def FG_proj_in_FG smult_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-hom_induced_vector"><span class="command">lemma</span></span> hom_induced_vector <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">rrsmult</span> induced_vector"</span></span>
<span class="keyword1"><span class="command">proof</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="bound">v'</span> <span class="main">∈</span> <span class="free">V</span>
              <span class="main">⟹</span> induced_vector <span class="main">(</span><span class="bound">v</span> <span class="main">+</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">=</span> induced_vector <span class="bound">v</span> <span class="main">+</span> induced_vector <span class="bound">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> induced_vector_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"induced_vector <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">v</span><span class="main">∈</span><span class="free">V</span> <span class="keyword1">then</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">FH</span>
              <span class="keyword1">then</span> <span class="main">(</span>FG_proj <span class="bound">y</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> induced_vector_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"supp induced_vector <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> supp_restrict0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> BaseFGMod.FG <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span>
              <span class="main">⟹</span> induced_vector <span class="main">(</span><span class="bound">x</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main"><span class="free">¤</span></span> induced_vector <span class="bound">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> xv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> BaseFGMod.FG"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"induced_vector <span class="main">(</span><span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main"><span class="free">¤</span></span> induced_vector <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
      <span class="keyword1"><span class="command">from</span></span> xv FH <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"induced_vector <span class="main">(</span><span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main"><span class="free">¤</span></span> induced_vector <span class="skolem">v</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> smult_closed induced_vector_def FG_proj_in_FG smult_assoc rrsmultD1
              FG_subring_FH Ring1.mult_closed<span class="main">[</span><span class="operator">OF</span> Ring1_FH<span class="main">]</span> induced_vector_apply1
              FG_proj_mult_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> smult_closed induced_vector_apply2 rrsmultD2
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-indspace_sum_list_fddh"><span class="command">lemma</span></span> indspace_sum_list_fddh<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">fhs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> set <span class="main">(</span>map snd <span class="free">fhs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">H</span><span class="main">;</span> <span class="free">f</span> <span class="main">∈</span> <span class="free">indV</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="free">fhs</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="free">fhs</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fhs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_nonempty_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>single <span class="skolem">fh</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> split_beta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span>"</span></span> <span class="quoted"><span class="skolem">fh</span></span><span class="main">]</span> split_beta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span> <span class="bound">h</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">fh</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cons <span class="skolem">fh</span> <span class="skolem">fhs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> prevcase<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="skolem">fh</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map snd <span class="skolem">fhs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">fhs</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">fhs</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">fh</span><span class="main">#</span><span class="skolem">fhs</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>
              <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span>fst <span class="skolem">fh</span><span class="main">)</span> <span class="keyword1">δδ</span> <span class="main">(</span>snd <span class="skolem">fh</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">ah</span><span class="main">←</span><span class="skolem">fhs</span><span class="main">.</span> case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="bound">ah</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> split_beta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span>"</span></span> <span class="quoted"><span class="skolem">fh</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> prevcase<span class="main">(</span>1<span class="main">)</span> FH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">fh</span><span class="main">)</span> <span class="keyword1">δδ</span> <span class="main">(</span>snd <span class="skolem">fh</span><span class="main">)</span> <span class="main">∈</span> <span class="free">FH</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Supgroup.RG_aezdeltafun_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> prevcase<span class="main">(</span>2<span class="main">)</span> FH
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ah</span><span class="main">←</span><span class="skolem">fhs</span><span class="main">.</span> case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="bound">ah</span><span class="main">)</span> <span class="main">∈</span> <span class="free">FH</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Supgroup.RG_aezdeltafun_closed
          Ring1.sum_list_closed<span class="main">[</span><span class="operator">OF</span> Ring1_FH<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ah</span><span class="main">.</span> case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="bound">ah</span>"</span></span> <span class="quoted"><span class="skolem">fhs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">fh</span><span class="main">#</span><span class="skolem">fhs</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>
                              <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span>fst <span class="skolem">fh</span><span class="main">)</span> <span class="keyword1">δδ</span> <span class="main">(</span>snd <span class="skolem">fh</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">fhs</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indV prevcase<span class="main">(</span>3<span class="main">)</span> BaseFGMod.indspaceD_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> prevcase<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> split_beta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span> <span class="bound">h</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">a</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">fh</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-induced_fsmult_conv_fsmult_1ddh"><span class="command">lemma</span></span> induced_fsmult_conv_fsmult_1ddh <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">indV</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span> <span class="main">¤¤</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main">♯⋅</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FH indV induced_smult.fsmultD Supgroup.RG_aezdeltafun_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'f</span>"</span></span><span class="main">]</span>
        rrsmultD1 aezdeltafun_decomp'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">h</span></span><span class="main">]</span>
        aezdeltafun_decomp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">h</span></span><span class="main">]</span> Supgroup.RG_aezdeltafun_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'f</span>"</span></span><span class="main">]</span>
        Group.zero_closed<span class="main">[</span><span class="operator">OF</span> GroupG<span class="main">]</span>
        BaseFGMod.indspaceD_transform<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">FH</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">δδ</span> <span class="free">h</span>"</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
        BaseFGMod.fsmultD
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-indspace_el_eq_on_1ddh_imp_eq_on_rddh"><span class="command">lemma</span></span> indspace_el_eq_on_1ddh_imp_eq_on_rddh <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">HmodG</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">h</span><span class="main">∈</span><span class="free">HmodG</span><span class="main">.</span> <span class="free">G</span> <span class="main">+</span> <span class="main">{</span><span class="bound">h</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span><span class="main">∈</span><span class="free">HmodG</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span>6<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="keyword2"><span class="keyword">where</span></span> h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="main">∈</span> <span class="free">HmodG</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">+</span> <span class="main">{</span><span class="skolem">h'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> h'<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">h'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_plus_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">δδ</span> <span class="main">0</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="skolem">g</span><span class="main">+</span><span class="skolem">h'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aezdeltafun_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="skolem">g</span><span class="main">+</span><span class="skolem">h'</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">g</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">h'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> times_aezdeltafun_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'f</span>"</span></span><span class="main">,</span> <span class="operator">THEN</span> sym<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">δδ</span> <span class="skolem">g</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">h'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aezdeltafun_decomp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> indV FH assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> g<span class="main">(</span>1<span class="main">)</span> h'<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">δδ</span> <span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="free">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">h'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">δδ</span> <span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="free">f'</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">h'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Supgroup.RG_aezdeltafun_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h'</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
          BaseFGMod.indspaceD_transform<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">FH</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">h'</span>"</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
          BaseFGMod.indspaceD_transform<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f'</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">FH</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">h'</span>"</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">δδ</span> <span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h'<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-indspace_el_eq"><span class="command">lemma</span></span> indspace_el_eq <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">HmodG</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">h</span><span class="main">∈</span><span class="free">HmodG</span><span class="main">.</span> <span class="free">G</span> <span class="main">+</span> <span class="main">{</span><span class="bound">h</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span><span class="main">∈</span><span class="free">HmodG</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">f'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f'</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">FH</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> conjcases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> BothTrue 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">δδ</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_aezfun_transfer <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> indspace_el_eq_on_1ddh_imp_eq_on_rddh<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">HmodG</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">f'</span></span><span class="main">]</span> Supgroup.zero_closed
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> OneTrue <span class="keyword1"><span class="command">with</span></span> FH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Supgroup.RG_zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> OtherTrue 
    <span class="keyword1"><span class="command">with</span></span> FH <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rhs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> rhs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map snd <span class="skolem">rhs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">rhs</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Supgroup.RG_el_decomp_aezdeltafun
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> OtherTrue rhs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> rhs_nnil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rhs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> rhs
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">rhs</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span><span class="main">←</span><span class="skolem">rhs</span><span class="main">.</span> <span class="free">f'</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> indspace_sum_list_fddh
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rhs<span class="main">(</span>1<span class="main">)</span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">rhs</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> indspace_el_eq_on_1ddh_imp_eq_on_rddh<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">HmodG</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">f'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_prod_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">rhs</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">h</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> BothFalse
    <span class="keyword1"><span class="command">with</span></span> indV assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> BaseFGMod.indspaceD_supp'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> BaseFGMod.indspaceD_supp'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f'</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-indspace_el_eq'"><span class="command">lemma</span></span> indspace_el_eq' <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">hs</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">h</span><span class="main">∈</span>set <span class="free">hs</span><span class="main">.</span> <span class="free">G</span> <span class="main">+</span> <span class="main">{</span><span class="bound">h</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f'</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">hs</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">f'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-4<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> indspace_el_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"set <span class="free"><span class="free">hs</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span><span class="main">∈</span>set <span class="free">hs</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> set <span class="free">hs</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">hs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> in_set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set <span class="free">hs</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">f'</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context InducedFHModule *)</span>




<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Representations of Finite Groups›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Locale and basic facts›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Define a group representation to be a module over the group ring that is finite-dimensional as
  a vector space. The only restriction on the characteristic of the field is that it does not
  divide the order of the group. Also, we don't explicitly assume that the group is finite;
  instead, the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>good_char›</span></span></span></span> assumption implies that the cardinality of G is not zero, which
  implies G is finite. (See lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>good_card_imp_finite›</span></span></span></span>.)
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> FinGroupRepresentation <span class="main">=</span> FGModule <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
<span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> good_char<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     findim   <span class="main">:</span> <span class="quoted"><span class="quoted">"fscalar_mult.findim fsmult <span class="free">V</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> trivial_FinGroupRep <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> good_char  <span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     smult_zero <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>group_ring<span class="main">.</span> <span class="free">smult</span> <span class="bound">a</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'v</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FinGroupRepresentation.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> smult_zero <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'v</span> set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trivial_FGModule <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fscalar_mult.findim <span class="main">(</span>aezfun_scalar_mult.fsmult <span class="free">smult</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> R_scalar_mult.RSpan.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> aezfun_scalar_mult.R_scalar_mult empty_set empty_subsetI set_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> good_char <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FinGroupRepresentation_axioms <span class="free">G</span> <span class="free">smult</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> FinGroupRepresentation
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ordG</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ordG</span> <span class="main">≡</span> of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">GRepHom</span> <span class="main">≡</span> FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">GRepIso</span> <span class="main">≡</span> FGModuleIso <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">GRepEnd</span> <span class="main">≡</span> FGModuleEnd <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> zero_closed              <span class="main">=</span> zero_closed
<span class="keyword1"><span class="command">lemmas</span></span> Group                    <span class="main">=</span> Group
<span class="keyword1"><span class="command">lemmas</span></span> GSubmodule_GSpan_single  <span class="main">=</span> RSubmodule_RSpan_single
<span class="keyword1"><span class="command">lemmas</span></span> GSpan_single_nonzero     <span class="main">=</span> RSpan_single_nonzero

<span class="keyword1" id="Rep_Fin_Groups-finiteG"><span class="command">lemma</span></span> finiteG<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> good_char good_card_imp_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-FinDimVectorSpace"><span class="command">lemma</span></span> FinDimVectorSpace<span class="main">:</span> <span class="quoted"><span class="quoted">"FinDimVectorSpace fsmult <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> findim fVectorSpace VectorSpace.FinDimVectorSpaceI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-GSubspace_is_FinGroupRep"><span class="command">lemma</span></span> GSubspace_is_FinGroupRep <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span>
  <span class="operator">rule</span> FinGroupRepresentation.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> GSubspace_is_FGModule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span>
<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fscalar_mult.findim fsmult <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FinDimVectorSpace GSubspace_is_Subspace FinDimVectorSpace.Subspace_is_findim
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> good_char<span class="main">)</span>

<span class="keyword1" id="Rep_Fin_Groups-isomorphic_imp_GRep"><span class="command">lemma</span></span> isomorphic_imp_GRep <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isomorphic <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FinGroupRepresentation <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FinGroupRepresentation.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleIso.ImG FGModuleHom.FGModule_Im<span class="main">[</span><span class="operator">OF</span> FGModuleIso.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fscalar_mult.findim <span class="main">(</span>aezfun_scalar_mult.fsmult <span class="free">smult'</span><span class="main">)</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleIso.ImG findim FGModuleIso.VectorSpaceHom
          VectorSpaceHom.findim_domain_findim_image
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> good_char <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FinGroupRepresentation_axioms <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FinGroupRepresentation *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Irreducible representations›</span></span>

<span class="keyword1"><span class="command">locale</span></span> IrrFinGroupRepresentation <span class="main">=</span> FinGroupRepresentation
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">U</span> <span class="main">⟹</span> <span class="free">U</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">U</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> AbGroup <span class="main">=</span> AbGroup

<span class="keyword1" id="Rep_Fin_Groups-zero_isomorphic_to_FG_zero"><span class="command">lemma</span></span> zero_isomorphic_to_FG_zero <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"isomorphic <span class="main">(*)</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> aezfun set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GRepIso <span class="main">(*)</span> <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleIso.intro<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GRepHom <span class="main">(*)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trivial_FGModuleHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleIso_axioms <span class="free">V</span> <span class="main">0</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">0</span> <span class="free">V</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-eq_GSpan_single"><span class="command">lemma</span></span> eq_GSpan_single <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">V</span> <span class="main">=</span> GSpan <span class="main">[</span><span class="free">v</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> irr RSubmodule_RSpan_single RSpan_single_nonzero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context IrrFinGroupRepresentation *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> trivial_IrrFinGroupRepI <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">smult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>group_ring<span class="main">.</span> <span class="free">smult</span> <span class="bound">a</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'v</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IrrFinGroupRepresentation.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trivial_FinGroupRep <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation_axioms <span class="free">G</span> <span class="free">smult</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RModule.zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> trivial_IrrFinGroupRepresentation_in_FG <span class="main">:</span>
  <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">)</span>
        <span class="main">⟹</span> IrrFinGroupRepresentation <span class="free">G</span> <span class="main">(*)</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> trivial_IrrFinGroupRepI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">context</span></span> FinGroupRepresentation
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-IrrFinGroupRep_trivialGSubspace"><span class="command">lemma</span></span> IrrFinGroupRep_trivialGSubspace <span class="main">:</span>
  <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'v</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordG <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> good_char <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>FG<span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> smult_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ActingGroup.trivial_IrrFinGroupRepI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-IrrI"><span class="command">lemma</span></span> IrrI <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> FGModule.GSubspace <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="bound">U</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">U</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms IrrFinGroupRepresentation.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1" id="Rep_Fin_Groups-notIrr"><span class="command">lemma</span></span> notIrr <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span>
        <span class="main">⟹</span> <span class="main">∃</span><span class="bound">U</span><span class="main">.</span> GSubspace <span class="bound">U</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">≠</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> IrrI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FinGroupRepresentation *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Maschke's theorem›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Averaged projection onto a G-subspace›</span></span>

<span class="keyword1"><span class="command">context</span></span> FinGroupRepresentation
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-avg_proj_eq_id_on_right"><span class="command">lemma</span></span> avg_proj_eq_id_on_right <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"VectorSpace fsmult <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">V</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> P <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≡</span> <span class="main">(</span><span class="main">⨁</span><span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">V</span><span class="main">]</span><span class="main">↓</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> CP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CP</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Gmult <span class="main">(</span><span class="main">-</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∘</span> <span class="free">P</span> <span class="main">∘</span> Gmult <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> T <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">≡</span> fsmult <span class="main">(</span><span class="main">1</span><span class="main">/</span>ordG<span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> P assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main">*⋅</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Gmult_closed VectorSpace.AbGroup<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> AbGroup 
          AbGroup_inner_dirsum_el_decomp_nth_id_on_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">V</span><span class="main">]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> CP assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">CP</span> <span class="bound">g</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Gmult_neg_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> good_char T <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finiteG sum_fun_apply<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">CP</span></span><span class="main">]</span> sum_fsmult_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span>"</span></span><span class="main">]</span>
          fsmult_assoc<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted">ordG</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-avg_proj_onto_right"><span class="command">lemma</span></span> avg_proj_onto_right <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"VectorSpace fsmult <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">U</span><span class="main">]</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="free">W</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> P <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≡</span> <span class="main">(</span><span class="main">⨁</span><span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">U</span><span class="main">]</span><span class="main">↓</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> CP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CP</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Gmult <span class="main">(</span><span class="main">-</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∘</span> <span class="free">P</span> <span class="main">∘</span> Gmult <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> T <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">≡</span> fsmult <span class="main">(</span><span class="main">1</span><span class="main">/</span>ordG<span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">=</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GSubspace_is_FGModule <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> P U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Gmult_closed VectorSpace.AbGroup FGModule.AbGroup
            AbGroup_inner_dirsum_el_decomp_nth_onto_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> U CP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">CP</span> <span class="bound">g</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FGModule.Gmult_closed GroupG Group.neg_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> U T <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finiteG FGModule.sum_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span> <span class="skolem">v</span>"</span></span><span class="main">]</span>
            sum_fun_apply<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">CP</span></span><span class="main">]</span> FGModule.fsmult_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊇</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> u T CP P assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> GSubspace_is_FinGroupRep FinGroupRepresentation.avg_proj_eq_id_on_right
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">]</span> assms<span class="main">(</span>1-4<span class="main">)</span> u <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">`</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Module.AbGroup RModule.AbGroup AbGroup_subset_inner_dirsum
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-FGModuleEnd_avg_proj_right"><span class="command">lemma</span></span> FGModuleEnd_avg_proj_right <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fSubspace <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="free">W</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> P <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≡</span> <span class="main">(</span><span class="main">⨁</span><span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">U</span><span class="main">]</span><span class="main">↓</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> CP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CP</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Gmult <span class="main">(</span><span class="main">-</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∘</span> <span class="free">P</span> <span class="main">∘</span> Gmult <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> T <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">≡</span> <span class="main">(</span>fsmult <span class="main">(</span><span class="main">1</span><span class="main">/</span>ordG<span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">↓</span><span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModuleEnd <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> VecEnd_GMap_is_FGModuleEnd<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> T <span class="keyword1"><span class="command">have</span></span> T_apply<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span><span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>ordG<span class="main">)</span> <span class="main">♯⋅</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finiteG sum_fun_apply<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">CP</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1-4<span class="main">)</span> P <span class="keyword1"><span class="command">have</span></span> Pgv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span> <span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span> <span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Gmult_closed VectorSpace_fSubspace VectorSpace.AbGroup<span class="main">[</span><span class="operator">of</span> <span class="quoted">fsmult</span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span>
          RModule.AbGroup<span class="main">[</span><span class="operator">of</span> <span class="quoted">FG</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span>
          GroupEnd_inner_dirsum_el_decomp_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
          GroupEnd.endomorph<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> im_CP_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span> <span class="bound">v</span><span class="main">)</span> <span class="main">`</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">`</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> CP Pgv<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> ActingGroup.neg_closed Gmult_closed finiteG <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> sumCP_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finiteG im_CP_V sum_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VectorSpaceEnd <span class="main">(♯⋅)</span> <span class="free">V</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span>
    <span class="operator">rule</span> VectorSpaceEndI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> VectorSpace.VectorSpaceHomI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fVectorSpace
  <span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"GroupHom <span class="free">V</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">v'</span> <span class="keyword3"><span class="command">assume</span></span> vv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> T_apply <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>ordG<span class="main">)</span> <span class="main">♯⋅</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">v'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> add_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">CP</span> <span class="bound">g</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> <span class="free">CP</span> <span class="bound">g</span> <span class="skolem">v</span> <span class="main">+</span> <span class="free">CP</span> <span class="bound">g</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> CP P vv' assms<span class="main">(</span>1-4<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">CP</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">*⋅</span> <span class="main">(</span> <span class="free">P</span> <span class="main">(</span> <span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span> <span class="main">)</span> <span class="main">+</span> <span class="free">P</span> <span class="main">(</span> <span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v'</span> <span class="main">)</span> <span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Gmult_distrib_left Gmult_closed VectorSpace_fSubspace
                VectorSpace.AbGroup<span class="main">[</span><span class="operator">of</span> <span class="quoted">fsmult</span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span> RModule.AbGroup<span class="main">[</span><span class="operator">of</span> <span class="quoted">FG</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span>
                GroupEnd_inner_dirsum_el_decomp_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
                GroupEnd.hom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> g vv' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">CP</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">v'</span><span class="main">)</span>
                              <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">*⋅</span> <span class="free">P</span> <span class="main">(</span> <span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span> <span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">*⋅</span> <span class="free">P</span> <span class="main">(</span> <span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v'</span> <span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Pgv ActingGroup.neg_closed Gmult_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">CP</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> <span class="free">CP</span> <span class="skolem">g</span> <span class="skolem">v</span> <span class="main">+</span> <span class="free">CP</span> <span class="skolem">g</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> CP <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="skolem">v</span> <span class="main">+</span> <span class="free">T</span> <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vv' sumCP_V<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> sumCP_V<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> sum.distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span> <span class="skolem">v</span>"</span></span><span class="main">]</span>
              T_apply
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> T <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="free">T</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> supp_restrict0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">a</span> <span class="main">♯⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">♯⋅</span> <span class="free">T</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> T_apply <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">♯⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>ordG<span class="main">)</span> <span class="main">♯⋅</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">♯⋅</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fsmult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">CP</span> <span class="bound">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">♯⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">♯⋅</span> <span class="free">CP</span> <span class="bound">g</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1-4<span class="main">)</span> CP P v <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">CP</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">♯⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">♯⋅</span> <span class="free">CP</span> <span class="skolem">g</span> <span class="skolem">v</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> fsmult_Gmult_comm GSubspace_is_Subspace Gmult_closed fVectorSpace
                VectorSpace.VectorSpaceEnd_inner_dirsum_el_decomp_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted">fsmult</span><span class="main">]</span>
                VectorSpaceEnd.f_map<span class="main">[</span><span class="operator">of</span> <span class="quoted">fsmult</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="bound">N</span><span class="main">←</span><span class="main">[</span><span class="free">W</span><span class="main">,</span> <span class="free">U</span><span class="main">]</span><span class="main">.</span> <span class="bound">N</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span>"</span></span><span class="main">]</span>
                ActingGroup.neg_closed Pgv
          <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">♯⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">♯⋅</span> <span class="free">T</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> v im_CP_V sumCP_V T_apply finiteG
              fsmult_sum_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span> <span class="skolem">v</span>"</span></span><span class="main">]</span>
              fsmult_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span>ordG"</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span> <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sumCP_V fsmult_closed T_apply image_subsetI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*⋅</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main">*⋅</span> <span class="free">T</span> <span class="bound">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> T_apply <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>ordG<span class="main">)</span> <span class="main">♯⋅</span> <span class="main">(</span><span class="main">∑</span><span class="bound">h</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Gmult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>ordG<span class="main">)</span> <span class="main">♯⋅</span> <span class="main">(</span><span class="main">∑</span><span class="bound">h</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">CP</span> <span class="main">(</span><span class="bound">h</span> <span class="main">+</span> <span class="main">-</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> GroupG Group.neg_closed
            Group.right_translate_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">h</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> CP
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">CP</span> <span class="main">(</span><span class="bound">h</span> <span class="main">+</span> <span class="main">-</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">*⋅</span> <span class="free">CP</span> <span class="bound">h</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> g v Gmult_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> ActingGroup.neg_closed
            Gmult_assoc<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span>"</span></span><span class="main">,</span> <span class="operator">THEN</span> sym<span class="main">]</span>
            Gmult_neg_left minus_add<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">g</span>"</span></span><span class="main">]</span> Pgv Gmult_assoc
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">*⋅</span> <span class="free">T</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> g v GmultD finiteG FG_fddg_closed im_CP_V sumCP_V
            smult_sum_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>
            fsmult_Gmult_comm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="bound">h</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="free">CP</span> <span class="bound">h</span> <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main">]</span> T_apply
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-avg_proj_is_proj_right"><span class="command">lemma</span></span> avg_proj_is_proj_right <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"VectorSpace fsmult <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">U</span><span class="main">]</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="free">W</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> P <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≡</span> <span class="main">(</span><span class="main">⨁</span><span class="main">[</span><span class="free">W</span><span class="main">,</span><span class="free">U</span><span class="main">]</span><span class="main">↓</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> CP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CP</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Gmult <span class="main">(</span><span class="main">-</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∘</span> <span class="free">P</span> <span class="main">∘</span> Gmult <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> T <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">≡</span> fsmult <span class="main">(</span><span class="main">1</span><span class="main">/</span>ordG<span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">CP</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">(</span><span class="free">T</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   assms avg_proj_onto_right GSubspace_is_FinGroupRep
          FinGroupRepresentation.avg_proj_eq_id_on_right
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FinGroupRepresentation *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The theorem›</span></span>

<span class="keyword1"><span class="command">context</span></span> FinGroupRepresentation
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Maschke <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> GSubspace <span class="bound">W</span> <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="bound">W</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RModule.zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="free">U</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inner_dirsum_doubleI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"GSubspace <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> trivial_RSubmodule zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> GSubspace <span class="bound">W</span> <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="bound">W</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> W'<span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpace.Subspace fsmult <span class="free">V</span> <span class="skolem">W'</span> <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="skolem">W'</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GSubspace_is_Subspace FinDimVectorSpace FinDimVectorSpace.semisimple
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> vsp_W'<span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpace fsmult <span class="skolem">W'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dirsum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="skolem">W'</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpace.SubspaceD1<span class="main">[</span><span class="operator">OF</span> fVectorSpace<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> False dirsum <span class="keyword1"><span class="command">have</span></span> indS<span class="main">:</span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="skolem">W'</span><span class="main">,</span><span class="free">U</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_dirsumD2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span>  <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="main">[</span><span class="skolem">W'</span><span class="main">,</span><span class="free">U</span><span class="main">]</span><span class="main">↓</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">CP</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">CP</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> Gmult <span class="main">(</span><span class="main">-</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">P</span> <span class="main">∘</span> Gmult <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> fsmult <span class="main">(</span><span class="main">1</span><span class="main">/</span>ordG<span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="skolem">CP</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">=</span> GroupHom.Ker <span class="free">V</span> <span class="main">(</span><span class="skolem">S</span><span class="main">↓</span><span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms W' indS S_def CP_def P_def <span class="keyword1"><span class="command">have</span></span> endo<span class="main">:</span> <span class="quoted"><span class="quoted">"GRepEnd <span class="main">(</span><span class="skolem">S</span><span class="main">↓</span><span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleEnd_avg_proj_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> S_def CP_def P_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">S</span><span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">S</span><span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">S</span><span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="bound">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> endo FGModuleEnd.endomorph
            avg_proj_is_proj_right<span class="main">[</span><span class="operator">OF</span> vsp_W' assms indS dirsum<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S</span><span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">`</span> <span class="free">V</span> <span class="main">=</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms indS P_def CP_def S_def dirsum vsp_W' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">`</span> <span class="free">V</span> <span class="main">=</span> <span class="free">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> avg_proj_onto_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S</span><span class="main">↓</span><span class="free">V</span><span class="main">)</span> <span class="main">`</span> <span class="free">V</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">`</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="skolem">W</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"GSubspace <span class="skolem">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> W_def FGModuleEnd.proj_decomp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">↓</span><span class="free">V</span>"</span></span><span class="main">]</span>
          FGModuleEnd.GSubspace_Ker
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Maschke_proper <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">≠</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> GSubspace <span class="bound">W</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">≠</span> <span class="free">V</span> <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="bound">W</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"GSubspace <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="skolem">W</span> <span class="main">⊕</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Maschke <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> W<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inner_dirsum_double_left0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> W <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">≠</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Subgroup_RSubmodule Group.nonempty
          inner_dirsum_double_leftfull_imp_right0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">W</span></span> <span class="quoted"><span class="free">U</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> W <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FinGroupRepresentation *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Consequence: complete reducibility›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FinGroupRepresentation<span class="main">)</span> notIrr_decompose <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span>
        <span class="main">⟹</span> <span class="main">∃</span><span class="bound">U</span> <span class="bound">W</span><span class="main">.</span> GSubspace <span class="bound">U</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">≠</span> <span class="free">V</span> <span class="main">∧</span> GSubspace <span class="bound">W</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">≠</span> <span class="main">0</span>
          <span class="main">∧</span> <span class="bound">W</span> <span class="main">≠</span> <span class="free">V</span> <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="bound">U</span> <span class="main">⊕</span> <span class="bound">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> notIrr Maschke_proper <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In the following decomposition lemma, we do not need to explicitly include the condition that all
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"set <span class="free"><span class="free">Us</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are subsets of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">V</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. (See lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>AbGroup_subset_inner_dirsum›</span></span></span></span>.)
›</span></span>

<span class="keyword1" id="Rep_Fin_Groups-FinGroupRepresentation_reducible'"><span class="command">lemma</span></span> FinGroupRepresentation_reducible' <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V</span><span class="main">.</span> FinGroupRepresentation <span class="free">G</span> <span class="free">fgsmult</span> <span class="bound">V</span>
              <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> FGModule.fdim <span class="free">fgsmult</span> <span class="bound">V</span>
                <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Us</span><span class="main">.</span> Ball <span class="main">(</span>set <span class="bound">Us</span><span class="main">)</span> <span class="main">(</span>IrrFinGroupRepresentation <span class="free">G</span> <span class="free">fgsmult</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="main">(</span><span class="main">0</span> <span class="main">∉</span> set <span class="bound">Us</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="bound">Us</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> full_nat_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">V</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">GRep</span></span> <span class="skolem"><span class="skolem">IGRep</span></span> <span class="skolem"><span class="skolem">GSubspace</span></span> <span class="skolem"><span class="skolem">GSpan</span></span> <span class="skolem"><span class="skolem">fdim</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">GRep</span> <span class="main">=</span> FinGroupRepresentation <span class="free">G</span> <span class="free">fgsmult</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">IGRep</span> <span class="main">=</span> IrrFinGroupRepresentation <span class="free">G</span> <span class="free">fgsmult</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">GSubspace</span> <span class="main">=</span> FGModule.GSubspace <span class="free">G</span> <span class="free">fgsmult</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">GSpan</span> <span class="main">=</span> FGModule.GSpan <span class="free">G</span> <span class="free">fgsmult</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fdim</span> <span class="main">=</span> FGModule.fdim <span class="free">fgsmult</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> Suc <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">GRep</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">=</span> <span class="skolem">fdim</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">(</span> <span class="main">∃</span><span class="bound">Us</span><span class="main">.</span>
              Ball <span class="main">(</span>set <span class="bound">Us</span><span class="main">)</span> <span class="skolem">IGRep</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span> <span class="main">∉</span> set <span class="bound">Us</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="bound">Us</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> prev_case<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">W</span><span class="main">.</span> <span class="skolem">GRep</span> <span class="bound">W</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">=</span> <span class="skolem">fdim</span> <span class="bound">W</span> <span class="main">⟹</span> <span class="main">(</span> <span class="main">∃</span><span class="bound">Us</span><span class="main">.</span>
            Ball <span class="main">(</span>set <span class="bound">Us</span><span class="main">)</span> <span class="skolem">IGRep</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span> <span class="main">∉</span> set <span class="bound">Us</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="bound">Us</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc_le_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">GRep</span> <span class="skolem">V</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">fdim</span> <span class="skolem">V</span> <span class="main">⟹</span> <span class="main">(</span> <span class="main">∃</span><span class="bound">Us</span><span class="main">.</span>
          Ball <span class="main">(</span>set <span class="bound">Us</span><span class="main">)</span> <span class="skolem">IGRep</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span> <span class="main">∉</span> set <span class="bound">Us</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="bound">Us</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">GRep</span> <span class="skolem">V</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">fdim</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">Us</span><span class="main">.</span> Ball <span class="main">(</span>set <span class="bound">Us</span><span class="main">)</span> <span class="skolem">IGRep</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span> <span class="main">∉</span> set <span class="bound">Us</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="bound">Us</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">IGRep</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> conjcases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> BothTrue
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">[]</span><span class="main">)</span> <span class="skolem">IGRep</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span>set <span class="main">[]</span><span class="main">.</span> <span class="bound">U</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> inner_dirsum_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> OneTrue
      <span class="keyword1"><span class="command">with</span></span> V GRep_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> FinGroupRepresentation.Group<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">fgsmult</span></span><span class="main">]</span> Group.obtain_nonzero
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> v<span class="main">(</span>1<span class="main">)</span> V GRep_def GSpan_def GSubspace_def <span class="keyword1"><span class="command">have</span></span> GSub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">GSubspace</span> <span class="main">(</span><span class="skolem">GSpan</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> FinGroupRepresentation.GSubmodule_GSpan_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> v V GRep_def GSpan_def <span class="keyword1"><span class="command">have</span></span> nzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">GSpan</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> FinGroupRepresentation.GSpan_single_nonzero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="skolem">GSpan</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> OneTrue GSpan_def GSubspace_def IGRep_def IrrFinGroupRepresentation.irr
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
      <span class="keyword1"><span class="command">with</span></span> OneTrue
        <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">[</span><span class="skolem">GSpan</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">]</span><span class="main">)</span> <span class="skolem">IGRep</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="main">[</span><span class="skolem">GSpan</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">]</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="main">[</span><span class="skolem">GSpan</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">]</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nzero GSub inner_dirsum_singleD
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> OtherTrue <span class="keyword1"><span class="command">with</span></span> V GRep_def IGRep_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> FinGroupRepresentation.IrrFinGroupRep_trivialGSubspace <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> BothFalse
      <span class="keyword1"><span class="command">with</span></span> V GRep_def IGRep_def GSubspace_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="skolem"><span class="skolem">W</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">GSubspace</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="skolem">V</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>   W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">GSubspace</span> <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">≠</span> <span class="skolem">V</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>   Vdecompose<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">⊕</span> <span class="skolem">W</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> FinGroupRepresentation.notIrr_decompose<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">fgsmult</span></span> <span class="quoted"><span class="skolem">V</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> U<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> W<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> V GRep_def GSubspace_def fdim_def
        <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">fdim</span> <span class="skolem">U</span> <span class="main">&lt;</span> <span class="skolem">fdim</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fdim</span> <span class="skolem">W</span> <span class="main">&lt;</span> <span class="skolem">fdim</span> <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> FinGroupRepresentation.axioms<span class="main">(</span>1<span class="main">)</span>
              FGModule.GSubspace_is_Subspace<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">fgsmult</span></span> <span class="quoted"><span class="skolem">V</span></span> <span class="quoted"><span class="skolem">U</span></span><span class="main">]</span>
              FGModule.GSubspace_is_Subspace<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">fgsmult</span></span> <span class="quoted"><span class="skolem">V</span></span> <span class="quoted"><span class="skolem">W</span></span><span class="main">]</span>
              FinGroupRepresentation.FinDimVectorSpace<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">fgsmult</span></span> <span class="quoted"><span class="skolem">V</span></span><span class="main">]</span>
              FinDimVectorSpace.Subspace_dim_lt<span class="main">[</span>
                <span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun_scalar_mult.fsmult <span class="free">fgsmult</span>"</span></span> <span class="quoted"><span class="skolem">V</span></span> <span class="quoted"><span class="skolem">U</span></span>
              <span class="main">]</span>
              FinDimVectorSpace.Subspace_dim_lt<span class="main">[</span>
                <span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun_scalar_mult.fsmult <span class="free">fgsmult</span>"</span></span> <span class="quoted"><span class="skolem">V</span></span> <span class="quoted"><span class="skolem">W</span></span>
              <span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this U<span class="main">(</span>1<span class="main">)</span> W<span class="main">(</span>1<span class="main">)</span> V GSubspace_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Us</span></span> <span class="skolem"><span class="skolem">Ws</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="skolem">Us</span><span class="main">)</span> <span class="skolem">IGRep</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span> <span class="main">∉</span> set <span class="skolem">Us</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">X</span><span class="main">←</span><span class="skolem">Us</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="skolem">Ws</span><span class="main">)</span> <span class="skolem">IGRep</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span> <span class="main">∉</span> set <span class="skolem">Ws</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">W</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">X</span><span class="main">←</span><span class="skolem">Ws</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prev_case<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fdim</span> <span class="skolem">U</span>"</span></span><span class="main">]</span> prev_case<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fdim</span> <span class="skolem">W</span>"</span></span><span class="main">]</span> GRep_def
              FinGroupRepresentation.GSubspace_is_FinGroupRep<span class="main">[</span>
                <span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">fgsmult</span></span> <span class="quoted"><span class="skolem">V</span></span> <span class="quoted"><span class="skolem">U</span></span>
              <span class="main">]</span>
              FinGroupRepresentation.GSubspace_is_FinGroupRep<span class="main">[</span>
                <span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">fgsmult</span></span> <span class="quoted"><span class="skolem">V</span></span> <span class="quoted"><span class="skolem">W</span></span>
              <span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> Us<span class="main">:</span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="skolem">Us</span><span class="main">)</span> <span class="skolem">IGRep</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="skolem">Us</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">X</span><span class="main">←</span><span class="skolem">Us</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Ws<span class="main">:</span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="skolem">Ws</span><span class="main">)</span> <span class="skolem">IGRep</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="skolem">Ws</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">X</span><span class="main">←</span><span class="skolem">Ws</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span>  <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> Us<span class="main">(</span>1<span class="main">)</span> Ws<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">(</span><span class="skolem">Us</span><span class="main">@</span><span class="skolem">Ws</span><span class="main">)</span><span class="main">)</span> <span class="skolem">IGRep</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Us<span class="main">(</span>2<span class="main">)</span> Ws<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">Us</span><span class="main">@</span><span class="skolem">Ws</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">X</span><span class="main">←</span><span class="main">(</span><span class="skolem">Us</span><span class="main">@</span><span class="skolem">Ws</span><span class="main">)</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> U<span class="main">(</span>2<span class="main">)</span> Us<span class="main">(</span>3<span class="main">)</span> W<span class="main">(</span>2<span class="main">)</span> Ws<span class="main">(</span>3<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span>  indUs<span class="main">:</span> <span class="quoted"><span class="quoted">"add_independentS <span class="skolem">Us</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>   indWs<span class="main">:</span> <span class="quoted"><span class="quoted">"add_independentS <span class="skolem">Ws</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inner_dirsumD2
          <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> IGRep_def Us<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="skolem">Us</span><span class="main">)</span> <span class="main">(</span><span class="main">(∈)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IrrFinGroupRepresentation.axioms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">fgsmult</span></span><span class="main">]</span>
                FinGroupRepresentation.zero_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">fgsmult</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Us<span class="main">(</span>3<span class="main">)</span> Ws<span class="main">(</span>3<span class="main">)</span> BothFalse Vdecompose indUs indWs
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">Us</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">Ws</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inner_dirsumD2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">W</span><span class="main">]</span>"</span></span><span class="main">]</span> inner_dirsumD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Us</span></span><span class="main">]</span>
                inner_dirsumD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Ws</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">(</span><span class="skolem">Us</span><span class="main">@</span><span class="skolem">Ws</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> add_independentS_double_sum_conv_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> W<span class="main">(</span>1<span class="main">)</span> Ws<span class="main">(</span>3<span class="main">)</span> indWs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">←</span><span class="skolem">Ws</span><span class="main">.</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inner_dirsumD GSubspace_def RModule.zero_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Vdecompose Us<span class="main">(</span>3<span class="main">)</span> Ws<span class="main">(</span>3<span class="main">)</span> inner_dirsum_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FinGroupRepresentation<span class="main">)</span> reducible <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Us</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">∈</span>set <span class="bound">Us</span><span class="main">.</span> IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span> <span class="main">∉</span> set <span class="bound">Us</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="bound">Us</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FinGroupRepresentation_axioms FinGroupRepresentation_reducible' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Consequence: decomposition relative to a homomomorphism›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FinGroupRepresentation<span class="main">)</span> GRepHom_decomp <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">T</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> KerT <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">KerT</span> <span class="main">≡</span> <span class="main">(</span>ker <span class="free">T</span> <span class="main">∩</span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom  <span class="main">:</span> <span class="quoted"><span class="quoted">"GRepHom <span class="free">smult'</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">U</span><span class="main">.</span> GSubspace <span class="bound">U</span> <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="bound">U</span> <span class="main">⊕</span> <span class="free">KerT</span>
                <span class="main">∧</span> FGModule.isomorphic <span class="free">G</span> <span class="free">smult</span> <span class="bound">U</span> <span class="free">smult'</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> KerT <span class="keyword1"><span class="command">have</span></span> KerT'<span class="main">:</span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">KerT</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleHom.GSubspace_Ker<span class="main">[</span><span class="operator">OF</span> hom<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"GSubspace <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">⊕</span> <span class="free">KerT</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Maschke<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">KerT</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> nonzero U<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> indep<span class="main">:</span> <span class="quoted"><span class="quoted">"add_independentS <span class="main">[</span><span class="skolem">U</span><span class="main">,</span><span class="free">KerT</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_dirsumD2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"FGModuleIso <span class="free">G</span> <span class="free">smult</span> <span class="skolem">U</span> <span class="free">smult'</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleIso.intro<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> U<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="skolem">U</span> <span class="free">smult'</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FGModuleHom.FGModuleHom_restrict0_GSubspace<span class="main">[</span><span class="operator">OF</span> hom<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleIso_axioms <span class="skolem">U</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> FGModuleIso_axioms_def bij_betw_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inj_onI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">U</span> <span class="main">=</span> <span class="free">T</span> <span class="main">`</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">from</span></span> U<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">U</span> <span class="main">⊆</span> <span class="free">T</span> <span class="main">`</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">U</span> <span class="main">⊇</span> <span class="free">T</span> <span class="main">`</span> <span class="free">V</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_subsetI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> U<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> uk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">KerT</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> inner_dirsum_doubleD<span class="main">[</span><span class="operator">OF</span> indep<span class="main">]</span> set_plus_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">U</span></span> <span class="quoted"><span class="free">KerT</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
          <span class="keyword1"><span class="command">with</span></span> KerT U<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> kerD FGModuleHom.additive<span class="main">[</span><span class="operator">OF</span> hom<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">with</span></span> uk<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">T</span> <span class="main">↓</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> U<span class="main">(</span>1<span class="main">)</span> KerT <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="free">KerT</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> FGModuleHom.eq_im_imp_diff_in_Ker<span class="main">[</span><span class="operator">OF</span> hom<span class="main">]</span>
              GSubspace_is_FGModule FGModule.diff_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="skolem">U</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> U<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RModule.AbGroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> KerT' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"AbGroup <span class="free">KerT</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> RModule.AbGroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> indep AbGroup_inner_dirsum_pairwise_int0_double<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">U</span></span> <span class="quoted"><span class="free">KerT</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> U <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Schur's lemma›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> IrrFinGroupRepresentation<span class="main">)</span> Schur_Ker <span class="main">:</span>
  <span class="quoted"><span class="quoted">"GRepHom <span class="free">smult'</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> inj_on <span class="free">T</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> irr FGModuleHom.GSubspace_Ker<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> 
        FGModuleHom.Ker_Im_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span>
        FGModuleHom.Ker0_imp_inj_on<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FinGroupRepresentation<span class="main">)</span> Schur_Im <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"GRepHom <span class="free">smult'</span> <span class="free">T</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">=</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"FGModule.GSubspace <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule FG <span class="free">smult'</span> <span class="main">(</span><span class="free">T</span> <span class="main">`</span> <span class="free">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FGModuleHom.axioms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>
            RModuleHom.RModule_Im<span class="main">[</span><span class="operator">of</span> <span class="quoted">FG</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IrrFinGroupRepresentation.irr <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> IrrFinGroupRepresentation<span class="main">)</span> Schur1 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>   <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span> 
            <span class="quoted"><span class="quoted">"GRepHom <span class="free">smult'</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"GRepIso <span class="free">smult'</span> <span class="free">T</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleIso.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">T</span> <span class="free">V</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>     IrrFinGroupRepresentation_axioms assms
              IrrFinGroupRepresentation.axioms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>
              FinGroupRepresentation.Schur_Im<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>
              IrrFinGroupRepresentation.Schur_Ker<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
    <span class="keyword1"><span class="command">by</span></span>        <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> IrrFinGroupRepresentation<span class="main">)</span> Schur2 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> GRep      <span class="main">:</span> <span class="quoted"><span class="quoted">"GRepEnd <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     fdim       <span class="main">:</span> <span class="quoted"><span class="quoted">"fdim <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     alg_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'b</span> poly<span class="main">.</span> degree <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">T</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">c</span> <span class="main">♯⋅</span> <span class="bound">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fdim alg_closed <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> eu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">♯⋅</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleEnd.VectorSpaceEnd<span class="main">[</span><span class="operator">OF</span> GRep<span class="main">]</span>
          FinDimVectorSpace.endomorph_has_eigenvector<span class="main">[</span>
            <span class="operator">OF</span> FinDimVectorSpace<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">T</span></span>
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">T</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">♯⋅</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> eu U_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="free">T</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">♯⋅</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GRep irr FGModuleEnd.axioms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span>
          GSubspace_eigenspace<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The group ring as a representation space›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The group ring is a representation space›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> FGModule_FG <span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> FG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FG</span> <span class="main">≡</span> group_ring <span class="main">::</span> <span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="main">(*)</span> <span class="free">FG</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModule.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Group_axioms<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> RModuleI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Ring1 group_ring"</span></span> <span class="keyword1"><span class="command">using</span></span> Ring1_RG <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> 1 FG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group <span class="free">FG</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ring1.axioms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> 1 FG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"RModule_axioms group_ring <span class="main">(*)</span> <span class="free">FG</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ring1.mult_closed
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> FinGroupRepresentation_FG <span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> FG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FG</span> <span class="main">≡</span> group_ring <span class="main">::</span> <span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> good_char<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"FinGroupRepresentation <span class="free">G</span> <span class="main">(*)</span> <span class="free">FG</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FinGroupRepresentation.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> FG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="main">(*)</span> <span class="free">FG</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FGModule_FG <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FinGroupRepresentation_axioms <span class="free">G</span> <span class="main">(*)</span> <span class="free">FG</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> FG good_char <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> gs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">gs</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span> <span class="free">FG</span><span class="main">.</span> <span class="main">∃</span><span class="bound">bs</span><span class="main">.</span> length <span class="bound">bs</span> <span class="main">=</span> length <span class="skolem">gs</span>
                      <span class="main">∧</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span>zip <span class="bound">bs</span> <span class="skolem">gs</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> good_card_imp_finite FinGroupI FinGroup.group_ring_spanning_set
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1">(δδ)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">gs</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> FG gs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="free">FG</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RG_aezdeltafun_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"aezfun_scalar_mult.fSpan <span class="main">(*)</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="free">FG</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> 1 FG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"aezfun_scalar_mult.fSpan <span class="main">(*)</span> <span class="skolem">xs</span> <span class="main">⊆</span> <span class="free">FG</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> FGModule_FG FGModule.fSpan_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"aezfun_scalar_mult.fSpan <span class="main">(*)</span> <span class="skolem">xs</span> <span class="main">⊇</span> <span class="free">FG</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">FG</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this gs<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">bs</span> <span class="main">=</span> length <span class="skolem">gs</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">←</span>zip <span class="skolem">bs</span> <span class="skolem">gs</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
        <span class="keyword1"><span class="command">from</span></span> bs<span class="main">(</span>2<span class="main">)</span> xs_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">←</span>zip <span class="skolem">bs</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sum_list_prod_map2<span class="main">[</span><span class="operator">THEN</span> sym<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">with</span></span> bs<span class="main">(</span>1<span class="main">)</span> xs_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> aezfun_scalar_mult.fSpan <span class="main">(*)</span> <span class="skolem">xs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> aezfun_scalar_mult.fsmultD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">,</span> <span class="operator">THEN</span> sym<span class="main">]</span>
                sum_list_prod_cong<span class="main">[</span>
                  <span class="operator">of</span> <span class="quoted"><span class="quoted">"zip <span class="skolem">bs</span> <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="keyword1">δδ</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span>"</span></span>
                     <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span> <span class="bound">a</span><span class="main">.</span> aezfun_scalar_mult.fsmult <span class="main">(*)</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
                <span class="main">]</span>
                scalar_mult.lincomb_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun_scalar_mult.fsmult <span class="main">(*)</span>"</span></span> <span class="quoted"><span class="skolem">bs</span></span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span>
                scalar_mult.SpanD_lincomb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun_scalar_mult.fsmult <span class="main">(*)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">FG</span> <span class="main">∧</span> aezfun_scalar_mult.fSpan <span class="main">(*)</span> <span class="bound">xs</span> <span class="main">=</span> <span class="free">FG</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> good_char<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FinGroupRepresentation<span class="main">)</span> FinGroupRepresentation_FG <span class="main">:</span>
  <span class="quoted"><span class="quoted">"FinGroupRepresentation <span class="free">G</span> <span class="main">(*)</span> FG"</span></span>
  <span class="keyword1"><span class="command">using</span></span> good_char ActingGroup.FinGroupRepresentation_FG <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> FG_reducible <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Us</span><span class="main">::</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set list<span class="main">.</span>
                <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">∈</span>set <span class="bound">Us</span><span class="main">.</span> IrrFinGroupRepresentation <span class="free">G</span> <span class="main">(*)</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∉</span> set <span class="bound">Us</span>
                  <span class="main">∧</span> group_ring <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="bound">Us</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>   assms FinGroupRepresentation_FG FinGroupRepresentation.reducible
  <span class="keyword1"><span class="command">by</span></span>      <span class="operator">fast</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Irreducible representations are constituents of the group ring›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FGModuleIso<span class="main">)</span> isomorphic_to_irr_right <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FinGroupRepresentation.IrrI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FinGroupRepresentation <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IrrFinGroupRepresentation.axioms<span class="main">(</span>1<span class="main">)</span> isomorphic_sym
          FinGroupRepresentation.isomorphic_imp_GRep
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> GSubspace <span class="bound">U</span> <span class="main">⟹</span> <span class="bound">U</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">U</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IrrFinGroupRepresentation.irr isomorphic_to_irr_right' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FinGroupRepresentation<span class="main">)</span> IrrGSubspace_iso_constituent <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonzero <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     subsp   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     V_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span>set <span class="free">Us</span><span class="main">.</span> IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="bound">U</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">Us</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="free">Us</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">U</span><span class="main">∈</span>set <span class="free">Us</span><span class="main">.</span> FGModule.isomorphic <span class="free">G</span> <span class="free">smult</span> <span class="free">W</span> <span class="free">smult</span> <span class="bound">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> V_decomp<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> abGrp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span>set <span class="free">Us</span><span class="main">.</span> AbGroup <span class="bound">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IrrFinGroupRepresentation.AbGroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> nonzero V_decomp<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> indep<span class="main">:</span> <span class="quoted"><span class="quoted">"add_independentS <span class="free">Us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_dirsumD2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> V_decomp <span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span>set <span class="free">Us</span><span class="main">.</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abGrp AbGroup_subset_inner_dirsum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> subsp<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> V_decomp<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>  GSubspaces<span class="main">:</span> <span class="quoted"><span class="quoted">"GSubspace <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span> set <span class="free">Us</span><span class="main">.</span> GSubspace <span class="bound">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IrrFinGroupRepresentation.axioms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span>
          FinGroupRepresentation.axioms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span> GSubspaceI
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">Us</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="bound">i</span><span class="main">)</span> <span class="main">`</span> <span class="free">W</span> <span class="main">≠</span> <span class="main">0</span>
              <span class="main">⟹</span> FGModuleIso <span class="free">G</span> <span class="free">smult</span> <span class="free">W</span> <span class="free">smult</span> <span class="main">(</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="bound">i</span><span class="main">)</span> <span class="main">↓</span> <span class="free">W</span> <span class="main">)</span> <span class="main">(</span><span class="free">Us</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">Us</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="skolem">i</span><span class="main">)</span> <span class="main">`</span> <span class="free">W</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> i<span class="main">(</span>1<span class="main">)</span> V_decomp<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"GRepEnd <span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> GSubspaces<span class="main">(</span>2<span class="main">)</span> indep GEnd_inner_dirsum_el_decomp_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">smult</span> <span class="free">W</span> <span class="free">smult</span> <span class="main">(</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="skolem">i</span><span class="main">)</span> <span class="main">↓</span> <span class="free">W</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> GSubspaces<span class="main">(</span>1<span class="main">)</span> FGModuleEnd.FGModuleHom_restrict0_GSubspace
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="skolem">i</span><span class="main">)</span> <span class="main">↓</span> <span class="free">W</span> <span class="main">)</span> <span class="main">`</span> <span class="free">W</span> <span class="main">⊆</span> <span class="free">Us</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> V_decomp<span class="main">(</span>3<span class="main">)</span> i<span class="main">(</span>1<span class="main">)</span> subsp<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="skolem">i</span><span class="main">)</span> <span class="main">`</span> <span class="free">W</span> <span class="main">⊆</span> <span class="free">Us</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> indep abGrp AbGroup_inner_dirsum_el_decomp_nth_onto_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> i<span class="main">(</span>1<span class="main">)</span> V_decomp<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation <span class="free">G</span> <span class="free">smult</span> <span class="main">(</span><span class="free">Us</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span>   <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModuleIso <span class="free">G</span> <span class="free">smult</span> <span class="free">W</span> <span class="free">smult</span> <span class="main">(</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="skolem">i</span><span class="main">)</span> <span class="main">↓</span> <span class="free">W</span> <span class="main">)</span> <span class="main">(</span><span class="free">Us</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>2<span class="main">)</span>
            IrrFinGroupRepresentation.Schur1<span class="main">[</span>
              <span class="operator">OF</span> subsp<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="quoted">"<span class="free">Us</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="skolem">i</span><span class="main">)</span> <span class="main">↓</span> <span class="free">W</span> "</span></span>
            <span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> nonzero V_decomp<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">Us</span><span class="main">.</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="bound">i</span><span class="main">)</span> <span class="main">`</span> <span class="free">W</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_dirsum_Nil abGrp subsp<span class="main">(</span>1<span class="main">)</span> indep
          AbGroup_inner_dirsum_subset_proj_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Us</span></span> <span class="quoted"><span class="free">W</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">Us</span><span class="main">.</span>  FGModuleIso <span class="free">G</span> <span class="free">smult</span> <span class="free">W</span> <span class="free">smult</span>
                        <span class="main">(</span> <span class="main">(</span><span class="main">⨁</span><span class="free">Us</span><span class="main">↓</span><span class="bound">i</span><span class="main">)</span> <span class="main">↓</span> <span class="free">W</span> <span class="main">)</span> <span class="main">(</span><span class="free">Us</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subsp<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Us</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> IrrFinGroupRepresentation<span class="main">)</span> iso_FG_constituent <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonzero  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     FG_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span>set <span class="free">Us</span><span class="main">.</span> IrrFinGroupRepresentation <span class="free">G</span> <span class="main">(*)</span> <span class="bound">U</span>"</span></span>
                     <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">Us</span>"</span></span> <span class="quoted"><span class="quoted">"FG <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="free">Us</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">U</span><span class="main">∈</span>set <span class="free">Us</span><span class="main">.</span> isomorphic <span class="main">(*)</span> <span class="bound">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> nonzero <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">v</span><span class="main">)</span><span class="main">↓</span>FG"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="main">(*)</span> FG <span class="free">smult</span> <span class="skolem">T</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModule.FGModuleHomI_fromaxioms<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="main">(*)</span> FG"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ActingGroup.FGModule_FG <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> T_def v<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> FG <span class="main">⟹</span> <span class="bound">v'</span> <span class="main">∈</span> FG <span class="main">⟹</span> <span class="skolem">T</span> <span class="main">(</span><span class="bound">v</span> <span class="main">+</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">T</span> <span class="bound">v</span> <span class="main">+</span> <span class="skolem">T</span> <span class="bound">v'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ring1.add_closed<span class="main">[</span><span class="operator">OF</span> Ring1<span class="main">]</span> smult_distrib_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> T_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp <span class="skolem">T</span> <span class="main">⊆</span> FG"</span></span> <span class="keyword1"><span class="command">using</span></span> supp_restrict0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> T_def v<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> FG <span class="main">⟹</span> <span class="bound">m</span> <span class="main">∈</span> FG <span class="main">⟹</span> <span class="skolem">T</span> <span class="main">(</span><span class="bound">r</span> <span class="main">*</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">T</span> <span class="bound">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ActingGroup.RG_mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule.GSubspace <span class="free">G</span> <span class="main">(*)</span> FG <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"FG <span class="main">=</span> <span class="skolem">W</span> <span class="main">⊕</span> <span class="main">(</span>ker <span class="skolem">T</span> <span class="main">∩</span> FG<span class="main">)</span>"</span></span>
             <span class="quoted"><span class="quoted">"FGModule.isomorphic <span class="free">G</span> <span class="main">(*)</span> <span class="skolem">W</span> <span class="free">smult</span> <span class="main">(</span><span class="skolem">T</span> <span class="main">`</span> FG<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FG_n0
          FinGroupRepresentation.GRepHom_decomp<span class="main">[</span>
            <span class="operator">OF</span> FinGroupRepresentation_FG
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> T_def v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">`</span> FG <span class="main">=</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_GSpan_single RSpan_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> W<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> W'<span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule.isomorphic <span class="free">G</span> <span class="main">(*)</span> <span class="skolem">W</span> <span class="free">smult</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> W<span class="main">(</span>1<span class="main">)</span> nonzero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModule.GSubspace_is_FGModule<span class="main">[</span><span class="operator">OF</span> ActingGroup.FGModule_FG<span class="main">]</span>
          FGModule.isomorphic_to_zero_left
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> W' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation <span class="free">G</span> <span class="main">(*)</span> <span class="skolem">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IrrFinGroupRepresentation_axioms FGModuleIso.isomorphic_to_irr_right
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">U</span><span class="main">∈</span>set <span class="free">Us</span><span class="main">.</span> FGModule.isomorphic <span class="free">G</span> <span class="main">(*)</span> <span class="skolem">W</span> <span class="main">(*)</span> <span class="bound">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FG_decomp W<span class="main">(</span>1<span class="main">)</span> good_char FG_n0
          FinGroupRepresentation.IrrGSubspace_iso_constituent<span class="main">[</span>
            <span class="operator">OF</span> ActingGroup.FinGroupRepresentation_FG<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">W</span></span>
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> W<span class="main">(</span>1<span class="main">)</span> W' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModule.GSubspace_is_FGModule<span class="main">[</span><span class="operator">OF</span> ActingGroup.FGModule_FG<span class="main">]</span>
          FGModule.isomorphic_sym<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span> <span class="quoted"><span class="skolem">W</span></span> <span class="quoted"><span class="free">smult</span></span><span class="main">]</span> isomorphic_trans
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Isomorphism classes of irreducible representations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We have already demonstrated that the relation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FGModule.isomorphic›</span></span></span></span> is reflexive
  (lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FGModule.isomorphic_refl›</span></span></span></span>), symmetric (lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FGModule.isomorphic_sym›</span></span></span></span>),
  and transitive (lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FGModule.isomorphic_trans›</span></span></span></span>). In this section, we provide a finite
  set of representatives for the resulting isomorphism classes of irreducible representations.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> Group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">remisodups</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">remisodups</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remisodups</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Us</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">W</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">Us</span></span></span><span class="main">.</span> FGModule.isomorphic <span class="free">G</span> <span class="main">(*)</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(*)</span> <span class="bound">W</span><span class="main">)</span>
          <span class="keyword1">then</span> <span class="free">remisodups</span> <span class="free"><span class="bound"><span class="entity">Us</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">#</span> <span class="free">remisodups</span> <span class="free"><span class="bound"><span class="entity">Us</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-set_remisodups"><span class="command">lemma</span></span> set_remisodups <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>remisodups <span class="free">Us</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">Us</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Us</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-isodistinct_remisodups"><span class="command">lemma</span></span> isodistinct_remisodups <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">U</span><span class="main">∈</span>set <span class="free">Us</span><span class="main">.</span> FGModule <span class="free">G</span> <span class="main">(*)</span> <span class="bound">U</span><span class="main">;</span> <span class="free">V</span> <span class="main">∈</span> set <span class="main">(</span>remisodups <span class="free">Us</span><span class="main">)</span><span class="main">;</span>
        <span class="free">W</span> <span class="main">∈</span> set <span class="main">(</span>remisodups <span class="free">Us</span><span class="main">)</span><span class="main">;</span> <span class="free">V</span> <span class="main">≠</span> <span class="free">W</span> <span class="main">⟧</span>
          <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span>FGModule.isomorphic <span class="free">G</span> <span class="main">(*)</span> <span class="free">V</span> <span class="main">(*)</span> <span class="free">W</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Us</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">W</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">U</span> <span class="skolem">Us</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">∈</span>set <span class="skolem">Us</span><span class="main">.</span> FGModule.isomorphic <span class="free">G</span> <span class="main">(*)</span> <span class="skolem">U</span> <span class="main">(*)</span> <span class="bound">X</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span><span class="main">=</span><span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span><span class="main">=</span><span class="skolem">U</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> conjcases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> BothTrue <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> OneTrue <span class="keyword1"><span class="command">with</span></span> False Cons<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> set_remisodups <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> OtherTrue <span class="keyword1"><span class="command">with</span></span> False Cons<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> set_remisodups FGModule.isomorphic_sym<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span> <span class="quoted"><span class="skolem">V</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span> <span class="quoted"><span class="skolem">W</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> BothFalse <span class="keyword1"><span class="command">with</span></span> Cons False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">FG_constituents</span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">Us</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">∈</span>set <span class="bound">Us</span><span class="main">.</span> IrrFinGroupRepresentation <span class="free">G</span> <span class="main">(*)</span> <span class="bound">U</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">0</span> <span class="main">∉</span> set <span class="bound">Us</span> <span class="main">∧</span> group_ring <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span><span class="bound">Us</span><span class="main">.</span> <span class="bound">U</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-FG_constituents_irr"><span class="command">lemma</span></span> FG_constituents_irr <span class="main">:</span>
  <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">)</span>
        <span class="main">⟹</span> <span class="main">∀</span><span class="bound">U</span><span class="main">∈</span>set <span class="main">(</span>FG_constituents<span class="main">::</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set list<span class="main">)</span><span class="main">.</span> 
          IrrFinGroupRepresentation <span class="free">G</span> <span class="main">(*)</span> <span class="bound">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> FG_reducible<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> FG_constituents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-FG_consitutents_n0"><span class="command">lemma</span></span> FG_consitutents_n0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">)</span>
        <span class="main">⟹</span> <span class="main">0</span> <span class="main">∉</span> set <span class="main">(</span>FG_constituents<span class="main">::</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set list<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> FG_reducible<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> FG_constituents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-FG_constituents_constituents"><span class="command">lemma</span></span> FG_constituents_constituents <span class="main">:</span>
  <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">)</span>
        <span class="main">⟹</span> <span class="main">(</span>group_ring<span class="main">::</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨁</span><span class="bound">U</span><span class="main">←</span>FG_constituents<span class="main">.</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> FG_reducible<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> FG_constituents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">GIrrRep_repset</span> <span class="main">≡</span> <span class="main">0</span> <span class="main">∪</span> set <span class="main">(</span>remisodups FG_constituents<span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-finite_GIrrRep_repset"><span class="command">lemma</span></span> finite_GIrrRep_repset <span class="main">:</span> <span class="quoted"><span class="quoted">"finite GIrrRep_repset"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> GIrrRep_repset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-all_irr_GIrrRep_repset"><span class="command">lemma</span></span> all_irr_GIrrRep_repset <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="main">(</span>GIrrRep_repset<span class="main">::</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set set<span class="main">)</span><span class="main">.</span>
              IrrFinGroupRepresentation <span class="free">G</span> <span class="main">(*)</span> <span class="bound">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> GIrrRep_repset"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"IrrFinGroupRepresentation <span class="free">G</span> <span class="main">(*)</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trivial_IrrFinGroupRepresentation_in_FG GIrrRep_repset_def
          set_remisodups FG_constituents_irr
    <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-isodistinct_GIrrRep_repset"><span class="command">lemma</span></span> isodistinct_GIrrRep_repset <span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">GIRRS</span> <span class="main">≡</span> GIrrRep_repset <span class="main">::</span> <span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">GIRRS</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∈</span> <span class="free">GIRRS</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">≠</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>FGModule.isomorphic <span class="free">G</span> <span class="main">(*)</span> <span class="free">V</span> <span class="main">(*)</span> <span class="free">W</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> conjcases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> BothTrue <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OneTrue <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> GIrrRep_repset_def set_remisodups FG_consitutents_n0
          trivial_FGModule<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span> FGModule.isomorphic_to_zero_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> OtherTrue
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> set FG_constituents"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GIrrRep_repset_def set_remisodups <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> FG_consitutents_n0 FG_constituents_irr
          IrrFinGroupRepresentation.axioms<span class="main">(</span>1<span class="main">)</span>
          FinGroupRepresentation.axioms<span class="main">(</span>1<span class="main">)</span>
          FGModule.isomorphic_to_zero_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> BothFalse
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> set <span class="main">(</span>remisodups FG_constituents<span class="main">)</span>"</span></span>
                         <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∈</span> set <span class="main">(</span>remisodups FG_constituents<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> GIrrRep_repset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> FG_constituents_irr IrrFinGroupRepresentation.axioms<span class="main">(</span>1<span class="main">)</span>
          FinGroupRepresentation.axioms<span class="main">(</span>1<span class="main">)</span> isodistinct_remisodups
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Group *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> FGModule<span class="main">)</span> iso_in_list_imp_iso_in_remisodups <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">U</span><span class="main">∈</span>set <span class="free">Us</span><span class="main">.</span> isomorphic <span class="main">(*)</span> <span class="bound">U</span>
        <span class="main">⟹</span> <span class="main">∃</span><span class="bound">U</span><span class="main">∈</span>set <span class="main">(</span>ActingGroup.remisodups <span class="free">Us</span><span class="main">)</span><span class="main">.</span> isomorphic <span class="main">(*)</span> <span class="bound">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Us</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">U</span> <span class="skolem">Us</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">U</span><span class="main">#</span><span class="skolem">Us</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"isomorphic <span class="main">(*)</span> <span class="skolem">W</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span>
    <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">=</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">∈</span>set <span class="skolem">Us</span><span class="main">.</span> FGModule.isomorphic <span class="free">G</span> <span class="main">(*)</span> <span class="skolem">U</span> <span class="main">(*)</span> <span class="bound">X</span>"</span></span>
    <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> conjcases
  <span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> BothTrue <span class="keyword1"><span class="command">with</span></span> W<span class="main">(</span>2<span class="main">)</span> Cons<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> isomorphic_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span> <span class="quoted"><span class="skolem">W</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> OneTrue <span class="keyword1"><span class="command">with</span></span> W<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> OtherTrue <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span> W <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> BothFalse <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span> W <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> IrrFinGroupRepresentation<span class="main">)</span> iso_to_GIrrRep_rep <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">U</span><span class="main">∈</span>ActingGroup.GIrrRep_repset<span class="main">.</span> isomorphic <span class="main">(*)</span> <span class="bound">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_isomorphic_to_FG_zero ActingGroup.GIrrRep_repset_def
        good_char ActingGroup.FG_constituents_irr
        ActingGroup.FG_consitutents_n0 ActingGroup.FG_constituents_constituents
        iso_FG_constituent iso_in_list_imp_iso_in_remisodups
        ActingGroup.GIrrRep_repset_def
  <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Group<span class="main">)</span> iso_class_reps <span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">GIRRS</span> <span class="main">≡</span> GIrrRep_repset <span class="main">::</span> <span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun set set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">G</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">GIRRS</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="free">GIRRS</span><span class="main">.</span> IrrFinGroupRepresentation <span class="free">G</span> <span class="main">(*)</span> <span class="bound">U</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">W</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">U</span> <span class="main">∈</span> <span class="free">GIRRS</span><span class="main">;</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">GIRRS</span><span class="main">;</span> <span class="bound">U</span> <span class="main">≠</span> <span class="bound">W</span> <span class="main">⟧</span>
              <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span>FGModule.isomorphic <span class="free">G</span> <span class="main">(*)</span> <span class="bound">U</span> <span class="main">(*)</span> <span class="bound">W</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">fgsmult</span> <span class="bound">V</span><span class="main">.</span> IrrFinGroupRepresentation <span class="free">G</span> <span class="bound">fgsmult</span> <span class="bound">V</span>
              <span class="main">⟹</span> <span class="main">∃</span><span class="bound">U</span><span class="main">∈</span><span class="free">GIRRS</span><span class="main">.</span> FGModule.isomorphic <span class="free">G</span> <span class="bound">fgsmult</span> <span class="bound">V</span> <span class="main">(*)</span> <span class="bound">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms finite_GIrrRep_repset all_irr_GIrrRep_repset
        isodistinct_GIrrRep_repset IrrFinGroupRepresentation.iso_to_GIrrRep_rep
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Induced representations›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locale and basic facts›</span></span>

<span class="keyword1"><span class="command">locale</span></span> InducedFinGroupRepresentation <span class="main">=</span> Supgroup<span class="main">?</span><span class="main">:</span> Group <span class="quoted"><span class="free">H</span></span>
<span class="main">+</span> BaseRep<span class="main">?</span><span class="main">:</span> FinGroupRepresentation <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span>
<span class="main">+</span> induced_smult<span class="main">?</span><span class="main">:</span> aezfun_scalar_mult <span class="quoted"><span class="free">rrsmult</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>   <span class="free">H</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">G</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">smult</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">V</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">rrsmult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span><span class="tfree">'v</span><span class="main">)</span>
                          <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span><span class="tfree">'v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">¤</span>"</span> 70<span class="main">)</span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">FH</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">indV</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> FH            <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FH</span> <span class="main">≡</span> Supgroup.group_ring"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     indV          <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indV</span> <span class="main">≡</span> BaseRep.indspace <span class="free">G</span> <span class="free">FH</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rrsmult       <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rrsmult</span> <span class="main">=</span> Ring1.rightreg_scalar_mult <span class="free">FH</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     good_ordSupgrp<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>card <span class="free">H</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>  <span class="comment1">(* this implies H is finite *)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     Subgroup      <span class="main">:</span> <span class="quoted"><span class="quoted">"Supgroup.Subgroup <span class="free">G</span>"</span></span>  <span class="comment1">(* G is a subgroup of H *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> InducedFinGroupRepresentation <span class="main">&lt;</span> InducedFHModule 
  <span class="keyword1"><span class="command">using</span></span> FH indV rrsmult Subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">context</span></span> InducedFinGroupRepresentation
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ordH</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ordH</span> <span class="main">≡</span> of_nat <span class="main">(</span>card <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_Vfbasis</span> <span class="main">≡</span> fbasis_for <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">GRepHomSet</span> <span class="main">≡</span> FGModuleHomSet <span class="free">G</span> <span class="free">smult</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">HRepHom</span>    <span class="main">≡</span> FGModuleHom <span class="free">H</span> <span class="free">rrsmult</span> <span class="free">indV</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">HRepHomSet</span> <span class="main">≡</span> FGModuleHomSet <span class="free">H</span> <span class="free">rrsmult</span> <span class="free">indV</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-finiteSupgroup"><span class="command">lemma</span></span> finiteSupgroup<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> good_ordSupgrp good_card_imp_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-FinGroupSupgroup"><span class="command">lemma</span></span> FinGroupSupgroup <span class="main">:</span> <span class="quoted"><span class="quoted">"FinGroup <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finiteSupgroup Supgroup.FinGroupI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemmas</span></span> fVectorSpace          <span class="main">=</span> fVectorSpace
<span class="keyword1"><span class="command">lemmas</span></span> FinDimVectorSpace     <span class="main">=</span> FinDimVectorSpace
<span class="keyword1"><span class="command">lemmas</span></span> ex_rcoset_replist_hd0
              <span class="main">=</span> FinGroup.ex_rcoset_replist_hd0<span class="main">[</span><span class="operator">OF</span> FinGroupSupgroup Subgroup<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context InducedFinGroupRepresentation *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹A basis for the induced space›</span></span>

<span class="keyword1"><span class="command">context</span></span> InducedFinGroupRepresentation
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">negHorbit_list</span> <span class="main">≡</span> induced_smult.negGorbit_list"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> ex_rcoset_replist
              <span class="main">=</span> FinGroup.ex_rcoset_replist<span class="main">[</span><span class="operator">OF</span> FinGroupSupgroup Subgroup<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> length_negHorbit_list         <span class="main">=</span> induced_smult.length_negGorbit_list
<span class="keyword1"><span class="command">lemmas</span></span> length_negHorbit_list_sublist <span class="main">=</span> induced_smult.length_negGorbit_list_sublist
<span class="keyword1"><span class="command">lemmas</span></span> negHorbit_list_indV           <span class="main">=</span> FGModule.negGorbit_list_V<span class="main">[</span><span class="operator">OF</span> FHModule_indspace<span class="main">]</span>

<span class="keyword1" id="Rep_Fin_Groups-flincomb_Horbit_induced_veclist_reduce"><span class="command">lemma</span></span> flincomb_Horbit_induced_veclist_reduce <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">vs</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">hs</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> list"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> hfvss       <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hfvss</span> <span class="main">≡</span> negHorbit_list <span class="free">hs</span> induced_vector <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> vs          <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">hs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     scalars     <span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">rs</span> <span class="bound">ms</span><span class="main">.</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="bound">ms</span><span class="main">)</span> <span class="free">css</span> <span class="free">hfvss</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     rcoset_reps <span class="main">:</span> <span class="quoted"><span class="quoted">"Supgroup.is_rcoset_replist <span class="free">G</span> <span class="free">hs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>concat <span class="free">css</span><span class="main">)</span> <span class="main">∙¤¤</span> <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> mostly_zero<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> length <span class="free">hs</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">hs</span> 
          <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">∙¤¤</span> <span class="main">(</span><span class="free">hfvss</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="bound">k</span><span class="main">)</span>
            <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="bound">k</span><span class="main">)</span> <span class="main">∙♯⋅</span> <span class="free">vs</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">hs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">hs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> hsk_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hs</span><span class="main">!</span><span class="skolem">k</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hsj_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hs</span><span class="main">!</span><span class="skolem">j</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Supgroup.is_rcoset_replistD_set<span class="main">[</span><span class="operator">OF</span> rcoset_reps<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">LHS</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="main">∙¤¤</span> <span class="main">(</span><span class="free">hfvss</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> hfvss
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">m</span><span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">hfvss</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span> <span class="main">¤¤</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> length_negHorbit_list scalar_mult.lincomb_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">induced_smult.fsmult</span><span class="main">]</span>
            sum_list_prod_fun_apply
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">m</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">hfvss</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
                        <span class="main">(</span>induced_smult.fsmult <span class="bound">r</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="bound">m</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod_ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">hfvss</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> k j vs hfvss
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>induced_smult.fsmult <span class="skolem">r</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">♯⋅</span> <span class="skolem">m</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Supgroup.is_rcoset_replistD_set<span class="main">[</span><span class="operator">OF</span> rcoset_reps<span class="main">]</span> set_zip_rightD
              set_concat length_negHorbit_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hs</span></span> <span class="quoted">induced_vector</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
              nth_mem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="free">hfvss</span></span><span class="main">]</span> hsk_H induced_fsmult_conv_fsmult_1ddh<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="quoted">"<span class="free">hs</span><span class="main">!</span><span class="skolem">k</span>"</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
              induced_vector_indV negHorbit_list_indV<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hs</span></span> <span class="quoted">induced_vector</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="free">vs</span><span class="main">.</span>
            <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">(</span>induced_vector <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">-</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FH j hfvss induced_smult.negGorbit_list_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hs</span></span> <span class="quoted">induced_vector</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
            sum_list_prod_cong<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span>induced_smult.fsmult <span class="bound">r</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span><span class="main">]</span>
            sum_list_prod_map2<span class="main">[</span><span class="operator">of</span>
              <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="bound">m</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"Hmult <span class="main">(</span><span class="main">-</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"map induced_vector <span class="free">vs</span>"</span></span>
            <span class="main">]</span>
            sum_list_prod_map2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">(</span>Hmult <span class="main">(</span><span class="main">-</span><span class="free">hs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span><span class="main">]</span>
            induced_smult.GmultD hsk_H
            Supgroup.RG_aezdeltafun_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">hs</span><span class="main">!</span><span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'f</span>"</span></span><span class="main">]</span>
            rrsmultD1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">-</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">k</span> <span class="main">-</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> times_aezdeltafun_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">hs</span><span class="main">!</span><span class="skolem">k</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="free">vs</span><span class="main">.</span>
                          <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">(</span>induced_vector <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">k</span> <span class="main">-</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_prod_map2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> FH vs
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">(</span>induced_vector <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">k</span> <span class="main">-</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">(</span>FG_proj <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">k</span> <span class="main">-</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> set_zip_rightD induced_vector_def hsk_H hsj_H Supgroup.diff_closed
            Supgroup.RG_aezdeltafun_closed<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'f</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> calc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="free">vs</span><span class="main">.</span>
                                <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">(</span>FG_proj <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">k</span> <span class="main">-</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_prod_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="main">∙♯⋅</span> <span class="free">vs</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> calc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="free">vs</span><span class="main">.</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">1</span> <span class="main">♯⋅</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Group.zero_closed<span class="main">[</span><span class="operator">OF</span> GroupG<span class="main">]</span>
              aezfun_setspan_proj_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'f</span>"</span></span><span class="main">]</span>
              BaseRep.fsmult_def
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> vs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">1</span> <span class="main">♯⋅</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="bound">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_zip_rightD BaseRep.fsmult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> True sum_list_prod_cong<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">1</span> <span class="main">♯⋅</span> <span class="bound">v</span>"</span></span><span class="main">]</span>
              scalar_mult.lincomb_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">BaseRep.fsmult</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> k j calc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="free">vs</span><span class="main">.</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">(</span><span class="main">0</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Supgroup.is_rcoset_replist_imp_nrelated_nth<span class="main">[</span><span class="operator">OF</span> Subgroup rcoset_reps<span class="main">]</span>
              aezfun_setspan_proj_aezdeltafun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'f</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> vs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">(</span><span class="main">0</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_zip_rightD BaseRep.zero_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">←</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="free">vs</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'v</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum_list_prod_cong<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">r</span> <span class="main">♯⋅</span> <span class="main">(</span><span class="main">0</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">rv</span><span class="main">←</span>zip <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span> <span class="free">vs</span><span class="main">.</span> case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'v</span><span class="main">)</span><span class="main">)</span> <span class="bound">rv</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">terms</span></span> <span class="skolem"><span class="skolem">LHS</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">terms</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> case_prod <span class="main">(</span><span class="main">λ</span><span class="bound">cs</span> <span class="bound">hfvs</span><span class="main">.</span> <span class="main">(</span><span class="bound">cs</span> <span class="main">∙¤¤</span> <span class="bound">hfvs</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">css</span> <span class="free">hfvss</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>concat <span class="free">css</span><span class="main">)</span> <span class="main">∙¤¤</span> <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> sum_list <span class="skolem">terms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> scalars
          VectorSpace.lincomb_concat<span class="main">[</span><span class="operator">OF</span> fVectorSpace_indspace<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">css</span></span> <span class="quoted"><span class="free">hfvss</span></span><span class="main">]</span>
          sum_list_prod_fun_apply
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">terms</span><span class="main">}</span><span class="main">.</span> <span class="skolem">terms</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_list_sum_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">terms</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> terms_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">terms</span><span class="main">}</span><span class="main">.</span> <span class="skolem">terms</span><span class="main">!</span><span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">∙¤¤</span> <span class="main">(</span><span class="free">hfvss</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>   <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LHS</span> <span class="main">=</span> <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> terms_def sum.cong scalars list_all2_lengthD<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">css</span></span> <span class="quoted"><span class="free">hfvss</span></span><span class="main">]</span> hfvss 
          length_negHorbit_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hs</span></span> <span class="quoted">induced_vector</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> i mostly_zero
          sum_single_nonzero<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">hs</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">∙¤¤</span> <span class="main">(</span><span class="free">hfvss</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">css</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>"</span></span>
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-indspace_fspanning_set"><span class="command">lemma</span></span> indspace_fspanning_set <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">vs</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">hs</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> list"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> hfvss       <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hfvss</span> <span class="main">≡</span> negHorbit_list <span class="free">hs</span> induced_vector <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> base_spset  <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> BaseRep.fSpan <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     rcoset_reps <span class="main">:</span> <span class="quoted"><span class="quoted">"Supgroup.is_rcoset_replist <span class="free">G</span> <span class="free">hs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">indV</span> <span class="main">=</span> induced_smult.fSpan <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> VectorSpace.SpanI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fVectorSpace_indspace<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> base_spset<span class="main">(</span>1<span class="main">)</span> hfvss <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">indV</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Supgroup.is_rcoset_replistD_set<span class="main">[</span><span class="operator">OF</span> rcoset_reps<span class="main">]</span>
          induced_vector_indV negHorbit_list_indV
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">indV</span> <span class="main">⊆</span> R_scalar_mult.RSpan UNIV <span class="main">(</span>aezfun_scalar_mult.fsmult <span class="main"><span class="free">(¤)</span></span><span class="main">)</span>
              <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span> <span class="main">∈</span> set <span class="free">hs</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> indV BaseRep.indspaceD_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> base_spset<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  coeffs_exist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span> <span class="main">∈</span> set <span class="free">hs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ahs</span><span class="main">.</span> length <span class="bound">ahs</span> <span class="main">=</span> length <span class="free">vs</span>
                                <span class="main">∧</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="bound">h</span><span class="main">)</span> <span class="main">=</span> <span class="bound">ahs</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> BaseRep.in_fSpan_obtain_same_length_coeffs
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f_coeffs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f_coeffs</span> <span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">ahs</span><span class="main">.</span> length <span class="bound">ahs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="bound">ahs</span> <span class="main">∙♯⋅</span> <span class="free">vs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">h</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ahss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ahss</span> <span class="main">=</span> map <span class="skolem">f_coeffs</span> <span class="free">hs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> len_ahss<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ahss</span> <span class="main">=</span> length <span class="free">hs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> hfvss <span class="keyword1"><span class="command">have</span></span> len_zip_ahss_hfvss<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>zip <span class="skolem">ahss</span> <span class="free">hfvss</span><span class="main">)</span> <span class="main">=</span> length <span class="free">hs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> length_negHorbit_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hs</span></span> <span class="quoted">induced_vector</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> len_ahss_el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ahs</span><span class="main">∈</span>set <span class="skolem">ahss</span><span class="main">.</span> length <span class="bound">ahs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ahs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ahs</span> <span class="main">∈</span> set <span class="skolem">ahss</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this ahss_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> set <span class="free">hs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ahs</span> <span class="main">=</span> <span class="skolem">f_coeffs</span> <span class="skolem">h</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> h<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ahs</span><span class="main">.</span> length <span class="bound">ahs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="bound">ahs</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> coeffs_exist <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">with</span></span> h<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ahs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_coeffs_def
        <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ahs</span><span class="main">.</span> length <span class="bound">ahs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="bound">ahs</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">ahs</span><span class="main">,</span><span class="bound">hfvs</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>zip <span class="skolem">ahss</span> <span class="free">hfvss</span><span class="main">)</span><span class="main">.</span> length <span class="bound">ahs</span> <span class="main">=</span> length <span class="bound">hfvs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="skolem">ahss</span> <span class="free">hfvss</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="skolem">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ahs</span><span class="main">,</span> <span class="bound">hfvs</span><span class="main">)</span> <span class="main">⇒</span> length <span class="bound">ahs</span> <span class="main">=</span> length <span class="bound">hfvs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ahs</span> <span class="skolem">hfvs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ahs</span><span class="main">,</span><span class="skolem">hfvs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> x hfvss <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ahs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">hfvs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> set_zip_leftD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ahs</span></span> <span class="quoted"><span class="skolem">hfvs</span></span><span class="main">]</span> len_ahss_el set_zip_rightD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ahs</span></span> <span class="quoted"><span class="skolem">hfvs</span></span><span class="main">]</span>
                length_negHorbit_list_sublist<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">hs</span></span> <span class="quoted">induced_vector</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ahs</span> <span class="main">=</span> length <span class="skolem">hfvs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> hfvss <span class="keyword1"><span class="command">have</span></span> list_all2_len_ahss_hfvss<span class="main">:</span>
      <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">rs</span> <span class="bound">ms</span><span class="main">.</span> length <span class="bound">rs</span> <span class="main">=</span> length <span class="bound">ms</span><span class="main">)</span> <span class="skolem">ahss</span> <span class="free">hfvss</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len_ahss length_negHorbit_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hs</span></span> <span class="quoted">induced_vector</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
            list_all2I<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ahss</span></span> <span class="quoted"><span class="free">hfvss</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> <span class="main">(</span>concat <span class="skolem">ahss</span><span class="main">)</span> <span class="main">∙¤¤</span> <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Supgroup.is_rcoset_replistD_set<span class="main">[</span><span class="operator">OF</span> rcoset_reps<span class="main">]</span>
            Supgroup.group_eq_subgrp_rcoset_un<span class="main">[</span><span class="operator">OF</span> Subgroup rcoset_reps<span class="main">]</span>
            f
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> indspace_el_eq'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">hs</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> f'_def hfvss base_spset<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Supgroup.is_rcoset_replistD_set<span class="main">[</span><span class="operator">OF</span> rcoset_reps<span class="main">]</span>
              induced_vector_indV negHorbit_list_indV<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hs</span></span> <span class="quoted">induced_vector</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
              FGModule.flincomb_closed<span class="main">[</span><span class="operator">OF</span> FHModule_indspace<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>length <span class="free">hs</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">hs</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> f_coeffs_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f_coeffs</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> coeffs_exist
                someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ahs</span><span class="main">.</span> length <span class="bound">ahs</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="free">hs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">ahs</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> i hfvss f'_def base_spset<span class="main">(</span>1<span class="main">)</span> rcoset_reps ahss_def
          <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f_coeffs</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> list_all2_len_ahss_hfvss flincomb_Horbit_induced_veclist_reduce
          <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">hs</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">δδ</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> f'_def hfvss base_spset<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> induced_smult.fSpan <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Supgroup.is_rcoset_replistD_set<span class="main">[</span><span class="operator">OF</span> rcoset_reps<span class="main">]</span>
            induced_vector_indV negHorbit_list_indV<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hs</span></span> <span class="quoted">induced_vector</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
            VectorSpace.SpanI_lincomb_arb_len_coeffs<span class="main">[</span><span class="operator">OF</span> fVectorSpace_indspace<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-indspace_basis"><span class="command">lemma</span></span> indspace_basis <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">vs</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">hs</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> list"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> hfvss       <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hfvss</span> <span class="main">≡</span> negHorbit_list <span class="free">hs</span> induced_vector <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> base_spset  <span class="main">:</span> <span class="quoted"><span class="quoted">"BaseRep.fbasis_for <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     rcoset_reps <span class="main">:</span> <span class="quoted"><span class="quoted">"Supgroup.is_rcoset_replist <span class="free">G</span> <span class="free">hs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fscalar_mult.basis_for induced_smult.fsmult <span class="free">indV</span> <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
    <span class="keyword1"><span class="command">have</span></span>  1<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">indV</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>    <span class="quoted"><span class="quoted">"<span class="free">indV</span> <span class="main">=</span> induced_smult.fSpan <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Supgroup.is_rcoset_replistD_set<span class="main">[</span><span class="operator">OF</span> rcoset_reps<span class="main">]</span>
          induced_vector_indV negHorbit_list_indV<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hs</span></span> <span class="quoted">induced_vector</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
          indspace_fspanning_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">hs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"induced_smult.f_lin_independent <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span>
    <span class="operator">rule</span> VectorSpace.lin_independentI_concat_all_scalars<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fVectorSpace_indspace<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">rule</span> 1
  <span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rss</span>
    <span class="keyword3"><span class="command">assume</span></span> rss<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> length <span class="bound">ys</span><span class="main">)</span> <span class="skolem">rss</span> <span class="free">hfvss</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="main">(</span>concat <span class="skolem">rss</span><span class="main">)</span> <span class="main">∙¤¤</span> <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> rss<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> len_rss_hfvsss<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">rss</span> <span class="main">=</span> length <span class="free">hfvss</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> list_all2_lengthD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> hfvss <span class="keyword1"><span class="command">have</span></span> len_rss_hs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">rss</span> <span class="main">=</span> length <span class="free">hs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> length_negHorbit_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">rs</span><span class="main">∈</span>set <span class="skolem">rss</span><span class="main">.</span> set <span class="bound">rs</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∈</span> set <span class="skolem">rss</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">rss</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">=</span> <span class="skolem">rss</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> in_set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">rs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">with</span></span> hfvss rss<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">rs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> list_all2_nthD len_rss_hfvsss in_set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">hfvss</span></span><span class="main">]</span>
              length_negHorbit_list_sublist
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> hfvss rss i base_spset<span class="main">(</span>1<span class="main">)</span> rcoset_reps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">∙♯⋅</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> len_rss_hs flincomb_Horbit_induced_veclist_reduce <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> base_spset flin_independentD_all_scalars <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-induced_vector_decomp"><span class="command">lemma</span></span> induced_vector_decomp <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">vs</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">hs</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> list"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="free">cs</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> list"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> hfvss       <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hfvss</span> <span class="main">≡</span> negHorbit_list <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="free">hs</span><span class="main">)</span> induced_vector <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     extrazeros  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">extrazeros</span> <span class="main">≡</span> replicate <span class="main">(</span><span class="main">(</span>length <span class="free">hs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> base_spset  <span class="main">:</span> <span class="quoted"><span class="quoted">"BaseRep.fbasis_for <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     rcoset_reps <span class="main">:</span> <span class="quoted"><span class="quoted">"Supgroup.is_rcoset_replist <span class="free">G</span> <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="free">hs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     cs          <span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     v           <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">cs</span> <span class="main">∙♯⋅</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"induced_vector <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">cs</span><span class="main">@</span><span class="free">extrazeros</span><span class="main">)</span> <span class="main">∙¤¤</span> <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> hfvss base_spset
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">hfvss</span> <span class="main">=</span> <span class="main">(</span>map induced_vector <span class="free">vs</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>negHorbit_list <span class="free">hs</span> induced_vector <span class="free">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> induced_vector_indV
          FGModule.negGorbit_list_Cons0<span class="main">[</span><span class="operator">OF</span> FHModule_indspace<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> cs extrazeros base_spset rcoset_reps v
    <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"induced_vector <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">cs</span><span class="main">@</span><span class="free">extrazeros</span><span class="main">)</span> <span class="main">∙¤¤</span> <span class="main">(</span>concat <span class="free">hfvss</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> scalar_mult.lincomb_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">cs</span></span> <span class="main">_</span> <span class="quoted">induced_smult.fsmult</span><span class="main">]</span>
          Supgroup.is_rcoset_replistD_set induced_vector_indV
          negHorbit_list_indV<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hs</span></span> <span class="quoted">induced_vector</span> <span class="quoted"><span class="free">vs</span></span><span class="main">]</span>
          VectorSpace.lincomb_replicate0_left<span class="main">[</span><span class="operator">OF</span> fVectorSpace_indspace<span class="main">]</span>
          FGModuleHom.VectorSpaceHom<span class="main">[</span><span class="operator">OF</span> hom_induced_vector<span class="main">]</span>
          VectorSpaceHom.distrib_lincomb
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context InducedFinGroupRepresentation *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The induced space is a representation space›</span></span>

<span class="keyword1"><span class="command">context</span></span> InducedFinGroupRepresentation
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-indspace_findim"><span class="command">lemma</span></span> indspace_findim <span class="main">:</span>
  <span class="quoted"><span class="quoted">"fscalar_mult.findim induced_smult.fsmult <span class="free">indV</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> BaseRep.findim <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> BaseRep.fSpan <span class="skolem">vs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hs</span></span> <span class="keyword2"><span class="keyword">where</span></span> hs<span class="main">:</span> <span class="quoted"><span class="quoted">"Supgroup.is_rcoset_replist <span class="free">G</span> <span class="skolem">hs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_rcoset_replist <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hfvss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hfvss</span> <span class="main">=</span> negHorbit_list <span class="skolem">hs</span> induced_vector <span class="skolem">vs</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> vs hs
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"set <span class="main">(</span>concat <span class="skolem">hfvss</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">indV</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">indV</span> <span class="main">=</span> induced_smult.fSpan <span class="main">(</span>concat <span class="skolem">hfvss</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Supgroup.is_rcoset_replistD_set<span class="main">[</span><span class="operator">OF</span> hs<span class="main">]</span> induced_vector_indV
          negHorbit_list_indV<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">hs</span></span> <span class="quoted">induced_vector</span> <span class="quoted"><span class="skolem">vs</span></span><span class="main">]</span> indspace_fspanning_set
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> FinGroupRepresentation_indspace <span class="main">:</span>
  <span class="quoted"><span class="quoted">"FinGroupRepresentation <span class="free">H</span> <span class="free">rrsmult</span> <span class="free">indV</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FHModule_indspace
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FinGroupRepresentation.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> good_ordSupgrp <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FinGroupRepresentation_axioms <span class="free">H</span> <span class="main"><span class="free">(¤)</span></span> <span class="free">indV</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> indspace_findim <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context InducedFinGroupRepresentation *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Frobenius reciprocity›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locale and basic facts›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹There are a number of defined objects and lemmas concerning those objects leading up to the
        theorem of Frobenius reciprocity, so we create a locale to contain it all.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> FrobeniusReciprocity
<span class="main">=</span> GRep<span class="main">?</span><span class="main">:</span> InducedFinGroupRepresentation <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">rrsmult</span></span>
<span class="main">+</span> HRep<span class="main">?</span><span class="main">:</span> FinGroupRepresentation <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">W</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">H</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span><span class="main">::</span>group_add set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">G</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">::</span>field<span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">rrsmult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span>
                        <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">¤</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">smult'</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>ab_group_add <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">W</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'w</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">fsmult'</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span>           <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">♯⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fsmult'</span> <span class="main">≡</span> HRep.fsmult"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">flincomb'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> list <span class="main">⇒</span> <span class="tfree">'w</span> list <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∙♯⋆</span>"</span> 70<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">flincomb'</span> <span class="main">≡</span> HRep.flincomb"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Hmult'</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'w</span>"</span></span>           <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">*⋆</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hmult'</span> <span class="main">≡</span> HRep.Gmult"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Tsmult1</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span><span class="main">⇒</span><span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span><span class="main">⇒</span><span class="tfree">'w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆¤</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Tsmult1</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">a</span> <span class="bound">T</span><span class="main">.</span> <span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">a</span> <span class="main">♯⋆</span> <span class="main">(</span><span class="bound">T</span> <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Tsmult2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">⇒</span><span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">⇒</span><span class="tfree">'w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋆⋅</span>"</span> 70<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Tsmult2</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">a</span> <span class="bound">T</span><span class="main">.</span> <span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="bound">a</span> <span class="main">♯⋆</span> <span class="main">(</span><span class="bound">T</span> <span class="bound">v</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-FHModuleW"><span class="command">lemma</span></span> FHModuleW <span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">H</span> <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Rep_Fin_Groups-FGModuleW"><span class="command">lemma</span></span> FGModuleW<span class="main">:</span> <span class="quoted"><span class="quoted">"FGModule <span class="free">G</span> <span class="free">smult'</span> <span class="free">W</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> FHModuleW Subgroup HRep.restriction_to_subgroup_is_module
 <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In order to build an inverse for the required isomorphism of Hom-sets, we will need a basis for
  the induced <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-space.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Vfbasis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Vfbasis</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">vs</span><span class="main">.</span> is_Vfbasis <span class="bound">vs</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-Vfbasis"><span class="command">lemma</span></span> Vfbasis <span class="main">:</span> <span class="quoted"><span class="quoted">"is_Vfbasis Vfbasis"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Vfbasis_def FinDimVectorSpace.basis_ex<span class="main">[</span><span class="operator">OF</span> GRep.FinDimVectorSpace<span class="main">]</span> someI_ex
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-Vfbasis_V"><span class="command">lemma</span></span> Vfbasis_V <span class="main">:</span> <span class="quoted"><span class="quoted">"set Vfbasis <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Vfbasis <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nonzero_H_rcoset_reps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nonzero_H_rcoset_reps</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">hs</span><span class="main">.</span> Group.is_rcoset_replist <span class="free">H</span> <span class="free">G</span> <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="bound">hs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">H_rcoset_reps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">H_rcoset_reps</span> <span class="main">≡</span> <span class="main">0</span> <span class="main">#</span> nonzero_H_rcoset_reps"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-H_rcoset_reps"><span class="command">lemma</span></span> H_rcoset_reps <span class="main">:</span> <span class="quoted"><span class="quoted">"Group.is_rcoset_replist <span class="free">H</span> <span class="free">G</span> H_rcoset_reps"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_rcoset_reps_def nonzero_H_rcoset_reps_def GRep.ex_rcoset_replist_hd0 someI_ex
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-H_rcoset_reps_H"><span class="command">lemma</span></span> H_rcoset_reps_H <span class="main">:</span> <span class="quoted"><span class="quoted">"set H_rcoset_reps <span class="main">⊆</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_rcoset_reps Group.is_rcoset_replistD_set<span class="main">[</span><span class="operator">OF</span> HRep.GroupG<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-nonzero_H_rcoset_reps_H"><span class="command">lemma</span></span> nonzero_H_rcoset_reps_H <span class="main">:</span> <span class="quoted"><span class="quoted">"set nonzero_H_rcoset_reps <span class="main">⊆</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_rcoset_reps_H H_rcoset_reps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">negHorbit_homVfbasis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'w</span> list list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">negHorbit_homVfbasis</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">≡</span> HRep.negGorbit_list H_rcoset_reps <span class="free"><span class="bound"><span class="entity">T</span></span></span> Vfbasis"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-negHorbit_Hom_indVfbasis_W"><span class="command">lemma</span></span> negHorbit_Hom_indVfbasis_W <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span> <span class="main">⟹</span> set <span class="main">(</span>concat <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_rcoset_reps_H Vfbasis_V
        HRep.negGorbit_list_V<span class="main">[</span><span class="operator">of</span> <span class="quoted">H_rcoset_reps</span> <span class="quoted"><span class="free">T</span></span> <span class="quoted">Vfbasis</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-negHorbit_HomSet_indVfbasis_W"><span class="command">lemma</span></span> negHorbit_HomSet_indVfbasis_W <span class="main">:</span>  
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GRepHomSet <span class="free">smult'</span> <span class="free">W</span> <span class="main">⟹</span> set <span class="main">(</span>concat <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FGModuleHomSetD_Im negHorbit_Hom_indVfbasis_W <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">indVfbasis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">indVfbasis</span> <span class="main">≡</span> GRep.negHorbit_list H_rcoset_reps induced_vector Vfbasis"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-indVfbasis"><span class="command">lemma</span></span> indVfbasis <span class="main">:</span>
  <span class="quoted"><span class="quoted">"fscalar_mult.basis_for induced_smult.fsmult <span class="free">indV</span> <span class="main">(</span>concat indVfbasis<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Vfbasis H_rcoset_reps indVfbasis_def indspace_basis<span class="main">[</span><span class="operator">of</span> <span class="quoted">Vfbasis</span> <span class="quoted">H_rcoset_reps</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword1" id="Rep_Fin_Groups-indVfbasis_indV"><span class="command">lemma</span></span> indVfbasis_indV <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hfvs</span> <span class="main">∈</span> set indVfbasis <span class="main">⟹</span> set <span class="free">hfvs</span> <span class="main">⊆</span> <span class="free">indV</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indVfbasis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FrobeniusReciprocity *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The required isomorphism of Hom-sets›</span></span>

<span class="keyword1"><span class="command">context</span></span> FrobeniusReciprocity
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following function will demonstrate the required isomorphism of Hom-sets (as vector
        spaces).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">≡</span> restrict0 <span class="main">(</span><span class="main">λ</span><span class="bound">T</span><span class="main">.</span> <span class="bound">T</span> <span class="main">∘</span> GRep.induced_vector<span class="main">)</span> <span class="main">(</span>HRepHomSet <span class="free">smult'</span> <span class="free">W</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-φ_im"><span class="command">lemma</span></span> φ_im <span class="main">:</span> <span class="quoted"><span class="quoted">"φ <span class="main">`</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span> <span class="main">⊆</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_subsetI<span class="main">)</span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T</span> <span class="keyword3"><span class="command">assume</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"φ <span class="skolem">T</span> <span class="main">∈</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FGModuleHomSetI<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> T <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"FGModuleHom <span class="free">G</span> <span class="free">rrsmult</span> <span class="free">indV</span> <span class="free">smult'</span> <span class="skolem">T</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FGModuleHomSetD_FGModuleHom GRep.Subgroup
            FGModuleHom.restriction_to_subgroup_is_hom
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"BaseRep.GRepHom <span class="main"><span class="free">(⋆)</span></span> <span class="main">(</span>φ <span class="skolem">T</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T φ_def GRep.hom_induced_vector GRep.induced_vector_indV
            FGModuleHom.FGModHom_composite_left
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"φ <span class="skolem">T</span> <span class="main">`</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> T φ_def GRep.induced_vector_indV FGModuleHomSetD_Im <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FrobeniusReciprocity *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The inverse map of Hom-sets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section we build an inverse for the required isomorphism, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">φ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">context</span></span> FrobeniusReciprocity
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ψ_condition</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ_condition</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>
              <span class="main">≡</span> VectorSpaceHom induced_smult.fsmult <span class="free">indV</span> fsmult' <span class="free"><span class="bound"><span class="entity">S</span></span></span> 
                <span class="main">∧</span> map <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> indVfbasis <span class="main">=</span> negHorbit_homVfbasis <span class="free"><span class="bound"><span class="entity">T</span></span></span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-inverse_im_exists'"><span class="command">lemma</span></span> inverse_im_exists' <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">S</span><span class="main">.</span> VectorSpaceHom induced_smult.fsmult <span class="free">indV</span> fsmult' <span class="bound">S</span>
                <span class="main">∧</span> map <span class="bound">S</span> <span class="main">(</span>concat indVfbasis<span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span>
  <span class="operator">rule</span> VectorSpace.basis_im_defines_hom<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fVectorSpace_indspace<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">rule</span> HRep.fVectorSpace<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> indVfbasis
<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span>  assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>concat <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> negHorbit_HomSet_indVfbasis_W <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"length <span class="main">(</span>concat <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>concat indVfbasis<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> length_concat_negGorbit_list indVfbasis_def
          induced_smult.length_concat_negGorbit_list<span class="main">[</span><span class="operator">of</span> <span class="quoted">H_rcoset_reps</span> <span class="quoted">induced_vector</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-inverse_im_exists"><span class="command">lemma</span></span> inverse_im_exists <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">S</span><span class="main">.</span> ψ_condition <span class="free">T</span> <span class="bound">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> ψ_condition <span class="free">T</span> <span class="bound">S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpaceHom induced_smult.fsmult <span class="free">indV</span> fsmult' <span class="skolem">S</span>"</span></span> 
               <span class="quoted"><span class="quoted">"map <span class="skolem">S</span> <span class="main">(</span>concat indVfbasis<span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inverse_im_exists'
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> S<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>map <span class="main">(</span>map <span class="skolem">S</span><span class="main">)</span> indVfbasis<span class="main">)</span>
                          <span class="main">=</span> concat <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> map_concat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> length <span class="bound">ys</span><span class="main">)</span>
                        <span class="main">(</span>map <span class="main">(</span>map <span class="skolem">S</span><span class="main">)</span> indVfbasis<span class="main">)</span> <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffD2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> list_all2_iff<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>map <span class="main">(</span>map <span class="skolem">S</span><span class="main">)</span> indVfbasis<span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> indVfbasis_def induced_smult.length_negGorbit_list
              HRep.length_negGorbit_list<span class="main">[</span><span class="operator">of</span> <span class="quoted">H_rcoset_reps</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span><span class="bound">ys</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>map <span class="skolem">S</span><span class="main">)</span> indVfbasis<span class="main">)</span>
                  <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> length <span class="bound">ys</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod_ballI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span>
        <span class="keyword3"><span class="command">assume</span></span> xsys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span><span class="main">,</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="main">(</span>map <span class="skolem">S</span><span class="main">)</span> indVfbasis<span class="main">)</span>
                            <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> zs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">∈</span> set indVfbasis"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> map <span class="skolem">S</span> <span class="skolem">zs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> set_zip_leftD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">with</span></span> xsys <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">ys</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> indVfbasis_def set_zip_rightD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">]</span>
                HRep.length_negGorbit_list_sublist<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ys</span></span> <span class="quoted">H_rcoset_reps</span> <span class="quoted"><span class="free">T</span></span> <span class="quoted">Vfbasis</span><span class="main">]</span>
                induced_smult.length_negGorbit_list_sublist
          <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>map <span class="skolem">S</span><span class="main">)</span> indVfbasis <span class="main">=</span> negHorbit_homVfbasis <span class="free">T</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> concat_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>map <span class="skolem">S</span><span class="main">)</span> indVfbasis"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> S<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ψ_condition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span> <span class="bound">U</span><span class="main">.</span> ψ_condition <span class="free">T</span> <span class="bound">S</span> <span class="main">⟹</span> ψ_condition <span class="free">T</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="bound">S</span> <span class="main">=</span> <span class="bound">U</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="skolem">U</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ψ_condition <span class="free">T</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"ψ_condition <span class="free">T</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"VectorSpaceHom induced_smult.fsmult <span class="free">indV</span> fsmult' <span class="skolem">S</span>"</span></span>
          <span class="quoted"><span class="quoted">"map <span class="skolem">S</span> <span class="main">(</span>concat indVfbasis<span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"VectorSpaceHom induced_smult.fsmult <span class="free">indV</span> fsmult' <span class="skolem">U</span>"</span></span>
          <span class="quoted"><span class="quoted">"map <span class="skolem">U</span> <span class="main">(</span>concat indVfbasis<span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ψ_condition_def map_concat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> map_concat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">U</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inverse_im_exists' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ψ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'f</span><span class="main">,</span> <span class="tfree">'g</span><span class="main">)</span> aezfun <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">≡</span> restrict0 <span class="main">(</span><span class="main">λ</span><span class="bound">T</span><span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">S</span><span class="main">.</span> ψ_condition <span class="bound">T</span> <span class="bound">S</span><span class="main">)</span> <span class="main">(</span>GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rep_Fin_Groups-ψD"><span class="command">lemma</span></span> ψD <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span> <span class="main">⟹</span> ψ_condition <span class="free">T</span> <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ψ_def inverse_im_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> theI'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">S</span><span class="main">.</span> ψ_condition <span class="free">T</span> <span class="bound">S</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rep_Fin_Groups-ψD_VectorSpaceHom"><span class="command">lemma</span></span> ψD_VectorSpaceHom <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>
        <span class="main">⟹</span> VectorSpaceHom induced_smult.fsmult <span class="free">indV</span> fsmult' <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ψD ψ_condition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-ψD_im"><span class="command">lemma</span></span> ψD_im <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span> <span class="main">⟹</span> map <span class="main">(</span>map <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span><span class="main">)</span> indVfbasis
        <span class="main">=</span> aezfun_scalar_mult.negGorbit_list <span class="main"><span class="free">(⋆)</span></span> H_rcoset_reps <span class="free">T</span> Vfbasis"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ψD ψ_condition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Rep_Fin_Groups-ψD_im_single"><span class="command">lemma</span></span> ψD_im_single <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> set H_rcoset_reps"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set Vfbasis"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ψ <span class="free">T</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="free">h</span><span class="main">)</span> <span class="main">*¤</span> <span class="main">(</span>induced_vector <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">h</span><span class="main">)</span> <span class="main">*⋆</span> <span class="main">(</span><span class="free">T</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length H_rcoset_reps"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> H_rcoset_reps<span class="main">!</span><span class="skolem">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length Vfbasis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> Vfbasis<span class="main">!</span><span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted">H_rcoset_reps</span><span class="main">]</span> set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted">Vfbasis</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>map <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span><span class="main">)</span> indVfbasis <span class="main">!</span><span class="skolem">i</span> <span class="main">!</span><span class="skolem">j</span> <span class="main">=</span> ψ <span class="free">T</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">h</span><span class="main">)</span> <span class="main">*¤</span> <span class="main">(</span>induced_vector <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indVfbasis_def
          aezfun_scalar_mult.length_negGorbit_list<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="free">rrsmult</span></span> <span class="quoted">H_rcoset_reps</span> <span class="quoted">induced_vector</span>
          <span class="main">]</span>
          aezfun_scalar_mult.negGorbit_list_nth<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted">H_rcoset_reps</span> <span class="quoted"><span class="free">rrsmult</span></span> <span class="quoted">induced_vector</span>
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> HRep.negGorbit_list_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted">H_rcoset_reps</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> ψD_im <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-ψT_W"><span class="command">lemma</span></span> ψT_W <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ψ <span class="free">T</span> <span class="main">`</span> <span class="free">indV</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"VectorSpaceHom induced_smult.fsmult <span class="free">indV</span> fsmult' <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ψD_VectorSpaceHom <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">indV</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> cs<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="skolem">cs</span> <span class="main">=</span> length <span class="main">(</span>concat indVfbasis<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">cs</span> <span class="main">∙¤¤</span> <span class="main">(</span>concat indVfbasis<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indVfbasis scalar_mult.in_Span_obtain_same_length_coeffs
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> cs<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">css</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> css<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> concat <span class="skolem">css</span>"</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> length <span class="bound">ys</span><span class="main">)</span> <span class="skolem">css</span> indVfbasis"</span></span>
    <span class="keyword1"><span class="command">using</span></span> match_concat
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> assms cs<span class="main">(</span>2<span class="main">)</span> css
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ <span class="free">T</span> <span class="skolem">f</span> <span class="main">=</span> ψ <span class="free">T</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">cs</span><span class="main">,</span><span class="bound">hfvs</span><span class="main">)</span><span class="main">←</span>zip <span class="skolem">css</span> indVfbasis<span class="main">.</span> <span class="bound">cs</span> <span class="main">∙¤¤</span> <span class="bound">hfvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> VectorSpace.lincomb_concat<span class="main">[</span><span class="operator">OF</span> fVectorSpace_indspace<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">cs</span><span class="main">,</span><span class="bound">hfvs</span><span class="main">)</span><span class="main">←</span>zip <span class="skolem">css</span> indVfbasis<span class="main">.</span> ψ <span class="free">T</span>  <span class="main">(</span><span class="bound">cs</span> <span class="main">∙¤¤</span> <span class="bound">hfvs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_zip_rightD<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">css</span></span> <span class="quoted">indVfbasis</span><span class="main">]</span> indVfbasis_indV
          VectorSpace.lincomb_closed<span class="main">[</span><span class="operator">OF</span> GRep.fVectorSpace_indspace<span class="main">]</span>
          VectorSpaceHom.im_sum_list_prod<span class="main">[</span><span class="operator">OF</span> T<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ <span class="free">T</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">cs</span><span class="main">,</span><span class="bound">ψThfvs</span><span class="main">)</span><span class="main">←</span>zip <span class="skolem">css</span> <span class="main">(</span>map <span class="main">(</span>map <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span><span class="main">)</span> indVfbasis<span class="main">)</span><span class="main">.</span>
                      <span class="bound">cs</span> <span class="main">∙♯⋆</span> <span class="bound">ψThfvs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_zip_rightD<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">css</span></span> <span class="quoted">indVfbasis</span><span class="main">]</span> indVfbasis_indV
          VectorSpaceHom.distrib_lincomb<span class="main">[</span><span class="operator">OF</span> T<span class="main">]</span> 
          sum_list_prod_cong<span class="main">[</span><span class="operator">of</span>
            <span class="quoted"><span class="quoted">"zip <span class="skolem">css</span> indVfbasis"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">cs</span> <span class="bound">hfvs</span><span class="main">.</span> ψ <span class="free">T</span> <span class="main">(</span><span class="bound">cs</span> <span class="main">∙¤¤</span> <span class="bound">hfvs</span><span class="main">)</span>"</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">cs</span> <span class="bound">hfvs</span><span class="main">.</span> <span class="bound">cs</span> <span class="main">∙♯⋆</span> <span class="main">(</span>map <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span> <span class="bound">hfvs</span><span class="main">)</span>"</span></span>
          <span class="main">]</span>
          sum_list_prod_map2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">cs</span> <span class="bound">ψThfvs</span><span class="main">.</span> <span class="bound">cs</span> <span class="main">∙♯⋆</span> <span class="bound">ψThfvs</span>"</span></span> <span class="quoted"><span class="skolem">css</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> css<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> length <span class="bound">ys</span><span class="main">)</span> <span class="skolem">css</span> <span class="main">(</span>map <span class="main">(</span>map <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span><span class="main">)</span> indVfbasis<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> list_all2_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">css</span></span> <span class="quoted">indVfbasis</span><span class="main">]</span> set_zip_map2
          list_all2_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">css</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>map <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span><span class="main">)</span> indVfbasis"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ <span class="free">T</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span>concat <span class="skolem">css</span><span class="main">)</span> <span class="main">∙♯⋆</span> <span class="main">(</span>concat <span class="main">(</span>negHorbit_homVfbasis <span class="free">T</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> HRep.flincomb_concat map_concat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ψ <span class="free">T</span>"</span></span><span class="main">]</span> ψD_im<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ψ <span class="free">T</span> <span class="skolem">f</span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms negHorbit_HomSet_indVfbasis_W HRep.flincomb_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-ψT_Hmap_on_indVfbasis"><span class="command">lemma</span></span> ψT_Hmap_on_indVfbasis <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="bound">f</span> <span class="main">∈</span> set <span class="main">(</span>concat indVfbasis<span class="main">)</span>
                <span class="main">⟹</span> ψ <span class="free">T</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*¤</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">*⋆</span> <span class="main">(</span>ψ <span class="free">T</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="main">(</span>concat indVfbasis<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> f <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length indVfbasis"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="main">(</span>indVfbasis<span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_concat set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted">indVfbasis</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> i<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> i'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length H_rcoset_reps"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indVfbasis_def
          aezfun_scalar_mult.length_negGorbit_list<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="free">rrsmult</span></span> <span class="quoted">H_rcoset_reps</span> <span class="quoted">induced_vector</span>
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hi</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hi</span> <span class="main">=</span> H_rcoset_reps<span class="main">!</span><span class="skolem">i</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> i' <span class="keyword1"><span class="command">have</span></span> hi_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hi</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_conv_nth H_rcoset_reps_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> hi_def i<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span>Hmult <span class="main">(</span><span class="main">-</span><span class="skolem">hi</span><span class="main">)</span> <span class="main">∘</span> induced_vector<span class="main">)</span> Vfbasis<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indVfbasis_def i'
          aezfun_scalar_mult.negGorbit_list_nth<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted">H_rcoset_reps</span> <span class="quoted"><span class="free">rrsmult</span></span> <span class="quoted">induced_vector</span>
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> set Vfbasis"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">hi</span><span class="main">)</span> <span class="main">*¤</span> <span class="main">(</span>induced_vector <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> v<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> v_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Tv_W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Vfbasis_V FGModuleHomSetD_Im<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hi</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hi_H Supgroup.diff_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length H_rcoset_reps"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hi</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">+</span> <span class="main">{</span>H_rcoset_reps<span class="main">!</span><span class="skolem">j</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted">H_rcoset_reps</span><span class="main">]</span> H_rcoset_reps
          Group.group_eq_subgrp_rcoset_un<span class="main">[</span><span class="operator">OF</span> HRep.GroupG Subgroup H_rcoset_reps<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> j<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> j'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length indVfbasis"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indVfbasis_def
          aezfun_scalar_mult.length_negGorbit_list<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="free">rrsmult</span></span> <span class="quoted">H_rcoset_reps</span> <span class="quoted">induced_vector</span>
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hj</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hj</span> <span class="main">=</span> H_rcoset_reps<span class="main">!</span><span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> j<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> hj_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hj</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_conv_nth H_rcoset_reps_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> hj_def j<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hi</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">hj</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> x_hi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">hi</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">hj</span> <span class="main">+</span> <span class="main">-</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> minus_diff_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">hi</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> minus_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> v_V ActingGroup.neg_closed BaseRep.Gmult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">cs</span> <span class="main">=</span> length Vfbasis"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">cs</span> <span class="main">∙♯⋅</span> Vfbasis"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Vfbasis
          VectorSpace.in_Span_obtain_same_length_coeffs<span class="main">[</span><span class="operator">OF</span> GRep.fVectorSpace<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>

  <span class="keyword1"><span class="command">from</span></span> v<span class="main">(</span>2<span class="main">)</span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ <span class="free">T</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*¤</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> ψ <span class="free">T</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="skolem">hi</span><span class="main">)</span> <span class="main">*¤</span> <span class="main">(</span>induced_vector <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hi_H Supgroup.neg_closed v_V induced_vector_indV
          FGModule.Gmult_assoc<span class="main">[</span><span class="operator">OF</span> GRep.FHModule_indspace<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ψ <span class="free">T</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="skolem">hj</span><span class="main">)</span> <span class="main">*¤</span> <span class="main">(</span>induced_vector <span class="main">(</span><span class="main">-</span><span class="skolem">g</span> <span class="main">*⋅</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_hi hj_H Subgroup Supgroup.neg_closed v_V induced_vector_indV
          FGModule.Gmult_assoc<span class="main">[</span><span class="operator">OF</span> GRep.FHModule_indspace<span class="main">]</span>
          ActingGroup.neg_closed
          FGModuleHom.G_map<span class="main">[</span><span class="operator">OF</span> hom_induced_vector<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> cs<span class="main">(</span>2<span class="main">)</span> hj_def j<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ψ <span class="free">T</span> <span class="main">(</span><span class="skolem">cs</span> <span class="main">∙¤¤</span> <span class="main">(</span>indVfbasis<span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hj_H Vfbasis_V FGModuleHom.distrib_flincomb<span class="main">[</span><span class="operator">OF</span> hom_induced_vector<span class="main">]</span>
          indVfbasis_def Supgroup.neg_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">hj</span></span><span class="main">]</span> induced_vector_indV
          FGModule.Gmult_flincomb_comm<span class="main">[</span>
            <span class="operator">OF</span> GRep.FHModule_indspace<span class="main">,</span>
            <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">hj</span>"</span></span> <span class="quoted"><span class="quoted">"map induced_vector Vfbasis"</span></span>
          <span class="main">]</span>
          aezfun_scalar_mult.negGorbit_list_nth<span class="main">[</span>
            <span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted">H_rcoset_reps</span> <span class="quoted"><span class="free">rrsmult</span></span> <span class="quoted">induced_vector</span>
          <span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">cs</span> <span class="main">∙♯⋆</span> <span class="main">(</span><span class="main">(</span>map <span class="main">(</span>map <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span><span class="main">)</span> indVfbasis<span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ψD_VectorSpaceHom<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> indVfbasis_indV j' set_conv_nth
          VectorSpaceHom.distrib_lincomb<span class="main">[</span><span class="operator">of</span> <span class="quoted">induced_smult.fsmult</span> <span class="quoted"><span class="free">indV</span></span> <span class="quoted">fsmult'</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> j<span class="main">(</span>1<span class="main">)</span> hj_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">hj</span><span class="main">)</span> <span class="main">*⋆</span> <span class="skolem">cs</span> <span class="main">∙♯⋆</span> <span class="main">(</span>map <span class="free">T</span> Vfbasis<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ψD_im<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
          aezfun_scalar_mult.negGorbit_list_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted">H_rcoset_reps</span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> hj_H
          Group.neg_closed<span class="main">[</span><span class="operator">OF</span> HRep.GroupG<span class="main">]</span>
          Vfbasis_V FGModuleHomSetD_Im<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
          HRep.Gmult_flincomb_comm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">hj</span>"</span></span> <span class="quoted"><span class="quoted">"map <span class="free">T</span> Vfbasis"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> cs<span class="main">(</span>2<span class="main">)</span> g<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">hj</span><span class="main">)</span> <span class="main">*⋆</span> <span class="main">(</span><span class="main">-</span><span class="skolem">g</span><span class="main">)</span> <span class="main">*⋆</span> <span class="main">(</span><span class="free">T</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> v_V FGModuleHomSetD_FGModuleHom<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> Vfbasis_V
          FGModuleHom.distrib_flincomb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span><span class="main">]</span>
          ActingGroup.neg_closed
          FGModuleHom.G_map<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">smult'</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">g</span>"</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>1<span class="main">)</span> v<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">hi</span><span class="main">)</span> <span class="main">*⋆</span> <span class="main">(</span><span class="free">T</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModuleHomSetD_FGModuleHom<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> Vfbasis_V Supgroup.neg_closed
          hj_H Subgroup FGModuleHomSetD_Im<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
          HRep.Gmult_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">hj</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="skolem">v</span>"</span></span><span class="main">]</span> x_hi
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*⋆</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">hi</span><span class="main">)</span> <span class="main">*⋆</span> <span class="main">(</span><span class="free">T</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hi_H Supgroup.neg_closed Tv_W HRep.Gmult_assoc
    <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ψ <span class="free">T</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*¤</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*⋆</span> <span class="main">(</span>ψ <span class="free">T</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> v hi_def i' set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted">H_rcoset_reps</span><span class="main">]</span> ψD_im_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-ψT_hom"><span class="command">lemma</span></span> ψT_hom <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"HRepHom <span class="main"><span class="free">(⋆)</span></span> <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> indVfbasis ψD_VectorSpaceHom<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> FHModuleW
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span>
  <span class="operator">rule</span> FGModule.VecHom_GMap_on_fbasis_is_FGModuleHom<span class="main"><span class="main">[</span></span>
    <span class="operator">OF</span> GRep.FHModule_indspace
  <span class="main"><span class="main">]</span></span>
<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ψ <span class="free">T</span> <span class="main">`</span> <span class="free">indV</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indVfbasis ψT_W<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span>concat indVfbasis<span class="main">)</span>
              <span class="main">⟹</span> ψ <span class="free">T</span> <span class="main">(</span><span class="bound">g</span> <span class="main">*¤</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="main">*⋆</span> ψ <span class="free">T</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ψT_Hmap_on_indVfbasis<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-ψ_im"><span class="command">lemma</span></span> ψ_im <span class="main">:</span> <span class="quoted"><span class="quoted">"ψ <span class="main">`</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span> <span class="main">⊆</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ψT_W ψT_hom FGModuleHomSetI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FrobeniusReciprocity *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Demonstration of bijectivity›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we demonstrate that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">φ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is bijective via the inverse <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ψ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">context</span></span> FrobeniusReciprocity
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-φψ"><span class="command">lemma</span></span> φψ <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> GRepHomSet <span class="free">smult'</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>φ <span class="main">∘</span> ψ<span class="main">)</span> <span class="free">T</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>φ <span class="main">∘</span> ψ<span class="main">)</span> <span class="free">T</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">T</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">cs</span> <span class="main">=</span> length Vfbasis"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">cs</span> <span class="main">∙♯⋅</span> Vfbasis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Vfbasis
            VectorSpace.in_Span_obtain_same_length_coeffs<span class="main">[</span><span class="operator">OF</span> GRep.fVectorSpace<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">extrazeros</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">extrazeros</span> <span class="main">=</span> replicate <span class="main">(</span><span class="main">(</span>length nonzero_H_rcoset_reps<span class="main">)</span><span class="main">*</span><span class="main">(</span>length Vfbasis<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> cs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"GRep.induced_vector <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="skolem">extrazeros</span><span class="main">)</span> <span class="main">∙¤¤</span> <span class="main">(</span>concat indVfbasis<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>     H_rcoset_reps induced_vector_decomp<span class="main">[</span><span class="operator">OF</span> Vfbasis<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> H_rcoset_reps_def indVfbasis_def
      <span class="keyword1"><span class="command">by</span></span>        <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>φ <span class="main">∘</span> ψ<span class="main">)</span> <span class="free">T</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="skolem">extrazeros</span><span class="main">)</span> <span class="main">∙♯⋆</span> <span class="main">(</span>map <span class="main">(</span>ψ <span class="free">T</span><span class="main">)</span> <span class="main">(</span>concat indVfbasis<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ψ_im φ_def indVfbasis
            VectorSpaceHom.distrib_lincomb<span class="main">[</span><span class="operator">OF</span> ψD_VectorSpaceHom<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="skolem">extrazeros</span><span class="main">)</span> <span class="main">∙♯⋆</span> <span class="main">(</span>map <span class="free">T</span> Vfbasis
                    <span class="main">@</span> concat <span class="main">(</span>HRep.negGorbit_list nonzero_H_rcoset_reps <span class="free">T</span> Vfbasis<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> map_concat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ψ <span class="free">T</span>"</span></span><span class="main">]</span> ψD_im<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> H_rcoset_reps_def
            FGModuleHomSetD_Im<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> Vfbasis_V HRep.negGorbit_list_Cons0
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> cs<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">cs</span> <span class="main">∙♯⋆</span> <span class="main">(</span>map <span class="free">T</span> Vfbasis<span class="main">)</span> <span class="main">+</span> <span class="skolem">extrazeros</span>
                  <span class="main">∙♯⋆</span> <span class="main">(</span>concat <span class="main">(</span>HRep.negGorbit_list nonzero_H_rcoset_reps <span class="free">T</span> Vfbasis<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> scalar_mult.lincomb_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">cs</span></span> <span class="main">_</span> <span class="quoted">fsmult'</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">cs</span> <span class="main">∙♯⋆</span> <span class="main">(</span>map <span class="free">T</span> Vfbasis<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nonzero_H_rcoset_reps_H Vfbasis FGModuleHomSetD_Im<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
            HRep.negGorbit_list_V
            VectorSpace.lincomb_replicate0_left<span class="main">[</span><span class="operator">OF</span> HRep.fVectorSpace<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> extrazeros_def
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> cs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">T</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FGModuleHomSetD_FGModuleHom<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
            FGModuleHom.VectorSpaceHom Vfbasis
            VectorSpaceHom.distrib_lincomb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"aezfun_scalar_mult.fsmult <span class="free">smult</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ψ_im φ_def GRep.induced_vector_def ψD_VectorSpaceHom
            VectorSpaceHom.im_zero
            FGModuleHomSetD_FGModuleHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">smult</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span>
            FGModuleHom.supp suppI_contra
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rep_Fin_Groups-φ_inverse_im"><span class="command">lemma</span></span> φ_inverse_im <span class="main">:</span> <span class="quoted"><span class="quoted">"φ <span class="main">`</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span> <span class="main">⊇</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> φψ ψ_im <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rep_Fin_Groups-bij_φ"><span class="command">lemma</span></span> bij_φ <span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw φ <span class="main">(</span>HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span> <span class="main">(</span>GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
<span class="keyword1"><span class="command">proof</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">S</span> <span class="bound">T</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">S</span> <span class="main">∈</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">;</span> <span class="bound">T</span> <span class="main">∈</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">;</span>
            φ <span class="bound">S</span> <span class="main">=</span> φ <span class="bound">T</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">S</span> <span class="main">=</span> <span class="bound">T</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> VectorSpaceHom.same_image_on_spanset_imp_same_hom<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="skolem">T</span>
    <span class="keyword3"><span class="command">assume</span></span> ST<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"φ <span class="skolem">S</span> <span class="main">=</span> φ <span class="skolem">T</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ST<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ST'<span class="main">:</span> <span class="quoted"><span class="quoted">"HRepHom <span class="free">smult'</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"HRepHom <span class="free">smult'</span> <span class="skolem">T</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FGModuleHomSetD_FGModuleHom<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">rrsmult</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> ST'
      <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"VectorSpaceHom induced_smult.fsmult <span class="free">indV</span> fsmult' <span class="skolem">S</span>"</span></span>
            <span class="quoted"><span class="quoted">"VectorSpaceHom induced_smult.fsmult <span class="free">indV</span> fsmult' <span class="skolem">T</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FGModuleHom.VectorSpaceHom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">rrsmult</span></span> <span class="quoted"><span class="free">indV</span></span> <span class="quoted"><span class="free">smult'</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">indV</span> <span class="main">=</span> induced_smult.fSpan <span class="main">(</span>concat indVfbasis<span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"set <span class="main">(</span>concat indVfbasis<span class="main">)</span> <span class="main">⊆</span> <span class="free">indV</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> indVfbasis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span>set <span class="main">(</span>concat indVfbasis<span class="main">)</span><span class="main">.</span> <span class="skolem">S</span> <span class="bound">f</span> <span class="main">=</span> <span class="skolem">T</span> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="main">(</span>concat indVfbasis<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hfvs</span></span> <span class="keyword2"><span class="keyword">where</span></span> hfvs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hfvs</span> <span class="main">∈</span> set indVfbasis"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="skolem">hfvs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_concat <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">from</span></span> hfvs<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> set H_rcoset_reps"</span></span>
                 <span class="quoted"><span class="quoted">"<span class="skolem">hfvs</span> <span class="main">=</span> map <span class="main">(</span>Hmult <span class="main">(</span><span class="main">-</span><span class="skolem">h</span><span class="main">)</span> <span class="main">∘</span> induced_vector<span class="main">)</span> Vfbasis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> indVfbasis_def
              induced_smult.negGorbit_list_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">H_rcoset_reps</span> <span class="quoted">induced_vector</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> hfvs<span class="main">(</span>2<span class="main">)</span> h<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> set Vfbasis"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">h</span><span class="main">)</span> <span class="main">*¤</span> <span class="main">(</span>induced_vector <span class="skolem">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> v h<span class="main">(</span>1<span class="main">)</span> ST<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">h</span><span class="main">)</span> <span class="main">*⋆</span> <span class="main">(</span>φ <span class="skolem">S</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ST'<span class="main">(</span>1<span class="main">)</span> H_rcoset_reps_H Group.neg_closed<span class="main">[</span><span class="operator">OF</span> HRep.GroupG<span class="main">]</span>
              GRep.induced_vector_indV Vfbasis_V φ_def FGModuleHom.G_map
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> v h<span class="main">(</span>1<span class="main">)</span> ST<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">h</span><span class="main">)</span> <span class="main">*⋆</span> <span class="main">(</span>φ <span class="skolem">T</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ST'<span class="main">(</span>2<span class="main">)</span> H_rcoset_reps_H Group.neg_closed<span class="main">[</span><span class="operator">OF</span> HRep.GroupG<span class="main">]</span> GRep.induced_vector_indV
              Vfbasis_V φ_def FGModuleHom.G_map
        <span class="keyword1"><span class="command">by</span></span>    <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">T</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ST<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inj_on φ <span class="main">(</span>HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"φ <span class="main">`</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span> <span class="main">=</span> GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> φ_im φ_inverse_im <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FrobeniusReciprocity *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finally we demonstrate that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">φ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is an isomorphism of vector spaces between the two
  hom-sets, leading to Frobenius reciprocity.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> FrobeniusReciprocity
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rep_Fin_Groups-VectorSpaceIso_φ"><span class="command">lemma</span></span> VectorSpaceIso_φ <span class="main">:</span>
  <span class="quoted"><span class="quoted">"VectorSpaceIso Tsmult1 <span class="main">(</span>HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span> Tsmult2 φ
        <span class="main">(</span>GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> VectorSpaceIso.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> VectorSpace.VectorSpaceHomI_fromaxioms<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> Tsmult1_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"VectorSpace Tsmult1 <span class="main">(</span>HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FHModule_indspace FHModuleW
          FGModule.VectorSpace_FGModuleHomSet
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> φ_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"supp φ <span class="main">⊆</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> suppD_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted">φ</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw φ <span class="main">(</span>HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span> <span class="main">(</span>GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_φ <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"VectorSpaceIso_axioms <span class="main">(</span>HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span> φ <span class="main">(</span>GRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">next</span></span>    
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="skolem">T</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"φ <span class="main">(</span><span class="skolem">S</span> <span class="main">+</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">=</span> φ <span class="skolem">S</span> <span class="main">+</span> φ <span class="skolem">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> φ_def Group.add_closed
          FGModule.Group_FGModuleHomSet<span class="main">[</span><span class="operator">OF</span> FHModule_indspace FHModuleW<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">auto</span>

<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">T</span> <span class="keyword3"><span class="command">assume</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> Tsmult1_def <span class="keyword1"><span class="command">have</span></span> aT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⋆¤</span> <span class="skolem">T</span> <span class="main">∈</span> HRepHomSet <span class="main"><span class="free">(⋆)</span></span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FGModule.VectorSpace_FGModuleHomSet<span class="main">[</span>
            <span class="operator">OF</span> FHModule_indspace FHModuleW
          <span class="main">]</span>
          VectorSpace.smult_closed
    <span class="keyword1"><span class="command">by</span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"φ <span class="main">(</span><span class="skolem">a</span> <span class="main">⋆¤</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⋆⋅</span> <span class="main">(</span>φ <span class="skolem">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> φ_def Tsmult1_def Tsmult2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> FrobeniusReciprocity <span class="main">:</span>
  <span class="quoted"><span class="quoted">"VectorSpace.isomorphic Tsmult1 <span class="main">(</span>HRepHomSet <span class="free">smult'</span> <span class="free">W</span><span class="main">)</span> Tsmult2
        <span class="main">(</span>GRepHomSet <span class="free">smult'</span> <span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> VectorSpaceIso_φ <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context FrobeniusReciprocity *)</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div>