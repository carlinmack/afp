<div id="Dioid_Power_Sum">
<div class="head">
<h1>Theory Dioid_Power_Sum</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Regular Algebras
   Author:     Simon Foster, Georg Struth
   Maintainer: Simon Foster &lt;s.foster at york.ac.uk&gt;
               Georg Struth &lt;g.struth at sheffield.ac.uk&gt;               
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Dioids, Powers and Finite Sums›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Dioid_Power_Sum
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Kleene_Algebra/Dioid.html">Kleene_Algebra.Dioid</a> <a href="../Kleene_Algebra/Finite_Suprema.html">Kleene_Algebra.Finite_Suprema</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We add a few facts about powers and finite
 sums---in fact, finite suprema---to an existing theory field for dioids.›</span></span>

<span class="keyword1"><span class="command">context</span></span> dioid_one_zero

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Dioid_Power_Sum-add_iso_r"><span class="command">lemma</span></span> add_iso_r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.join.sup_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">notation</span></span> power <span class="main">(</span><span class="quoted">"_<span class="keyword1">⇗</span>_<span class="keyword1">⇖</span>"</span> <span class="main">[</span>101<span class="main">,</span>50<span class="main">]</span> 100<span class="main">)</span> 

<span class="keyword1" id="Dioid_Power_Sum-power_subdist"><span class="command">lemma</span></span> power_subdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> local.mult_isol_var local.power_Suc2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="Dioid_Power_Sum-power_inductl_var"><span class="command">lemma</span></span> power_inductl_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> local.dual_order.trans local.mult_isol local.power_Suc2 mult_assoc<span class="main">)</span>

<span class="keyword1" id="Dioid_Power_Sum-power_inductr_var"><span class="command">lemma</span></span> power_inductr_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> eq_refl mult_oner power.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> mult.assoc mult_isor order_refl order_trans power.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> power_commutes<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">powsum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"_<span class="keyword1">⇘</span>_<span class="keyword1">⇙⇗</span>_<span class="keyword1">⇖</span>"</span> <span class="main">[</span>101<span class="main">,</span>50<span class="main">,</span>50<span class="main">]</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">powsum</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> sum <span class="main">(</span><span class="main">(^)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> powsum_simps <span class="main">=</span> powsum_def atLeastAtMostSuc_conv numerals

<span class="keyword1" id="Dioid_Power_Sum-powsum1"><span class="command">lemma</span></span> powsum1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>powsum_simps<span class="main">)</span>
  
<span class="keyword1" id="Dioid_Power_Sum-powsum2"><span class="command">lemma</span></span> powsum2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="free">m</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span>Suc <span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="free">m</span></sup><span class="hidden">⇖</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">(^)</span> <span class="free">x</span><span class="main">)</span> <span class="main">{</span><span class="free">n</span><span class="main">..</span><span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span><span class="main">+</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> powsum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">(^)</span> <span class="free">x</span><span class="main">)</span> <span class="main">{</span><span class="free">n</span><span class="main">..</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span> <span class="main">+</span>  <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span>Suc <span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ab_semigroup_add_class.add.commute atLeastAtMostSuc_conv local.join.sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powsum_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_00"><span class="command">lemma</span></span> powsum_00 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="main">0</span> </sup><span class="hidden">⇖</span><span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powsum_def<span class="main">)</span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_01"><span class="command">lemma</span></span> powsum_01 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="main">1</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powsum2<span class="main">)</span> 

<span class="keyword1" id="Dioid_Power_Sum-powsum_10"><span class="command">lemma</span></span> powsum_10 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powsum_simps<span class="main">)</span> 

<span class="keyword1" id="Dioid_Power_Sum-powsum_split"><span class="command">lemma</span></span> powsum_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">i</span><span class="main">+</span>Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">i</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span><span class="main">+</span>Suc <span class="free">i</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>powsum_simps <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_split_var1"><span class="command">lemma</span></span> powsum_split_var1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span> <span class="main">+</span> <span class="main">1</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="main">0</span> <span class="main">+</span> Suc <span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span> <span class="main">+</span> Suc <span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powsum_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span> <span class="main">+</span> Suc <span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_split_var2"><span class="command">lemma</span></span> powsum_split_var2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem' power_0 powsum_00<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_commute powsum2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_split_var3"><span class="command">lemma</span></span> powsum_split_var3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span><span class="main">+</span>Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span><span class="main">+</span>Suc <span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powsum_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_split_var4"><span class="command">lemma</span></span> powsum_split_var4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span><span class="main">+</span><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span><span class="main">+</span><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_0_iff add_comm powsum1 powsum_split_var2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> hyp <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span> <span class="main">+</span> Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">m</span> <span class="main">+</span> Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powsum2<span class="main">)</span>  
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">m</span> <span class="main">+</span> Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc add.left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span><span class="main">+</span><span class="skolem">n</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right add.assoc add.commute add_idem' hyp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span> <span class="main">+</span> Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_commute powsum2<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_split_var6"><span class="command">lemma</span></span> powsum_split_var6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span><span class="main">+</span>Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="free">k</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span><span class="main">+</span>Suc <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>     
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> powsum_split_var3<span class="main">)</span> 

<span class="keyword1" id="Dioid_Power_Sum-powsum_ext"><span class="command">lemma</span></span> powsum_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def local.join.sup_ge2 powsum_01<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>less_eq_def powsum_simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> add.left_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_one"><span class="command">lemma</span></span> powsum_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> One_nat_def local.join.sup.cobounded1 powsum_01<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Suc_eq_plus1 local.join.sup.cobounded1 powsum_split_var1<span class="main">)</span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_shift1"><span class="command">lemma</span></span> powsum_shift1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span><span class="main">+</span><span class="main">1</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powsum_simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.add_left_comm local.distrib_left powsum_def<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_shift"><span class="command">lemma</span></span> powsum_shift<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">k</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">k</span><span class="main">+</span><span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Suc_eq_plus1 mult.assoc powsum_shift1<span class="main">)</span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_prod_suc"><span class="command">lemma</span></span> powsum_prod_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">note</span></span> hyp <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span>  <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powsum2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>hyp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub>Suc <span class="skolem">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powsum_shift<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub>Suc <span class="skolem">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span> <span class="main">+</span> Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>powsum2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub>Suc <span class="skolem">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right add_Suc_shift add.assoc add.left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> add_Suc_right<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> add_Suc_shift<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> powsum_split_var4<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="main">(</span>Suc <span class="skolem">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powsum2<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dioid_Power_Sum-powsum_prod"><span class="command">lemma</span></span> powsum_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span><span class="main">+</span><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powsum_prod_suc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Regular_Algebras">
<div class="head">
<h1>Theory Regular_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Regular Algebras
   Author:     Simon Foster, Georg Struth
   Maintainer: Simon Foster &lt;s.foster at york.ac.uk&gt;
               Georg Struth &lt;g.struth at sheffield.ac.uk&gt;               
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Regular Algebras›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Regular_Algebras
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Dioid_Power_Sum.html">Dioid_Power_Sum</a> <a href="../Kleene_Algebra/Finite_Suprema.html">Kleene_Algebra.Finite_Suprema</a> <a href="../Kleene_Algebra/Kleene_Algebra.html">Kleene_Algebra.Kleene_Algebra</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conway's Classical Axioms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Conway's classical axiomatisation of Regular Algebra from~\cite{Conway}.›</span></span>
 
<span class="keyword1"><span class="command">class</span></span> star_dioid <span class="main">=</span> dioid_one_zero <span class="main">+</span> star_op <span class="main">+</span> plus_ord

<span class="keyword1"><span class="command">class</span></span> conway_dioid <span class="main">=</span> star_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> C12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span><span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> strong_conway_dioid <span class="main">=</span> conway_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  C13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> C_algebra <span class="main">=</span> strong_conway_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We tried to dualise using sublocales, but this causes an infinite loop on dual.dual.dual....›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> conway_dioid<span class="main">)</span> C11_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 distrib_left mult.assoc mult_oner<span class="main">)</span>   
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span>  <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right mult.assoc mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C11 C12 mult_onel mult_oner<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> conway_dioid<span class="main">)</span> dual_conway_dioid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"class.conway_dioid <span class="main">(+)</span> <span class="main">(⊙)</span> <span class="main">1</span> <span class="main">0</span> <span class="main">(≤)</span> <span class="main">(&lt;)</span> star"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_oner opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_zerol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir times.opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> opp_mult_def distrib_right'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C11_var opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 mult.assoc opp_mult_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strong_conway_dioid<span class="main">)</span> dual_strong_conway_dioid<span class="main">:</span> <span class="quoted"><span class="quoted">"class.strong_conway_dioid <span class="main">(</span><span class="main">(+)</span> <span class="main">)</span> <span class="main">(</span><span class="main">(⊙)</span> <span class="main">)</span> <span class="main">1</span> <span class="main">0</span> <span class="main">(≤)</span> <span class="main">(&lt;)</span> star"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_oner opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_zerol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊙</span>  <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> opp_mult_def distrib_right'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C11_var opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C13<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Nitpick finds counterexamples to the following claims.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> conway_dioid<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span> <span class="main">[</span>expect<span class="main">=</span>genuine<span class="main">]</span> <span class="comment1">― ‹3-element counterexample›</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> conway_dioid<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span> <span class="main">[</span>expect<span class="main">=</span>genuine<span class="main">]</span> <span class="comment1">― ‹3-element counterexample›</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">context</span></span> C_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Regular_Algebras-C_unfoldl"><span class="command">lemma</span></span> C_unfoldl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span>  <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span>  <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 mult_onel mult_oner<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-C_slide"><span class="command">lemma</span></span> C_slide<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 mult_onel distrib_right'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left mult.assoc mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 mult.assoc mult_onel mult_oner<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-powsum_ub"><span class="command">lemma</span></span> powsum_ub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">i</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> <span class="quoted">"0.prems"</span> eq_iff le_0_eq power_0 powsum_00<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ff1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">∧</span> Suc <span class="skolem">n</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> aa1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> ff2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">∧</span> Suc <span class="skolem">n</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ff1 powsum2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">i</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps Suc.prems ff2 le_Suc_eq local.dual_order.trans local.join.le_supE<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">i</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.less_eq_def local.powsum_split_var2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-C14_aux"><span class="command">lemma</span></span> C14_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span>  <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="main">⋅</span>  <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span>  <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">-</span><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> le_add_diff_inverse2 power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">-</span><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span>  <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> C_slide ab_semigroup_add_class.add.commute power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assm le_add_diff_inverse ab_semigroup_add_class.add.commute power_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> dioid_one_zero
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Regular_Algebras-opp_power_def"><span class="command">lemma</span></span> opp_power_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"power.power <span class="main">1</span> <span class="main">(⊙)</span> <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power.power.power_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power.power.power_Suc power_Suc2 times.opp_mult_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-opp_powsum_def"><span class="command">lemma</span></span> opp_powsum_def<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dioid_one_zero.powsum <span class="main">(+)</span> <span class="main">(⊙)</span> <span class="main">1</span> <span class="main">0</span> <span class="free">x</span> <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>power.power <span class="main">1</span> <span class="main">(⊙)</span> <span class="free">x</span><span class="main">)</span> <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">}</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">(^)</span> <span class="free">x</span><span class="main">)</span> <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>opp_power_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dioid_one_zero.powsum_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span><span class="main"><span class="main">]</span></span> dual_dioid_one_zero powsum_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Regular_Algebras-C14_dual"><span class="command">lemma</span></span> C14_dual<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>C_algebra"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span>  <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> C14<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powsum_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le0 sum_interval_distl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum_interval_cong <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>C14_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_interval_distr<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> powsum_def Nat.add_0_right<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-C_algebra"><span class="command">lemma</span></span> C_algebra<span class="main">:</span> <span class="quoted"><span class="quoted">"class.C_algebra <span class="main">(+)</span> <span class="main">(⊙)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>C_algebra<span class="main">)</span> <span class="main">0</span> <span class="main">(≤)</span> <span class="main">(&lt;)</span> star"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C11_var opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C13<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> power.power <span class="main">1</span> <span class="main">(⊙)</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> dioid_one_zero.powsum <span class="main">(+)</span> <span class="main">(⊙)</span> <span class="main">1</span> <span class="main">0</span> <span class="skolem">x</span> <span class="main">0</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C14_dual opp_mult_def opp_power_def opp_powsum_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opp_mult_def mult.assoc distrib_left<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Boffa's Axioms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Boffa's two axiomatisations of Regular Algebra from~\cite{Boffa1,Boffa2}.›</span></span>

<span class="keyword1"><span class="command">class</span></span> B1_algebra <span class="main">=</span> conway_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> B2_algebra <span class="main">=</span> star_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B22 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> B1_algebra<span class="main">)</span> B1_algebra<span class="main">:</span>
  <span class="quoted"><span class="quoted">"class.B1_algebra <span class="main">(+)</span> <span class="main">(⊙)</span> <span class="main">1</span> <span class="main">0</span> <span class="main">(≤)</span> <span class="main">(&lt;)</span> star"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_oner opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_zerol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C11_var opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> R opp_mult_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> B2_algebra<span class="main">)</span> B2_algebra<span class="main">:</span>
  <span class="quoted"><span class="quoted">"class.B2_algebra <span class="main">(+)</span> <span class="main">(⊙)</span> <span class="main">1</span> <span class="main">0</span> <span class="main">(≤)</span> <span class="main">(&lt;)</span> star"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left times.opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_oner opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_zerol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B21<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B22 opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">;</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B23 opp_mult_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> B1_algebra <span class="main">⊆</span> B2_algebra 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 add_iso_r distrib_right join.sup.cobounded1 mult_onel<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> C11_var C12 R add_idem' mult_onel mult_oner<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">;</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> C11_var R two distrib_left join.sup.bounded_iff less_eq_def mult.assoc mult.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> B2_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Regular_Algebras-star_ref"><span class="command">lemma</span></span> star_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.B21 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Regular_Algebras-star_plus_one"><span class="command">lemma</span></span> star_plus_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_def star_ref<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_trans"><span class="command">lemma</span></span> star_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B22 order_refl<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_trans_eq"><span class="command">lemma</span></span> star_trans_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B22<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_invol"><span class="command">lemma</span></span> star_invol <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B21 B22 B23 antisym star_plus_one<span class="main">)</span>
 
<span class="keyword1" id="Regular_Algebras-star_1l"><span class="command">lemma</span></span> star_1l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.B21 local.join.sup.boundedE local.mult_isor local.star_trans_eq<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_one"><span class="command">lemma</span></span> star_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B23 add_idem antisym mult_oner order_refl star_ref<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_subdist"><span class="command">lemma</span></span> star_subdist<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.B21 local.B23 local.join.sup.bounded_iff local.star_trans_eq<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_iso"><span class="command">lemma</span></span> star_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_def star_subdist<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star2"><span class="command">lemma</span></span> star2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B21 add.commute less_eq_def star_invol star_subdist<span class="main">)</span> 

<span class="keyword1" id="Regular_Algebras-star_unfoldl"><span class="command">lemma</span></span> star_unfoldl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.join.sup.bounded_iff star_1l star_ref<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_unfoldr"><span class="command">lemma</span></span> star_unfoldr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> B21 local.join.sup.bounded_iff mult_isol star_trans_eq<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_ext"><span class="command">lemma</span></span> star_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B21 local.join.sup.bounded_iff<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_1r"><span class="command">lemma</span></span> star_1r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol star_ext star_trans_eq<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_unfoldl_eq"><span class="command">lemma</span></span> star_unfoldl_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc' add_idem' distrib_left mult.assoc mult_onel mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc add.commute distrib_left less_eq_def mult.assoc star_1l star_trans_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B23 local.join.sup.mono local.join.sup.cobounded1 distrib_left eq_iff mult_1_right star_plus_one star_unfoldl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-star_unfoldr_eq"><span class="command">lemma</span></span> star_unfoldr_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc add_idem' distrib_left mult_1_left mult_1_right mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc' distrib_left mult.assoc mult_oner distrib_right' star_trans_eq star_unfoldl_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B21 B23 add.commute local.join.sup.mono local.join.sup.cobounded1 eq_iff eq_refl mult_1_left distrib_right' star_unfoldl_eq star_unfoldr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>                                          

<span class="keyword1" id="Regular_Algebras-star_prod_unfold_le"><span class="command">lemma</span></span> star_prod_unfold_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span><span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc local.join.sup.cobounded1  distrib_left less_eq_def mult_1_right mult.assoc mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc  distrib_left distrib_right mult.assoc mult_oner star_trans_eq star_unfoldr_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.join.sup.cobounded2 mult_1_left mult.assoc mult_double_iso order_trans star_ref<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.B23<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-star_prod_unfold"><span class="command">lemma</span></span> star_prod_unfold <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.join.sup.mono mult_double_iso order_refl star_prod_unfold_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc distrib_left mult_1_left mult.assoc distrib_right'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc distrib_left mult_1_right mult.assoc star_unfoldl_eq star_unfoldr_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym star_prod_unfold_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-star_slide1"><span class="command">lemma</span></span> star_slide1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel distrib_right'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left mult.assoc mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl mult.assoc star_unfoldr_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-star_slide_var1"><span class="command">lemma</span></span> star_slide_var1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel mult_oner star_slide1<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_slide"><span class="command">lemma</span></span> star_slide<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_slide1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left mult.assoc mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel distrib_right'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor star_unfoldl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-star_rtc1"><span class="command">lemma</span></span> star_rtc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.B21 local.join.sup_least local.star_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Regular_Algebras-star_rtc1_eq"><span class="command">lemma</span></span> star_rtc1_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B21 B22 less_eq_def<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_subdist_var_1"><span class="command">lemma</span></span> star_subdist_var_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.join.le_supE local.star_ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Regular_Algebras-star_subdist_var_2"><span class="command">lemma</span></span> star_subdist_var_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> local.join.le_supE mult_isol_var star_ext star_trans_eq<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_subdist_var_3"><span class="command">lemma</span></span> star_subdist_var_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute mult_isol_var star_subdist star_trans_eq<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-R_lemma"><span class="command">lemma</span></span> R_lemma<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B21<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add_idem' add.left_commute assms distrib_left mult_onel mult_oner distrib_right'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B23 order_refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-star_denest_var_0"><span class="command">lemma</span></span> star_denest_var_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> one_below<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol_var star_one star_ref star_trans_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> x_below<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol mult_oner order_trans star_ext star_ref star_slide<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> y_below<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol_var mult_onel mult_oner order_trans star_ext star_slide star_unfoldl_eq subdistl<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> one_below x_below y_below <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_trans_eq star_slide mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B23 add_assoc' mult.assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> add.commute mult_isol_var star_invol star_iso star_subdist_var_1 star_trans_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-star_denest"><span class="command">lemma</span></span> star_denest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> R_lemma add.commute star_denest_var_0 star_plus_one star_prod_unfold star_slide star_trans_eq<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_sum_var"><span class="command">lemma</span></span> star_sum_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>  <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_denest star_invol<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_denest_var"><span class="command">lemma</span></span> star_denest_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_denest_var_0 star_slide<span class="main">)</span> 

<span class="keyword1" id="Regular_Algebras-star_denest_var_2"><span class="command">lemma</span></span> star_denest_var_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_denest star_denest_var<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_denest_var_3"><span class="command">lemma</span></span> star_denest_var_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B22 add_comm mult.assoc star_denest star_denest_var_2<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_denest_var_4"><span class="command">lemma</span></span> star_denest_var_4<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_comm star_denest<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_denest_var_5"><span class="command">lemma</span></span> star_denest_var_5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute star_denest_var<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_denest_var_6"><span class="command">lemma</span></span> star_denest_var_6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc star_denest star_denest_var_3<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_denest_var_7"><span class="command">lemma</span></span> star_denest_var_7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_denest star_denest_var star_denest_var_3 star_denest_var_5 star_slide<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_denest_var_8"><span class="command">lemma</span></span> star_denest_var_8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_denest star_denest_var_6<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_denest_var_9"><span class="command">lemma</span></span> star_denest_var_9<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_denest star_denest_var_7<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_slide_var"><span class="command">lemma</span></span> star_slide_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_left mult_oner star_slide<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_sum_unfold"><span class="command">lemma</span></span> star_sum_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left mult_1_right mult.assoc star_denest_var star_unfoldl_eq<span class="main">)</span> 

<span class="keyword1" id="Regular_Algebras-troeger"><span class="command">lemma</span></span> troeger<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_comm distrib_left mult.assoc distrib_right'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_sum_unfold<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-meyer_1"><span class="command">lemma</span></span> meyer_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc mult_onel distrib_right'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> combine_common_factor distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc add_idem' mult.assoc star_slide star_trans_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_unfoldl_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_comm add_idem' add.left_commute star_unfoldl_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_left distrib_right'<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_right star_unfoldl_eq subdistl<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B23 mult.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_left distrib_right'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_zeror local.join.sup_least local.mult_isol_var local.mult_oner local.star_ext local.star_invol local.star_iso local.star_subdist_var_2 local.star_trans_eq local.subdistl_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-star_zero"><span class="command">lemma</span></span> star_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_zeror star2 star_one<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_subsum"><span class="command">lemma</span></span> star_subsum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc add_idem star_slide_var star_unfoldl_eq<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-prod_star_closure"><span class="command">lemma</span></span> prod_star_closure<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol_var star_trans_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> B2_algebra <span class="main">⊆</span> B1_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> star_denest_var_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_prod_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> R_lemma<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> B2_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Regular_Algebras-power_le_star"><span class="command">lemma</span></span> power_le_star<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_ref prod_star_closure star_ext<span class="main">)</span> 

<span class="keyword1" id="Regular_Algebras-star_power_slide"><span class="command">lemma</span></span> star_power_slide<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">k</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">k</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">k</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">-</span><span class="free">k</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">k</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> le_add_diff_inverse2 power_add star_slide<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> le_add_diff_inverse2 ab_semigroup_add_class.add.commute power_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-powsum_le_star"><span class="command">lemma</span></span> powsum_le_star<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="free">m</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  powsum2<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> power_le_star<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span>  power_Suc power_le_star<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-star_sum_power_slide"><span class="command">lemma</span></span> star_sum_power_slide<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span>  </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel mult_oner powsum_00<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> hyp <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span></sup><span class="hidden">⇖</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>powsum2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps Suc.prems Suc_leD<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems star_power_slide<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>powsum2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-aarden_aux"><span class="command">lemma</span></span> aarden_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">+</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> One_nat_def add.commute add_iso mult_1_right power_one_right star_plus_one subdistl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc add_iso mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> distrib_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_assoc' distrib_left mult.assoc mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute assms mult.assoc order_trans power_Suc2 star_unfoldr_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-conway_powerstar1"><span class="command">lemma</span></span> conway_powerstar1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>  <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span>  <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> mult.assoc star_sum_power_slide<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_trans_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">=</span>  <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">+</span><span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc powsum_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="skolem">m</span> <span class="main">+</span> <span class="numeral">2</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoid_add_class.add.left_neutral powsum_split_var3 add_2_eq_Suc'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">+</span> <span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powsum_shift<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> mult.assoc<span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">+</span>  <span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span></sup><span class="hidden">⇖</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>powsum2<span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc add.commute add.left_commute distrib_left mult.assoc<span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem' distrib_right' star_subsum<span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span> </sup><span class="hidden">⇖</span><span class="main">+</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem' distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>powsum2<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-conway_powerstar2"><span class="command">lemma</span></span> conway_powerstar2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"0"</span> local.B21 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 powsum_ext  mult_isor mult_onel order_trans star_ref<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="skolem">m</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 local.join.le_supE mult_isor mult_onel powsum_split_var1 star_ref<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> one two <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc Suc_eq_plus1 add_2_eq_Suc' local.join.sup_least<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> powerstar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conway_powerstar1 conway_powerstar2 mult.assoc B23<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor power_le_star star_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_invol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.prod_star_closure powsum_le_star<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span><span class="main">+</span><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="hidden">⇗</span><sup><span class="free">n</span> </sup><span class="hidden">⇖</span><span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_trans_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> B2_algebra <span class="main">⊆</span> strong_conway_dioid  
  <span class="keyword1"><span class="command">by</span></span>  <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> star_invol<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> B2_algebra <span class="main">⊆</span> C_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> powerstar<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following fact could neither be verified nor falsified in Isabelle. It does not hold for other reasons.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> C_algebra<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">+</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Boffa Monoid Identities›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> boffa_mon <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">f</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>monoid_mult<span class="main">}</span>  <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>B1_algebra<span class="main">.</span> True<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">notation</span></span>
  Rep_boffa_mon <span class="main">(</span><span class="quoted">"_<span class="keyword1">⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>range <span class="main">(</span>Rep_boffa_mon <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_code finite_imageI<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">boffa_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> boffa_mon <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>monoid_mult<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>B1_algebra"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">boffa_pair</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span> <span class="main">∑</span> <span class="main">{</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">k</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">⋅</span><span class="bound">k</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  boffa_pair <span class="main">(</span><span class="quoted">"_<span class="keyword1">⇘</span>_<span class="keyword1">,</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">conway_assms</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">conway_assms</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="hidden">⇘</span><sub><span class="bound">i</span> </sub><span class="hidden">⇙</span><span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">⋅</span><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">,</span><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">,</span><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Regular_Algebras-pair_one"><span class="command">lemma</span></span> pair_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span><span class="main">,</span><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conway_assm1</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">conway_assm1</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="hidden">⇘</span><sub><span class="bound">i</span> </sub><span class="hidden">⇙</span><span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">⋅</span><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conway_assm2</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">conway_assm2</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">,</span><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">,</span><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Regular_Algebras-pair_star"><span class="command">lemma</span></span> pair_star<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conway_assm2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span><span class="main">,</span><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span><span class="main">,</span><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> conway_assm2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-conway_monoid_one"><span class="command">lemma</span></span> conway_monoid_one<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conway_assm2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pair_star<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_plus_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-conway_monoid_split"><span class="command">lemma</span></span> conway_monoid_split<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conway_assm2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span> </sub><span class="hidden">⇙</span><span class="main">|</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span> </sub><span class="hidden">⇙</span><span class="main">|</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span> </sub><span class="hidden">⇙</span><span class="main">|</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">=</span> <span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span> </sub><span class="hidden">⇙</span><span class="main">|</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="main">1</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I insert_Diff_single insert_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">∑</span> <span class="main">(</span>Rep_boffa_mon <span class="free">x</span> <span class="main">`</span> <span class="main">(</span>insert <span class="main">1</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fset_to_im<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">+</span> <span class="main">∑</span> <span class="main">(</span>Rep_boffa_mon <span class="free">x</span> <span class="main">`</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_fun_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">+</span> <span class="main">∑</span> <span class="main">{</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fset_to_im<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> unfld<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">+</span> <span class="main">∑</span> <span class="main">{</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> conway_monoid_one<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> unfld<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-boffa_mon_aux1"><span class="command">lemma</span></span> boffa_mon_aux1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">⋅</span><span class="bound">j</span> </sub><span class="hidden">⇙</span><span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV <span class="main">∧</span> <span class="bound">j</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> monoid_mult_class.mult.left_neutral<span class="main">)</span>

<span class="keyword1" id="Regular_Algebras-sum_intro'"><span class="command">lemma</span></span> sum_intro' <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="main">(</span><span class="free">A</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>join_semilattice_zero set<span class="main">)</span><span class="main">;</span> finite <span class="free">B</span><span class="main">;</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∑</span><span class="free">A</span> <span class="main">≤</span> <span class="main">∑</span><span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sum_intro<span class="main">)</span>  

<span class="keyword1" id="Regular_Algebras-boffa_aux2"><span class="command">lemma</span></span> boffa_aux2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"conway_assm1 <span class="free">x</span> <span class="main">⟹</span>
  <span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">⋅</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span> </sub><span class="hidden">⇙</span><span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV <span class="main">∧</span> <span class="bound">j</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">≤</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">⋅</span><span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV <span class="main">∧</span> <span class="bound">j</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conway_assm1_def
  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_Collect<span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Regular_Algebras-boffa_aux3"><span class="command">lemma</span></span> boffa_aux3<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conway_assm1 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span> </sub><span class="hidden">⇙</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV <span class="main">∧</span> <span class="bound">j</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span> </sub><span class="hidden">⇙</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV <span class="main">∧</span> <span class="bound">j</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">⋅</span><span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV <span class="main">∧</span> <span class="bound">j</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add_iso_r<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> boffa_aux2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> add_idem boffa_mon_aux1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebras-conway_monoid_identity"><span class="command">lemma</span></span> conway_monoid_identity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conway_assm1 <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"conway_assm2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> conway_monoid_split<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> calculation less_eq_def mult_isol mult_isol_equiv_subdistl mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span> </sub><span class="hidden">⇙</span><span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>UNIV <span class="main">∧</span> <span class="bound">j</span><span class="main">∈</span>UNIV<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dioid_sum_prod finite_UNIV<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">⋅</span> <span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">=</span> <span class="main">∑</span> <span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">⋅</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">+</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV <span class="main">∧</span> <span class="bound">j</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">R</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">⋅</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">R</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">=</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">R</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> boffa_aux3 conway_monoid_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">+</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">⋅</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV <span class="main">∧</span> <span class="bound">j</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">=</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> one B1_algebra_class.R star_trans_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conway's Conjectures›</span></span>

<span class="keyword1"><span class="command">class</span></span> C0_algebra <span class="main">=</span> strong_conway_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C0<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> C1l_algebra <span class="main">=</span> strong_conway_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C1l<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> C1r_algebra <span class="main">=</span> strong_conway_dioid <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> C1r<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> C2l_algebra <span class="main">=</span> conway_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C2l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> C2r_algebra <span class="main">=</span> conway_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C2r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> C3l_algebra <span class="main">=</span> conway_dioid <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> C3l<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> C3r_algebra <span class="main">=</span> conway_dioid <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> C3r<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> C1r_algebra <span class="main">⊆</span> dual<span class="main">:</span> C1l_algebra
  <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊙)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_oner opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_zerol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C11_var opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C13<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C1r opp_mult_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> C2r_algebra <span class="main">⊆</span> dual<span class="main">:</span> C2l_algebra
  <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊙)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_oner opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_zerol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C11_var opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C2r opp_mult_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> C3r_algebra <span class="main">⊆</span> dual<span class="main">:</span> C3l_algebra
  <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊙)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_oner opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_zerol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C11_var opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C3r opp_mult_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> C3l_algebra<span class="main">)</span> k2_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.C3l local.join.le_supE local.join.sup.absorb2 local.subdistl<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> C2l_algebra <span class="main">⊆</span> B1_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> C2l monoid_mult_class.mult.left_neutral mult_oner conway_dioid_class.C12<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> C2r_algebra <span class="main">⊆</span>  B1_algebra 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> C2r conway_dioid_class.C12<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following claims are refuted by Nitpick›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> conway_dioid<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="comment1">(*  nitpick [expect=genuine] -- "3-element counterexample"*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> conway_dioid<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="comment1">(*  nitpick [expect=genuine] -- "3-element counterexample"*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following fact could not be refuted by Nitpick or Quickcheck; but an infinite counterexample exists.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> B1_algebra<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">⟶</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">instance</span></span> C3l_algebra <span class="main">⊆</span> C2l_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> C3l conway_dioid_class.C12 dual_order.antisym join.sup.cobounded1 mult_isol_var mult_onel order_refl<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C2l_algebra <span class="main">⊆</span> C3l_algebra  
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_def mult_onel distrib_right'<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C2l<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C11 C2l add_comm mult_1_left mult_1_right<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> C1l_algebra <span class="main">⊆</span> C3l_algebra  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span>  mult_oner C1l C12 C13 add_zeror annir<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C3l_algebra <span class="main">⊆</span> C1l_algebra  
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.C11_var local.C12 local.C3l local.eq_iff local.eq_refl local.join.sup.absorb2 local.join.sup_ge1 local.mult_onel local.mult_oner<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C12 mult_isol mult_oner order_prop<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">⋅</span><span class="skolem">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.C12 local.join.sup_commute local.mult_onel local.mult_oner local.subdistl mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r1<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> k2_var mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> C1l_algebra <span class="main">⊆</span> C2l_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> C12 C3l add.commute  local.join.sup.cobounded1 distrib_right less_eq_def mult_1_left order_refl<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C3r_algebra <span class="main">⊆</span> C2r_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> C12 C3r add.commute  local.join.sup.cobounded1 distrib_left less_eq_def mult_1_right order_refl<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C2r_algebra <span class="main">⊆</span> C3r_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> dual.C3l opp_mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C1r_algebra <span class="main">⊆</span> C3r_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> dual.C3l opp_mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C3r_algebra <span class="main">⊆</span> C1r_algebra 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> dual.C13<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> dual.C1l opp_mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> C1_algebra <span class="main">=</span> C1l_algebra <span class="main">+</span> C1r_algebra

<span class="keyword1"><span class="command">class</span></span> C2_algebra <span class="main">=</span> C2l_algebra <span class="main">+</span> C2r_algebra

<span class="keyword1"><span class="command">class</span></span> C3_algebra <span class="main">=</span> C3l_algebra <span class="main">+</span> C3r_algebra

<span class="keyword1"><span class="command">sublocale</span></span> C0_algebra <span class="main">⊆</span> C2_algebra  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> C12 C13 add_zeror annil mult_oner mult_onel C0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> C2_algebra <span class="main">⊆</span> C0_algebra  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> C1l C1r eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C2_algebra <span class="main">⊆</span> C1_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> C1_algebra <span class="main">⊆</span> C2_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> C2_algebra <span class="main">⊆</span> C3_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> C3_algebra <span class="main">⊆</span> C2_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Kozen's Kleene Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Kozen's Kleene Algebras~\cite{Kozen,Kozensemi}.›</span></span>

<span class="keyword1"><span class="command">class</span></span> Kl_base <span class="main">=</span> star_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Kl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> Kr_base <span class="main">=</span> star_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Kr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> K1l_algebra <span class="main">=</span> Kl_base <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> K1r_algebra <span class="main">=</span> Kr_base <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_inductr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> K2l_algebra <span class="main">=</span> Kl_base <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_inductl_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> K2r_algebra <span class="main">=</span> Kr_base <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_inductr_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> K1_algebra <span class="main">=</span> K1l_algebra <span class="main">+</span> K1r_algebra

<span class="keyword1"><span class="command">class</span></span> K2_algebra <span class="main">=</span> K2l_algebra <span class="main">+</span> K2r_algebra

<span class="keyword1"><span class="command">sublocale</span></span> K1r_algebra <span class="main">⊆</span> dual<span class="main">:</span> K1l_algebra
  <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊙)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_oner opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_zerol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Kr opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_inductr opp_mult_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> K1l_algebra <span class="main">⊆</span> B2_algebra
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_iso_r  local.join.sup.cobounded1 mult_isol mult_oner order_trans Kl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.Kl local.eq_iff local.phl_cons1 local.star_inductl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">;</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.distrib_right' local.join.le_sup_iff local.join.sup.order_iff local.mult_isol local.mult_oner local.star_inductl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> K1r_algebra <span class="main">⊆</span> B2_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> dual.B21 dual.B22 dual.B23 opp_mult_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> K1l_algebra <span class="main">⊆</span> C2l_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> less_eq_def mult_1_left mult.assoc star_inductl star_invol star_one star_plus_one star_trans_eq troeger<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C2l_algebra <span class="main">⊆</span> K1l_algebra 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> C12 eq_iff mult_1_left mult_1_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> C3l<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> K1r_algebra <span class="main">⊆</span> C2r_algebra
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> dual.C2l opp_mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C2r_algebra <span class="main">⊆</span> K1r_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> dual.star_unfoldl opp_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> C3r<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> K1_algebra <span class="main">⊆</span> C0_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> C1l C1r eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C0_algebra <span class="main">⊆</span> K1l_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> K2r_algebra <span class="main">⊆</span> dual<span class="main">:</span> K2l_algebra
  <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊙)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_oner opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_zerol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> opp_mult_def Kr<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> opp_mult_def star_inductr_var<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> K1l_algebra <span class="main">⊆</span> K2l_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> local.join.le_supE  star_inductl order_prop subdistl<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> K2l_algebra <span class="main">⊆</span> K1l_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.star_inductl_var<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> K1r_algebra <span class="main">⊆</span> K2r_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> dual.star_inductl_var opp_mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> K2r_algebra <span class="main">⊆</span> K1r_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> dual.star_inductl opp_mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> kleene_algebra <span class="main">⊆</span> K1_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_unfoldl<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_inductl_var<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_unfoldr<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_inductr_var<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> K1_algebra <span class="main">⊆</span> K2_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> K2_algebra <span class="main">⊆</span> koz<span class="main">:</span> kleene_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Kl<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_inductl_var<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_inductr_var<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Salomaa's Axioms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Salomaa's axiomatisations of Regular Algebra~\cite{Salomaa}.›</span></span>

<span class="keyword1"><span class="command">class</span></span> salomaa_base <span class="main">=</span> star_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">ewp</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> S11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  EWP <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ewp</span> <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">ewp</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> Sr_algebra <span class="main">=</span> salomaa_base <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S12r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Ar <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> ewp <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following claim is ruled out by Nitpick. The unfold law cannot be weakened as in Kleene algebra.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> salomaa_base<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> S12r'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Ar' <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> ewp <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="comment1">(*nitpick [expect=genuine] -- "4-element counterexample"*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">class</span></span> Sl_algebra <span class="main">=</span> salomaa_base <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S12l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Al <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> ewp <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">⋅</span><span class="free">x</span><span class="main">+</span><span class="free">z</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">z</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> S_algebra <span class="main">=</span> Sl_algebra <span class="main">+</span> Sr_algebra

<span class="keyword1"><span class="command">sublocale</span></span> Sl_algebra <span class="main">⊆</span> dual<span class="main">:</span> Sr_algebra
  <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊙)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span> <span class="quoted"><span class="quoted">"ewp"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_left opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_oner opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_zerol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir times.opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> opp_mult_def distrib_right'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊙</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> S11<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ewp <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> ewp <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> EWP<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> S12l opp_mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> ewp <span class="skolem">y</span><span class="main">;</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">⊙</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> opp_mult_def Al<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> Sr_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Regular_Algebras-kozen_induct_r"><span class="command">lemma</span></span> kozen_induct_r<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ewp <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute assms local.Ar local.join.le_supE local.join.sup.orderE local.mult_isor<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ewp <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> assm1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> assm2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ewp <span class="skolem">x'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> EWP<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> S11 local.join.le_supE assm1 assm2 assms eq_iff less_eq_def Ar subdistl<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.join.sup.cobounded1 local.mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> Sl_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Regular_Algebras-kozen_induct_l"><span class="command">lemma</span></span> kozen_induct_l<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual.kozen_induct_r times.opp_mult_def assms<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> Sr_algebra <span class="main">⊆</span> K2r_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> S12r order_refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_comm kozen_induct_r<span class="main">)</span> 

<span class="keyword1"><span class="command">sublocale</span></span> Sr_algebra <span class="main">⊆</span> K1r_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> Sl_algebra <span class="main">⊆</span> K2l_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> S12l order_refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_comm kozen_induct_l<span class="main">)</span> 

<span class="keyword1"><span class="command">sublocale</span></span> Sl_algebra <span class="main">⊆</span> K1l_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> S_algebra <span class="main">⊆</span> K1_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> S_algebra <span class="main">⊆</span> K2_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following claim could be refuted.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> K2_algebra<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">1</span> <span class="main">≤</span>  <span class="free">x</span><span class="main">)</span> <span class="main">⟶</span>  <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">class</span></span> salomaa_conj_r <span class="main">=</span> salomaa_base <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> salomaa_small_unfold<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> salomaa_small_r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> ewp <span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="main">1</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> Sr_algebra <span class="main">⊆</span> salomaa_conj_r
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> S12r<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> mult_onel Ar<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> salomaa_conj_r<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> ewp <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="comment1">(*nitpick [expect=genuine] -- "3-element counterexample"*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Regular_Algebra_Models">
<div class="head">
<h1>Theory Regular_Algebra_Models</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Regular Algebras
   Author:     Simon Foster, Georg Struth
   Maintainer: Simon Foster &lt;s.foster at york.ac.uk&gt;
               Georg Struth &lt;g.struth at sheffield.ac.uk&gt;               
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Models of Regular Algebra›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Regular_Algebra_Models
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Regular_Algebras.html">Regular_Algebras</a> <a href="../Kleene_Algebra/Kleene_Algebra_Models.html">Kleene_Algebra.Kleene_Algebra_Models</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Language Model of Salomaa Algebra›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">w_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> nat"</span></span> <span class="main">(</span> <span class="quoted">"<span class="keyword1">|</span>_<span class="keyword1">|</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">|</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">|</span></span> <span class="main">≡</span> length <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">l_ewp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lan <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">l_ewp</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟷</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> lan_kozen<span class="main">:</span> K2_algebra <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> lan"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> lan_boffa<span class="main">:</span> B1_algebra <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> lan"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Regular_Algebra_Models-length_lang_pow_lb"><span class="command">lemma</span></span> length_lang_pow_lb<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">|</span><span class="bound">x</span><span class="main">|</span> <span class="main">≥</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">^</span><span class="free">n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span><span class="main">|</span> <span class="main">≥</span> <span class="free">k</span><span class="main">*</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">note</span></span> hyp <span class="main">=</span> this
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">@</span><span class="bound">z</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">X</span><span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>c_prod_def times_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> hyp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">@</span><span class="bound">z</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">y</span><span class="main">|</span> <span class="main">≥</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">z</span><span class="main">|</span> <span class="main">≥</span> <span class="free">k</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">@</span><span class="bound">z</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">y</span><span class="main">|</span> <span class="main">≥</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">z</span><span class="main">|</span> <span class="main">≥</span> <span class="free">k</span><span class="main">*</span><span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span> <span class="main">|</span><span class="skolem">x</span><span class="main">|</span> <span class="main">=</span> <span class="main">|</span><span class="bound">y</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span><span class="bound">z</span><span class="main">|</span> <span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">@</span><span class="bound">z</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">y</span><span class="main">|</span> <span class="main">≥</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">z</span><span class="main">|</span> <span class="main">≥</span> <span class="free">k</span><span class="main">*</span><span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span> <span class="main">|</span><span class="skolem">x</span><span class="main">|</span> <span class="main">≥</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span> <span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_mono mult.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 hyp<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebra_Models-l_prod_elim"><span class="command">lemma</span></span> l_prod_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main">∈</span><span class="free">X</span> <span class="main">⋅</span> <span class="free">Y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">u</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> <span class="bound">u</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∈</span><span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_prod_def times_list_def<span class="main">)</span>

<span class="keyword1" id="Regular_Algebra_Models-power_minor_var"><span class="command">lemma</span></span> power_minor_var<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">k</span><span class="main">≤</span><span class="main">|</span><span class="bound">w</span><span class="main">|</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="free">n</span><span class="main">*</span><span class="free">k</span><span class="main">≤</span><span class="main">|</span><span class="bound">w</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_prod_elim<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> length_lang_pow_lb trans_le_add2
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_lang_pow_lb trans_le_add2 mult.commute<span class="main">)</span>
 
<span class="keyword1" id="Regular_Algebra_Models-power_lb"><span class="command">lemma</span></span> power_lb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">k</span><span class="main">≤</span><span class="main">|</span><span class="bound">w</span><span class="main">|</span> <span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span><span class="main">∈</span><span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⟶</span> <span class="free">n</span><span class="main">*</span><span class="free">k</span><span class="main">≤</span><span class="main">|</span><span class="bound">w</span><span class="main">|</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power_minor_var<span class="main">)</span>

<span class="keyword1" id="Regular_Algebra_Models-prod_lb"><span class="command">lemma</span></span> prod_lb<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> length <span class="bound">w</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="free">n</span> <span class="main">≤</span> length <span class="bound">w</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="main">(</span><span class="free">X</span><span class="main">⋅</span><span class="free">Y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">≤</span> length <span class="bound">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> l_prod_elim add_le_mono length_append<span class="main">)</span> 

<span class="keyword1" id="Regular_Algebra_Models-suicide_aux_l"><span class="command">lemma</span></span> suicide_aux_l<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">0</span><span class="main">≤</span>length <span class="bound">w</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="free">n</span> <span class="main">≤</span> length <span class="bound">w</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">Y</span><span class="main">.</span> <span class="free">n</span> <span class="main">≤</span> length <span class="bound">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> l_prod_elim<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ua</span> <span class="main">@</span> <span class="improper">va</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_prod_elim<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Regular_Algebra_Models-suicide_aux_r"><span class="command">lemma</span></span> suicide_aux_r<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">0</span><span class="main">≤</span>length <span class="bound">w</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="free">n</span> <span class="main">≤</span> length <span class="bound">w</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">Y</span> <span class="main">⋅</span> <span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">.</span> <span class="free">n</span> <span class="main">≤</span> length <span class="bound">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> le0 plus_nat.add_0 prod_lb<span class="main">)</span>

<span class="keyword1" id="Regular_Algebra_Models-word_suicide_l"><span class="command">lemma</span></span> word_suicide_l<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> l_ewp <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">w</span><span class="main">∉</span><span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="bound">n</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">0</span><span class="main">≤</span>length <span class="bound">v</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">1</span><span class="main">≤</span>length <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_ewp_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> le_0_eq length_0_conv not_less_eq_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">w</span><span class="main">∉</span><span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="bound">n</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_mult_1_right power_lb suicide_aux_l le0 Suc_n_not_le_n<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Regular_Algebra_Models-word_suicide_r"><span class="command">lemma</span></span> word_suicide_r<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> l_ewp <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">w</span><span class="main">∉</span><span class="free">Y</span> <span class="main">⋅</span> <span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">0</span><span class="main">≤</span>length <span class="bound">v</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">1</span><span class="main">≤</span>length <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_ewp_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> le_0_eq length_0_conv not_less_eq_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">w</span><span class="main">∉</span><span class="free">Y</span> <span class="main">⋅</span> <span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="bound">n</span> </sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_mult_1_right power_lb suicide_aux_r le0 Suc_n_not_le_n<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Regular_Algebra_Models-word_suicide_lang_l"><span class="command">lemma</span></span> word_suicide_lang_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> l_ewp <span class="free">X</span><span class="main">;</span> <span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">Y</span> <span class="main">≤</span> <span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="bound">n</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Set.set_eqI empty_iff in_mono word_suicide_l<span class="main">)</span>

<span class="keyword1" id="Regular_Algebra_Models-word_suicide_lang_r"><span class="command">lemma</span></span> word_suicide_lang_r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> l_ewp <span class="free">X</span><span class="main">;</span> <span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">Y</span> <span class="main">≤</span> <span class="free">Y</span> <span class="main">⋅</span> <span class="free">X</span><span class="hidden">⇗</span><sup>Suc <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Set.set_eqI empty_iff in_mono word_suicide_r<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹These duality results cannot be relocated easily›</span></span>

<span class="keyword1"><span class="command">context</span></span> K1_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Regular_Algebra_Models-power_dual_transfer"><span class="command">lemma</span></span> power_dual_transfer <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"power.power <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(⊙)</span> <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span><span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> opp_mult_def power_commutes<span class="main">)</span>

<span class="keyword1" id="Regular_Algebra_Models-aarden_aux_l"><span class="command">lemma</span></span> aarden_aux_l<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span>  <span class="free">x</span><span class="hidden">⇗</span><sup>Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dual.aarden_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>opp_mult_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Regular_Algebra_Models-arden_l"><span class="command">lemma</span></span> arden_l<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> l_ewp <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">⋅</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> join_semilattice_class.add_comm left_near_kleene_algebra_class.star_inductl_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">z</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> assms'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="hidden">⇗</span><sup>Suc <span class="bound">n</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> kleene_algebra_class.aarden_aux_l subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">x</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">y</span><span class="hidden">⇗</span><sup>Suc <span class="bound">n</span> </sup><span class="hidden">⇖</span><span class="main">⋅</span> <span class="free">x</span> <span class="main">∨</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> all_not_in_conv assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subsetI word_suicide_l<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebra_Models-arden_r"><span class="command">lemma</span></span> arden_r<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> l_ewp <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> join.sup_commute kleene_algebra_class.star_inductr_var order_refl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> assms'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="hidden">⇗</span><sup>Suc <span class="bound">n</span></sup><span class="hidden">⇖</span> <span class="main">+</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> kleene_algebra_class.aarden_aux subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">x</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="hidden">⇗</span><sup>Suc <span class="bound">n</span></sup><span class="hidden">⇖</span> <span class="main">∨</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> all_not_in_conv assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subsetI word_suicide_r<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following two facts provide counterexamples to Arden's rule if the empty word property is not considered.›</span></span>

<span class="keyword1" id="Regular_Algebra_Models-arden_l_counter"><span class="command">lemma</span></span> arden_l_counter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> lan<span class="main">)</span> <span class="main">(</span><span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> lan<span class="main">)</span> <span class="main">(</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span> lan<span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> lan<span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab_near_semiring_one_class.mult_onel kleene_algebra_class.dual.add_zerol<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> lan<span class="main">)</span> <span class="main">≠</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> list set<span class="main">)</span> <span class="main">≠</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> list set<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kleene_algebra_class.dual.annir kleene_algebra_class.dual.mult.right_neutral<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> list set<span class="main">)</span> <span class="main">≠</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> one <span class="keyword2"><span class="keyword">and</span></span> two
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kleene_algebra_class.dual.add_zerol kleene_algebra_class.dual.add_zeror<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Regular_Algebra_Models-arden_r_counter"><span class="command">lemma</span></span> arden_r_counter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> lan<span class="main">)</span> <span class="main">(</span><span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> lan<span class="main">)</span> <span class="main">(</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span> lan<span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> lan<span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab_near_semiring_one_class.mult_onel kleene_algebra_class.dual.add_zerol<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> lan<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⋅</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> list set<span class="main">)</span> <span class="main">≠</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> list set<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kleene_algebra_class.dual.annir kleene_algebra_class.dual.mult.right_neutral<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> list set<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⋅</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> one <span class="keyword2"><span class="keyword">and</span></span> two
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kleene_algebra_class.dual.add_zerol kleene_algebra_class.dual.add_zeror<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> lan_salomaa_l<span class="main">:</span> Sl_algebra <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> lan"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span> <span class="quoted"><span class="quoted">"l_ewp"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lan"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kleene_algebra_class.dual.star2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"l_ewp <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> l_ewp <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>l_ewp_def one_set_def one_list_def plus_set_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> insertCI mk_disjoint_insert<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kleene_algebra_class.star_unfoldl_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> l_ewp <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arden_l<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> lan_salomaa_r<span class="main">:</span> Sr_algebra <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> lan"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"star"</span></span> <span class="quoted"><span class="quoted">"l_ewp"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lan"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kleene_algebra_class.star_unfoldr_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> l_ewp <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arden_r<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Regular Language Model of Salomaa Algebra›</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  Atom <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">⟩</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Plus <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Star <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup><span class="hidden">⇩</span><sub>r</sub></span>"</span> <span class="main">[</span>101<span class="main">]</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Zero <span class="main">(</span><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  One <span class="main">(</span><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>r</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rexp_ewp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rexp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rexp_ewp</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rexp_ewp</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rexp_ewp</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⟩</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rexp_ewp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">rexp_ewp</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∨</span> <span class="free">rexp_ewp</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rexp_ewp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">rexp_ewp</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="free">rexp_ewp</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rexp_ewp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup><span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ro</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>rexp_ewp <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">else</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> r_ewp <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> reg_lan <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"l_ewp"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> r_lang <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rexp <span class="main">⇒</span> <span class="tfree">'a</span> reg_lan"</span></span>  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"lang"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">r_sim</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rexp <span class="main">⇒</span> <span class="tfree">'a</span> rexp <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">∼</span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> r_lang <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> r_lang <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> Rep_reg_lan <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> Rep_reg_lan_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> Abs_reg_lan_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1" id="Regular_Algebra_Models-rexp_ewp_l_ewp"><span class="command">lemma</span></span> rexp_ewp_l_ewp<span class="main">:</span> <span class="quoted"><span class="quoted">"l_ewp <span class="main">(</span>lang <span class="free">x</span><span class="main">)</span> <span class="main">=</span> rexp_ewp <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Star <span class="skolem">x</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> lan_salomaa_l.EWP left_near_kleene_algebra_class.star_plus_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>l_ewp_def zero_set_def one_set_def one_list_def plus_set_def c_prod_def times_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> regexp_ewp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> P_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="free">t</span><span class="main">)</span> <span class="main">≡</span> <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="free">t</span> <span class="main">∼</span> ro<span class="main">(</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">t'</span> <span class="main">∧</span> ro<span class="main">(</span><span class="bound">t'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>P_def r_lang_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="main">⟨</span><span class="skolem">a</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>P_def r_lang_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">a</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>P_def r_lang_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="skolem">t1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="skolem">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1'</span></span> <span class="skolem"><span class="skolem">t2'</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∼</span> ro<span class="main">(</span><span class="skolem">t1</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t1'</span>"</span></span> <span class="quoted"><span class="quoted">"ro<span class="main">(</span><span class="skolem">t1'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∼</span> ro<span class="main">(</span><span class="skolem">t2</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2'</span>"</span></span> <span class="quoted"><span class="quoted">"ro<span class="main">(</span><span class="skolem">t2'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms rexp.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="skolem">t1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> P_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t1'</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="improper">t2'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.left_commute join.sup_assoc join.sup_left_idem rexp.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="skolem">t1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="skolem">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1'</span></span> <span class="skolem"><span class="skolem">t2'</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> t1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∼</span> ro<span class="main">(</span><span class="skolem">t1</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t1'</span>"</span></span> <span class="quoted"><span class="quoted">"ro<span class="main">(</span><span class="skolem">t1'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          t2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∼</span> ro<span class="main">(</span><span class="skolem">t2</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2'</span>"</span></span> <span class="quoted"><span class="quoted">"ro<span class="main">(</span><span class="skolem">t2'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms rexp.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="skolem">t1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ro<span class="main">(</span><span class="skolem">t1</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2'</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t1'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> ro<span class="main">(</span><span class="skolem">t2</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t1'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> t1 t2 <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span> <span class="quoted"><span class="quoted">"ro<span class="main">(</span><span class="var">?t'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> t1 t2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2</span> <span class="main">∼</span> <span class="main">(</span>ro<span class="main">(</span><span class="skolem">t1</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t1'</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span>ro<span class="main">(</span><span class="skolem">t2</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2'</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">∼</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∼</span> ro<span class="main">(</span><span class="skolem">t1</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> ro<span class="main">(</span><span class="skolem">t2</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> ro<span class="main">(</span><span class="skolem">t1</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2'</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t1'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> ro<span class="main">(</span><span class="skolem">t2</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t1'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">∼</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> lang.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> distrib_right' semiring_class.distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> join_semilattice_class.add_comm semiring_class.combine_common_factor<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∼</span> ro<span class="main">(</span><span class="skolem">t1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> ro<span class="main">(</span><span class="skolem">t1</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2'</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t1'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> ro<span class="main">(</span><span class="skolem">t2</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t1'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">∼</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∼</span> ro<span class="main">(</span><span class="skolem">t1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t2</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="var">?t'</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> lang.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> join_semilattice_class.add_assoc'<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> r1
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> P_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?t'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> r1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼</span> ro<span class="main">(</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"ro<span class="main">(</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms rexp.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup><span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="skolem">s'</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup><span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span> <span class="quoted"><span class="quoted">"ro<span class="main">(</span><span class="var">?t'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> r1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rexp.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rexp_ewp.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assm r1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ro<span class="main">(</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">s'</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup><span class="hidden">⇩</span><sub>r</sub></span> <span class="main">∼</span> <span class="main">(</span><span class="skolem">s'</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup><span class="hidden">⇩</span><sub>r</sub></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">∼</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∼</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">s'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="skolem">s'</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup><span class="hidden">⇩</span><sub>r</sub></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">∼</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∼</span> ro<span class="main">(</span><span class="skolem">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup><span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="var">?t'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> rexp_ewp.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms lang.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> r1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> r2 r_lang.abs_eq r_lang.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> reg_lan <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">Sr_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">ewp_reg_lan</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> reg_lan <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"l_ewp"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> reg_lan"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kleene_algebra_class.dual.star2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> reg_lan"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kleene_algebra_class.star_unfoldr_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> reg_lan"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ewp <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> ewp <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"r_lang <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∼</span> ro<span class="main">(</span><span class="skolem">t</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"ro<span class="main">(</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> regexp_ewp<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> lang.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rexp.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rexp_ewp_l_ewp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> lan_salomaa_l.EWP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> reg_lan"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> ewp <span class="skolem">y</span><span class="main">;</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> lan_salomaa_r.Ar<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> reg_lan <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">Sl_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> reg_lan"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> left_pre_kleene_algebra_class.star_unfoldl_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> reg_lan"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> ewp <span class="skolem">y</span><span class="main">;</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> lan_salomaa_l.Al<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> reg_lan <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">S_algebra</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">theorem</span></span> arden_regexp_l<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ro<span class="main">(</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">x</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">z</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup><span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> arden_l lang.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> lang.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> lang.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> rexp.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rexp_ewp_l_ewp<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> arden_regexp_r<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ro<span class="main">(</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>r</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">y</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">z</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">z</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup><span class="hidden">⇩</span><sub>r</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">metis</span> lan_salomaa_r.Ar lang.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> lang.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> lang.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> rexp.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rexp_ewp_l_ewp<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Pratts_Counterexamples">
<div class="head">
<h1>Theory Pratts_Counterexamples</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Regular Algebras
   Author:     Simon Foster, Georg Struth
   Maintainer: Simon Foster &lt;s.foster at york.ac.uk&gt;
               Georg Struth &lt;g.struth at sheffield.ac.uk&gt;               
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Pratt's Counterexamples›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Pratts_Counterexamples
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Regular_Algebras.html">Regular_Algebras</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We create two regular algebra models due to Pratt~\cite{Pratt} which are used to
        distinguish K1 algebras from K1l and K1r algebras.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> pratt1 <span class="main">=</span> 
  P1Bot <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⊥<span class="hidden">⇩</span><sub>1</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span> <span class="main">|</span>
  P1Nat <span class="quoted">nat</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">[</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">]<span class="hidden">⇩</span><sub>1</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span> <span class="main">|</span> 
  P1Infty <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">∞<span class="hidden">⇩</span><sub>1</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span> <span class="main">|</span>
  P1Top <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⊤<span class="hidden">⇩</span><sub>1</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">datatype</span></span> pratt2 <span class="main">=</span> 
  P2Bot <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⊥<span class="hidden">⇩</span><sub>2</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span> <span class="main">|</span>
  P2Nat <span class="quoted">nat</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">[</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">]<span class="hidden">⇩</span><sub>2</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span> <span class="main">|</span> 
  P2Infty <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">∞<span class="hidden">⇩</span><sub>2</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span> <span class="main">|</span>
  P2Top <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⊤<span class="hidden">⇩</span><sub>2</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pratt1_max</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt1_max</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">[</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt1_max</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt1_max</span> <span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt1_max</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt1_max</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt1_max</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt1_max</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt1_max</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pratt1_plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pratt1 <span class="main">⇒</span> pratt1 <span class="main">⇒</span> pratt1"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+<span class="hidden">⇩</span><sub>1</sub></span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span> <span class="comment1">(* Can be adjusted to PInfty *)</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>

<span class="keyword1" id="Pratts_Counterexamples-plusl_top_infty"><span class="command">lemma</span></span> plusl_top_infty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Pratts_Counterexamples-plusl_infty_top"><span class="command">lemma</span></span> plusl_infty_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>  <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Pratts_Counterexamples-plusl_bot_infty"><span class="command">lemma</span></span> plusl_bot_infty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Pratts_Counterexamples-plusl_infty_bot"><span class="command">lemma</span></span> plusl_infty_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span>  <span class="main">=</span> <span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Pratts_Counterexamples-plusl_zero_infty"><span class="command">lemma</span></span> plusl_zero_infty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Pratts_Counterexamples-plusl_infty_zero"><span class="command">lemma</span></span> plusl_infty_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Pratts_Counterexamples-plusl_infty_num"><span class="command">lemma</span></span> plusl_infty_num <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[</span><span class="free">x</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Pratts_Counterexamples-plusl_num_infty"><span class="command">lemma</span></span> plusl_num_infty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">x</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pratt2_max</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt2_max</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">[</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt2_max</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊥<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt2_max</span> <span class="main">⊥<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt2_max</span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt2_max</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt2_max</span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt2_max</span> <span class="main">⊤<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pratt2_max</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊤<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pratt2_plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pratt2 <span class="main">⇒</span> pratt2 <span class="main">⇒</span> pratt2"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+<span class="hidden">⇩</span><sub>2</sub></span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊥<span class="hidden">⇩</span><sub>2</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">⊥<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">⊥<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span> <span class="comment1">(* Can be adjusted to PInfty *)</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊤<span class="hidden">⇩</span><sub>2</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">⊤<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main"><span class="free">+<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> pratt1 <span class="main">::</span> <span class="quoted">selective_semiring</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> zero_pratt1_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≡</span> <span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> one_pratt1_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≡</span> <span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> plus_pratt1_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> pratt1_max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> times_pratt1_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> less_eq_pratt1_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>pratt1<span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> less_pratt1_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>pratt1<span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">pratt1</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt1_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt1_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt1_def times_pratt1_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> nat.exhaust plusl_zero_infty pratt1_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc plusl_infty_zero plusl_zero_infty pratt1_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> neq0_conv plusl_num_infty plusl_zero_infty pratt1_plus.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc plusl_infty_zero pratt1_plus.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> pratt1_plus.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc plusl_infty_zero pratt1_plus.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> pratt1_plus.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt1_def times_pratt1_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> neq0_conv plusl_num_infty plusl_zero_infty pratt1_max.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_pratt1_def times_pratt1_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_pratt1_def times_pratt1_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt1_def zero_pratt1_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_pratt1_def zero_pratt1_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_pratt1_def zero_pratt1_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_pratt1_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_pratt1_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt1_def max_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt1_def times_pratt1_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> nat.exhaust plusl_zero_infty pratt1_max.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> pratt1_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> neq0_conv plusl_num_infty plusl_zero_infty pratt1_max.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> nat.exhaust plusl_zero_infty pratt1_max.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> pratt1_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> neq0_conv plusl_num_infty plusl_zero_infty pratt1_max.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> neq0_conv plusl_infty_num plusl_infty_zero pratt1_max.simps<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> pratt1_max.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc plusl_infty_zero pratt1_max.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> pratt1_max.simps<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> pratt1_plus.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">instance</span></span> pratt1 <span class="main">::</span> <span class="quoted">dioid_one_zero</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> pratt2 <span class="main">::</span> <span class="quoted">selective_semiring</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> zero_pratt2_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≡</span> <span class="main">⊥<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> one_pratt2_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≡</span> <span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> times_pratt2_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">plus_pratt2</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pratt2 <span class="main">⇒</span> pratt2 <span class="main">⇒</span> pratt2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">plus_pratt2</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> pratt2_max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> less_eq_pratt2_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>pratt2<span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> less_pratt2_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>pratt2<span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">pratt2</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_pratt2_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc pratt2_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc pratt2_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc pratt2_plus.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc pratt2_plus.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt2_def times_pratt2_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc pratt2_max.simps<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> pratt2_max.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> max_0L max_0R max.left_idem nat.exhaust pratt2_max.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> 
                   pratt2_max.simps<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_pratt2_def times_pratt2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_pratt2_def times_pratt2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt2_def zero_pratt2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_pratt2_def zero_pratt2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_pratt2_def zero_pratt2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_pratt2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_pratt2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt2_def max_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pratt2_def times_pratt2_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc pratt2_max.simps<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> pratt2_max.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> nat.exhaust pratt2_max.simps<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> pratt2_max.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc pratt2_max.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> pratt2_max.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> nat.exhaust pratt2_max.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> pratt2_max.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc pratt2_max.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc pratt2_max.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> pratt2_plus.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1" id="Pratts_Counterexamples-top_greatest"><span class="command">lemma</span></span> top_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_pratt1_def plus_pratt1_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">instantiation</span></span> pratt1 <span class="main">::</span> <span class="quoted">star_op</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">star_pratt1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> pratt2 <span class="main">::</span> <span class="quoted">star_op</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">star_pratt2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊥<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">0</span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">else</span> <span class="main">⊤<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> pratt1 <span class="main">::</span> <span class="quoted">K1r_algebra</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">pratt1</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_pratt1_def one_pratt1_def times_pratt1_def less_eq_pratt1_def plus_pratt1_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">pratt1</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>star_pratt1_def one_pratt1_def times_pratt1_def less_eq_pratt1_def plus_pratt1_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not0_implies_Suc plusl_zero_infty pratt1.distinct<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> pratt1_max.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> pratt1_plus.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> pratt2 <span class="main">::</span> <span class="quoted">K1l_algebra</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">pratt2</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">⋅</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_pratt2_def one_pratt2_def times_pratt2_def less_eq_pratt2_def plus_pratt2_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">pratt2</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span></span></span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>star_pratt2_def one_pratt2_def times_pratt2_def less_eq_pratt2_def plus_pratt2_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>star_pratt2_def one_pratt2_def times_pratt2_def less_eq_pratt2_def plus_pratt2_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pratts_Counterexamples-one_star_top"><span class="command">lemma</span></span> one_star_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">1</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">⊤<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>star_pratt1_def one_pratt1_def<span class="main">)</span>

<span class="keyword1" id="Pratts_Counterexamples-pratt1_kozen_1l_counterexample"><span class="command">lemma</span></span> pratt1_kozen_1l_counterexample<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">::</span> pratt1<span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">[</span><span class="main">1</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⋅</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="main">[</span><span class="main">1</span><span class="main">]<span class="hidden">⇩</span><sub>1</sub></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="main">∞<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_pratt1_def times_pratt1_def less_eq_pratt1_def plus_pratt1_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pratts_Counterexamples-pratt2_kozen_1r_counterexample"><span class="command">lemma</span></span> pratt2_kozen_1r_counterexample<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">::</span> pratt2<span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⋅</span> <span class="main">[</span><span class="main">1</span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⋅</span> <span class="main">[</span><span class="main">1</span><span class="main">]<span class="hidden">⇩</span><sub>2</sub></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">∞<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_pratt2_def times_pratt2_def less_eq_pratt2_def plus_pratt2_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Regular_Algebra_Variants">
<div class="head">
<h1>Theory Regular_Algebra_Variants</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Regular Algebras
   Author:     Simon Foster, Georg Struth
   Maintainer: Simon Foster &lt;s.foster at york.ac.uk&gt;
               Georg Struth &lt;g.struth at sheffield.ac.uk&gt;               
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Variants of Regular Algebra›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Regular_Algebra_Variants
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Regular_Algebras.html">Regular_Algebras</a> <a href="Pratts_Counterexamples.html">Pratts_Counterexamples</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Replacing Kozen's induction axioms by Boffa's leads to incompleteness.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> star_dioid<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="comment1">(*  nitpick [expect=genuine] --"5-element counterexample"*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> star_dioid<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="comment1">(*  nitpick [expect=genuine] --"5-element counterexample"*)</span>
<span class="keyword1"><span class="command">oops</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> star_dioid<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_iso_r assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_oner subdistl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> star_dioid<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">oops</span></span> <span class="comment1">― ‹need to reconsider this›</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> star_dioid<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> star_dioid<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="comment1">(*  nitpick -- "3-element counterexample"*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> star_dioid<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">z</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="comment1">(*  nitpick [expect=genuine] -- "3-element counterexample"*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> star_dioid<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span>  <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">class</span></span> C3l_var <span class="main">=</span> conway_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C3l_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> C3r_var <span class="main">=</span> conway_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C3r_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> C3_var <span class="main">=</span> C3l_var <span class="main">+</span> C3r_var

<span class="keyword1"><span class="command">sublocale</span></span> C3l_var <span class="main">⊆</span> C3l_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.C3l_var<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C3l_algebra <span class="main">⊆</span> C3l_var
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_inductl_var<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C3_var <span class="main">⊆</span> C3_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.C3r_var<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> C3_algebra <span class="main">⊆</span> C3_var
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_inductr_var<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> Brtc_algebra <span class="main">=</span> star_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rtc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rtc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> B2_algebra <span class="main">⊆</span> Brtc_algebra
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.star_ext<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B23 local.join.le_sup_iff eq_iff mult_1_right subdistl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> Brtc_algebra <span class="main">⊆</span> B2_algebra
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rtc1 join.le_sup_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rtc1 join.le_sup_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rtc1 add.commute join.le_sup_iff less_eq_def mult_isor mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">;</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rtc2 eq_refl less_eq_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">class</span></span> wB1_algebra <span class="main">=</span> conway_dioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> wB1_algebra <span class="main">⊆</span> B1_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> order_refl wR<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> B1_algebra<span class="main">)</span> one_plus_star<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C11_var R add_idem' mult_onel mult_oner<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> B1_algebra <span class="main">⊆</span> wB1_algebra
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.distrib_left local.join.sup_absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add.left_commute distrib_right' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> R add_assoc' add_idem' one_plus_star<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>