<div id="GroupAction">
<div class="head">
<h1>Theory GroupAction</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Group Actions
    Author:     Jakob von Raumer, Karlsruhe Institute of Technology
    Maintainer: Jakob von Raumer &lt;jakob.raumer at student.kit.edu&gt;
*)</span>

<span class="keyword1"><span class="command">theory</span></span> GroupAction
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Algebra/Bij.html">HOL-Algebra.Bij</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Algebra/Sylow.html">HOL-Algebra.Sylow</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Group Actions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is an implemention of group actions based on the group
implementation of HOL-Algebra. An action a group $G$ on a set $M$ is
represented by a group homomorphism between $G$ and the group of bijections
on $M$›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries and Definition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First, we need two theorems about singletons and sets of singletons
which unfortunately are not included in the library.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> singleton_intersection<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> noteq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>card_Suc_eq<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> card_singleton_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cardOne<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span><span class="main">(</span>card <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> card <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> card_Union_disjoint<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> cardOne <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> finite <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_ge_0_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pairwise disjnt <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pairwise_def disjnt_def
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> cardOne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> singleton_intersection<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> cardOne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Intersecting Cosets are equal:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> subgroup<span class="main">)</span> repr_independence2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> group<span class="main">:</span><span class="quoted"><span class="quoted">"group <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> U<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="keyword1">rcosets</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> U <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> RCOSETS_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> group h <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> group.repr_independence is_subgroup<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> group_action <span class="main">=</span> group <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">φ</span> <span class="free">M</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> grouphom<span class="main">:</span><span class="quoted"><span class="quoted">"group_hom <span class="free">G</span> <span class="main">(</span>BijGroup <span class="free">M</span><span class="main">)</span> <span class="free">φ</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> group_action
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="GroupAction-is_group_action"><span class="command">lemma</span></span> is_group_action<span class="main">:</span><span class="quoted"><span class="quoted">"group_action <span class="free">G</span> <span class="free">φ</span> <span class="free">M</span>"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The action of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">𝟭</span></span><span class="hidden">⇘</span><sub><span class="free"><span class="free">G</span></span></sub><span class="hidden">⇙</span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has no effect:›</span></span>

<span class="keyword1" id="GroupAction-one_is_id"><span class="command">lemma</span></span> one_is_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="main">𝟭</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> grouphom <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="main">𝟭</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="main">(</span>BijGroup <span class="free">M</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> group_hom.hom_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">M</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoid.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="GroupAction-action_closed"><span class="command">lemma</span></span> action_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="free">g</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms grouphom group_hom.hom_closed <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def Bij_def bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="GroupAction-img_in_bij"><span class="command">lemma</span></span> img_in_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> Bij <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms grouphom <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> group_hom.hom_closed<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The action of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">inv</span></span> <span class="free"><span class="free">g</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> reverts the action of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="GroupAction-group_inv_rel"><span class="command">lemma</span></span> group_inv_rel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> phi<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> Bij <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> img_in_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g grouphom <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> restrict <span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> inv_BijGroup group_hom.hom_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span>restrict <span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">M</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> mn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g phi <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">φ</span> <span class="free">g</span> <span class="main">∈</span> Bij <span class="free">M</span>›</span></span> Bij_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="free">M</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g mn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv_into <span class="free">M</span> <span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_into_f_f<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="GroupAction-images_are_bij"><span class="command">lemma</span></span> images_are_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="free">M</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> Bij <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> img_in_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Bij_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="free">M</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="GroupAction-action_mult"><span class="command">lemma</span></span> action_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="free">h</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">φ</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> φg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> Bij <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> img_in_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> φh<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="free">h</span><span class="main">)</span> <span class="main">∈</span> Bij <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> img_in_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="free">φ</span> <span class="free">h</span><span class="main">)</span> <span class="free">M</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> images_are_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="free">h</span><span class="main">)</span> <span class="main">`</span> <span class="free">M</span> <span class="main">=</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> m <span class="keyword1"><span class="command">have</span></span> hm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="free">h</span><span class="main">)</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> grouphom g h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="main">(</span>BijGroup <span class="free">M</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">φ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> group_hom.hom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="free">h</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="main">(</span>BijGroup <span class="free">M</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">φ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> φg φh <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>compose <span class="free">M</span> <span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">φ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> φg φh hm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="free">h</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_eq m<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="free">h</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">φ</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The orbit relation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following describes the relation containing the information
whether two elements of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> lie in the same orbit of the action›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">same_orbit_rel</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">same_orbit_rel</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> <span class="free">M</span> <span class="main">×</span> <span class="free">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">g</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="free">φ</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fst <span class="bound">p</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Use the library about equivalence relations to define the set of
orbits and the map assigning to each element of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> its orbit›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">orbits</span>
 <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">orbits</span> <span class="main">=</span> <span class="free">M</span> <span class="main">//</span> same_orbit_rel"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">orbit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'c</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">orbit</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> same_orbit_rel <span class="main">``</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next, we define a more easy-to-use characterization of an orbit.›</span></span>

<span class="keyword1" id="GroupAction-orbit_char"><span class="command">lemma</span></span> orbit_char<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">m</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> carrier <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="free">φ</span> <span class="bound">g</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> orbit_def Image_def same_orbit_rel_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="free">φ</span> <span class="skolem">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> group_inv_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> carrier <span class="free">G</span> <span class="main">∧</span> <span class="free">φ</span> <span class="bound">h</span> <span class="main">(</span><span class="free">φ</span> <span class="skolem">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> m <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">g</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> action_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> m g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="free">φ</span> <span class="skolem">g</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> group_inv_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="free">φ</span> <span class="bound">h</span> <span class="main">(</span><span class="free">φ</span> <span class="skolem">g</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="GroupAction-same_orbit_char"><span class="command">lemma</span></span> same_orbit_char<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> same_orbit_rel <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="bound">g</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> same_orbit_rel_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we show that the relation we've defined is, indeed, an
equivalence relation:›</span></span>

<span class="keyword1" id="GroupAction-same_orbit_is_equiv"><span class="command">lemma</span></span> same_orbit_is_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">M</span> same_orbit_rel"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> equivI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">M</span> same_orbit_rel"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> refl_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"same_orbit_rel <span class="main">⊆</span> <span class="free">M</span> <span class="main">×</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="main">𝟭</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> one_is_id<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> <span class="free">M</span>›</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> same_orbit_rel"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>same_orbit_char<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym same_orbit_rel"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> symI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> mn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> same_orbit_rel"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> invg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> mn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">×</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> mn2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> g mn2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> group_inv_rel<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> invg mn2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> same_orbit_rel"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans same_orbit_rel"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> transI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> same_orbit_rel"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> grel<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> yz<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> same_orbit_rel"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hrel<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> g h <span class="keyword1"><span class="command">have</span></span> gh<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> xy yz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> g h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">φ</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> action_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> hrel grel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> gh <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">M</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> same_orbit_rel"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stabilizer and fixed points›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following definition models the stabilizer of a group action:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stabilizer</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">stabilizer</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="free">φ</span> <span class="bound">g</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This shows that the stabilizer of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a subgroup of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="GroupAction-stabilizer_is_subgroup"><span class="command">lemma</span></span> stabilizer_is_subgroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> subgroupI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stabilizer <span class="free">m</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="main">𝟭</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> one_is_id<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> stabilizer <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"stabilizer <span class="free">m</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> stabilizer <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> m <span class="keyword1"><span class="command">have</span></span> ginv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> group_inv_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ginv <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span>  stabilizer <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">h</span>
  <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> stabilizer <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> stabilizer <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> g2 <span class="keyword1"><span class="command">have</span></span> gh<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> m_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> g2 h2 m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">h</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="free">φ</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="skolem">h</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> action_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">h</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> gh <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">h</span> <span class="main">∈</span> stabilizer <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next, we define and characterize the fixed points of a group action.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fixed_points</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fixed_points</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">m</span></span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> carrier <span class="free">G</span> <span class="main">⊆</span> stabilizer <span class="bound">m</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="GroupAction-fixed_point_char"><span class="command">lemma</span></span> fixed_point_char<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span> <span class="main">∈</span> fixed_points<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="free">φ</span> <span class="bound">g</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> fixed_points_def stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="GroupAction-orbit_contains_rep"><span class="command">lemma</span></span> orbit_contains_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> orbit <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> orbit_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equiv_class_self same_orbit_is_equiv<span class="main">)</span>

<span class="keyword1" id="GroupAction-singleton_orbit_eq_fixed_point"><span class="command">lemma</span></span> singleton_orbit_eq_fixed_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>card <span class="main">(</span>orbit <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">∈</span> fixed_points<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> card<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="main">(</span>orbit <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> orbit <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> orbit_contains_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> m <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> fixed_points"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fixed_points_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
    <span class="keyword3"><span class="command">assume</span></span> gG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">g</span> <span class="free">m</span> <span class="main">∈</span> orbit <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>orbit_char<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">∈</span> orbit <span class="free">m</span>›</span></span> card <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">g</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Suc_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> gG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> stabilizer <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> fixed_points"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> fixed<span class="main">:</span><span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">⊆</span> stabilizer <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fixed_points_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">m</span> <span class="main">=</span> <span class="main">{</span><span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orbit_contains_rep<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> orbit <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> m <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">g</span> <span class="free">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> orbit_char<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> fixed <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">g</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>orbit <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Orbit-Stabilizer Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section contains some theorems about orbits and their quotient
groups. The first one is the well-known orbit-stabilizer theorem which
establishes a bijection between the the quotient group of the an element's
stabilizer and its orbit.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> orbit_thm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">∈</span> <span class="main">(</span>carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">rep</span> <span class="bound">U</span> <span class="main">∈</span> <span class="bound">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">H</span><span class="main">.</span> <span class="main">(</span><span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="main">(</span><span class="free">rep</span> <span class="bound">H</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>orbit <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>bij_betw_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">H</span><span class="main">.</span> <span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="main">(</span><span class="free">rep</span> <span class="bound">H</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> stabilizer <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">V</span>
    <span class="keyword3"><span class="command">assume</span></span> U<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> V<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="free">rep</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="free">rep</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> stabSubset<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> m <span class="keyword1"><span class="command">have</span></span> stabSubgroup<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> stabilizer_is_subgroup<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> V rep <span class="keyword1"><span class="command">have</span></span> hV<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> V stabSubset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> FactGroup_def RCOSETS_def r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> hV <span class="keyword1"><span class="command">have</span></span> hG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> hinvG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> U rep <span class="keyword1"><span class="command">have</span></span> gU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> U stabSubset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> FactGroup_def RCOSETS_def r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> gU <span class="keyword1"><span class="command">have</span></span> gG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> ginvG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> gG hinvG <span class="keyword1"><span class="command">have</span></span> ginvhG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_closed<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> reps<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">rep</span> <span class="skolem">U</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">rep</span> <span class="skolem">V</span><span class="main">)</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> gh<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def h_def<span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> gG hinvG m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">φ</span> <span class="skolem">g</span> <span class="main">(</span><span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> action_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gh ginvG gG m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> action_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> m gG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> one_is_id<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> ginvhG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">∈</span> stabilizer <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="main">𝟭</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coset_join2 coset_mult_one m stabSubset stabilizer_is_subgroup subgroup.mem_carrier<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> hinvG hG gG stabSubset <span class="keyword1"><span class="command">have</span></span>  stabgstabh<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="skolem">h</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coset_mult_inv1 group.coset_mult_one is_group<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> stabSubgroup is_group U gU <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> FactGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>subgroup.repr_independence2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> stabgstabh is_group stabSubgroup V hV subgroup.repr_independence2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> FactGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> stabSubset<span class="main">:</span><span class="quoted"><span class="quoted">"stabilizer <span class="free">m</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> stabilizer <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> rep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rep</span> <span class="skolem">H</span> <span class="main">∈</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> H stabSubset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> FactGroup_def RCOSETS_def r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rep</span> <span class="skolem">H</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">rep</span> <span class="skolem">H</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> m <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">rep</span> <span class="skolem">H</span><span class="main">)</span> <span class="free">m</span> <span class="main">∈</span> orbit <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>orbit_char<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> orbit <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> m <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">g</span> <span class="free">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>orbit_char<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> invg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> stabinvg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> stabilizer <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> FactGroup_def RCOSETS_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">rep</span> <span class="main">(</span><span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rep<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> stabilizer <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">rep</span> <span class="main">(</span><span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">rep</span> <span class="main">(</span><span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span>  <span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> hG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed inv_inv inv_mult_group<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g hG m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">φ</span> <span class="skolem">g</span> <span class="main">(</span><span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> action_mult inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> h m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">h</span> <span class="main">∈</span> stabilizer <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> stabilizer_is_subgroup subgroup.m_inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">g</span> <span class="main">(</span><span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">φ</span> <span class="skolem">g</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">rep</span> <span class="main">(</span><span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> stabinvg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">H</span><span class="main">.</span> <span class="free">φ</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">rep</span> <span class="bound">H</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">`</span> carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> stabilizer <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the case of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> being finite, the last theorem can be reduced
to a statement about the cardinality of orbit and stabilizer:›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> orbit_size<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> card <span class="main">(</span>orbit <span class="free">m</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rep</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="main">∈</span> <span class="main">(</span>carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">∈</span> <span class="main">(</span>carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">rep</span> <span class="bound">U</span> <span class="main">∈</span> <span class="bound">U</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">assume</span></span> U<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> stabilizer <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">U</span> <span class="main">=</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> FactGroup_def RCOSETS_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rcos_self stabilizer_is_subgroup someI_ex<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> U <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="skolem">U</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rep_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> m <span class="keyword1"><span class="command">have</span></span>  bij<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="main">(</span>carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>orbit <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_same_card orbit_thm<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fin m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>carrier <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>stabilizer <span class="free">m</span><span class="main">)</span>  <span class="main">=</span> order <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> FactGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stabilizer_is_subgroup lagrange<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> bij <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="GroupAction-orbit_not_empty"><span class="command">lemma</span></span> orbit_not_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> orbits"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> orbit <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orbits_def quotient_def orbit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> orbit_contains_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orbits_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fin A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orbits_def quotient_def Image_def same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="GroupAction-fin_set_imp_fin_orbits"><span class="command">lemma</span></span> fin_set_imp_fin_orbits<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finM<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite orbits"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> orbits_def quotient_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(*One-Element-Orbits are Fixed Points*)</span>
<span class="keyword1" id="GroupAction-singleton_orbits"><span class="command">lemma</span></span> singleton_orbits<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">N</span></span><span class="main">∈</span>orbits<span class="main">.</span> card <span class="bound">N</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> fixed_points"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">N</span></span> <span class="main">∈</span> orbits<span class="main">.</span> card <span class="bound">N</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> fixed_points"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">N</span></span> <span class="main">∈</span> orbits<span class="main">.</span> card <span class="bound">N</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orbits_def quotient_def Image_def same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">∈</span> orbits"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">N</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Norbit<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> orbit <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orbits_def quotient_def orbit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> orbit_contains_rep<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> N <span class="keyword1"><span class="command">have</span></span> Nsing<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Suc_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Norbit <span class="keyword1"><span class="command">have</span></span> Norbit2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> orbit <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="free">φ</span> <span class="bound">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> carrier <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">∈</span> orbit <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>orbit_char<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Nsing <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Norbit2 singleton_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">M</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fixed_points"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fixed_points_def stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fixed_points <span class="main">⊆</span> <span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">N</span></span> <span class="main">∈</span> orbits<span class="main">.</span> card <span class="bound">N</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> fixed_points"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> mM<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fixed_points_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> orbit<span class="main">:</span><span class="quoted"><span class="quoted">"orbit <span class="skolem">m</span> <span class="main">∈</span> orbits"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orbits_def quotient_def orbit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> mM m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>orbit <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> singleton_orbit_eq_fixed_point<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> orbit <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orbit <span class="skolem">m</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">N</span></span> <span class="main">∈</span> orbits<span class="main">.</span> card <span class="bound">N</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> mM <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">N</span></span> <span class="main">∈</span> orbits<span class="main">.</span> card <span class="bound">N</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> orbit_contains_rep<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-group acting on a finite set, a given orbit is
either a singleton or <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> divides its cardinality.›</span></span>

<span class="keyword1" id="GroupAction-p_dvd_orbit_size"><span class="command">lemma</span></span> p_dvd_orbit_size<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> orderG<span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> prime<span class="main">:</span><span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finM<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Norbit<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∈</span> orbits"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">N</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> card <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Norbit <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> orbit <span class="skolem">m</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> orbits_def quotient_def orbit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> prime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat<span class="main">)</span> 
  <span class="keyword1"><span class="command">with</span></span> orderG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite less_nat_zero_code<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> card <span class="main">(</span>orbit <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>stabilizer <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> orbit_size<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> orderG m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">=</span> card <span class="free">N</span> <span class="main">*</span> card <span class="main">(</span>stabilizer <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">N</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_mult2 dvd_mult_cancel1 nat_dvd_not_less nat_mult_1 prime 
          prime_dvd_power_nat prime_factor_nat prime_nat_iff zero_less_one<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As a result of the last lemma the only orbits that count modulo
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are the fixed points›</span></span>

<span class="keyword1" id="GroupAction-fixed_point_congruence"><span class="command">lemma</span></span> fixed_point_congruence<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finM<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">M</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> card fixed_points <span class="keyword1">mod</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">big_orbits</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">big_orbits</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">N</span></span><span class="main">∈</span>orbits<span class="main">.</span> card <span class="bound">N</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> finM <span class="keyword1"><span class="command">have</span></span> orbit_part<span class="main">:</span><span class="quoted"><span class="quoted">"orbits <span class="main">=</span> <span class="skolem">big_orbits</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">N</span></span><span class="main">∈</span>orbits<span class="main">.</span> card <span class="bound">N</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> big_orbits_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>orbit_not_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> orbit_disj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">big_orbits</span> <span class="main">∩</span> <span class="main">{</span><span class="bound"><span class="bound">N</span></span><span class="main">∈</span>orbits<span class="main">.</span> card <span class="bound">N</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> big_orbits_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finM <span class="keyword1"><span class="command">have</span></span> orbits_fin<span class="main">:</span><span class="quoted"><span class="quoted">"finite orbits"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fin_set_imp_fin_orbits<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> fin_parts<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="skolem">big_orbits</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">N</span></span><span class="main">∈</span>orbits<span class="main">.</span> card <span class="bound">N</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> big_orbits_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">N</span><span class="main">.</span> <span class="bound">N</span> <span class="main">∈</span> <span class="skolem">big_orbits</span> <span class="main">⟹</span> <span class="free">p</span> <span class="keyword1">dvd</span> card <span class="bound">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> big_orbits_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_dvd_orbit_size<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> orbit_div<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">N</span><span class="main">.</span> <span class="bound">N</span> <span class="main">∈</span> <span class="skolem">big_orbits</span> <span class="main">⟹</span> card <span class="bound">N</span> <span class="main">=</span> <span class="main">(</span>card <span class="bound">N</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_mult_div_cancel mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">M</span> <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> orbits<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orbits_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Union_quotient same_orbit_is_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> orbits<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">N</span><span class="main">∈</span>orbits<span class="main">.</span> card <span class="bound">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orbits_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> card_Union_disjoint<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pairwise disjnt <span class="main">(</span><span class="free">M</span> <span class="main">//</span> same_orbit_rel<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pairwise_def disjnt_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> same_orbit_is_equiv quotient_disj<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">//</span> same_orbit_rel <span class="main">⟹</span> finite <span class="bound">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finM same_orbit_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>finite_equiv_class<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> orbit_part orbit_disj fin_parts <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">N</span><span class="main">∈</span><span class="skolem">big_orbits</span><span class="main">.</span> card <span class="bound">N</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">N</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">N'</span></span><span class="main">∈</span>orbits<span class="main">.</span> card <span class="bound">N'</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> card <span class="bound">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> sum.union_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms orbit_div fin_parts <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">N</span><span class="main">∈</span><span class="skolem">big_orbits</span><span class="main">.</span> <span class="main">(</span>card <span class="bound">N</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span><span class="main">⋃</span><span class="main">{</span><span class="bound"><span class="bound">N'</span></span><span class="main">∈</span>orbits<span class="main">.</span> card <span class="bound">N'</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_singleton_set<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">N</span><span class="main">∈</span><span class="skolem">big_orbits</span><span class="main">.</span> card <span class="bound">N</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> card fixed_points"</span></span> <span class="keyword1"><span class="command">using</span></span> singleton_orbits <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sum_distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">M</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">N</span><span class="main">∈</span><span class="skolem">big_orbits</span><span class="main">.</span> card <span class="bound">N</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> card fixed_points"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="free">M</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">N</span><span class="main">∈</span><span class="skolem">big_orbits</span><span class="main">.</span> card <span class="bound">N</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> card fixed_points<span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>card fixed_points<span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_mult_self3<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can restrict any group action to the action of a subgroup:›</span></span>

<span class="keyword1" id="GroupAction-subgroup_action"><span class="command">lemma</span></span> subgroup_action<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"group_action <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span> <span class="free">φ</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> group_action_def group_action_axioms_def group_hom_def group_hom_axioms_def hom_def
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_group subgroup.subgroup_is_group group_BijGroup<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.mem_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> grouphom <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>BijGroup <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> group_hom.hom_closed<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.mem_carrier<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> grouphom <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">φ</span> <span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>BijGroup <span class="free">M</span></sub><span class="hidden">⇙</span> <span class="free">φ</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> group_hom.hom_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Some Examples for Group Actions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> right_mult_is_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="free">h</span> <span class="main">⊗</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∈</span> Bij <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Bij_def bij_betw_def inj_on_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">h</span> <span class="main">⊗</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> h <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> h <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">h</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_closed inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">h</span> <span class="main">⊗</span> <span class="skolem">x</span><span class="main">)</span>  <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed r_inv m_assoc l_one<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(⊗</span><span class="main">)</span> <span class="free">h</span> <span class="main">`</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> right_mult_group_action<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"group_action <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">h</span><span class="main">.</span> <span class="main">λ</span><span class="bound">g</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="bound">h</span> <span class="main">⊗</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> group_action_def group_action_axioms_def group_hom_def group_hom_axioms_def hom_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>is_group group_BijGroup<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="skolem">h</span> <span class="main">⊗</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∈</span> carrier <span class="main">(</span>BijGroup <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>right_mult_is_bij<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">multx</span></span> <span class="skolem"><span class="skolem">multy</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">multx</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">multy</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">⊗</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> x y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">multx</span> <span class="main">∈</span> <span class="main">(</span>Bij <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">multy</span> <span class="main">∈</span> <span class="main">(</span>Bij <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> right_mult_is_bij<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">multx</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>BijGroup <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="skolem">multy</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="skolem">multx</span> <span class="main">(</span><span class="skolem">multy</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compose_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊗</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> multx_def multy_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> restrict_ext<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
    <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> x y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">with</span></span> x y g <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">⊗</span> <span class="bound">g</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>m_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊗</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>BijGroup <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">⊗</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> multx_def multy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> rcosets_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> HG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> M<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">#&gt;</span> <span class="free">g</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> M <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> RCOSETS_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> g HG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">#&gt;</span> <span class="free">g</span> <span class="main">=</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coset_mult_assoc subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> HG g h <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">#&gt;</span> <span class="free">g</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rcosetsI subgroup.m_closed subgroup.subset subgroup_self<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> inv_mult_on_rcosets_is_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> HG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> Bij <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Bij_def bij_betw_def inj_on_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> HG g <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed rcosets_closed<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
  <span class="keyword3"><span class="command">assume</span></span> M<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> HG g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">#&gt;</span> <span class="free">g</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rcosets_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> M HG g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">#&gt;</span> <span class="free">g</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">=</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coset_mult_assoc coset_mult_inv2 inv_closed is_group subgroup.rcosets_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">M</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">N</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> M<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">M</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> HG M N g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coset_mult_assoc is_group subgroup.m_inv_closed subgroup.rcosets_carrier subgroup_self<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> HG M N g <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> l_inv coset_mult_one is_group subgroup.rcosets_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> inv_mult_on_rcosets_action<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> HG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"group_action <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">λ</span><span class="bound">U</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> group_action_def group_action_axioms_def group_hom_def group_hom_axioms_def hom_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>is_group group_BijGroup<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> HG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">∈</span> carrier <span class="main">(</span>BijGroup <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>inv_mult_on_rcosets_is_bij<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cosx</span></span> <span class="skolem"><span class="skolem">cosy</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cosx</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cosy</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> x y HG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cosx</span> <span class="main">∈</span> <span class="main">(</span>Bij <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cosy</span> <span class="main">∈</span> <span class="main">(</span>Bij <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_mult_on_rcosets_is_bij<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cosx</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>BijGroup <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="skolem">cosy</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="skolem">cosx</span> <span class="main">(</span><span class="skolem">cosy</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compose_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cosx_def cosy_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> restrict_ext<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">assume</span></span> U<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> HG y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed rcosets_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> x y HG U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">y</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x y U HG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_mult_group coset_mult_assoc inv_closed is_group subgroup.rcosets_carrier<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>BijGroup <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cosx_def cosy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SubgroupConjugation">
<div class="head">
<h1>Theory SubgroupConjugation</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Subgroup Conjugation
    Author:     Jakob von Raumer, Karlsruhe Institute of Technology
    Maintainer: Jakob von Raumer &lt;jakob.raumer at student.kit.edu&gt;
*)</span>

<span class="keyword1"><span class="command">theory</span></span> SubgroupConjugation
<span class="keyword2"><span class="keyword">imports</span></span> <a href="GroupAction.html">GroupAction</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Conjugation of Subgroups and Cosets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory examines properties of the conjugation of subgroups
of a fixed group as a group action›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions and Preliminaries›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the set of all subgroups of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> which have a certain
cardinality. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> will act on those sets. Afterwards some theorems which
are already available for right cosets are dualized into statements about
left cosets.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> subgroup<span class="main">)</span> subgroup_of_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> G<span class="main">:</span><span class="quoted"><span class="quoted">"group <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> PH<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> <span class="free">K</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> KG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">K</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">K</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms subgroup_def group.m_inv_consistent m_inv_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">context</span></span> group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subgroups_of_size</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subgroups_of_size</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">H</span><span class="main">.</span> subgroup <span class="bound">H</span> <span class="free">G</span> <span class="main">∧</span> card <span class="bound">H</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="SubgroupConjugation-lcosI"><span class="command">lemma</span></span> lcosI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">h</span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> <span class="free">H</span> <span class="main">⊆</span> carrier <span class="free">G</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">x</span> <span class="main">⊗</span> <span class="free">h</span> <span class="main">∈</span> <span class="free">x</span> <span class="main">&lt;#</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_coset_def<span class="main">)</span>

<span class="keyword1" id="SubgroupConjugation-lcoset_join2"><span class="command">lemma</span></span> lcoset_join2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">&lt;#</span> <span class="free">H</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> g H <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.m_closed<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> g H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.m_closed subgroup.m_inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x g H <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_group subgroup.lcos_module_rev subgroup.mem_carrier<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SubgroupConjugation-cardeq_rcoset"><span class="command">lemma</span></span> cardeq_rcoset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">M</span> <span class="main">#&gt;</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> card  <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">#&gt;</span> <span class="free">g</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> rcosetsI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">M</span> <span class="main">#&gt;</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> card <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> card_rcosets_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SubgroupConjugation-cardeq_lcoset"><span class="command">lemma</span></span> cardeq_lcoset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> M<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">g</span> <span class="main">&lt;#</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> card  <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free">g</span> <span class="main">⊗</span> <span class="bound">m</span><span class="main">)</span> <span class="free">M</span> <span class="main">(</span><span class="free">g</span> <span class="main">&lt;#</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">(⊗</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> invg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inv_closed<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> M <span class="keyword1"><span class="command">have</span></span> xG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> g invg xG yG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> g invg xG yG <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(⊗</span><span class="main">)</span> <span class="free">g</span> <span class="main">`</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">g</span> <span class="main">&lt;#</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> card <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_same_card<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conjugation is a group action›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We will now prove that conjugation acts on the subgroups
of a certain group. A large part of this proof consists of showing that
the conjugation of a subgroup with a group element is, again, a subgroup.›</span></span>

<span class="keyword1" id="SubgroupConjugation-conjugation_subgroup"><span class="command">lemma</span></span> conjugation_subgroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> HG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> gG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> HG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> r_coset_subset_G subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> gG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> l_coset_subset_G<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> gG <span class="keyword1"><span class="command">have</span></span> invgG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> HG <span class="keyword1"><span class="command">have</span></span> lcosSubset<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> r_coset_subset_G subgroup.subset<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> x'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="skolem">x'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hx</span></span> <span class="skolem"><span class="skolem">hy</span></span> <span class="keyword2"><span class="keyword">where</span></span> hx<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">hx</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">hx</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hy<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">hy</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> <span class="skolem">hy</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> x' y' <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">hx</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">hy</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">hx</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">hy</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> hx hy HG <span class="keyword1"><span class="command">have</span></span> hxG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">hx</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hyG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">hy</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.mem_carrier<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> gG hy x2 invgG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">hx</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">hy</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="skolem">hx</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">hy</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_assoc m_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> invgG gG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="skolem">hx</span> <span class="main">⊗</span> <span class="main">𝟭</span> <span class="main">⊗</span> <span class="skolem">hy</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gG hxG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="skolem">hx</span> <span class="main">⊗</span> <span class="skolem">hy</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_closed r_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gG hxG invgG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">(</span><span class="skolem">hx</span> <span class="main">⊗</span> <span class="skolem">hy</span><span class="main">)</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gG hxG hyG invgG m_assoc m_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">hx</span> <span class="main">⊗</span> <span class="skolem">hy</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> hx hy HG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hx</span> <span class="main">⊗</span> <span class="skolem">hy</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.m_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> invgG HG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">hx</span> <span class="main">⊗</span> <span class="skolem">hy</span><span class="main">)</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rcosI subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> gG lcosSubset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">hx</span> <span class="main">⊗</span> <span class="skolem">hy</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lcosI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> xy <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> gG <span class="keyword1"><span class="command">have</span></span> invgG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> HG <span class="keyword1"><span class="command">have</span></span> lcosSubset<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> r_coset_subset_G subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> HG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgroup.one_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> invgG HG <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rcosI subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> gG lcosSubset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">𝟭</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lcosI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> gG invgG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> gG <span class="keyword1"><span class="command">have</span></span> invgG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> HG <span class="keyword1"><span class="command">have</span></span> lcosSubset<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> r_coset_subset_G subgroup.subset<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> x'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hx</span></span> <span class="keyword2"><span class="keyword">where</span></span> hx<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">hx</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">hx</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> HG <span class="keyword1"><span class="command">have</span></span> invhx<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">hx</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.m_inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x' hx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">hx</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x' hx HG gG invgG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">hx</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation in_mono inv_mult_group lcosSubset subgroup.mem_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">hx</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gG invgG invhx HG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">hx</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_assoc subgroup.mem_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> invx<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">hx</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> invhx invgG HG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">hx</span><span class="main">)</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rcosI subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> gG lcosSubset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">hx</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lcosI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> invx <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conjugation_action</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">conjugation_action</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="free">G</span><span class="main">.</span> <span class="main">λ</span><span class="bound">P</span><span class="main">∈</span>subgroups_of_size <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">.</span> <span class="bound">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="bound">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SubgroupConjugation-conjugation_is_size_invariant"><span class="command">lemma</span></span> conjugation_is_size_invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="free">p</span> <span class="free">g</span> <span class="free">P</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> invg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> PG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> card<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> PsubG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> PinvgsubG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> invg r_coset_subset_G<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>subgroups_of_size_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g PG conjugation_subgroup<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> card PsubG fin invg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cardeq_rcoset<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> g PinvgsubG fin <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cardeq_lcoset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> P g <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SubgroupConjugation-conjugation_is_Bij"><span class="command">lemma</span></span> conjugation_is_Bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="free">p</span> <span class="free">g</span> <span class="main">∈</span> Bij <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> invg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="free">p</span> <span class="free">g</span> <span class="main">∈</span> extensional <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>conjugation_action <span class="free">p</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span> <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>bij_betw_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>conjugation_action <span class="free">p</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">V</span>
      <span class="keyword3"><span class="command">assume</span></span> U<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> V<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> subsetG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq subgroup.subset<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">hence</span></span> subsetL<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> invg r_coset_subset_G<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="free">p</span> <span class="free">g</span> <span class="skolem">U</span> <span class="main">=</span> conjugation_action <span class="free">p</span> <span class="free">g</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> g U V <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">V</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">V</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">V</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g invg lcos_m_assoc r_coset_subset_G subsetG<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">V</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g l_inv<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span> <span class="main">=</span> <span class="skolem">V</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subsetL lcos_mult_one<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">V</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">V</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coset_mult_assoc g inv_closed subsetG<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">#&gt;</span> <span class="main">𝟭</span> <span class="main">=</span> <span class="skolem">V</span> <span class="main">#&gt;</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g l_inv<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coset_mult_one subsetG<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="free">p</span> <span class="free">g</span> <span class="skolem">P</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fin g conjugation_is_size_invariant<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> invg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="free">p</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">P</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fin invg conjugation_is_size_invariant<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> invg P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">#&gt;</span> <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g inv_inv<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">#&gt;</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">.</span> <span class="main">{</span><span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="bound">p</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_coset_def l_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>m_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> PG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>subgroup.subset<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">.</span>  <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="bound">p</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="bound">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> PG <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> g invg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">p</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_assoc m_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> g invg g p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> l_one r_inv r_one<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span><span class="keyword1"><span class="command">.</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">.</span> <span class="main">{</span><span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="bound">p</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">#&gt;</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="bound">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> subgroups_of_size <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> P g <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> conjugation_action <span class="free">p</span> <span class="free">g</span> <span class="main">`</span> subgroups_of_size <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def Bij_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SubgroupConjugation-lr_coset_assoc"><span class="command">lemma</span></span> lr_coset_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">&lt;#</span> <span class="free">P</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">⊗</span> <span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> g h p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">g</span> <span class="main">&lt;#</span> <span class="free">P</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">g</span> <span class="main">&lt;#</span> <span class="free">P</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> g h p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">⊗</span> <span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> acts_on_subsets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"group_action <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="free">p</span><span class="main">)</span> <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> group_action_def group_action_axioms_def group_hom_def group_hom_axioms_def hom_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>is_group group_BijGroup<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> fin <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="free">p</span> <span class="skolem">g</span> <span class="main">∈</span> carrier <span class="main">(</span>BijGroup <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_is_Bij partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> invx<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> invy<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> x y <span class="keyword1"><span class="command">have</span></span> xyG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m_closed<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">conjx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">conjx</span> <span class="main">=</span> conjugation_action <span class="free">p</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">conjy</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">conjy</span> <span class="main">=</span> conjugation_action <span class="free">p</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin x <span class="keyword1"><span class="command">have</span></span> xBij<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">conjx</span> <span class="main">∈</span> Bij <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_is_Bij<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fin y <span class="keyword1"><span class="command">have</span></span> yBij<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">conjy</span> <span class="main">∈</span> Bij <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjy_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_is_Bij<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">conjx</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>BijGroup <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="skolem">conjy</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span>Bij <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span><span class="main">.</span> restrict <span class="main">(</span>compose <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>Bij <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">conjx</span> <span class="skolem">conjy</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> BijGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> xBij yBij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> compose <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span> <span class="skolem">conjx</span> <span class="skolem">conjy</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">∈</span>subgroups_of_size <span class="free">p</span><span class="main">.</span> <span class="skolem">conjx</span> <span class="main">(</span><span class="skolem">conjy</span> <span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">∈</span>subgroups_of_size <span class="free">p</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="bound">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> restrict_ext<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> PG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>subgroup.subset<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> y <span class="keyword1"><span class="command">have</span></span> yPG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;#</span> <span class="skolem">P</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> l_coset_subset_G<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> x y <span class="keyword1"><span class="command">have</span></span> invxyG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xyG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inv_closed m_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> yBij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">conjy</span> <span class="main">`</span> subgroups_of_size <span class="free">p</span> <span class="main">=</span> subgroups_of_size <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bij_def bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> conjyP<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">conjy</span> <span class="skolem">P</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bij_def bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> imageI<span class="main">)</span> 
    <span class="keyword1"><span class="command">with</span></span> x y P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">conjx</span> <span class="main">(</span><span class="skolem">conjy</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjy_def conjx_def conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> y invy PG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">y</span> <span class="main">&lt;#</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lr_coset_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> PG invx invy y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span> <span class="main">&lt;#</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">y</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coset_mult_assoc yPG<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span> <span class="main">&lt;#</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_mult_group<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> invxyG x yPG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">&lt;#</span> <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lr_coset_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x y PG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lcos_m_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> xyG invxyG PG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lr_coset_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">conjx</span> <span class="main">(</span><span class="skolem">conjy</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">conjx</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>BijGroup <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="skolem">conjy</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">∈</span>subgroups_of_size <span class="free">p</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="bound">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> xyG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="free">p</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="main">=</span> conjugation_action <span class="free">p</span> <span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>BijGroup <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span></sub><span class="hidden">⇙</span> conjugation_action <span class="free">p</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> conjx_def conjy_def conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the Conjugation Action›</span></span>

<span class="keyword1" id="SubgroupConjugation-stabilizer_contains_P"><span class="command">lemma</span></span> stabilizer_contains_P<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> group_action.stabilizer <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="free">p</span><span class="main">)</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> PG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword1"><span class="command">interpret</span></span> conj<span class="main">:</span>group_action <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>conjugation_action <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> acts_on_subsets<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> PG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.m_inv_closed<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> x P <span class="keyword1"><span class="command">have</span></span> xG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def subgroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="free">p</span> <span class="skolem">x</span> <span class="free">P</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> PG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">&lt;#</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coset_join2 subgroup.mem_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> PG x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lcoset_join2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="free">p</span> <span class="skolem">x</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> xG <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> group_action.stabilizer <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="free">p</span><span class="main">)</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conj.stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> stabilizer_supergrp_P<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> group_action.stabilizer <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="free">p</span><span class="main">)</span> <span class="free">P</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> group_action.stabilizer <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="free">p</span><span class="main">)</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stabilizer_contains_P<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> P fin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>group_action.stabilizer <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="free">p</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acts_on_subsets group_action.stabilizer_is_subgroup<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_group subgroup.subgroup_of_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> P_fixed_point_of_P_conj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> subgroups_of_size <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> group_action.fixed_points <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>conjugation_action <span class="free">p</span><span class="main">)</span> <span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword1"><span class="command">interpret</span></span> conjG<span class="main">:</span> group_action <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"subgroups_of_size <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> acts_on_subsets<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> fin <span class="keyword1"><span class="command">interpret</span></span> conjP<span class="main">:</span> group_action <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>conjugation_action <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subgroups_of_size <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acts_on_subsets group_action.subgroup_action<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fin P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> conjG.stabilizer <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stabilizer_contains_P<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> conjP.stabilizer <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conjG.stabilizer_def conjP.stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> P <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> conjP.fixed_points"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjP.fixed_points_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SubgroupConjugation-conj_wo_inv"><span class="command">lemma</span></span> conj_wo_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> QG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">Q</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> PG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">Q</span> <span class="main">#&gt;</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">#&gt;</span> <span class="free">g</span> <span class="main">=</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> invg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> conj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">Q</span> <span class="main">#&gt;</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> QG g invg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">Q</span> <span class="main">#&gt;</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lcos_m_assoc r_coset_subset_G subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g invg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">Q</span> <span class="main">#&gt;</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> r_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> QG g <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">#&gt;</span> <span class="free">g</span> <span class="main">=</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lcos_mult_one r_coset_subset_G subgroup.subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SndSylow">
<div class="head">
<h1>Theory SndSylow</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Secondary Sylow Theorems
    Author:     Jakob von Raumer, Karlsruhe Institute of Technology
    Maintainer: Jakob von Raumer &lt;jakob.raumer at student.kit.edu&gt;
*)</span>

<span class="keyword1"><span class="command">theory</span></span> SndSylow
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SubgroupConjugation.html">SubgroupConjugation</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> Multiset.subset_mset  <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">&lt;#</span>"</span> 50<span class="main">)</span> <span class="comment1">(*prevent a clash with the same syntax for l_coset*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Secondary Sylow Theorems›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1" id="SndSylow-singletonI"><span class="command">lemma</span></span> singletonI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">context</span></span> group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SndSylow-set_mult_inclusion"><span class="command">lemma</span></span> set_mult_inclusion<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Q<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> PQ<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">P</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgroup.one_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> PQ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> H Q x <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_mono l_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SndSylow-card_subgrp_dvd"><span class="command">lemma</span></span> card_subgrp_dvd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">H</span> <span class="keyword1">dvd</span> order <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">H</span><span class="main">)</span> <span class="main">*</span> card <span class="free">H</span> <span class="main">=</span> order <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lagrange<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_triv_left mult.commute<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_0_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SndSylow-subgroup_finite"><span class="command">lemma</span></span> subgroup_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subgroup<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite finite_subset subgroup subgroup.subset<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Extending the Sylow Locale›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This locale extends the originale <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sylow</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> locale by adding
the constraint that the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> must not divide the remainder <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
i.e. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">p</span></span> <span class="main"><span class="main">^</span></span> <span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the maximal size of a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-subgroup of
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> snd_sylow <span class="main">=</span> sylow <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pNotDvdm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">m</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> snd_sylow
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SndSylow-pa_not_zero"><span class="command">lemma</span></span> pa_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_gt_0_nat prime_p<span class="main">)</span>

<span class="keyword1" id="SndSylow-sylow_greater_zero"><span class="command">lemma</span></span> sylow_greater_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> PG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="skolem">P</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cardP<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="skolem">P</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sylow_thm<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> finite_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def subgroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SndSylow-is_snd_sylow"><span class="command">lemma</span></span> is_snd_sylow<span class="main">:</span> <span class="quoted"><span class="quoted">"snd_sylow <span class="free">G</span> <span class="free">p</span> <span class="free">a</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> snd_sylow_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Every $p$-group is Contained in a conjugate of a $p$-Sylow-Group›</span></span>

<span class="keyword1" id="SndSylow-ex_conj_sylow_group"><span class="command">lemma</span></span> ex_conj_sylow_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Psize<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> HsubG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> HG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Psize <span class="keyword1"><span class="command">have</span></span> PG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cardP<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H'</span> <span class="main">=</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> HsubG <span class="keyword1"><span class="command">interpret</span></span> Hgroup<span class="main">:</span> group <span class="quoted"><span class="skolem">H'</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup_imp_group<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> orderH'<span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="skolem">H'</span> <span class="main">=</span>  <span class="free">p</span> <span class="main">^</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H'_def subgroups_of_size_def order_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">λ</span><span class="bound">U</span><span class="main">∈</span><span class="keyword1">rcosets</span> <span class="free">P</span><span class="main">.</span> <span class="bound">U</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> PG <span class="keyword1"><span class="command">interpret</span></span> Gact<span class="main">:</span> group_action <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">φ</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">rcosets</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> φ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_mult_on_rcosets_action<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">interpret</span></span> H'act<span class="main">:</span> group_action <span class="quoted"><span class="skolem">H'</span></span> <span class="quoted"><span class="skolem">φ</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">rcosets</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H'_def subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Gact.subgroup_action mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finite_G PG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> RCOSETS_def r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> finite.emptyI finite_UN_I finite_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> orderH' sylow_axioms cardP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card H'act.fixed_points <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> card <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sylow_def sylow_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H'act.fixed_point_congruence<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> finite_G PG order_G cardP  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">P</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>  <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">*</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lagrange<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> prime_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code mult_cancel2 mult_is_0 mult.commute order_G zero_less_o_G<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">rcosets</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> pNotDvdm prime_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_eq_mod_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card H'act.fixed_points <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">∈</span> H'act.fixed_points"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> Ncoset<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">∈</span> <span class="keyword1">rcosets</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H'act.fixed_points_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="free">P</span> <span class="main">#&gt;</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> RCOSETS_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> invg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> invinvg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> N <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"carrier <span class="skolem">H'</span> <span class="main">⊆</span> H'act.stabilizer <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H'act.fixed_points_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span><span class="main">∈</span><span class="free">H</span><span class="main">.</span> <span class="skolem">φ</span> <span class="bound">h</span> <span class="skolem">N</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H'act.stabilizer_def <span class="keyword1"><span class="command">using</span></span> H'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> HG Ncoset <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span><span class="main">∈</span><span class="free">H</span><span class="main">.</span> <span class="skolem">N</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="bound">h</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> φ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">&lt;#&gt;</span> <span class="free">H</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def r_coset_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">h</span>
    <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> mem_Collect_eq subgroup.m_inv_closed subgroups_of_size_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> n HG PG a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> HG h <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">⊗</span> <span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_mono inv_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">&lt;#&gt;</span> <span class="free">H</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> PG g invg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">&lt;#&gt;</span> <span class="free">H</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coset_mult_assoc coset_mult_one r_inv subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g HG PG invg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">&lt;#&gt;</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">&lt;#</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lr_coset_assoc r_coset_subset_G rcos_assoc_lcos setmult_rcos_assoc subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> PG HG g invg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">&lt;#</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> l_coset_subset_G r_coset_subset_G set_mult_inclusion<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">&lt;#</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> HG g invg invinvg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">&lt;#</span> <span class="free">H</span> <span class="main">⊆</span> <span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coset_mult_assoc coset_mult_inv2 l_coset_subset_G<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">&lt;#</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> HG g invg invinvg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> <span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_inv lcos_m_assoc lcos_mult_one r_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> invg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Every $p$-Group is Contained in a $p$-Sylow-Group›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sylow_contained_in_sylow_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> HG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>subgroup.subset<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> PG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="skolem">P</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cardP<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="skolem">P</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sylow_thm<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> Psize<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> H <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> <span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ex_conj_sylow_group<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> Psize g
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> finite_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span> <span class="skolem">g</span> <span class="skolem">P</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_is_size_invariant<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹$p$-Sylow-Groups are conjugates of each other›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sylow_conjugate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Q<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="free">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Q <span class="keyword1"><span class="command">have</span></span> Qcard<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Q P <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊆</span> <span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ex_conj_sylow_group<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> P finite_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span> <span class="skolem">g</span> <span class="free">P</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_is_size_invariant<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> g P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span> <span class="skolem">g</span> <span class="free">P</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> conjSize<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Qcard <span class="keyword1"><span class="command">have</span></span>  card<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="free">Q</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> conjSize finite_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> finite_subset mem_Collect_eq subgroup.subset subgroups_of_size_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g card <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> sylow_conj_orbit_rel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Q<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">,</span><span class="free">Q</span><span class="main">)</span> <span class="main">∈</span> group_action.same_orbit_rel <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> group_action.same_orbit_rel_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Q P <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">Q</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sylow_conjugate<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Q P <span class="keyword1"><span class="command">have</span></span> g'<span class="main">:</span><span class="quoted"><span class="quoted">"conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span> <span class="skolem">g</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> finite_G <span class="keyword1"><span class="command">interpret</span></span> conj<span class="main">:</span> group_action <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> acts_on_subsets<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conj.same_orbit_rel <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span> <span class="main">∈</span> <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span> <span class="main">×</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">g</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fst <span class="bound">X</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conj.same_orbit_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g g' P Q <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Counting Sylow-Groups›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The number of sylow groups is the orbit size of one of them:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> num_eq_card_orbit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> group_action.orbit <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finite_G <span class="keyword1"><span class="command">interpret</span></span> conj<span class="main">:</span> group_action <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> acts_on_subsets<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"group_action.orbit <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span> <span class="main">=</span> group_action.same_orbit_rel <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">``</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conj.orbit_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Q</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> Q<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> P Q <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="free">P</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sylow_conjugate<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> P conj.orbit_char <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> group_action.orbit <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> group_action.orbit <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> P conj.orbit_char <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span> <span class="skolem">g</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> finite_G P <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_is_size_invariant<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> num_sylow_normalizer<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Psize<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">rcosets</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> group_action.stabilizer <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span><span class="main">⦈</span></sub><span class="hidden">⇙</span> <span class="free">P</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">=</span> card <span class="main">(</span>group_action.stabilizer <span class="free">G</span> <span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> finite_G <span class="keyword1"><span class="command">interpret</span></span> conj<span class="main">:</span> group_action <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> acts_on_subsets<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Psize <span class="keyword1"><span class="command">have</span></span> PG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cardP<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> finite_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> card <span class="main">(</span>conj.orbit <span class="free">P</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>conj.stabilizer <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Psize acts_on_subsets group_action.orbit_size<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> order_G Psize <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">*</span> <span class="free">m</span> <span class="main">=</span> card <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>conj.stabilizer <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> num_eq_card_orbit<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Psize <span class="keyword1"><span class="command">interpret</span></span> stabGroup<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> conj.stabilizer <span class="free">P</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj.stabilizer_is_subgroup subgroup_imp_group<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finite_G Psize <span class="keyword1"><span class="command">have</span></span> PStab<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> conj.stabilizer <span class="free">P</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stabilizer_supergrp_P<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finite_G Psize <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>conj.stabilizer <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite conj.stabilizer_is_subgroup less_nat_zero_code subgroup.finite_imp_card_positive<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> finite_G PStab stabGroup.lagrange <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">rcosets</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> conj.stabilizer <span class="free">P</span><span class="main">⦈</span></sub><span class="hidden">⇙</span> <span class="free">P</span><span class="main">)</span> <span class="main">*</span> card <span class="free">P</span> <span class="main">=</span> order <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> conj.stabilizer <span class="free">P</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> cardP <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> snd_sylow<span class="main">)</span> num_sylow_dvd_remainder<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> finite_G <span class="keyword1"><span class="command">interpret</span></span> conj<span class="main">:</span> group_action <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> acts_on_subsets<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> PG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="skolem">P</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cardP<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="skolem">P</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sylow_thm<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> Psize<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> finite_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> card <span class="main">(</span>conj.orbit <span class="skolem">P</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>conj.stabilizer <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Psize acts_on_subsets group_action.orbit_size<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> order_G Psize <span class="keyword1"><span class="command">have</span></span> orderEq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">*</span> <span class="free">m</span> <span class="main">=</span> card <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>conj.stabilizer <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> num_eq_card_orbit<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> card <span class="main">(</span><span class="keyword1">rcosets</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> conj.stabilizer <span class="skolem">P</span><span class="main">⦈</span></sub><span class="hidden">⇙</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> Psize <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">=</span> card <span class="main">(</span>conj.stabilizer <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> num_sylow_normalizer<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> orderEq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">*</span> <span class="free">m</span> <span class="main">=</span> card <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>mult.assoc mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">*</span> <span class="free">m</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">*</span> card <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> card <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pa_not_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can restrict this locale to refer to a subgroup of order at
least <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">p</span></span> <span class="main"><span class="main">^</span></span> <span class="free"><span class="free">a</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> snd_sylow<span class="main">)</span> restrict_locale<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subgrp<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> card<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="keyword1">dvd</span> card <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd_sylow <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span><span class="main">)</span> <span class="free">p</span> <span class="free">a</span> <span class="main">(</span><span class="main">(</span>card <span class="free">P</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> subgrp <span class="keyword1"><span class="command">interpret</span></span> groupP<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup_imp_group<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span>card <span class="free">P</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> card <span class="keyword1"><span class="command">have</span></span> cardP<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> orderP<span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> cardP subgrp order_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="main">*</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_subgrp_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_mult_dvd_cancel_disj pa_not_zero<span class="main">)</span> 
  <span class="keyword1"><span class="command">with</span></span> pNotDvdm <span class="keyword1"><span class="command">have</span></span> ndvd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dvd_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">PcalM</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PcalM</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">⊆</span> carrier <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">s</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">PRelM</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PRelM</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">N1</span><span class="main">,</span> <span class="bound">N2</span><span class="main">)</span><span class="main">.</span> <span class="bound">N1</span> <span class="main">∈</span> <span class="skolem">PcalM</span> <span class="main">∧</span> <span class="bound">N2</span> <span class="main">∈</span> <span class="skolem">PcalM</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span><span class="main">)</span><span class="main">.</span> <span class="bound">N1</span> <span class="main">=</span> <span class="bound">N2</span> <span class="main">#&gt;</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span></sub><span class="hidden">⇙</span> <span class="bound">g</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> subgrp finite_G <span class="keyword1"><span class="command">have</span></span> finite_groupP<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>subgroup_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> Nsylow<span class="main">:</span> snd_sylow <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">PcalM</span></span> <span class="quoted"><span class="skolem">PRelM</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> snd_sylow_def snd_sylow_axioms_def sylow_def sylow_axioms_def k_def
     <span class="keyword1"><span class="command">using</span></span> groupP.is_group prime_p orderP finite_groupP ndvd PcalM_def PRelM_def k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nsylow.is_snd_sylow<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> snd_sylow<span class="main">)</span> p_sylow_mod_p<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> PG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="skolem">P</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cardP<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="skolem">P</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sylow_thm<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> orderP<span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">P</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> PG <span class="keyword1"><span class="command">have</span></span> PsubG<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> PG cardP <span class="keyword1"><span class="command">have</span></span> PSize<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> PG <span class="keyword1"><span class="command">interpret</span></span> groupP<span class="main">:</span>group <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">P</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgroup_imp_group<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> cardP <span class="keyword1"><span class="command">have</span></span> PSize2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> groupP.subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> groupP.subgroups_of_size_def groupP.subgroup_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finite_G <span class="keyword1"><span class="command">interpret</span></span> conjG<span class="main">:</span> group_action <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> acts_on_subsets<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> PG <span class="keyword1"><span class="command">interpret</span></span> conjP<span class="main">:</span> group_action <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">P</span><span class="main">⦈</span>"</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conjG.subgroup_action<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finite_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def subgroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> orderP prime_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> card conjP.fixed_points <span class="keyword1">mod</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conjP.fixed_point_congruence<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Q</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">∈</span> conjP.fixed_points <span class="main">⟹</span> <span class="bound">Q</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Q</span>
      <span class="keyword3"><span class="command">assume</span></span> Qfixed<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> conjP.fixed_points"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> Qsize<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjP.fixed_points_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> cardQ<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="skolem">Q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="comment1">― ‹The normalizer of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span> in <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">G</span></span><span class="antiquote">}</span></span>›</span>
      <span class="comment1">― ‹Let's first show some basic propertiers of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">N</span><span class="antiquote">}</span></span>›</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> conjG.stabilizer <span class="skolem">Q</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span>card <span class="skolem">N</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> N_def Qsize <span class="keyword1"><span class="command">have</span></span> NG<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="skolem">N</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjG.stabilizer_is_subgroup<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> groupN<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup_imp_group<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Qsize N_def <span class="keyword1"><span class="command">have</span></span> QN<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="skolem">Q</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> stabilizer_supergrp_P <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">― ‹The following proposition is used to show that $P = Q$ later›</span>
      <span class="keyword1"><span class="command">from</span></span> Qsize <span class="keyword1"><span class="command">have</span></span> NfixesQ<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="skolem">N</span><span class="main">.</span> conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span> <span class="bound">g</span> <span class="skolem">Q</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> N_def conjG.stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> Qfixed <span class="keyword1"><span class="command">have</span></span> PfixesQ<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span> <span class="bound">g</span> <span class="skolem">Q</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjP.fixed_points_def conjP.stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> PsubG <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> N_def conjG.stabilizer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> PG N_def Qsize <span class="keyword1"><span class="command">have</span></span> PN<span class="main">:</span><span class="quoted"><span class="quoted">"subgroup <span class="skolem">P</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjG.stabilizer_is_subgroup is_group subgroup.subgroup_of_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> cardP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="keyword1">dvd</span> order <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> groupN.card_subgrp_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">a</span> <span class="keyword1">dvd</span> card <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> NG <span class="keyword1"><span class="command">have</span></span> smaller_sylow<span class="main">:</span><span class="quoted"><span class="quoted">"snd_sylow <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span><span class="main">)</span> <span class="free">p</span> <span class="free">a</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> restrict_locale<span class="main">)</span>
      <span class="comment1">― ‹Instantiate the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">snd_sylow</span><span class="antiquote">}</span></span> Locale a second time for the normalizer of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span>›</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">NcalM</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">NcalM</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">⊆</span> carrier <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">s</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">NRelM</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">NRelM</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">N1</span><span class="main">,</span> <span class="bound">N2</span><span class="main">)</span><span class="main">.</span> <span class="bound">N1</span> <span class="main">∈</span> <span class="skolem">NcalM</span> <span class="main">∧</span> <span class="bound">N2</span> <span class="main">∈</span> <span class="skolem">NcalM</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">∈</span>carrier <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span><span class="main">)</span><span class="main">.</span> <span class="bound">N1</span> <span class="main">=</span> <span class="bound">N2</span> <span class="main">#&gt;</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span></sub><span class="hidden">⇙</span> <span class="bound">g</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">interpret</span></span> Nsylow<span class="main">:</span> snd_sylow <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span>"</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">NcalM</span></span> <span class="quoted"><span class="skolem">NRelM</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> NcalM_def NRelM_def <span class="keyword1"><span class="command">using</span></span> smaller_sylow <span class="keyword1"><span class="command">.</span></span>
      <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">P</span></span><span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span> are conjugate in <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">N</span></span><span class="antiquote">}</span></span>:›</span>
      <span class="keyword1"><span class="command">from</span></span> cardP PN <span class="keyword1"><span class="command">have</span></span> PsizeN<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> groupN.subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> groupN.subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> cardQ QN <span class="keyword1"><span class="command">have</span></span> QsizeN<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> groupN.subgroups_of_size <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> groupN.subgroups_of_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> QsizeN PsizeN <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">&lt;#</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">#&gt;</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span></sub><span class="hidden">⇙</span> <span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">N</span><span class="main">⦈</span></sub><span class="hidden">⇙</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Nsylow.sylow_conjugate<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> NG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">&lt;#</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">#&gt;</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_coset_def l_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>m_inv_consistent<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> NG g Qsize <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugation_action <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">a</span><span class="main">)</span> <span class="skolem">g</span> <span class="skolem">Q</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conjugation_action_def <span class="keyword1"><span class="command">using</span></span> subgroup.subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">with</span></span> g NfixesQ <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> finite_G PSize <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> conjP.fixed_points"</span></span> <span class="keyword1"><span class="command">using</span></span> P_fixed_point_of_P_conj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjP.fixed_points <span class="main">=</span> <span class="main">{</span><span class="skolem">P</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> one<span class="main">:</span><span class="quoted"><span class="quoted">"card conjP.fixed_points <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Suc_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prime_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card conjP.fixed_points <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prime_nat_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> one <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mod_pos_pos_trivial <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>