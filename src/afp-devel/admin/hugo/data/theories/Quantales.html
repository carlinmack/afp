<div id="Dioid_Models_New">
<div class="head">
<h1>Theory Dioid_Models_New</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Models of Dioids
   Author:     Alasdair Armstrong, Georg Struth, Tjark Weber
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Models of Dioids›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Dioid_Models_New
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Kleene_Algebra/Dioid.html">Kleene_Algebra.Dioid</a>
          <a href="../../HOL/HOL/Real.html">HOL.Real</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section we consider some well known models of
dioids. These so far include the powerset dioid over a monoid,
languages, binary relations, sets of traces, sets paths (in a graph),
as well as the min-plus and the max-plus semirings. Most of these
models are taken from an article about Kleene algebras with
domain~\cite{desharnaismoellerstruth06kad}.

The advantage of formally linking these models with the abstract
axiomatisations of dioids is that all abstract theorems are
automatically available in all models. It therefore makes sense to
establish models for the strongest possible axiomatisations (whereas
theorems should be proved for the weakest ones).›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Powerset Dioid over a Monoid›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We assume a multiplicative monoid and define the usual complex
product on sets of elements. We formalise the well known result that
this lifting induces a dioid.›</span></span>

<span class="comment1">(* change here! *)</span>

<span class="keyword1"><span class="command">instantiation</span></span> set <span class="main">::</span> <span class="main">(</span><span class="quoted">semigroup_mult</span><span class="main">)</span> <span class="quoted">semigroup_mult</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">times_set</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="comment1">― ‹the complex product›</span>
  <span class="quoted"><span class="quoted">"<span class="free">times_set</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">u</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command">unfolding</span></span> times_set_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> mult.assoc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> set <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_mult</span><span class="main">)</span> <span class="quoted">monoid_mult</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_set</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">one_set</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command">unfolding</span></span> one_set_def times_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* instantiation and end of change *)</span>

<span class="keyword1"><span class="command">instantiation</span></span> set <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_mult</span><span class="main">)</span> <span class="quoted">dioid_one_zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> zero_set_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> plus_set_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">Z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">+</span> <span class="skolem">Y</span> <span class="main">+</span> <span class="skolem">Z</span> <span class="main">=</span> <span class="skolem">X</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">+</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_assoc plus_set_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">+</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="skolem">Y</span> <span class="main">+</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute plus_set_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X</span> <span class="main">+</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">Z</span> <span class="main">=</span> <span class="skolem">X</span> <span class="main">⋅</span> <span class="skolem">Z</span> <span class="main">+</span> <span class="skolem">Y</span> <span class="main">⋅</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_set_def times_set_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⋅</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_set_def times_set_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⋅</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_set_def times_set_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_set_def zero_set_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⋅</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_set_def zero_set_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_set_def zero_set_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span> <span class="main">⟷</span> <span class="skolem">X</span> <span class="main">+</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_set_def subset_Un_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊂</span> <span class="skolem">Y</span> <span class="main">⟷</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span> <span class="main">∧</span> <span class="skolem">X</span> <span class="main">≠</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> psubset_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">+</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_absorb plus_set_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">+</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">+</span> <span class="skolem">X</span> <span class="main">⋅</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_set_def times_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* instantiation *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Language Dioids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Language dioids arise as special cases of the monoidal lifting
because sets of words form free monoids. Moreover, monoids of words
are isomorphic to monoids of lists under append.

To show that languages form dioids it therefore suffices to show that
sets of lists closed under append and multiplication with the empty
word form a (multiplicative) monoid. Isabelle then does the rest of the work
automatically. Infix~<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>@›</span></span></span></span> denotes word
concatenation.›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">monoid_mult</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> times_list_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> one_list_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≡</span> <span class="main">[]</span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">*</span> <span class="skolem">ys</span> <span class="main">*</span> <span class="skolem">zs</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">*</span> <span class="skolem">zs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_list_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_list_def times_list_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_list_def times_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>  <span class="comment1">(* instantiation *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Languages as sets of lists have already been formalised in
Isabelle in various places. We can now obtain much of their algebra
for free.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> lan <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list set"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> lan_dioid<span class="main">:</span> dioid_one_zero <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> lan"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relation Dioids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now show that binary relations under union, relational
composition, the identity relation, the empty relation and set
inclusion form dioids. Due to the well developed relation library of
Isabelle this is entirely trivial.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_dioid<span class="main">:</span> dioid_one_zero <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span> <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_monoid<span class="main">:</span> monoid_mult <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Trace Dioids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Traces have been considered, for instance, by
Kozen~\cite{kozen00hoare} in the context of Kleene algebras with
tests. Intuitively, a trace is an execution sequence of a labelled
transition system from some state to some other state, in which state
labels and action labels alternate, and which begin and end with a
state label.

Traces generalise words: words can be obtained from traces by
forgetting state labels. Similarly, sets of traces generalise
languages.

In this section we show that sets of traces under union, an
appropriately defined notion of complex product, the set of all traces
of length zero, the empty set of traces and set inclusion form a
dioid.

We first define the notion of trace and the product of traces, which
has been called \emph{fusion product} by Kozen.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'p</span><span class="main">)</span> list"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">first</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace <span class="main">⇒</span> <span class="tfree">'p</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">first</span> <span class="main">=</span> fst"</span></span>

<span class="keyword1" id="Dioid_Models_New-first_conv"><span class="command">lemma</span></span> first_conv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"first <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> first_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">last</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace <span class="main">⇒</span> <span class="tfree">'p</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">last</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">last</span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>List.last <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Dioid_Models_New-last_append"><span class="command">lemma</span></span> last_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> last <span class="main">(</span>last <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> last <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> last <span class="main">(</span>last <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">list</span><span class="main">.</span> <span class="free">xs</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">#</span> <span class="bound">list</span> <span class="main">⟹</span>
    last <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> last <span class="main">(</span>last <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">list</span><span class="main">.</span> <span class="main">⟦</span><span class="free">xs</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">#</span> <span class="bound">list</span><span class="main">;</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span><span class="main">⟧</span>
      <span class="main">⟹</span> last <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> last <span class="main">(</span>last <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">list</span> <span class="bound">aa</span> <span class="bound">lista</span><span class="main">.</span> <span class="main">⟦</span><span class="free">xs</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">#</span> <span class="bound">list</span><span class="main">;</span> <span class="free">ys</span> <span class="main">=</span> <span class="bound">aa</span> <span class="main">#</span> <span class="bound">lista</span><span class="main">⟧</span>
      <span class="main">⟹</span> last <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> last <span class="main">(</span>last <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The fusion product is a partial operation. It is undefined if
the last element of the first trace and the first element of the
second trace are different. If these elements are the same, then the
fusion product removes the first element from the second trace and
appends the resulting object to the first trace.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">t_fusion</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">t_fusion</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> last <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> first <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">@</span> snd <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">else</span> undefined"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now show that the first element and the last element of a
trace are a left and right unit for that trace and prove some other
auxiliary lemmas.›</span></span>

<span class="keyword1" id="Dioid_Models_New-t_fusion_leftneutral"><span class="command">lemma</span></span> t_fusion_leftneutral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"t_fusion <span class="main">(</span>first <span class="free">x</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_fusion_def<span class="main">)</span>

<span class="keyword1" id="Dioid_Models_New-fusion_rightneutral"><span class="command">lemma</span></span> fusion_rightneutral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"t_fusion <span class="free">x</span> <span class="main">(</span>last <span class="free">x</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_fusion_def<span class="main">)</span>

<span class="keyword1" id="Dioid_Models_New-first_t_fusion"><span class="command">lemma</span></span> first_t_fusion <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="free">x</span> <span class="main">=</span> first <span class="free">y</span> <span class="main">⟹</span> first <span class="main">(</span>t_fusion <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> first <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_def t_fusion_def<span class="main">)</span>

<span class="keyword1" id="Dioid_Models_New-last_t_fusion"><span class="command">lemma</span></span> last_t_fusion <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="free">x</span> <span class="main">=</span> first <span class="free">y</span> <span class="main">⟹</span> last <span class="main">(</span>t_fusion <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> last <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_def t_fusion_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show that fusion of traces is associative.›</span></span>

<span class="keyword1" id="Dioid_Models_New-t_fusion_assoc"><span class="command">lemma</span></span> t_fusion_assoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> last <span class="free">x</span> <span class="main">=</span> first <span class="free">y</span><span class="main">;</span> last <span class="free">y</span> <span class="main">=</span> first <span class="free">z</span> <span class="main">⟧</span> <span class="main">⟹</span> t_fusion <span class="free">x</span> <span class="main">(</span>t_fusion <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> t_fusion <span class="main">(</span>t_fusion <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_fusion_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sets of Traces›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now lift the fusion product to a complex product on sets of
traces. This operation is total.›</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">t_prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">{</span>t_fusion <span class="bound">u</span> <span class="bound">v</span><span class="main">|</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∧</span> last <span class="bound">u</span> <span class="main">=</span> first <span class="bound">v</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we define the empty set of traces and the set of traces
of length zero as the multiplicative unit of the trace dioid.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">t_zero</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">t_zero</span> <span class="main">≡</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">t_one</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">t_one</span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now provide elimination rules for trace products.›</span></span>

<span class="keyword1" id="Dioid_Models_New-t_prod_iff"><span class="command">lemma</span></span> t_prod_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">X</span><span class="main">⋅</span><span class="free">Y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> t_fusion <span class="bound">u</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∧</span> last <span class="bound">u</span> <span class="main">=</span> first <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> t_prod_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Dioid_Models_New-t_prod_intro"><span class="command">lemma</span></span> t_prod_intro <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">X</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">;</span> last <span class="free">u</span> <span class="main">=</span> first <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> t_fusion <span class="free">u</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">X</span><span class="main">⋅</span><span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> t_prod_iff<span class="main">)</span>

<span class="keyword1" id="Dioid_Models_New-t_prod_elim"><span class="command">lemma</span></span> t_prod_elim <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">X</span><span class="main">⋅</span><span class="free">Y</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> t_fusion <span class="bound">u</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∧</span> last <span class="bound">u</span> <span class="main">=</span> first <span class="bound">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> t_prod_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we prove the interpretation statement that sets of traces
under union and the complex product based on trace fusion together
with the empty set of traces and the set of traces of length one forms
a dioid.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> trace_dioid<span class="main">:</span> dioid_one_zero <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted">t_prod</span> <span class="quoted">t_one</span> <span class="quoted">t_zero</span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_prod_def t_one_def t_zero_def t_fusion_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> last_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> last_append append_assoc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  t_prod <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Path Diod›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next model we consider are sets of paths in a graph. We
consider two variants, one that contains the empty path and one that
doesn't. The former leads to more difficult proofs and a more involved
specification of the complex product. We start with paths that include
the empty path. In this setting, a path is a list of nodes.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Path Models with the Empty Path›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> path <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Path fusion is defined similarly to trace
fusion. Mathematically it should be a partial operation. The fusion of
two empty paths yields the empty path; the fusion between a non-empty
path and an empty one is undefined; the fusion of two non-empty paths
appends the tail of the second path to the first one.

We need to use a total alternative and make sure that undefined paths
do not contribute to the complex product.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">p_fusion</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> path <span class="main">⇒</span> <span class="tfree">'a</span> path <span class="main">⇒</span> <span class="tfree">'a</span> path"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p_fusion</span> <span class="main">[]</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">p_fusion</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">p_fusion</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span>"</span></span>

<span class="keyword1" id="Dioid_Models_New-p_fusion_assoc"><span class="command">lemma</span></span> p_fusion_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"p_fusion <span class="free">ps</span> <span class="main">(</span>p_fusion <span class="free">qs</span> <span class="free">rs</span><span class="main">)</span> <span class="main">=</span> p_fusion <span class="main">(</span>p_fusion <span class="free">ps</span> <span class="free">qs</span><span class="main">)</span> <span class="free">rs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_fusion.elims p_fusion.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">qs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neq_Nil_conv p_fusion.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> p_fusion.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span><span class="main">.</span> <span class="main">(</span><span class="main">[]</span> <span class="main">=</span> <span class="bound">ps</span> <span class="main">∨</span> hd <span class="bound">ps</span> <span class="main">#</span> tl <span class="bound">ps</span> <span class="main">=</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">q</span> <span class="bound">qs</span><span class="main">.</span> <span class="bound">q</span> <span class="main">#</span> <span class="bound">qs</span> <span class="main">≠</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">∨</span> <span class="main">[]</span> <span class="main">≠</span> <span class="bound">ps</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> list.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">q</span> <span class="bound">qs</span><span class="main">.</span> p_fusion <span class="bound">ps</span> <span class="main">(</span><span class="bound">q</span> <span class="main">#</span> <span class="bound">qs</span><span class="main">)</span> <span class="main">=</span> <span class="bound">ps</span> <span class="main">@</span> <span class="bound">qs</span> <span class="main">∨</span> <span class="main">[]</span> <span class="main">=</span> <span class="bound">ps</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_fusion.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Cons_eq_appendI append_eq_appendI p_fusion.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> p_fusion.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This lemma overapproximates the real situation, but it holds
in all cases where path fusion should be defined.›</span></span>

<span class="keyword1" id="Dioid_Models_New-p_fusion_last"><span class="command">lemma</span></span> p_fusion_last<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"List.last <span class="free">ps</span> <span class="main">=</span> hd <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">qs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"List.last <span class="main">(</span>p_fusion <span class="free">ps</span> <span class="free">qs</span><span class="main">)</span> <span class="main">=</span> List.last <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> List.last.simps List.last_append append_Nil2 assms list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neq_Nil_conv p_fusion.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Dioid_Models_New-p_fusion_hd"><span class="command">lemma</span></span> p_fusion_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">ps</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="free">qs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> hd <span class="main">(</span>p_fusion <span class="free">ps</span> <span class="free">qs</span><span class="main">)</span> <span class="main">=</span> hd <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust p_fusion.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> append_Cons list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Dioid_Models_New-nonempty_p_fusion"><span class="command">lemma</span></span> nonempty_p_fusion<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">ps</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="free">qs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> p_fusion <span class="free">ps</span> <span class="free">qs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust append_Cons p_fusion.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define a condition that filters out undefined paths in
the complex product.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">p_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> path <span class="main">⇒</span> <span class="tfree">'a</span> path <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">p_filter</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>List.last <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">=</span> hd <span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p_prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> path set <span class="main">⇒</span> <span class="tfree">'a</span> path set <span class="main">⇒</span> <span class="tfree">'a</span> path set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">rs</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">ps</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">qs</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">.</span> <span class="bound">rs</span> <span class="main">=</span> p_fusion <span class="bound">ps</span> <span class="bound">qs</span> <span class="main">∧</span> p_filter <span class="bound">ps</span> <span class="bound">qs</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Dioid_Models_New-p_prod_iff"><span class="command">lemma</span></span> p_prod_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⋅</span> <span class="free">Y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">qs</span> <span class="bound">rs</span><span class="main">.</span> <span class="free">ps</span> <span class="main">=</span> p_fusion <span class="bound">qs</span> <span class="bound">rs</span> <span class="main">∧</span> <span class="bound">qs</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">rs</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∧</span> p_filter <span class="bound">qs</span> <span class="bound">rs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> p_prod_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Due to the complexity of the filter condition, proving
properties of complex products can be tedious.›</span></span>

<span class="keyword1" id="Dioid_Models_New-p_prod_assoc"><span class="command">lemma</span></span> p_prod_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">X</span> <span class="main">⋅</span> <span class="free">Y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">Z</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">Y</span> <span class="main">⋅</span> <span class="free">Z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> <span class="main">(</span><span class="free">X</span> <span class="main">⋅</span> <span class="free">Y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">Z</span> <span class="main">⟷</span> <span class="skolem">ps</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">Y</span> <span class="main">⋅</span> <span class="free">Z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> nonempty_p_fusion p_prod_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_prod_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> nonempty_p_fusion p_fusion_assoc p_fusion_hd p_fusion_last<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define the multiplicative unit of the path dioid as the
set of all paths of length one, including the empty path, and show the
unit laws with respect to the path product.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p_one</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> path set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p_one</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">p</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">q</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">[</span><span class="bound">q</span><span class="main">]</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Dioid_Models_New-p_prod_onel"><span class="command">lemma</span></span> p_prod_onel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"p_one <span class="main">⋅</span> <span class="free">X</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> p_one <span class="main">⋅</span> <span class="free">X</span> <span class="main">⟷</span> <span class="skolem">ps</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_one_def p_prod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> nonempty_p_fusion not_Cons_self<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_one_def p_prod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> append_Cons append_Nil list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neq_Nil_conv p_fusion.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Cons_eq_appendI list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> last_ConsL list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> p_fusion.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> self_append_conv2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dioid_Models_New-p_prod_oner"><span class="command">lemma</span></span> p_prod_oner <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⋅</span> p_one <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⋅</span> p_one <span class="main">⟷</span> <span class="skolem">ps</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_one_def p_prod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> nonempty_p_fusion not_Cons_self2<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> p_fusion.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_one_def p_prod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> append_Nil2 neq_Nil_conv p_fusion.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> p_fusion.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> self_append_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show distributivity laws at the powerset level.›</span></span>

<span class="keyword1" id="Dioid_Models_New-p_prod_distl"><span class="command">lemma</span></span> p_prod_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">Y</span> <span class="main">∪</span> <span class="free">Z</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⋅</span> <span class="free">Y</span> <span class="main">∪</span> <span class="free">X</span> <span class="main">⋅</span> <span class="free">Z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">Y</span> <span class="main">∪</span> <span class="free">Z</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">ps</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⋅</span> <span class="free">Y</span> <span class="main">∪</span> <span class="free">X</span> <span class="main">⋅</span> <span class="free">Z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ps</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_prod_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Dioid_Models_New-p_prod_distr"><span class="command">lemma</span></span> p_prod_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">Z</span> <span class="main">=</span> <span class="free">X</span> <span class="main">⋅</span> <span class="free">Z</span> <span class="main">∪</span> <span class="free">Y</span> <span class="main">⋅</span> <span class="free">Z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">∈</span> <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">Z</span> <span class="main">⟷</span> <span class="skolem">ps</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⋅</span> <span class="free">Z</span> <span class="main">∪</span> <span class="free">Y</span> <span class="main">⋅</span> <span class="free">Z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ps</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_prod_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we show that sets of paths under union, the complex
product, the unit set and the empty set form a dioid.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> path_dioid<span class="main">:</span> dioid_one_zero <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted">p_one</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> path set"</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span> <span class="main">∪</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">∪</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∪</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> p_prod_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">∪</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> p_prod_distr<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_one <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> p_prod_onel<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> p_one <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> p_prod_oner<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∪</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_not_in_conv p_prod_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_not_in_conv p_prod_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊂</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">∪</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">∪</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> p_prod_distl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  p_prod <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Path Models without the Empty Path›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now build a model of paths that does not include the empty
path and therefore leads to a simpler complex product.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> ppath <span class="main">=</span> Node <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">|</span> Cons <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">pp_first</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pp_first</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>   <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pp_first</span> <span class="main">(</span>Cons <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">pp_last</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pp_last</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>    <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pp_last</span> <span class="main">(</span>Cons <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">pp_last</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The path fusion product (although we define it as a total
funcion) should only be applied when the last element of the first
argument is equal to the first element of the second argument.›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">pp_fusion</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath <span class="main">⇒</span> <span class="tfree">'a</span> ppath <span class="main">⇒</span> <span class="tfree">'a</span> ppath"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pp_fusion</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pp_fusion</span> <span class="main">(</span>Cons <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> Cons <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">pp_fusion</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now go through the same steps as for traces and paths
before, showing that the first and last element of a trace a left or
right unit for that trace and that the fusion product on traces is
associative.›</span></span>

<span class="keyword1" id="Dioid_Models_New-pp_fusion_leftneutral"><span class="command">lemma</span></span> pp_fusion_leftneutral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pp_fusion <span class="main">(</span>Node <span class="main">(</span>pp_first <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Dioid_Models_New-pp_fusion_rightneutral"><span class="command">lemma</span></span> pp_fusion_rightneutral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pp_fusion <span class="free">x</span> <span class="main">(</span>Node <span class="main">(</span>pp_last <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Dioid_Models_New-pp_first_pp_fusion"><span class="command">lemma</span></span> pp_first_pp_fusion <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"pp_last <span class="free">x</span> <span class="main">=</span> pp_first <span class="free">y</span> <span class="main">⟹</span> pp_first <span class="main">(</span>pp_fusion <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> pp_first <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Dioid_Models_New-pp_last_pp_fusion"><span class="command">lemma</span></span> pp_last_pp_fusion <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"pp_last <span class="free">x</span> <span class="main">=</span> pp_first <span class="free">y</span> <span class="main">⟹</span> pp_last <span class="main">(</span>pp_fusion <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> pp_last <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Dioid_Models_New-pp_fusion_assoc"><span class="command">lemma</span></span> pp_fusion_assoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> pp_last <span class="free">x</span> <span class="main">=</span> pp_first <span class="free">y</span><span class="main">;</span> pp_last <span class="free">y</span> <span class="main">=</span> pp_first <span class="free">z</span> <span class="main">⟧</span> <span class="main">⟹</span> pp_fusion <span class="free">x</span> <span class="main">(</span>pp_fusion <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> pp_fusion <span class="main">(</span>pp_fusion <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now lift the path fusion product to a complex product on
sets of paths. This operation is total.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pp_prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath set <span class="main">⇒</span> <span class="tfree">'a</span> ppath set <span class="main">⇒</span> <span class="tfree">'a</span> ppath set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main"><span class="free">⋅</span></span><span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">{</span>pp_fusion <span class="bound">u</span> <span class="bound">v</span><span class="main">|</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∧</span> pp_last <span class="bound">u</span> <span class="main">=</span> pp_first <span class="bound">v</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we define the set of paths of length one as the
multiplicative unit of the path dioid.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pp_one</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pp_one</span> <span class="main">≡</span> range Node"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We again provide an
elimination rule.›</span></span>

<span class="keyword1" id="Dioid_Models_New-pp_prod_iff"><span class="command">lemma</span></span> pp_prod_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">X</span><span class="main">⋅</span><span class="free">Y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> pp_fusion <span class="bound">u</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∧</span> pp_last <span class="bound">u</span> <span class="main">=</span> pp_first <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> pp_prod_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">interpretation</span></span> ppath_dioid<span class="main">:</span> dioid_one_zero <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted">pp_one</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span> <span class="main">∪</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">∪</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∪</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_prod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> pp_first_pp_fusion pp_fusion_assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> pp_last_pp_fusion<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">∪</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_prod_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pp_one <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_one_def pp_prod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> pp_fusion.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pp_last.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rangeI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> pp_one <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_one_def pp_prod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> pp_first.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pp_fusion_rightneutral rangeI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∪</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_prod_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_prod_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊂</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">∪</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">∪</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_prod_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  pp_prod <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Distributive Lattice Dioid›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A bounded distributive lattice is a distributive lattice with
a least and a greatest element. Using Isabelle's lattice theory file
we define a bounded distributive lattice as an axiomatic type class
and show, using a sublocale statement, that every bounded distributive
lattice is a dioid with one and zero.›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_distributive_lattice <span class="main">=</span> bounded_lattice <span class="main">+</span> distrib_lattice

<span class="keyword1"><span class="command">sublocale</span></span> bounded_distributive_lattice <span class="main">⊆</span> dioid_one_zero <span class="quoted">sup</span> <span class="quoted">inf</span> <span class="quoted">top</span> <span class="quoted">bot</span> <span class="quoted">less_eq</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sup <span class="main">(</span>sup <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> sup <span class="skolem">x</span> <span class="main">(</span>sup <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> sup_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sup <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> sup <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> sup.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span>inf <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> inf <span class="skolem">x</span> <span class="main">(</span>inf <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf.left_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span>sup <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> sup <span class="main">(</span>inf <span class="skolem">x</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span>inf <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf top <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf <span class="skolem">x</span> top <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sup bot <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf bot <span class="skolem">x</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf <span class="skolem">x</span> bot <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sup <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> le_iff_sup<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sup <span class="skolem">x</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf <span class="skolem">x</span> <span class="main">(</span>sup <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span>inf <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>inf <span class="skolem">x</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> inf_sup_distrib1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Boolean Dioid›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section we show that the booleans form a dioid,
because the booleans form a bounded distributive lattice.›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> bool <span class="main">::</span> <span class="quoted">bounded_distributive_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* instantiation *)</span>

<span class="keyword1"><span class="command">interpretation</span></span> boolean_dioid<span class="main">:</span> dioid_one_zero <span class="quoted">sup</span> <span class="quoted">inf</span> <span class="quoted">True</span> <span class="quoted">False</span> <span class="quoted">less_eq</span> <span class="quoted">less</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_bool_def sup_bool_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Max-Plus Dioid›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following dioids have important applications in
combinatorial optimisations, control theory, algorithm design and
computer networks.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A definition of reals extended with~<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>+∞›</span></span></span></span> {\em
and}~<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>-∞›</span></span></span></span> may be found in {\em
HOL/Library/Extended\_Real.thy}. Alas, we require separate extensions
with either~<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>+∞›</span></span></span></span> or~<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>-∞›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The carrier set of the max-plus semiring is the set of real
numbers extended by minus infinity. The operation of addition is
maximum, the operation of multiplication is addition, the additive
unit is minus infinity and the multiplicative unit is zero.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> mreal <span class="main">=</span> mreal <span class="quoted">real</span> <span class="main">|</span> MInfty  <span class="comment1">― ‹minus infinity›</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mreal_max</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mreal_max</span> <span class="main">(</span>mreal <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>mreal <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> mreal <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mreal_max</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> MInfty <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mreal_max</span> MInfty <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1" id="Dioid_Models_New-mreal_max_simp_3"><span class="command">lemma</span></span> mreal_max_simp_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mreal_max MInfty <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mreal_plus</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mreal_plus</span> <span class="main">(</span>mreal <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>mreal <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> mreal <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mreal_plus</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> MInfty"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now show that the max plus-semiring satisfies the axioms of
selective semirings, from which it follows that it satisfies the dioid
axioms.›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> mreal <span class="main">::</span> <span class="quoted">selective_semiring</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> zero_mreal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≡</span> MInfty"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> one_mreal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≡</span> mreal <span class="main">0</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> plus_mreal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> mreal_max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> times_mreal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> mreal_plus <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> less_eq_mreal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>mreal<span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> less_mreal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>mreal<span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">mreal</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_mreal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_mreal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_mreal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_mreal_def times_mreal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_mreal_def times_mreal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_mreal_def times_mreal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_mreal_def zero_mreal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_mreal_def zero_mreal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_mreal_def zero_mreal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_mreal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_mreal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_mreal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> linorder_le_cases max.absorb_iff2 max.absorb1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_mreal_def times_mreal_def<span class="main">)</span>     <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* instantiation *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Min-Plus Dioid›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The min-plus dioid is also known as {\em tropical
semiring}. Here we need to add a positive infinity to the real
numbers. The procedere follows that of max-plus semirings.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> preal <span class="main">=</span> preal <span class="quoted">real</span> <span class="main">|</span> PInfty  <span class="comment1">― ‹plus infinity›</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">preal_min</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preal_min</span> <span class="main">(</span>preal <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>preal <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> preal <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">preal_min</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> PInfty <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">preal_min</span> PInfty <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1" id="Dioid_Models_New-preal_min_simp_3"><span class="command">lemma</span></span> preal_min_simp_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"preal_min PInfty <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">preal_plus</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preal_plus</span> <span class="main">(</span>preal <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>preal <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> preal <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">preal_plus</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> PInfty"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> preal <span class="main">::</span> <span class="quoted">selective_semiring</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> zero_preal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≡</span> PInfty"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> one_preal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≡</span> preal <span class="main">0</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> plus_preal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> preal_min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> times_preal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> preal_plus <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> less_eq_preal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>preal<span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> less_preal_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>preal<span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">preal</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_preal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_preal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_preal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_preal_def times_preal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_preal_def times_preal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_preal_def times_preal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_preal_def zero_preal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_preal_def zero_preal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_preal_def zero_preal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_preal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_preal_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_preal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> linorder_le_cases min.absorb2 min.absorb_iff1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_preal_def times_preal_def<span class="main">)</span>   <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* instantiation *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Variants of min-plus and max-plus semirings can easily be
obtained. Here we formalise the min-plus semiring over the natural
numbers as an example.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> pnat <span class="main">=</span> pnat <span class="quoted">nat</span> <span class="main">|</span> PInfty  <span class="comment1">― ‹plus infinity›</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pnat_min</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pnat_min</span> <span class="main">(</span>pnat <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>pnat <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> pnat <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pnat_min</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> PInfty <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pnat_min</span> PInfty <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Dioid_Models_New-pnat_min_simp_3"><span class="command">lemma</span></span> pnat_min_simp_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pnat_min PInfty <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pnat_plus</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pnat_plus</span> <span class="main">(</span>pnat <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>pnat <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> pnat <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pnat_plus</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> PInfty"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> pnat <span class="main">::</span> <span class="quoted">selective_semiring</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> zero_pnat_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≡</span> PInfty"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> one_pnat_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≡</span> pnat <span class="main">0</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> plus_pnat_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> pnat_min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> times_pnat_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> pnat_plus <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> less_eq_pnat_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>pnat<span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> less_pnat_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>pnat<span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

  <span class="keyword1" id="Dioid_Models_New-zero_pnat_top"><span class="command">lemma</span></span> zero_pnat_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>pnat<span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_pnat_def plus_pnat_def one_pnat_def<span class="main">)</span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">pnat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pnat_def times_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_pnat_def times_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_pnat_def times_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pnat_def zero_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_pnat_def zero_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_pnat_def zero_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pnat_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> linorder_le_cases min.absorb2 min.absorb_iff1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pnat_def times_pnat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* instantiation *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Quantales">
<div class="head">
<h1>Theory Quantales</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Quantales
   Author: Georg Struth 
   Maintainer: Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
   Contributions by Brijesh Dongol, Victor Gomes, Ian Hayes
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Quantales›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quantales
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../Order_Lattice_Props/Closure_Operators.html">Order_Lattice_Props.Closure_Operators</a>"</span>
   <a href="../Kleene_Algebra/Dioid.html">Kleene_Algebra.Dioid</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Families of Proto-Quantales›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proto-Quanales are complete lattices equipped with an operation of composition or multiplication
that need not be associative. The notation in this component differs from Rosenthal's \cite{Rosenthal90}, but is consistent with the one we use 
for semirings and Kleene algebras.›</span></span>
  
<span class="keyword1"><span class="command">class</span></span> proto_near_quantale <span class="main">=</span> complete_lattice <span class="main">+</span> times <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> Sup_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="free">X</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantales-Sup_pres_multr"><span class="command">lemma</span></span> Sup_pres_multr<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup_pres <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>proto_near_quantale<span class="main">)</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fun_eq_iff comp_def Sup_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

<span class="keyword1" id="Quantales-sup_pres_multr"><span class="command">lemma</span></span> sup_pres_multr<span class="main">:</span> <span class="quoted"><span class="quoted">"sup_pres <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>proto_near_quantale<span class="main">)</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Sup_pres_multr Sup_sup_pres <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Quantales-bot_pres_multr"><span class="command">lemma</span></span> bot_pres_multr<span class="main">:</span> <span class="quoted"><span class="quoted">"bot_pres <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>proto_near_quantale<span class="main">)</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SUP_empty Sup_distr Sup_empty<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> proto_near_quantale
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Quantales-mult_botl"><span class="command">lemma</span></span> mult_botl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">a</span><span class="main">∈</span><span class="main">{}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_distr Sup_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Quantales-sup_distr"><span class="command">lemma</span></span> sup_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> SUP_empty SUP_insert Sup_distr sup_Sup sup_bot.right_neutral<span class="main">)</span>
   
<span class="keyword1" id="Quantales-mult_isor"><span class="command">lemma</span></span> mult_isor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.absorb_iff1 sup_distr<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Left and right residuals can be defined in every proto-nearquantale.›</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bres</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">→</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fres</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">←</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main"><span class="free">←</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The left one is a right adjoint  to composition. For the right one, additional assumptions are needed›</span></span>

<span class="keyword1" id="Quantales-bres_galois_imp"><span class="command">lemma</span></span> bres_galois_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_upper bres_def<span class="main">)</span>
    
<span class="keyword1" id="Quantales-fres_galois"><span class="command">lemma</span></span> fres_galois<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_upper fres_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main">}</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_def mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_distr setcompr_eq_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Quantales-fres_adj"><span class="command">lemma</span></span> fres_adj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>proto_near_quantale<span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊣</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_def fres_galois<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> proto_near_quantale
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Quantales-fres_canc1"><span class="command">lemma</span></span> fres_canc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois<span class="main">)</span>

<span class="keyword1" id="Quantales-fres_canc2"><span class="command">lemma</span></span> fres_canc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fres_galois <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Quantales-inf_fres"><span class="command">lemma</span></span> inf_fres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">←</span> <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fres_canc2 Inf_eqI fres_galois mem_Collect_eq<span class="main">)</span>

<span class="keyword1" id="Quantales-bres_iso"><span class="command">lemma</span></span> bres_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">→</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">→</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Sup_le_iff bres_def bres_galois_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Quantales-bres_anti"><span class="command">lemma</span></span> bres_anti<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">→</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Sup_le_iff bres_def bres_galois_imp fres_galois order_trans mem_Collect_eq<span class="main">)</span>

<span class="keyword1" id="Quantales-fres_iso"><span class="command">lemma</span></span> fres_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">←</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">←</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fres_galois dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantales-bres_top_top"><span class="command">lemma</span></span> bres_top_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main">→</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois_imp dual_order.antisym<span class="main">)</span>

<span class="keyword1" id="Quantales-fres_top_top"><span class="command">lemma</span></span> fres_top_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main">←</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fres_galois top_greatest top_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantales-bres_bot_bot"><span class="command">lemma</span></span> bres_bot_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">→</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois_imp top_le<span class="main">)</span>

<span class="keyword1" id="Quantales-left_sided_localp"><span class="command">lemma</span></span> left_sided_localp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor top_greatest<span class="main">)</span>

<span class="keyword1" id="Quantales-fres_sol"><span class="command">lemma</span></span> fres_sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dual_order.antisym fres_canc1 fres_canc2 mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Quantales-sol_fres"><span class="command">lemma</span></span> sol_fres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">←</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">y</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fres_canc1 fres_canc2 fres_sol eq_iff fres_galois<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> proto_pre_quantale <span class="main">=</span> proto_near_quantale <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> Sup_subdistl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">⨆</span><span class="free">Y</span>"</span></span>
    
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Quantales-sup_subdistl"><span class="command">lemma</span></span> sup_subdistl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> SUP_empty SUP_insert Sup_subdistl sup_Sup sup_bot_right<span class="main">)</span>

<span class="keyword1" id="Quantales-mult_isol"><span class="command">lemma</span></span> mult_isol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_sup le_sup_iff sup_subdistl<span class="main">)</span>

<span class="keyword1" id="Quantales-fres_anti"><span class="command">lemma</span></span> fres_anti<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">←</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dual_order.trans fres_galois mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
    
<span class="keyword1"><span class="command">class</span></span> weak_proto_quantale <span class="main">=</span> proto_near_quantale <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> weak_Sup_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">⨆</span><span class="free">Y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span> 

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> proto_pre_quantale
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">⨆</span><span class="bound">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">⨆</span><span class="bound">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weak_Sup_distl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">⨆</span><span class="bound">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Quantales-sup_distl"><span class="command">lemma</span></span>  sup_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> weak_Sup_distl<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_eqI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span> <span class="comment1">(* nitpick [expect = genuine] *)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">class</span></span> proto_quantale <span class="main">=</span> proto_near_quantale <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Sup_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">⨆</span><span class="free">Y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span>  

<span class="keyword1" id="Quantales-Sup_pres_multl"><span class="command">lemma</span></span> Sup_pres_multl<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup_pres <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>proto_quantale<span class="main">)</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fun_eq_iff comp_def Sup_distl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

<span class="keyword1" id="Quantales-sup_pres_multl"><span class="command">lemma</span></span> sup_pres_multl<span class="main">:</span> <span class="quoted"><span class="quoted">"sup_pres <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>proto_quantale<span class="main">)</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> SUP_insert Sup_distl Sup_empty Sup_insert sup_bot_right<span class="main">)</span>

<span class="keyword1" id="Quantales-bot_pres_multl"><span class="command">lemma</span></span> bot_pres_multl<span class="main">:</span> <span class="quoted"><span class="quoted">"bot_pres <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>proto_quantale<span class="main">)</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SUP_empty Sup_distl Sup_empty<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> proto_quantale
<span class="keyword2"><span class="keyword">begin</span></span>
 
<span class="keyword1"><span class="command">subclass</span></span> weak_proto_quantale
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_distl<span class="main">)</span>

<span class="keyword1" id="Quantales-mult_botr"><span class="command">lemma</span></span> mult_botr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> image_empty Sup_distl Sup_empty<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now there is also an adjunction for the other residual.›</span></span>
    
<span class="keyword1" id="Quantales-bres_galois"><span class="command">lemma</span></span> bres_galois<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_upper bres_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_def mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_distl setcompr_eq_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Quantales-bres_adj"><span class="command">lemma</span></span> bres_adj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>proto_quantale<span class="main">)</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊣</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">→</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_def bres_galois<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> proto_quantale
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Quantales-bres_canc1"><span class="command">lemma</span></span> bres_canc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois<span class="main">)</span>

<span class="keyword1" id="Quantales-bres_canc2"><span class="command">lemma</span></span> bres_canc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois_imp<span class="main">)</span>

<span class="keyword1" id="Quantales-inf_bres"><span class="command">lemma</span></span>  inf_bres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="bound">z</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bres_galois fres_galois inf_fres <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Quantales-bres_sol"><span class="command">lemma</span></span> bres_sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bres_galois antisym mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Quantales-sol_bres"><span class="command">lemma</span></span> sol_bres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">→</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bres_canc1 bres_canc2 bres_iso eq_iff<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1" id="Quantales-bres_fres_clop"><span class="command">lemma</span></span> bres_fres_clop<span class="main">:</span> <span class="quoted"><span class="quoted">"clop <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>proto_quantale<span class="main">.</span> <span class="free">y</span> <span class="main">←</span> <span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> clop_def comp_def mono_def le_fun_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bres_anti bres_canc1 bres_galois_imp fres_anti fres_galois id_apply<span class="main">)</span>

<span class="keyword1" id="Quantales-fres_bres_clop"><span class="command">lemma</span></span> fres_bres_clop<span class="main">:</span> <span class="quoted"><span class="quoted">"clop <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>proto_quantale<span class="main">.</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="bound">x</span><span class="main">)</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> clop_def comp_def mono_def le_fun_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bres_anti bres_canc1 bres_galois_imp fres_anti fres_canc1 fres_galois id_apply<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Families of Quantales›</span></span>
  
<span class="keyword1"><span class="command">class</span></span> near_quantale <span class="main">=</span> proto_near_quantale <span class="main">+</span> semigroup_mult 

<span class="keyword1"><span class="command">sublocale</span></span> near_quantale <span class="main">⊆</span> nsrnq<span class="main">:</span> near_dioid <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_distr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> near_quantale
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Quantales-fres_curry"><span class="command">lemma</span></span> fres_curry<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">←</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main">←</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff fres_canc1 fres_galois mult_assoc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">class</span></span> unital_near_quantale <span class="main">=</span> near_quantale <span class="main">+</span> monoid_mult

<span class="keyword1"><span class="command">sublocale</span></span> unital_near_quantale <span class="main">⊆</span> nsrnqo<span class="main">:</span> near_dioid_one <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> unital_near_quantale
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iter</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">^</span> <span class="bound">i</span>"</span></span>

<span class="keyword1" id="Quantales-iter_ref"><span class="command">lemma</span></span> iter_ref <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"iter <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iter_def Inf_lower power.power_0 rangeI<span class="main">)</span>
   
<span class="keyword1" id="Quantales-le_top"><span class="command">lemma</span></span> le_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.left_neutral mult_isor top_greatest<span class="main">)</span>

<span class="keyword1" id="Quantales-top_times_top"><span class="command">lemma</span></span> top_times_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main">⋅</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_top top_le<span class="main">)</span>

<span class="keyword1" id="Quantales-bres_one"><span class="command">lemma</span></span> bres_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois_imp<span class="main">)</span>

<span class="keyword1" id="Quantales-fres_one"><span class="command">lemma</span></span> fres_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fres_galois <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">class</span></span> pre_quantale <span class="main">=</span> proto_pre_quantale <span class="main">+</span> semigroup_mult 

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> near_quantale <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Quantales-fres_interchange"><span class="command">lemma</span></span> fres_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Sup_upper fres_canc1 fres_def mult_isol mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> pre_quantale <span class="main">⊆</span>  psrpq<span class="main">:</span> pre_dioid <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isol<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> unital_pre_quantale <span class="main">=</span> pre_quantale <span class="main">+</span> monoid_mult

<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">subclass</span></span> unital_near_quantale <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Abstract rules of Hoare logic without the star can be derived.›</span></span>

<span class="keyword1" id="Quantales-h_w1"><span class="command">lemma</span></span> h_w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x'</span> <span class="main">⟹</span>  <span class="free">x'</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois<span class="main">)</span>

<span class="keyword1" id="Quantales-h_w2"><span class="command">lemma</span></span> h_w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z'</span> <span class="main">⟹</span> <span class="free">z'</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantales-h_seq"><span class="command">lemma</span></span> h_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dual_order.trans mult_isol mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="Quantales-h_sup"><span class="command">lemma</span></span> h_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois<span class="main">)</span>

<span class="keyword1" id="Quantales-h_Sup"><span class="command">lemma</span></span> h_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="main">⨆</span><span class="free">X</span> <span class="main">⋅</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_least fres_galois<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> unital_pre_quantale <span class="main">⊆</span>  psrpqo<span class="main">:</span> pre_dioid_one <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
    
<span class="keyword1"><span class="command">class</span></span> weak_quantale <span class="main">=</span> weak_proto_quantale <span class="main">+</span> semigroup_mult

<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">subclass</span></span> pre_quantale <span class="keyword1"><span class="command">..</span></span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following counterexample shows an important consequence of weakness: 
the absence of right annihilation.›</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="comment1">(*nitpick[expect=genuine]*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> unital_weak_quantale <span class="main">=</span> weak_quantale <span class="main">+</span> monoid_mult
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> unital_weak_quantale<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="comment1">(*nitpick[expect=genuine]*)</span>
  <span class="keyword1"><span class="command">oops</span></span>
  
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> unital_weak_quantale<span class="main">)</span> unital_pre_quantale <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> unital_weak_quantale <span class="main">⊆</span>  wswq<span class="main">:</span> dioid_one_zerol <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_distl<span class="main">)</span>

    
<span class="keyword1"><span class="command">class</span></span> quantale <span class="main">=</span> proto_quantale <span class="main">+</span> semigroup_mult 
  
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">subclass</span></span> weak_quantale <span class="keyword1"><span class="command">..</span></span>   

<span class="keyword1" id="Quantales-Inf_subdistl"><span class="command">lemma</span></span> Inf_subdistl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">⨅</span><span class="free">Y</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Inf_greatest Inf_lower mult_isol<span class="main">)</span>

<span class="keyword1" id="Quantales-Inf_subdistr"><span class="command">lemma</span></span> Inf_subdistr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="free">X</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Inf_greatest Inf_lower mult_isor<span class="main">)</span>
    
<span class="keyword1" id="Quantales-fres_bot_bot"><span class="command">lemma</span></span> fres_bot_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">←</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_def<span class="main">)</span>

<span class="keyword1" id="Quantales-bres_interchange"><span class="command">lemma</span></span> bres_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bres_canc1 bres_galois mult_isor mult_assoc<span class="main">)</span>

<span class="keyword1" id="Quantales-bres_curry"><span class="command">lemma</span></span> bres_curry<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bres_canc1 bres_galois dual_order.antisym mult_assoc<span class="main">)</span>

<span class="keyword1" id="Quantales-fres_bres"><span class="command">lemma</span></span> fres_bres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">←</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="skolem">w</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> quantale_with_dual <span class="main">=</span> quantale <span class="main">+</span> complete_lattice_with_dual

<span class="keyword1"><span class="command">class</span></span> unital_quantale <span class="main">=</span> quantale <span class="main">+</span> monoid_mult

<span class="keyword1"><span class="command">class</span></span> unital_quantale_with_dual <span class="main">=</span> unital_quantale <span class="main">+</span> quantale_with_dual
  
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> unital_quantale<span class="main">)</span> unital_weak_quantale <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> unital_quantale <span class="main">⊆</span> wswq<span class="main">:</span> dioid_one_zero <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> ab_quantale <span class="main">=</span> quantale <span class="main">+</span> ab_semigroup_mult

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Quantales-bres_fres_eq"><span class="command">lemma</span></span> bres_fres_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_def bres_def mult_commute<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> ab_unital_quantale <span class="main">=</span> ab_quantale <span class="main">+</span> unital_quantale

<span class="keyword1"><span class="command">sublocale</span></span> complete_heyting_algebra <span class="main">⊆</span> chaq<span class="main">:</span> ab_unital_quantale <span class="quoted"><span class="quoted">"<span class="main">(⊓)</span>"</span></span> _ _ _ _ _ _ _ _ <span class="quoted"><span class="main">⊤</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc ch_dist inf.commute<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> distrib_quantale <span class="main">=</span> quantale <span class="main">+</span> distrib_lattice
  
<span class="keyword1"><span class="command">class</span></span> bool_quantale <span class="main">=</span> quantale <span class="main">+</span> complete_boolean_algebra_alt 
  
<span class="keyword1"><span class="command">class</span></span> distrib_unital_quantale <span class="main">=</span> unital_quantale <span class="main">+</span> distrib_lattice
  
<span class="keyword1"><span class="command">class</span></span> bool_unital_quantale <span class="main">=</span> unital_quantale <span class="main">+</span> complete_boolean_algebra_alt
  
<span class="keyword1"><span class="command">class</span></span> distrib_ab_quantale <span class="main">=</span> distrib_quantale <span class="main">+</span> ab_quantale
  
<span class="keyword1"><span class="command">class</span></span> bool_ab_quantale <span class="main">=</span> bool_quantale <span class="main">+</span> ab_quantale
  
<span class="keyword1"><span class="command">class</span></span> distrib_ab_unital_quantale <span class="main">=</span> distrib_quantale <span class="main">+</span> unital_quantale
  
<span class="keyword1"><span class="command">class</span></span> bool_ab_unital_quantale <span class="main">=</span> bool_ab_quantale <span class="main">+</span> unital_quantale

<span class="keyword1"><span class="command">sublocale</span></span> complete_boolean_algebra <span class="main">⊆</span> cba_quantale<span class="main">:</span> bool_ab_unital_quantale <span class="quoted">inf</span> _ _ _ _ _ _ _ _ _ _ <span class="quoted"><span class="main">⊤</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute Setcompr_eq_image inf_Sup Sup_inf<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> complete_boolean_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this setting, residuation is classical implication.›</span></span>
  
<span class="keyword1" id="Quantales-cba_bres1"><span class="command">lemma</span></span> cba_bres1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> cba_quantale.bres <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cba_quantale.bres_galois inf.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
<span class="keyword1" id="Quantales-cba_bres2"><span class="command">lemma</span></span> cba_bres2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> cba_quantale.bres <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cba_bres1 shunt1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Quantales-cba_bres_prop"><span class="command">lemma</span></span> cba_bres_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"cba_quantale.bres <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cba_bres2 eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Quantales Based on Sup-Lattices and Inf-Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹These classes are defined for convenience in instantiation and interpretation proofs, or likewise. 
They are useful, e.g., in the context of predicate transformers, where only one of Sup or Inf may be well behaved.›</span></span>

<span class="keyword1"><span class="command">class</span></span> Sup_quantale <span class="main">=</span> Sup_lattice <span class="main">+</span> semigroup_mult <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> Supq_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="free">X</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Supq_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">⨆</span><span class="free">Y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> unital_Sup_quantale <span class="main">=</span> Sup_quantale <span class="main">+</span> monoid_mult

<span class="keyword1"><span class="command">class</span></span> Inf_quantale <span class="main">=</span> Inf_lattice <span class="main">+</span> monoid_mult <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> Supq_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="free">X</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Supq_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">⨅</span><span class="free">Y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> unital_Inf_quantale <span class="main">=</span> Inf_quantale <span class="main">+</span> monoid_mult

<span class="keyword1"><span class="command">sublocale</span></span> Inf_quantale <span class="main">⊆</span> qdual<span class="main">:</span> Sup_quantale _ <span class="quoted">Inf</span> <span class="quoted"><span class="quoted">"<span class="main">(≥)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Supq_distr Supq_distl<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> unital_Inf_quantale <span class="main">⊆</span> uqdual<span class="main">:</span> unital_Sup_quantale _ _ <span class="quoted">Inf</span>  <span class="quoted"><span class="quoted">"<span class="main">(≥)</span>"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> Sup_quantale <span class="main">⊆</span> supq<span class="main">:</span> quantale _ <span class="quoted">Infs</span> <span class="quoted">Sup_class.Sup</span> <span class="quoted">infs</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted">le</span> <span class="quoted">sups</span> <span class="quoted">bots</span> <span class="quoted">tops</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Supq_distr Supq_distl<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> unital_Sup_quantale <span class="main">⊆</span> usupq<span class="main">:</span> unital_quantale _ _ <span class="quoted">Infs</span> <span class="quoted">Sup_class.Sup</span> <span class="quoted">infs</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted">le</span> <span class="quoted">sups</span> <span class="quoted">bots</span> <span class="quoted">tops</span><span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Products of Quantales›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Inf_prod</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⨅</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">inf_prod</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> fst <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> snd <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">bot_prod</span> <span class="main">=</span> <span class="main">(</span>bot<span class="main">,</span>bot<span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sup_prod</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sup_prod</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> fst <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> snd <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_prod</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>top<span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_prod</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> less_eq <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∧</span> less_eq <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_prod</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> less_eq <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∧</span> less_eq <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">times_prod'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> fst <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> snd <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_prod</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">dual_prod</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∂</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">∂</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">interpretation</span></span> prod<span class="main">:</span> complete_lattice <span class="quoted">Inf_prod</span> <span class="quoted">Sup_prod</span> <span class="quoted">inf_prod</span> <span class="quoted">less_eq_prod</span> <span class="quoted">less_prod</span> <span class="quoted">sup_prod</span> <span class="quoted">bot_prod</span> <span class="quoted"><span class="quoted">"top_prod <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>complete_lattice <span class="main">×</span> <span class="tfree">'b</span><span class="main">::</span>complete_lattice<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_prod_def Sup_prod_def inf_prod_def sup_prod_def bot_prod_def top_prod_def less_eq_prod_def less_prod_def Sup_distl Sup_distr <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Inf_lower Inf_greatest Sup_upper Sup_least<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> prod<span class="main">:</span> complete_lattice_with_dual <span class="quoted">Inf_prod</span> <span class="quoted">Sup_prod</span> <span class="quoted">inf_prod</span> <span class="quoted">less_eq_prod</span> <span class="quoted">less_prod</span> <span class="quoted">sup_prod</span> <span class="quoted">bot_prod</span> <span class="quoted"><span class="quoted">"top_prod <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>complete_lattice_with_dual <span class="main">×</span> <span class="tfree">'b</span><span class="main">::</span>complete_lattice_with_dual<span class="main">)</span>"</span></span> <span class="quoted">dual_prod</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_prod_def fun_eq_iff inj_def Sup_prod_def Inf_prod_def inj_dual_iff Sup_dual_def_var image_comp<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> prod<span class="main">:</span> proto_near_quantale <span class="quoted">Inf_prod</span> <span class="quoted">Sup_prod</span> <span class="quoted">inf_prod</span> <span class="quoted">less_eq_prod</span> <span class="quoted">less_prod</span> <span class="quoted">sup_prod</span> <span class="quoted">bot_prod</span> <span class="quoted"><span class="quoted">"top_prod <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>proto_near_quantale <span class="main">×</span> <span class="tfree">'b</span><span class="main">::</span>proto_near_quantale<span class="main">)</span>"</span></span> <span class="quoted">times_prod'</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_prod'_def Sup_prod_def Sup_distr image_comp<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> prod<span class="main">:</span> proto_quantale <span class="quoted">Inf_prod</span> <span class="quoted">Sup_prod</span> <span class="quoted">inf_prod</span> <span class="quoted">less_eq_prod</span> <span class="quoted">less_prod</span> <span class="quoted">sup_prod</span> <span class="quoted">bot_prod</span> <span class="quoted"><span class="quoted">"top_prod <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>proto_quantale <span class="main">×</span> <span class="tfree">'b</span><span class="main">::</span>proto_quantale<span class="main">)</span>"</span></span> <span class="quoted">times_prod'</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_prod'_def Sup_prod_def less_eq_prod_def Sup_distl image_comp<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> prod<span class="main">:</span> unital_quantale <span class="quoted">one_prod</span> <span class="quoted">times_prod'</span> <span class="quoted">Inf_prod</span> <span class="quoted">Sup_prod</span> <span class="quoted">inf_prod</span> <span class="quoted">less_eq_prod</span> <span class="quoted">less_prod</span> <span class="quoted">sup_prod</span> <span class="quoted">bot_prod</span> <span class="quoted"><span class="quoted">"top_prod <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">×</span> <span class="tfree">'b</span><span class="main">::</span>unital_quantale<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_prod_def times_prod'_def <span class="dynamic"><span class="dynamic">ac_simps</span></span> image_comp<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Quantale Morphisms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹There are various ways of defining quantale morphisms, depending on the application. Following Rosenthal, 
I present the most important one.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">comp_pres</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>times <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>times<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">comp_pres</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">un_pres</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>one <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>one<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">un_pres</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">comp_closed_set</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">un_closed_set</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quantale_homset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>quantale <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>quantale<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">quantale_homset</span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> comp_pres <span class="bound">f</span> <span class="main">∧</span> Sup_pres <span class="bound">f</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Quantales-quantale_homset_iff"><span class="command">lemma</span></span> quantale_homset_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset <span class="main">=</span> <span class="main">(</span>comp_pres <span class="free">f</span> <span class="main">∧</span> Sup_pres <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quantale_homset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unital_quantale_homset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>unital_quantale<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unital_quantale_homset</span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> comp_pres <span class="bound">f</span> <span class="main">∧</span> Sup_pres <span class="bound">f</span> <span class="main">∧</span> un_pres <span class="bound">f</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Quantales-unital_quantale_homset_iff"><span class="command">lemma</span></span> unital_quantale_homset_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> unital_quantale_homset <span class="main">=</span> <span class="main">(</span>comp_pres <span class="free">f</span> <span class="main">∧</span> Sup_pres <span class="free">f</span> <span class="main">∧</span> un_pres <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> unital_quantale_homset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Though Infs can be defined from Sups in any quantale, quantale morphisms do not generally preserve Infs.
A different kind of morphism is needed if this is to be guaranteed.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset <span class="main">⟹</span> Inf_pres <span class="free">f</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The images of quantale morphisms are closed under compositions and Sups, hence they form quantales.›</span></span>

<span class="keyword1" id="Quantales-quantale_hom_q_pres"><span class="command">lemma</span></span> quantale_hom_q_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset <span class="main">⟹</span> Sup_closed_set <span class="main">(</span>range <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> comp_closed_set <span class="main">(</span>range <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_pres_Sup_closed quantale_homset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> quantale_homset_iff comp_closed_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> imageE range_eqI<span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Yet the image need not be Inf-closed.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset <span class="main">⟹</span> Inf_closed_set <span class="main">(</span>range <span class="free">f</span><span class="main">)</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Of course Sups are preserved by quantale-morphisms, hence they are the same in subsets as in the original set.
Infs in the subset, however, exist, since they subset forms a quantale in which Infs can be defined, but these are generally
different from the Infs in the superstructure. 

This fact is hidden in Isabelle's definition of complete lattices, where Infs are axiomatised. There is no easy way in general to
show that images of quantale morphisms form quantales, though the statement for Sup-quantales is straightforward. I show this for quantic nuclei 
and left-sided elements.›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> quantale_homset <span class="main">=</span> <span class="quoted"><span class="quoted">"quantale_homset<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>quantale <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>quantale<span class="main">)</span> set"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"comp_pres <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale<span class="main">.</span> bot<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup_pres <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale<span class="main">.</span> bot<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fun_eq_iff comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale<span class="main">.</span> bot<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">∈</span> quantale_homset"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quantale_homset_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_quantale_homset

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Interestingly, the following type is not (gobally) inhabited.›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> unital_quantale_homset <span class="main">=</span> <span class="quoted"><span class="quoted">"unital_quantale_homset<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>unital_quantale<span class="main">)</span> set"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Quantales-quantale_hom_radj"><span class="command">lemma</span></span> quantale_hom_radj<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale_with_dual <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>quantale_with_dual"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset <span class="main">⟹</span> <span class="free">f</span> <span class="main">⊣</span> radj <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quantale_homset_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_pres_ladj_aux<span class="main">)</span>

<span class="keyword1" id="Quantales-quantale_hom_prop1"><span class="command">lemma</span></span> quantale_hom_prop1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale_with_dual <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>quantale_with_dual"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset <span class="main">⟹</span> radj <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">→</span> radj <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="main">(</span>radj <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> h adj_def bres_galois order_refl quantale_hom_radj<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> radj <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> h quantale_homset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> radj <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> radj <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adj_def h quantale_hom_radj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"radj <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> radj <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> radj <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> radj <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_canc1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> radj <span class="free">f</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adj_def h quantale_hom_radj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> radj <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> h quantale_homset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> radj <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> radj <span class="free">f</span> <span class="free">y</span> <span class="main">≤</span> radj <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adj_def h quantale_hom_radj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.antisym le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantales-quantale_hom_prop2"><span class="command">lemma</span></span> quantale_hom_prop2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale_with_dual <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>quantale_with_dual"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset <span class="main">⟹</span> radj <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> radj <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>radj <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> adj_def fres_galois h order_refl quantale_hom_radj<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>radj <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> h quantale_homset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"radj <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">≤</span> radj <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adj_def h quantale_hom_radj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"radj <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> radj <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>radj <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> radj <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_canc1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">(</span>radj <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adj_def h quantale_hom_radj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>radj <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">x</span><span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> h quantale_homset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>radj <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">←</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"radj <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">≤</span> radj <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adj_def h quantale_hom_radj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.antisym le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quantale_closed_maps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>quantale <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>quantale<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">quantale_closed_maps</span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Quantales-quantale_closed_maps_iff"><span class="command">lemma</span></span> quantale_closed_maps_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_closed_maps <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quantale_closed_maps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quantale_closed_Sup_maps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>quantale <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>quantale<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">quantale_closed_Sup_maps</span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> Sup_pres <span class="bound">f</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Quantales-quantale_closed_Sup_maps_iff"><span class="command">lemma</span></span> quantale_closed_Sup_maps_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_closed_Sup_maps <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> Sup_pres <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quantale_closed_Sup_maps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quantale_closed_unital_maps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>unital_quantale<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">quantale_closed_unital_maps</span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">f</span> <span class="main">1</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Quantales-quantale_closed_unital_maps_iff"><span class="command">lemma</span></span> quantale_closed_unital_maps_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_closed_unital_maps <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quantale_closed_unital_maps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quantale_closed_unital_Sup_maps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>unital_quantale<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">quantale_closed_unital_Sup_maps</span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> Sup_pres <span class="bound">f</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">f</span> <span class="main">1</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Quantales-quantale_closed_unital_Sup_maps_iff"><span class="command">lemma</span></span> quantale_closed_unital_Sup_maps_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_closed_unital_Sup_maps <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> Sup_pres <span class="free">f</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quantale_closed_unital_Sup_maps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Closed maps are the right adjoints of quantale morphisms.›</span></span>

<span class="keyword1" id="Quantales-quantale_hom_closed_map"><span class="command">lemma</span></span> quantale_hom_closed_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale_with_dual <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>quantale_with_dual"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∈</span> quantale_homset<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>radj <span class="free">f</span> <span class="main">∈</span> quantale_closed_maps<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>radj <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">f</span> <span class="main">(</span>radj <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj_def h order_refl psrpq.mult_isol_var quantale_hom_radj<span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>radj <span class="free">f</span> <span class="bound">x</span> <span class="main">⋅</span> radj <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> h quantale_homset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> radj <span class="free">f</span> <span class="bound">x</span> <span class="main">⋅</span> radj <span class="free">f</span> <span class="bound">y</span> <span class="main">≤</span> radj <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adj_def h quantale_hom_radj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quantale_closed_maps_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantales-unital_quantale_hom_closed_unital_map"><span class="command">lemma</span></span> unital_quantale_hom_closed_unital_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unital_quantale_with_dual <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>unital_quantale_with_dual"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∈</span> unital_quantale_homset<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>radj <span class="free">f</span> <span class="main">∈</span> quantale_closed_unital_maps<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> adj_def order_refl quantale_closed_maps_iff quantale_closed_unital_maps_iff quantale_hom_closed_map quantale_hom_radj quantale_homset_iff unital_quantale_homset_iff<span class="main">)</span>

 <span class="keyword2"><span class="keyword">end</span></span>


  
</pre>
</div><div id="Quantale_Star">
<div class="head">
<h1>Theory Quantale_Star</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Star and Fixpoints in Quantales
   Author: Georg Struth
   Maintainer: Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Star and Fixpoints in Quantales›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quantale_Star
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Quantales.html">Quantales</a> 
          <a href="../Kleene_Algebra/Kleene_Algebra.html">Kleene_Algebra.Kleene_Algebra</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This component formalises properties of the star in quantales. For pre-quantales these are modelled as 
fixpoints. For weak quantales they are given by iteration.›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Star and Fixpoints in Pre-Quantales›</span></span>
                     
<span class="keyword1"><span class="command">context</span></span> unital_near_quantale
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qiter_fun</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(⊔)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∘</span> <span class="main">(⋅)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qiterl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> lfp <span class="main">(</span>qiter_fun <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qiterg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> gfp <span class="main">(</span>qiter_fun <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">qiterl_id</span> <span class="main">≡</span> qiterl <span class="main">1</span>"</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">qiterq_id</span> <span class="main">≡</span> qiterg <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qstar</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantale_Star-qiter_fun_exp"><span class="command">lemma</span></span> qiter_fun_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"qiter_fun <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> qiter_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Many properties of fixpoints have been developed for Isabelle's monotone functions. These carry
two type parameters, and must therefore be used outside of contexts.›</span></span>

<span class="keyword1" id="Quantale_Star-iso_qiter_fun"><span class="command">lemma</span></span> iso_qiter_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_pre_quantale<span class="main">.</span> qiter_fun <span class="free">x</span> <span class="free">y</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoI proto_pre_quantale_class.mult_isol qiter_fun_exp sup.idem sup.mono sup.orderI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹I derive the left unfold and induction laws of Kleene algebra. I link with the Kleene algebra components
at the end of this section, to bring properties into scope.›</span></span>

<span class="keyword1" id="Quantale_Star-qiterl_unfoldl"><span class="command">lemma</span></span> qiterl_unfoldl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> qiterl <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> qiterl <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_pre_quantale<span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iso_qiter_fun lfp_unfold qiter_fun_exp qiterl_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Star-qiterg_unfoldl"><span class="command">lemma</span></span> qiterg_unfoldl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> qiterg <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> qiterg <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_pre_quantale<span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gfp_fixpoint iso_qiter_fun qiter_fun_exp qiterg_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Star-qiterl_inductl"><span class="command">lemma</span></span> qiterl_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> qiterl <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_near_quantale<span class="main">)</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_lowerbound qiterl_def qiter_fun_def<span class="main">)</span>
 
<span class="keyword1" id="Quantale_Star-qiterg_coinductl"><span class="command">lemma</span></span> qiterg_coinductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">≤</span> qiterg <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_near_quantale<span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gfp_upperbound qiterg_def qiter_fun_def<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> unital_near_quantale
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Quantale_Star-powers_distr"><span class="command">lemma</span></span> powers_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"qstar <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qstar_def Sup_distr image_comp<span class="main">)</span>

<span class="keyword1" id="Quantale_Star-Sup_iter_unfold"><span class="command">lemma</span></span> Sup_iter_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="main">0</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fSup_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 

<span class="keyword1" id="Quantale_Star-Sup_iter_unfold_var"><span class="command">lemma</span></span> Sup_iter_unfold_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Sup_iter_unfold<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Quantale_Star-power_inductr"><span class="command">lemma</span></span> power_inductr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">^</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> power_commutes eq_iff mult_isor order.trans mult_assoc power.power.power_Suc<span class="main">)</span>
    
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> unital_pre_quantale
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Quantale_Star-powers_subdistl"><span class="command">lemma</span></span> powers_subdistl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> qstar <span class="free">y</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_le_iff SUP_upper mult_isol qstar_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Star-qstar_subcomm"><span class="command">lemma</span></span> qstar_subcomm<span class="main">:</span> <span class="quoted"><span class="quoted">"qstar <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> qstar <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers_distr powers_subdistl power_commutes<span class="main">)</span>

<span class="keyword1" id="Quantale_Star-power_inductl"><span class="command">lemma</span></span> power_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">^</span> <span class="free">i</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> dual_order.trans mult_isol mult_assoc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Star and Iteration in Weak Quantales›</span></span>

<span class="keyword1"><span class="command">context</span></span> unital_weak_quantale
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In unital weak quantales one can derive the star axioms of Kleene algebra for iteration. This
generalises the language and relation models from our Kleene algebra components.›</span></span>

<span class="keyword1" id="Quantale_Star-powers_distl"><span class="command">lemma</span></span> powers_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> qstar <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qstar_def weak_Sup_distl image_comp<span class="main">)</span>

<span class="keyword1" id="Quantale_Star-qstar_unfoldl"><span class="command">lemma</span></span> qstar_unfoldl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> qstar <span class="free">x</span> <span class="main">≤</span> qstar <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> powers_distl Sup_iter_unfold_var<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qstar_def<span class="main">)</span>
 
<span class="keyword1" id="Quantale_Star-qstar_comm"><span class="command">lemma</span></span> qstar_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> qstar <span class="free">x</span> <span class="main">=</span> qstar <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> power_commutes powers_distr powers_distl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Quantale_Star-qstar_unfoldr"><span class="command">lemma</span></span> qstar_unfoldr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> qstar <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> qstar <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> qstar_comm qstar_unfoldl Sup_iter_unfold_var qstar_def powers_distl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Quantale_Star-qstar_inductl"><span class="command">lemma</span></span> qstar_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> qstar <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powers_distr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_least power_inductl<span class="main">)</span>

<span class="keyword1" id="Quantale_Star-qstar_inductr"><span class="command">lemma</span></span> qstar_inductr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> qstar <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powers_distl<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_least power_inductr<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Hence in this setting one also obtains the right Kleene algebra axioms.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> unital_weak_quantale <span class="main">⊆</span> uwqlka<span class="main">:</span> left_kleene_algebra_zerol <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">⊥</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted">qstar</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> qstar_unfoldl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qstar_inductl<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> unital_quantale <span class="main">⊆</span> uqka<span class="main">:</span> kleene_algebra <span class="quoted"><span class="quoted">"<span class="main">(⊔)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">⊥</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted">qstar</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qstar_inductr<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The star is indeed the least fixpoint.›</span></span>

<span class="keyword1" id="Quantale_Star-qstar_qiterl"><span class="command">lemma</span></span>  qstar_qiterl<span class="main">:</span> <span class="quoted"><span class="quoted">"qstar <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_weak_quantale<span class="main">)</span> <span class="main">=</span> qiterl_id <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym qiterl_inductl uwqlka.star_inductl_one<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> unital_weak_quantale
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Deriving the Star Axioms of Action Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally the star axioms of action algebras are derived.›</span></span>

<span class="keyword1" id="Quantale_Star-act_star1"><span class="command">lemma</span></span> act_star1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span>qstar <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>qstar <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>qstar <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> unital_quantale<span class="main">)</span> act_star3<span class="main">:</span> <span class="quoted"><span class="quoted">"qstar <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_canc1 bres_galois_imp uqka.star_inductr_var<span class="main">)</span>

<span class="keyword1" id="Quantale_Star-act_star3_var"><span class="command">lemma</span></span> act_star3_var<span class="main">:</span> <span class="quoted"><span class="quoted">"qstar <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fres_galois qstar_inductl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹An integration of action algebras requires first resolving some notational issues within the components
where these algebras are located.›</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Quantale_Modules">
<div class="head">
<h1>Theory Quantale_Modules</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Quantale Modules and Semidirect Products 
   Author: Georg Struth
   Maintainer: Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Quantale Modules and Semidirect Products›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quantale_Modules
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Quantale_Star.html">Quantale_Star</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Quantale Modules›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Quantale modules are extensions of semigroup actions in that a quantale acts on a complete lattice.
These have been investigated by Abramsky and Vickers~\cite{AbramskyV93} and others, predominantly in the context
of pointfree topology.›</span></span>
  
<span class="keyword1"><span class="command">locale</span></span> unital_quantale_module <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">act</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>complete_lattice_with_dual <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">α</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> act1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="free">y</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> act2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="main">1</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> act3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="main">⨆</span><span class="free">X</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="keyword1"><span class="free">α</span></span> <span class="bound">x</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> act4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">(</span><span class="main">⨆</span><span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">P</span><span class="main">.</span> <span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> unital_quantale_module
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Actions are morphisms. The curried notation is particularly convenient for this.›</span></span>
  
<span class="keyword1" id="Quantale_Modules-act_morph1"><span class="command">lemma</span></span> act_morph1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="free">x</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff act1<span class="main">)</span>
    
<span class="keyword1" id="Quantale_Modules-act_morph2"><span class="command">lemma</span></span> act_morph2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="main">1</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  
<span class="keyword1" id="Quantale_Modules-emp_act"><span class="command">lemma</span></span> emp_act <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="main">⨆</span><span class="main">{}</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> act3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    
<span class="keyword1" id="Quantale_Modules-emp_act_var"><span class="command">lemma</span></span> emp_act_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="main">⊥</span> <span class="free">p</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> emp_act <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Quantale_Modules-act_emp"><span class="command">lemma</span></span> act_emp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">(</span><span class="main">⨆</span><span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> act4<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    
<span class="keyword1" id="Quantale_Modules-act_emp_var"><span class="command">lemma</span></span> act_emp_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> act_emp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="Quantale_Modules-act_sup_distl"><span class="command">lemma</span></span> act_sup_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊔</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> act4 image_insert image_is_empty sup_Sup<span class="main">)</span>
  
<span class="keyword1" id="Quantale_Modules-act_sup_distr"><span class="command">lemma</span></span> act_sup_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="free">y</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> SUP_insert Sup_empty Sup_insert act3 sup_bot_right<span class="main">)</span>
  
<span class="keyword1" id="Quantale_Modules-act_sup_distr_var"><span class="command">lemma</span></span> act_sup_distr_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff act_sup_distr<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Semidirect Products and Weak Quantales›</span></span>
    
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next, the semidirect product of a  unital quantale and a complete lattice is defined. ›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sd_prod</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> fst <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> <span class="keyword1"><span class="free">α</span></span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
   
<span class="keyword1" id="Quantale_Modules-sd_distr"><span class="command">lemma</span></span> sd_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"sd_prod <span class="main">(</span>Sup_prod <span class="free">X</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> Sup_prod <span class="main">{</span>sd_prod <span class="bound">x</span> <span class="free">y</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sd_prod <span class="main">(</span>Sup_prod <span class="free">X</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> sd_prod <span class="main">(</span><span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> fst <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> fst <span class="bound">x</span><span class="main">)</span> <span class="main">⋅</span> fst <span class="free">y</span><span class="main">,</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> snd <span class="bound">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sd_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">x</span> <span class="main">⋅</span> fst <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> snd <span class="bound">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_distr image_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">x</span> <span class="main">⋅</span> fst <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> snd <span class="bound">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> act3 image_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">x</span> <span class="main">⋅</span> fst <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">(</span>snd <span class="bound">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complete_lattice_class.SUP_sup_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Sup_prod <span class="main">{</span><span class="main">(</span>fst <span class="bound">x</span> <span class="main">⋅</span> fst <span class="free">y</span><span class="main">,</span> snd <span class="bound">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Sup_prod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_Sup_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">Sup</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sd_prod_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Quantale_Modules-sd_distl_aux"><span class="command">lemma</span></span> sd_distl_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="free">p</span> <span class="main">⊔</span> <span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> SUP_bot_conv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> SUP_const SUP_upper2 sup_ge1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SUP_upper2 image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Sup_upper image_iff sup.idem sup.mono sup_ge2<span class="main">)</span>

<span class="keyword1" id="Quantale_Modules-sd_distl"><span class="command">lemma</span></span> sd_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> sd_prod <span class="free">x</span> <span class="main">(</span>Sup_prod <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> Sup_prod <span class="main">{</span>sd_prod <span class="free">x</span> <span class="bound">y</span> <span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sd_prod <span class="free">x</span> <span class="main">(</span>Sup_prod <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> sd_prod <span class="free">x</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> fst <span class="bound">y</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> fst <span class="bound">y</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>snd <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sd_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> fst <span class="free">x</span> <span class="main">⋅</span> fst <span class="bound">y</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>snd <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_distl image_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> fst <span class="free">x</span> <span class="main">⋅</span> fst <span class="bound">y</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>snd <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="keyword1"><span class="free">α</span></span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> act4 image_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> fst <span class="free">x</span> <span class="main">⋅</span> fst <span class="bound">y</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> snd <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a sd_distl_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Sup_prod <span class="main">{</span><span class="main">(</span>fst <span class="free">x</span> <span class="main">⋅</span> fst <span class="bound">y</span><span class="main">,</span> snd <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Sup_prod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_Sup_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">Sup</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sd_prod_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sd_unit</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">⊥</span><span class="main">)</span>"</span></span>
 
<span class="keyword1" id="Quantale_Modules-sd_unitl"><span class="command">lemma</span></span> sd_unitl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sd_prod sd_unit <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sd_prod_def sd_unit_def<span class="main">)</span>    
    
<span class="keyword1" id="Quantale_Modules-sd_unitr"><span class="command">lemma</span></span> sd_unitr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sd_prod <span class="free">x</span> sd_unit <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sd_prod_def sd_unit_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following counterexamples rule out that semidirect products of quantales and complete lattices form quantales.
The reason is that the right annihilation law fails.›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"sd_prod <span class="free">x</span> <span class="main">(</span>Sup_prod <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> Sup_prod <span class="main">{</span>sd_prod <span class="free">x</span> <span class="bound">y</span> <span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">}</span>"</span></span> <span class="comment1">(*nitpick[show_all,expect=genuine]*)</span>
  <span class="keyword1"><span class="command">oops</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"sd_prod <span class="free">x</span> bot_prod <span class="main">=</span> bot_prod"</span></span> <span class="comment1">(*nitpick[show_all,expect=genuine]*)</span>
  <span class="keyword1"><span class="command">oops</span></span>
    
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹However one can show that semidirect products of (unital) quantales with complete lattices form weak (unital) quantales. 
This provides an example of how weak quantales arise quite naturally.›</span></span>
    
<span class="keyword1"><span class="command">sublocale</span></span> dp_quantale<span class="main">:</span> weak_quantale <span class="quoted">sd_prod</span> <span class="quoted">Inf_prod</span> <span class="quoted">Sup_prod</span> <span class="quoted">inf_prod</span> <span class="quoted">less_eq_prod</span> <span class="quoted">less_prod</span> <span class="quoted">sup_prod</span> <span class="quoted">bot_prod</span> <span class="quoted">top_prod</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> act1 act_sup_distl mult.assoc sd_prod_def sup_assoc<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Setcompr_eq_image sd_distr<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Setcompr_eq_image sd_distl<span class="main">)</span> 

<span class="keyword1"><span class="command">sublocale</span></span> dpu_quantale<span class="main">:</span> unital_weak_quantale <span class="quoted">sd_unit</span> <span class="quoted">sd_prod</span> <span class="quoted">Inf_prod</span> <span class="quoted">Sup_prod</span> <span class="quoted">inf_prod</span> <span class="quoted">less_eq_prod</span> <span class="quoted">less_prod</span> <span class="quoted">sup_prod</span> <span class="quoted">bot_prod</span> <span class="quoted">top_prod</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Star in Semidirect Products›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹I define the star operation for a semidirect product of a quantale and a complete lattice, 
and prove a characteristic property.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">sd_power</span> <span class="main">≡</span> dpu_quantale.power"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">sd_star</span> <span class="main">≡</span> dpu_quantale.qstar"</span></span>    

<span class="keyword1" id="Quantale_Modules-sd_power_zero"><span class="command">lemma</span></span> sd_power_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sd_power <span class="free">x</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">⊥</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sd_unit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantale_Modules-sd_power_prop_aux"><span class="command">lemma</span></span> sd_power_prop_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="main">0</span><span class="main">)</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆</span><span class="main">{</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">y</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span>  <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> Suc <span class="free">i</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">y</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> Suc <span class="free">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> Sup_upper<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> Sup_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sup_insert Sup_upper insert_iff le_0_eq linorder_not_le mem_Collect_eq<span class="main">)</span>

<span class="keyword1" id="Quantale_Modules-sd_power_prop1"><span class="command">lemma</span></span> sd_power_prop1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sd_power <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">,</span> <span class="main">⨆</span><span class="main">{</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">y</span><span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sd_power <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> Suc <span class="skolem">i</span><span class="main">,</span> <span class="main">⨆</span><span class="main">{</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">y</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sd_power <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> Suc <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> <span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="main">0</span><span class="main">)</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆</span><span class="main">{</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sd_prod_def act1 act4<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> act4 image_Collect image_image<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> Suc <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> <span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="main">0</span><span class="main">)</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆</span><span class="main">{</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">y</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span>  <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> Suc <span class="skolem">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Suc_le_eq Suc_le_mono le_0_eq not0_implies_Suc zero_less_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> sd_power_prop_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantale_Modules-sd_power_prop2"><span class="command">lemma</span></span> sd_power_prop2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sd_power <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">i</span><span class="main">,</span> <span class="main">⨆</span><span class="main">{</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">y</span><span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> sd_unit_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">using</span></span> le_simps<span class="main">(</span>2<span class="main">)</span> unital_quantale_module.sd_power_prop1 unital_quantale_module_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Quantale_Modules-sdstar_prop"><span class="command">lemma</span></span> sdstar_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"sd_star <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>qstar <span class="free">x</span><span class="main">,</span> <span class="keyword1"><span class="free">α</span></span> <span class="main">(</span>qstar <span class="free">x</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sd_star <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> sup_prod <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">⊥</span><span class="main">)</span> <span class="main">(</span>Sup_prod <span class="main">{</span>sd_power <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> True<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dpu_quantale.Sup_iter_unfold dpu_quantale.qstar_def full_SetCompr_eq sd_power_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sup_prod <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">⊥</span><span class="main">)</span> <span class="main">(</span>Sup_prod <span class="main">{</span><span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">,</span> <span class="main">⨆</span><span class="main">{</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">y</span><span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> True<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sd_power_prop1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span><span class="main">(</span> <span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨆</span><span class="main">{</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">y</span><span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> sup_prod_def Sup_prod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊔</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_Sup_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">Sup</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>qstar <span class="free">x</span><span class="main">,</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨆</span><span class="main">{</span><span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">y</span><span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> fSup_unfold power_0 qstar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>qstar <span class="free">x</span><span class="main">,</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1"><span class="free">α</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_upper<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> SUP_upper2 Sup_upper mem_Collect_eq order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qstar_def act3 image_comp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Quantale_Models">
<div class="head">
<h1>Theory Quantale_Models</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Models of Quantales
   Author: Georg Struth
   Maintainer: Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Models of Quantales›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quantale_Models
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Quantales.html">Quantales</a>
  <span class="quoted">"<a href="Dioid_Models_New.html">Dioid_Models_New</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Most of the models in this section expand those of dioids (and hence Kleene algebras). They really belong here, 
because quantales form a stronger setting than dioids or Kleene algebras. They are, however, subsumed by the general lifting
results of partial semigroups and monoids from another AFP entry~\cite{DongolGHS17}.›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Quantales of Booleans›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> bool <span class="main">::</span> <span class="quoted">bool_ab_unital_quantale</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">one_bool</span></span> <span class="main">=</span> True"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">times_bool</span></span> <span class="main">=</span> <span class="main">(∧)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> times_bool_def one_bool_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1" id="Quantale_Models-bool_sep_eq_conj"><span class="command">lemma</span></span> bool_sep_eq_conj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">::</span> bool<span class="main">)</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∧</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> times_bool_def<span class="main">)</span>
  
<span class="keyword1" id="Quantale_Models-bool_impl_eq"><span class="command">lemma</span></span> bool_impl_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::</span> bool<span class="main">)</span> <span class="main">→</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bres_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Powerset Quantales of Semigroups and Monoids›</span></span>

<span class="keyword1"><span class="command">instance</span></span> set <span class="main">::</span> <span class="main">(</span><span class="quoted">semigroup_mult</span><span class="main">)</span> <span class="quoted">quantale</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> times_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹With the definition of products on powersets (from the component of models of dioids) one
can prove the following mixed distributivity law.›</span></span>

<span class="keyword1" id="Quantale_Models-comp_dist_mix"><span class="command">lemma</span></span> comp_dist_mix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">(</span><span class="free">X</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale set<span class="main">)</span> <span class="main">⋅</span> <span class="main">⨆</span><span class="free">Y</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">(</span><span class="free">X</span> <span class="main">⋅</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="free">X</span> <span class="main">⋅</span> <span class="main">⨆</span><span class="free">Y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> SUP_cong Sup_distl Sup_distr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="main">⨆</span><span class="main">{</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> setcompr_eq_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">smt</span> Collect_mono Sup_subset_mono mem_Collect_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">smt</span> Sup_upper calculation mem_Collect_eq psrpq.mult_isol_var<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_set_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Powerset quantales of monoids can nevertheless be formalised as instances.›</span></span>

<span class="keyword1"><span class="command">instance</span></span> set <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_mult</span><span class="main">)</span> <span class="quoted">unital_quantale</span><span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹There is much more to this example. In fact, every quantale can be represented, up to isomorphism, 
as a certain quotient of a powerset quantale over some semigroup~\cite{Rosenthal90}. This representation theorem is 
formalised in the section on nuclei.›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Language, Relation, Trace and Path Quantales›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The language quantale is implcit in the powerset quantale over a semigroup or monoid. The free list monoid has
already been linked with the class of monoid as an instance in Isabelle's dioid components~\cite{ArmstrongSW13}. I provide an alternative
interpretation. In all of the following locale statements, an interpretation for Sup-quantales fails, due to the occurance of some low level
less operations in the underlying model...›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> lan_quantale<span class="main">:</span> unital_quantale <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> lan"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted">Inf</span> <span class="quoted">Sup</span> <span class="quoted">inf</span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">sup</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted">UNIV</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_lower Inter_greatest Sup_upper Sup_least zero_set_def Sup_distr Sup_distl<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The relation quantale follows.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_quantale<span class="main">:</span> unital_quantale <span class="quoted">Id</span> <span class="quoted">relcomp</span> <span class="quoted">Inf</span> <span class="quoted">Sup</span> <span class="quoted">inf</span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">sup</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Traces alternate between state and action symbols, the first and last symbol of a trace being state symbols.
They can be associated with behaviours of automata or executions of programs.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> trace_quantale<span class="main">:</span> unital_quantale <span class="quoted">t_one</span> <span class="quoted">t_prod</span> <span class="quoted">Inf</span> <span class="quoted">Sup</span> <span class="quoted">inf</span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">sup</span> <span class="quoted">t_zero</span> <span class="quoted">UNIV</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Inf_lower Inf_greatest Sup_upper Sup_least t_zero_def t_prod_def t_fusion_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The final model corresponds to paths as sequences of states of an automata, transition system or graph.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> path_quantale<span class="main">:</span> unital_quantale <span class="quoted">p_one</span> <span class="quoted">p_prod</span> <span class="quoted">Inter</span> <span class="quoted">Union</span> <span class="quoted"><span class="quoted">"<span class="main">(∩)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted">UNIV</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_prod_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rosenthal's book contains a wealth of other examples. Many of them come from ring theory 
(e.g. the additive subgroups of a ring form a quantale and so do the left, right and two-sided ideals). Others are based
on the interval $[0,\infty]$. The first line of models was the original motivation for the study of quantales, the second 
one is important to Lawvere's categorical generalisation of metric spaces. These examples are left for future consideration.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>  

    


  

</pre>
</div><div id="Quantic_Nuclei_Conuclei">
<div class="head">
<h1>Theory Quantic_Nuclei_Conuclei</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Quantic Nuclei and Conuclei
   Author: Georg Struth
   Maintainer: Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Quantic Nuclei and Conuclei›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quantic_Nuclei_Conuclei
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Quantale_Models.html">Quantale_Models</a> 

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Quantic nuclei and conuclei are an important part of the structure theory of quantales. I formalise
the basics, following Rosenthal's book~\cite{Rosenthal90}. In the structure theorems, I collect all parts 
of the proof, but do not present the theorems in compact form due to difficulties to speak about subalgebras 
and homomorphic images without explicit carrier sets. Nuclei also arise in the context of complete Heyting algebras,
frames and locales~\cite{Johnstone82}. Their formalisation seems an interesting future task.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Nuclei›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nucleus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>quantale<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">nucleus</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span>clop <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_lax"><span class="command">lemma</span></span> nuc_lax<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nucleus_def<span class="main">)</span>   

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unucleus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">unucleus</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span>nucleus <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">conucleus</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_prop1"><span class="command">lemma</span></span> nuc_prop1<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clop_extensive_var clop_iso_var nucleus_def psrpq.mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> clop_alt clop_extensive_var dual_order.trans nucleus_def psrpq.mult_isol_var<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_prop2"><span class="command">lemma</span></span> nuc_prop2<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clop_extensive_var clop_iso_var nsrnq.mult_isor nucleus_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> clop_alt nuc_prop1 nucleus_def<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_comp_prop"><span class="command">lemma</span></span> nuc_comp_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span>  <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nuc_prop1 nuc_prop2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nucleus_alt_def1"><span class="command">lemma</span></span> nucleus_alt_def1<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span>"</span></span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clop_def nucleus_def clop_extensive_var<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_anti<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> clop_extensive_var h nucleus_def proto_pre_quantale_class.mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h nuc_lax<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_canc1 nucleus_def clop_iso_var<span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> clop_alt dual_order.trans nucleus_def order_refl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois_imp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nucleus_alt_def2"><span class="command">lemma</span></span> nucleus_alt_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span>"</span></span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clop_extensive_var nucleus_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_anti<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> clop_extensive_var h nsrnq.mult_isor nucleus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h nuc_lax<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> clop_iso_var fres_canc1 h nucleus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> clop_alt dual_order.trans nucleus_def order_refl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nucleus_alt_def3"><span class="command">lemma</span></span> nucleus_alt_def3<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">←</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">←</span> <span class="bound">x</span> <span class="main">⟹</span> nucleus <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">←</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">←</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> ext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> fres_galois fres_one mult.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> bres_galois dual_order.trans h1 ext nsrnqo.mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fres_canc2 fres_galois h2 nsrnqo.mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> h1 h2 bres_galois ext fres_galois<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clop_def iso lax le_funI ext trans monoI nucleus_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nucleus_alt_def"><span class="command">lemma</span></span> nucleus_alt_def<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">←</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">←</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nucleus_alt_def1 nucleus_alt_def2 nucleus_alt_def3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nucleus_alt_def_cor1"><span class="command">lemma</span></span> nucleus_alt_def_cor1<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bres_galois bres_iso clop_extensive_var fres_galois nucleus_alt_def2 nucleus_def<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nucleus_alt_def_cor2"><span class="command">lemma</span></span> nucleus_alt_def_cor2<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bres_galois clop_extensive_var fres_galois fres_iso nucleus_alt_def1 nucleus_def<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nucleus_ab_unital"><span class="command">lemma</span></span> nucleus_ab_unital<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ab_unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_fres_eq nucleus_alt_def<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_comp_assoc"><span class="command">lemma</span></span> nuc_comp_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc nuc_prop1 nuc_prop2<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_Sup_closed"><span class="command">lemma</span></span> nuc_Sup_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∘</span> Sup <span class="main">∘</span> <span class="main">(`)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> Sup<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nucleus_def fun_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> SUP_least Sup_upper clop_alt clop_def monoD<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_upper2 Sup_le_iff clop_extensive_var clop_iso_var<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_Sup_closed_var"><span class="command">lemma</span></span> nuc_Sup_closed_var<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">⨆</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nuc_Sup_closed o_apply<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_Inf_closed"><span class="command">lemma</span></span> nuc_Inf_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> Sup_closed_set <span class="main">(</span>Fix <span class="free">f</span><span class="main">)</span>"</span></span> <span class="comment1">(* nitpick *)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_Inf_closed"><span class="command">lemma</span></span> nuc_Inf_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> Inf_closed_set <span class="main">(</span>Fix <span class="free">f</span><span class="main">)</span>"</span></span>   
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clop_Inf_closed nucleus_def<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_comp_distl"><span class="command">lemma</span></span> nuc_comp_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="main">(</span><span class="main">⨆</span><span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_distl image_image nuc_Sup_closed_var nuc_prop1<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_comp_distr"><span class="command">lemma</span></span> nuc_comp_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="main">⨆</span><span class="free">X</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_image Sup_distr nuc_Sup_closed_var nuc_prop2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">y</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_bres_closed"><span class="command">lemma</span></span> nuc_bres_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nucleus_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> clop_closure clop_extensive_var nucleus_alt_def_cor1 nucleus_def order_class.order.antisym rangeI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">→</span> <span class="free">f</span> <span class="free">y</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_fres_closed"><span class="command">lemma</span></span> nuc_fres_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">←</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">←</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nucleus_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> clop_closure clop_extensive_var eq_iff nucleus_alt_def_cor2 nucleus_def rangeI<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_fres_closed"><span class="command">lemma</span></span> nuc_fres_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">←</span> <span class="free">f</span> <span class="free">y</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_inf_closed"><span class="command">lemma</span></span> nuc_inf_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> inf_closed_set <span class="main">(</span>Fix <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_inf_closed nuc_Inf_closed<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_inf_closed_var"><span class="command">lemma</span></span> nuc_inf_closed_var<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> antisym_conv clop_alt clop_extensive_var inf_le2 inf_sup_ord<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_inf_iff nucleus_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Taken together these facts show that, for $f:Q\to Q$, $f[Q]$ forms a quantale with 
composition $f\, (-\cdot -)$ and sup $f\, (\bigsqcup -)$, and that $f:Q\to f[Q]$ is a quantale morphism. 
This is the first part of Theorem 3.1.1 in Rosenthal's book.›</span></span>

<span class="keyword1"><span class="command">class</span></span> quantale_with_nuc <span class="main">=</span> quantale <span class="main">+</span> cl_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cl_op_nuc<span class="main">:</span> <span class="quoted"><span class="quoted">"cl_op <span class="free">x</span> <span class="main">⋅</span> cl_op <span class="free">y</span> <span class="main">≤</span> cl_op <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> clattice_with_clop<span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> unital_quantale_with_nuc <span class="main">=</span> quantale_with_nuc <span class="main">+</span> unital_quantale <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one_nuc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> cl_op <span class="main">1</span>"</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nucleus_cl_op"><span class="command">lemma</span></span> nucleus_cl_op<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="main">(</span>cl_op<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale_with_nuc <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cl_op_class.clop_iso cl_op_nuc  clop_def clop_ext le_funI monoI nucleus_def<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-unucleus_cl_op"><span class="command">lemma</span></span> unucleus_cl_op<span class="main">:</span> <span class="quoted"><span class="quoted">"unucleus <span class="main">(</span>cl_op<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale_with_nuc <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nucleus_cl_op one_nuc unucleus_def<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> cl_op_im <span class="main">::</span> <span class="main">(</span><span class="quoted">quantale_with_nuc</span><span class="main">)</span> <span class="quoted">quantale</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">times_cl_op_im</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale_with_nuc cl_op_im <span class="main">⇒</span> <span class="tfree">'a</span> cl_op_im <span class="main">⇒</span> <span class="tfree">'a</span> cl_op_im"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> cl_op <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nuc_comp_assoc nuc_comp_distr nucleus_cl_op nuc_comp_distl<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> cl_op_im <span class="main">::</span> <span class="main">(</span><span class="quoted">unital_quantale_with_nuc</span><span class="main">)</span> <span class="quoted">unital_quantale</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">one_cl_op_im</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>unital_quantale_with_nuc cl_op_im"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cl_op <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> clop_closure nsrnqo.mult_onel nuc_prop2 nucleus_cl_op nucleus_def nsrnqo.mult_oner nuc_prop1<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The usefulness of these theorems remains unclear; it seems difficult to make them collaborate with concrete nuclei.›</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_hom"><span class="command">lemma</span></span> nuc_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_cl_op_im <span class="main">∘</span> cl_op <span class="main">∈</span> quantale_homset"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quantale_homset_iff comp_def fun_eq_iff
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Abs_cl_op_im_inverse Rep_cl_op_im_inverse nuc_comp_prop nucleus_cl_op rangeI times_cl_op_im.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> Sup_cl_op_im_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Abs_cl_op_im_inverse SUP_cong image_image map_fun_apply nuc_Sup_closed_var nucleus_cl_op rangeI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This finishes the first statement of Theorem 3.1.1. The second part follows. It states that for every 
surjective quantale homomorphism there is a nucleus such that the range of the nucleus is isomorphic to the range of the surjection.›</span></span> 
 
<span class="keyword1" id="Quantic_Nuclei_Conuclei-quant_morph_nuc"><span class="command">lemma</span></span> quant_morph_nuc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale_with_dual <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>quantale_with_dual"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nucleus <span class="main">(</span><span class="main">(</span>radj <span class="free">f</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?φ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>radj <span class="free">f</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> adj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊣</span> <span class="main">(</span>radj <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms quantale_hom_radj<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"clop <span class="var">?φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clop_adj<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="var">?φ</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="var">?φ</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="var">?φ</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="var">?φ</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_eq_dest_lhs quantale_homset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj adj_cancel_eq1 fun.map_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms quantale_homset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="var">?φ</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="var">?φ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj adj_def comp_apply order_refl<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a nucleus_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Quantic_Nuclei_Conuclei-surj_quantale_hom_bij_on"><span class="command">lemma</span></span> surj_quantale_hom_bij_on<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale_with_dual <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>quantale_with_dual"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"surj <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="main">(</span>range <span class="main">(</span>radj <span class="free">f</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms quantale_homset_iff surj_Sup_pres_bij_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This establishes the bijection, extending a similar fact about closure operators and complete lattices (surj-Sup-pres-bij). 
It remains to show that $f$ is a quantale morphism, that is, it preserves Sups and compositions of closed elements with operations 
defined as in the previous instantiation statement. Sup-preservation holds already for closure operators on complete lattices (surj-Sup-pres-iso).
Hence it remains to prove preservation of compositions.›</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-surj_comp_pres_iso"><span class="command">lemma</span></span> surj_comp_pres_iso<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale_with_dual <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>quantale_with_dual"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> quantale_homset"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">(</span>radj <span class="free">f</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊣</span> <span class="main">(</span>radj <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms quantale_hom_radj<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">(</span>radj <span class="free">f</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj_cancel_eq1 comp_eq_dest_lhs<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms quantale_homset_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This establishes the quantale isomorphism and finishes the proof of Theorem 3.1.1.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next I prove Theorem 3.1.2 in Rosenthal's book. nuc-Inf-closed shows that $\mathit{Fix}\, f$ is Inf-closed. Hence the two following 
lemmas show one direction.›</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_bres_pres"><span class="command">lemma</span></span> nuc_bres_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> Fix <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">→</span> <span class="free">y</span> <span class="main">∈</span> Fix <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> Fix <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"clop <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nucleus_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 a1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> clop_Fix_range clop_closure clop_extensive_var dual_order.antisym nucleus_alt_def_cor1<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-nuc_fres_pres"><span class="command">lemma</span></span> nuc_fres_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> Fix <span class="free">f</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span> <span class="main">∈</span> Fix <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> Fix <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"clop <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nucleus_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym_conv clop_Fix_range clop_closure clop_extensive_var nucleus_alt_def_cor2<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-lax_aux"><span class="command">lemma</span></span> lax_aux<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">→</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">←</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> <span class="bound">z</span><span class="main">}</span> <span class="main">⋅</span> <span class="main">⨅</span><span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">z</span><span class="main">}</span> <span class="main">≤</span> <span class="main">⨅</span><span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">z</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?φ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⨅</span><span class="main">{</span><span class="bound"><span class="bound">w</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">w</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">←</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> b<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="free">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_lower c<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="var">?φ</span> <span class="free">x</span> <span class="main">→</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois_imp fres_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="free">x</span>  <span class="main">→</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> b<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="free">x</span> <span class="main">⋅</span> <span class="var">?φ</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_lower d bres_galois<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_Inf_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-Inf_closed_res_nuc"><span class="command">lemma</span></span> Inf_closed_res_nuc<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Inf_closed_set <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">→</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">←</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nucleus <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">⨅</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nucleus_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_closed_clop assms lax_aux<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-Inf_closed_res_Fix"><span class="command">lemma</span></span> Inf_closed_res_Fix<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Inf_closed_set <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">→</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">←</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> Fix <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">⨅</span><span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Fix_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_lower le_Inf_iff<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Inf_closed_set_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mem_Collect_eq subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This finishes the proof of Theorem 3.1.2›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A Representation Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The final proofs for nuclei lead to Rosenthal's representation theorem for quantales (Theorem 3.1.2).›</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-down_set_lax_morph"><span class="command">lemma</span></span> down_set_lax_morph<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">↓</span> <span class="main">∘</span> Sup<span class="main">)</span> <span class="main">(</span><span class="free">X</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale set<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">↓</span> <span class="main">∘</span> Sup<span class="main">)</span> <span class="free">Y</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">↓</span> <span class="main">∘</span> Sup<span class="main">)</span> <span class="main">(</span><span class="free">X</span> <span class="main">⋅</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">(</span><span class="main">(</span><span class="main">↓</span> <span class="main">∘</span> Sup<span class="main">)</span> <span class="free">X</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">↓</span> <span class="main">∘</span> Sup<span class="main">)</span> <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">(</span><span class="free">X</span> <span class="main">⋅</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Sup_downset_adj adj_cancel_eq1 comp_apply comp_dist_mix<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_downset_adj_var eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-downset_Sup_nuc"><span class="command">lemma</span></span> downset_Sup_nuc<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="main">(</span><span class="main">↓</span> <span class="main">∘</span> <span class="main">(</span>Sup<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale set <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Sup_downset_adj clop_adj down_set_lax_morph nucleus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-downset_surj"><span class="command">lemma</span></span> downset_surj<span class="main">:</span> <span class="quoted"><span class="quoted">"surj_on <span class="main">↓</span> <span class="main">(</span>range <span class="main">(</span><span class="main">↓</span> <span class="main">∘</span> Sup<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> surj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In addition, $\downarrow$ is injective by Lemma downset-inj. Hence it is a bijection between the quantale and the powerset quantale. 
It remains to show that $\downarrow$ is a quantale morphism.›</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-downset_Sup_pres_var"><span class="command">lemma</span></span> downset_Sup_pres_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">↓</span> <span class="main">(</span><span class="main">⨆</span><span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">↓</span> <span class="main">∘</span> Sup<span class="main">)</span> <span class="main">(</span><span class="main">⇓</span> <span class="main">(</span><span class="free">X</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale set<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> comp_def downset_prop downset_set_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> Sup_subset_mono dual_order.refl mem_Collect_eq order_subst1 subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Sup_mono le_iff_inf le_infI2 mem_Collect_eq<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-downset_Sup_pres"><span class="command">lemma</span></span> downset_Sup_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">↓</span> <span class="main">(</span><span class="main">⨆</span><span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">↓</span> <span class="main">∘</span> Sup<span class="main">)</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">↓</span> <span class="main">`</span> <span class="main">(</span><span class="free">X</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale set<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> downset_Sup_pres_var downset_set_prop_var<span class="main">)</span>  

<span class="keyword1" id="Quantic_Nuclei_Conuclei-downset_comp_pres"><span class="command">lemma</span></span> downset_comp_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">↓</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale<span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">↓</span> <span class="main">∘</span> Sup<span class="main">)</span> <span class="main">(</span><span class="main">↓</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">↓</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Sup_downset_adj_var comp_apply comp_dist_mix downset_iso_iff dual_order.antisym order_refl<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This finishes the proof of Theorem 3.1.2.›</span></span>
 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conuclei›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conucleus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>quantale<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">conucleus</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span>coclop <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-conuc_lax"><span class="command">lemma</span></span> conuc_lax<span class="main">:</span> <span class="quoted"><span class="quoted">"conucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conucleus_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uconucleus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">uconucleus</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span>conucleus <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">1</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next I prove Theorem 3.1.3.›</span></span> 

<span class="keyword1" id="Quantic_Nuclei_Conuclei-conuc_Sup_closed"><span class="command">lemma</span></span> conuc_Sup_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"conucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∘</span> Sup <span class="main">∘</span> <span class="main">(`)</span> <span class="free">f</span> <span class="main">=</span> Sup <span class="main">∘</span> <span class="main">(`)</span> <span class="free">f</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> conucleus_def fun_eq_iff comp_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> coclop_coextensive_var coclop_idem coclop_iso image_comp image_image le_iff_sup mono_SUP sup.orderE<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-conuc_comp_closed"><span class="command">lemma</span></span> conuc_comp_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"conucleus <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conucleus_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym_conv coclop_coextensive_var coclop_idem_var<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The sets of fixpoints of conuclei are closed under Sups and composition; hence they form subquantales.›</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-conuc_Sup_qclosed"><span class="command">lemma</span></span> conuc_Sup_qclosed<span class="main">:</span> <span class="quoted"><span class="quoted">"conucleus <span class="free">f</span> <span class="main">⟹</span> Sup_closed_set <span class="main">(</span>Fix <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> comp_closed_set <span class="main">(</span>Fix <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coclop_Sup_closed conucleus_def<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> conucleus_def comp_closed_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coclop_coclosure coclop_coclosure_set coclop_coextensive_var dual_order.antisym<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This shows that the subset $\mathit{Fix} f$ of a quantale, for conucleus $f$, is closed under Sups and composition. 
It is therefore a subquantale. $f:f[Q]\to Q$ is an embedding. As before, this could be shown by formalising a type class of quantales with a conucleus operation,
converting the range of the conucleus into a type and providing a sublocale proof. First, this would require showing that the coclosed 
elements of a complete lattice form a complete sublattice. Relative to the proofs for closure operators and nuclei there is nothing to 
be learned. I provide this proof in the section on left-sided elements, where the conucleus can be expressed within the language of quantales.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The second part of Theorem 3.1.3 states that every subquantale of a given quantale is equal to $\mathit{Fix} f$ for some conucleus $f$.›</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-lax_aux2"><span class="command">lemma</span></span> lax_aux2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Sup_closed_set <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"comp_closed_set <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">⋅</span> <span class="main">⨆</span><span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span> <span class="main">≤</span> <span class="main">⨆</span><span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?φ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⨆</span><span class="main">{</span><span class="bound"><span class="bound">z</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="free">x</span> <span class="main">⋅</span> <span class="var">?φ</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="main">⨆</span><span class="main">{</span><span class="bound">v</span> <span class="main">⋅</span> <span class="bound">w</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_distr Sup_distl setcompr_eq_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">v</span> <span class="main">⋅</span> <span class="bound">w</span> <span class="main">|</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">smt</span> Collect_mono_iff Sup_subset_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Sup_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">smt</span> Sup_upper2 eq_iff mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?φ</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Collect_mono_iff Sup_subset_mono assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_closed_set_def psrpq.mult_isol_var<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-subquantale_conucleus"><span class="command">lemma</span></span> subquantale_conucleus<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Sup_closed_set <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"comp_closed_set <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conucleus <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⨆</span><span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> conucleus_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_closed_coclop assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lax_aux2<span class="main">)</span>

<span class="keyword1" id="Quantic_Nuclei_Conuclei-subquantale_Fix"><span class="command">lemma</span></span> subquantale_Fix<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Sup_closed_set <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"comp_closed_set <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> Fix <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⨆</span><span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Fix_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sup_least Sup_upper antisym mem_Collect_eq order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sup_closed_set_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mem_Collect_eq subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This finishes the proof of Theorem 3.1.3›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Quantale_Left_Sided">
<div class="head">
<h1>Theory Quantale_Left_Sided</h1>
</div>
<pre class="source"><span class="comment1">(* Title: Left-Sided Elements in Quantales
   Author: Georg Struth
   Maintainer: Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Left-Sided Elements in Quantales›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quantale_Left_Sided
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Quantic_Nuclei_Conuclei.html">Quantic_Nuclei_Conuclei</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> quantale
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Left-sided elements are well investigated in quantale theory. They could be defined in weaker settings, for instance,
ord with a top element.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">lsd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⊤</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rsd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="main">⊤</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">twosd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>lsd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> rsd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">slsd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⊤</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">srsd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="main">⊤</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">stwsd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>slsd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> srsd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsided_bres"><span class="command">lemma</span></span> lsided_bres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="main">⊤</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois lsd_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsided_fres"><span class="command">lemma</span></span> lsided_fres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊤</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois lsd_def<span class="main">)</span> 

<span class="keyword1" id="Quantale_Left_Sided-lsided_fres_eq"><span class="command">lemma</span></span> lsided_fres_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lsd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊤</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fres_galois top_le lsd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Quantale_Left_Sided-lsided_slsided"><span class="command">lemma</span></span> lsided_slsided<span class="main">:</span> <span class="quoted"><span class="quoted">"lsd <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> slsd <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fres_sol lsided_fres_eq slsd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Quantale_Left_Sided-lsided_prop"><span class="command">lemma</span></span> lsided_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"lsd <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois lsided_fres_eq<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-rsided_fres"><span class="command">lemma</span></span> rsided_fres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rsd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">←</span> <span class="main">⊤</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fres_galois rsd_def<span class="main">)</span> 

<span class="keyword1" id="Quantale_Left_Sided-rsided_bres"><span class="command">lemma</span></span> rsided_bres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rsd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊤</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois rsd_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-rsided_bres_eq"><span class="command">lemma</span></span> rsided_bres_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rsd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊤</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> top_le rsided_bres <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantale_Left_Sided-rsided_srsided"><span class="command">lemma</span></span> rsided_srsided<span class="main">:</span> <span class="quoted"><span class="quoted">"rsd <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> srsd <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bres_sol rsided_bres_eq srsd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Quantale_Left_Sided-rsided_prop"><span class="command">lemma</span></span> rsided_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"rsd <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_galois rsided_bres_eq<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsided_top"><span class="command">lemma</span></span> lsided_top<span class="main">:</span> <span class="quoted"><span class="quoted">"lsd <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsd_def<span class="main">)</span>
    
<span class="keyword1" id="Quantale_Left_Sided-lsided_bot"><span class="command">lemma</span></span> lsided_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"lsd <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsd_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-rsided_top"><span class="command">lemma</span></span> rsided_top<span class="main">:</span> <span class="quoted"><span class="quoted">"rsd <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rsd_def<span class="main">)</span>
    
<span class="keyword1" id="Quantale_Left_Sided-rsided_bot"><span class="command">lemma</span></span> rsided_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"rsd <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rsd_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Right-sided elements are henceforth not considered. Their properties arise by opposition
duality, which is not formalised.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following functions have left-sided elements as fixpoints.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lsl</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ν</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ν</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊤</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lsu</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>quantale <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ν<span class="hidden">⇧</span><sup>♮</sup></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⊤</span> <span class="main">→</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹These functions are adjoints.›</span></span>

<span class="keyword1" id="Quantale_Left_Sided-ls_galois"><span class="command">lemma</span></span> ls_galois<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">⊣</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_def bres_galois lsl_def lsu_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Due to this, the following properties hold.›</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_iso"><span class="command">lemma</span></span> lsl_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="keyword1">ν</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> adj_iso1 ls_galois <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_iso_var"><span class="command">lemma</span></span> lsl_iso_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsl_iso monoD<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_iso"><span class="command">lemma</span></span> lsu_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> adj_iso2 ls_galois <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_iso_var"><span class="command">lemma</span></span> lsu_iso_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsu_iso monoD<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_bot"><span class="command">lemma</span></span> lsl_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsl_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_top"><span class="command">lemma</span></span> lsu_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsu_def bres_galois_imp top_le<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_Inf_pres"><span class="command">lemma</span></span> lsu_Inf_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf_pres <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fun_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ls_galois radj_Inf_pres<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_Sup_pres"><span class="command">lemma</span></span> lsl_Sup_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup_pres <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> SUP_cong Sup_distl lsl_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_Inf_closed"><span class="command">lemma</span></span> lsu_Inf_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf_closed_set <span class="main">(</span>range <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_pres_Inf_closed lsu_Inf_pres<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_Sup_closed"><span class="command">lemma</span></span> lsl_Sup_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup_closed_set <span class="main">(</span>range <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_pres_Sup_closed lsl_Sup_pres<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_lsu_canc1"><span class="command">lemma</span></span> lsl_lsu_canc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">∘</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">≤</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_cancel1 ls_galois<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_lsu_canc2"><span class="command">lemma</span></span> lsl_lsu_canc2<span class="main">:</span> <span class="quoted"><span class="quoted">"id <span class="main">≤</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">∘</span> <span class="keyword1">ν</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_cancel2 ls_galois<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-clop_lsu_lsl"><span class="command">lemma</span></span> clop_lsu_lsl<span class="main">:</span> <span class="quoted"><span class="quoted">"clop <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">∘</span> <span class="keyword1">ν</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clop_adj ls_galois<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-coclop_lsl_lsu"><span class="command">lemma</span></span> coclop_lsl_lsu<span class="main">:</span> <span class="quoted"><span class="quoted">"coclop <span class="main">(</span><span class="keyword1">ν</span> <span class="main">∘</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coclop_adj ls_galois<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-dang1"><span class="command">lemma</span></span> dang1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lsl_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bres_galois bres_interchange bres_top_top inf.coboundedI1<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_trans"><span class="command">lemma</span></span> lsl_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">∘</span> <span class="keyword1">ν</span> <span class="main">≤</span> <span class="keyword1">ν</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lsl_def fun_eq_iff comp_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> bres_galois bres_interchange bres_top_top le_funI<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_lsu_prop"><span class="command">lemma</span></span> lsl_lsu_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">∘</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">≤</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> le_fun_def comp_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj_def dang1 dual_order.trans le_iff_inf ls_galois order_refl top_greatest<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_lsl_prop"><span class="command">lemma</span></span> lsu_lsl_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">≤</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">∘</span> <span class="keyword1">ν</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> le_fun_def comp_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj_def comp_def le_fun_def ls_galois lsl_trans<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> unital_quantale
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Left-sidedness and strict left-sidedness now coincide.›</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsided_eq"><span class="command">lemma</span></span> lsided_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"lsd <span class="main">=</span> slsd"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fun_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_iff le_top lsd_def slsd_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsided_eq_var1"><span class="command">lemma</span></span> lsided_eq_var1<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="main">⊤</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">⊤</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bres_galois dual_order.trans eq_iff le_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantale_Left_Sided-lsided_eq_var2"><span class="command">lemma</span></span> lsided_eq_var2<span class="main">:</span> <span class="quoted"><span class="quoted">"lsd <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">⊤</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bres_galois lsided_eq lsided_eq_var1 lsd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsided_def3"><span class="command">lemma</span></span> lsided_def3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lsl_def lsu_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lsided_eq lsided_eq_var2 slsd_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-Fix_lsl_lsu"><span class="command">lemma</span></span> Fix_lsl_lsu<span class="main">:</span> <span class="quoted"><span class="quoted">"Fix <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> Fix <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Fix_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsided_def3<span class="main">)</span> 

<span class="keyword1" id="Quantale_Left_Sided-Fix_lsl_left_slsided"><span class="command">lemma</span></span> Fix_lsl_left_slsided<span class="main">:</span> <span class="quoted"><span class="quoted">"Fix <span class="keyword1">ν</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span><span class="main">.</span> lsd <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Fix_def lsl_def lsd_def <span class="keyword1"><span class="command">using</span></span> eq_iff le_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantale_Left_Sided-Fix_lsl_iff"><span class="command">lemma</span></span> Fix_lsl_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> Fix <span class="keyword1">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fix_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-Fix_lsu_iff"><span class="command">lemma</span></span> Fix_lsu_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> Fix <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fix_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_lsu_prop_eq"><span class="command">lemma</span></span> lsl_lsu_prop_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">∘</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">=</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> antisym clop_extensive_var clop_lsu_lsl comp_apply le_fun_def lsided_eq_var1 lsl_lsu_prop lsu_def lsu_lsl_prop<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_lsl_prop_eq"><span class="command">lemma</span></span> lsu_lsl_prop_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">∘</span> <span class="keyword1">ν</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj_cancel_eq1 ls_galois lsl_lsu_prop_eq<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Connection with Closure and Coclosure Operators, Nuclei and Conuclei›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹lsl is therefore a closure operator, lsu a cocolosure operator.›</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_clop"><span class="command">lemma</span></span> lsl_clop<span class="main">:</span> <span class="quoted"><span class="quoted">"clop <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> clop_lsu_lsl lsu_lsl_prop_eq<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_coclop"><span class="command">lemma</span></span> lsu_coclop<span class="main">:</span> <span class="quoted"><span class="quoted">"coclop <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coclop_lsl_lsu lsl_lsu_prop_eq<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_range_fix"><span class="command">lemma</span></span> lsl_range_fix<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> Fix <span class="keyword1">ν</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clop_closure_set lsl_clop<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_range_fix"><span class="command">lemma</span></span> lsu_range_fix<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> Fix <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coclop_coclosure_set lsu_coclop<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-range_lsl_iff"><span class="command">lemma</span></span> range_lsl_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span> <span class="main">∈</span> range <span class="keyword1">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsl_range_fix<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-range_lsu_iff"><span class="command">lemma</span></span> range_lsu_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span> <span class="main">∈</span> range <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsu_range_fix<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹lsl and lsu are therefore both Sup and Inf closed.›</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_Sup_closed"><span class="command">lemma</span></span> lsu_Sup_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup_closed_set <span class="main">(</span>Fix <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fix_lsl_lsu lsl_Sup_closed lsl_range_fix<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_Inf_closed"><span class="command">lemma</span></span> lsl_Inf_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf_closed_set <span class="main">(</span>Fix <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fix_lsl_lsu lsu_Inf_closed lsu_range_fix<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹lsl is even a quantic conucleus.›</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_lax"><span class="command">lemma</span></span> lsu_lax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lsu_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bres_canc1 bres_galois bres_interchange le_top order_trans<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_one"><span class="command">lemma</span></span> lsu_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lsu_def <span class="keyword1"><span class="command">using</span></span> bres_canc1 dual_order.trans le_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_one"><span class="command">lemma</span></span> lsl_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lsl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_conuc"><span class="command">lemma</span></span> lsu_conuc<span class="main">:</span> <span class="quoted"><span class="quoted">"conucleus <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsu_coclop conucleus_def lsu_lax<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹It is therefore closed under composition.›</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_comp_closed_var"><span class="command">lemma</span></span> lsu_comp_closed_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conuc_comp_closed lsu_conuc<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_comp_closed"><span class="command">lemma</span></span> lsu_comp_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"comp_closed_set <span class="main">(</span>Fix <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conuc_Sup_qclosed lsu_conuc<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹lsl is not a quantic nucleus unless composition is commutative.›</span></span>      

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span><span class="main">)</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Yet it is closed under composition (because the set of fixpoints are the same).›</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_comp_closed"><span class="command">lemma</span></span> lsl_comp_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"comp_closed_set <span class="main">(</span>Fix <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fix_lsl_lsu lsu_comp_closed<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_comp_closed_var"><span class="command">lemma</span></span> lsl_comp_closed_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fix_lsl_iff lsl_def lsl_range_fix mult.assoc rangeI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following simple properties go beyond nuclei and conuclei.›</span></span>  

<span class="keyword1" id="Quantale_Left_Sided-lsl_lsu_ran"><span class="command">lemma</span></span> lsl_lsu_ran<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">=</span> range <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fix_lsl_lsu lsl_range_fix lsu_range_fix<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_top"><span class="command">lemma</span></span> lsl_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊤</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clop_top lsl_clop<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_bot"><span class="command">lemma</span></span> lsu_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊥</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lsided_def3 lsl_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_inj_on"><span class="command">lemma</span></span> lsu_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span>Fix <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coclop_coclosure inj_onI lsu_coclop lsu_range_fix<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_inj_on"><span class="command">lemma</span></span> lsl_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="keyword1">ν</span> <span class="main">(</span>Fix <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> clop_closure inj_onI lsl_clop lsl_range_fix<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Additional preservation properties of lsl and lsu are useful in proofs.›</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_Inf_closed_var"><span class="command">lemma</span></span> lsl_Inf_closed_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="keyword1">ν</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span>  <span class="keyword1">ν</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> INF_image lsided_def3 lsu_Inf_pres lsu_lsl_prop_eq o_apply<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_Sup_closed_var"><span class="command">lemma</span></span> lsl_Sup_closed_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="keyword1">ν</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lsl_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_distl mult.assoc top_times_top<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_Inf_closed_var"><span class="command">lemma</span></span> lsu_Inf_closed_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> INF_image lsided_def3 lsl_Inf_closed_var lsl_lsu_prop_eq<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_Sup_closed_var"><span class="command">lemma</span></span> lsu_Sup_closed_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SUP_image lsided_def3 lsl_Sup_closed_var lsl_lsu_prop_eq<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_inf_closed_var"><span class="command">lemma</span></span> lsl_inf_closed_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> antisym clop_extensive_var dang1 inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_inf_iff lsl_clop<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_sup_closed_var"><span class="command">lemma</span></span> lsl_sup_closed_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⊔</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span> <span class="main">⊔</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Sup_sup_closed lsl_Sup_closed range_eqI range_lsl_iff sup_closed_set_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_inf_closed_var"><span class="command">lemma</span></span> lsu_inf_closed_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span> <span class="main">⊓</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lsided_def3 lsl_inf_closed_var lsl_lsu_prop_eq o_apply<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_sup_closed_var"><span class="command">lemma</span></span> lsu_sup_closed_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">⊔</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span> <span class="main">⊔</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lsided_def3 lsl_lsu_prop_eq lsl_sup_closed_var o_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_fres_closed"><span class="command">lemma</span></span> lsu_fres_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">←</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">←</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lsu_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_curry fres_bres<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_fres_closed"><span class="command">lemma</span></span> lsl_fres_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">←</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">←</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lsl_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fres_interchange lsd_def lsided_eq mult.assoc slsd_def top_times_top<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_almost_lax"><span class="command">lemma</span></span> lsl_almost_lax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top.right_neutral lsided_eq lsided_prop lsl_def lsl_inf_closed_var mult.right_neutral slsd_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally, here are two counterexamples.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">→</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">→</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">→</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">→</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale<span class="main">)</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>
 
<span class="keyword1"><span class="command">context</span></span> ab_quantale
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1" id="Quantale_Left_Sided-lsided_times_top"><span class="command">lemma</span></span> lsided_times_top<span class="main">:</span> <span class="quoted"><span class="quoted">"lsd <span class="main">(</span><span class="main">⊤</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lsd_def mult_isor top_greatest mult_assoc<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsided_le2"><span class="command">lemma</span></span> lsided_le2<span class="main">:</span> <span class="quoted"><span class="quoted">"lsd <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">⊤</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lsided_prop psrpq.mult_isol mult_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Quantale_Left_Sided-lsided_le3"><span class="command">lemma</span></span> lsided_le3<span class="main">:</span> <span class="quoted"><span class="quoted">"lsd <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le1 lsided_prop mult_isol order_trans mult_commute<span class="main">)</span>
    
<span class="keyword1" id="Quantale_Left_Sided-lsided_le4"><span class="command">lemma</span></span> lsided_le4<span class="main">:</span> <span class="quoted"><span class="quoted">"lsd <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_isor lsided_le3<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsided_times_le_inf"><span class="command">lemma</span></span> lsided_times_le_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"lsd <span class="free">x</span> <span class="main">⟹</span> lsd <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lsided_prop lsided_le2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now lsl is a quantic nucleus.›</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_lax"><span class="command">lemma</span></span> lsl_lax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'aa</span><span class="main">::</span>ab_unital_quantale<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> lsl_almost_lax lsl_def mult.commute mult.left_commute<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_nuc"><span class="command">lemma</span></span> lsl_nuc<span class="main">:</span> <span class="quoted"><span class="quoted">"nucleus <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ab_unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsl_clop nucleus_def lsl_lax<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following properties go beyond nuclei.›</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_comp_pres"><span class="command">lemma</span></span> lsl_comp_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ab_unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lsl_comp_closed_var lsl_nuc nuc_prop1 nuc_prop2<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_bres_closed"><span class="command">lemma</span></span> lsl_bres_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">→</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">→</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ab_unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsl_nuc nuc_bres_closed<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_bres_pres"><span class="command">lemma</span></span> lsu_bres_pres <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">→</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">→</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ab_unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bres_fres_eq<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_prelocalic_var"><span class="command">lemma</span></span> lsl_prelocalic_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ab_unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top.right_neutral lsided_le4 lsided_times_top lsl_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-dang3"><span class="command">lemma</span></span> dang3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ab_unital_quantale<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lsided_le4 lsided_times_top lsl_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_prelocalic"><span class="command">lemma</span></span> lsl_prelocalic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ab_unital_quantale<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lsided_times_le_inf lsided_times_top lsl_def<span class="main">)</span> 

<span class="keyword1" id="Quantale_Left_Sided-lsl_local"><span class="command">lemma</span></span> lsl_local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ab_unital_quantale<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsl_def mult.left_commute<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_local_eq"><span class="command">lemma</span></span> lsl_local_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ab_unital_quantale<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsl_def mult.left_commute<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Relative pseudocomplementation can be defined on the subquantale induced by lsu.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rpc</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>bool_unital_quantale<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_rpc"><span class="command">lemma</span></span> lsl_rpc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span>rpc <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> rpc <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lsl_lsu_prop_eq o_apply rpc_def<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-lsu_rpc"><span class="command">lemma</span></span> lsu_rpc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span>rpc <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> rpc <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lsided_def3 lsl_rpc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quantale_Left_Sided-lsl_rpc_galois"><span class="command">lemma</span></span> lsl_rpc_galois<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">≤</span> rpc <span class="free">x</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>bool_unital_quantale<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj_def inf_commute ls_galois shunt1<span class="main">)</span> 

<span class="keyword1" id="Quantale_Left_Sided-lsl_rpc_galois_var"><span class="command">lemma</span></span> lsl_rpc_galois_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">ν</span> <span class="free">z</span> <span class="main">≤</span> rpc <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adj_def ls_galois lsl_rpc_galois lsu_rpc<span class="main">)</span>

<span class="keyword1" id="Quantale_Left_Sided-rpc_expl_aux"><span class="command">lemma</span></span> rpc_expl_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊓</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>bool_unital_quantale<span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span> <span class="main">≤</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊓</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> lsided_eq lsided_prop lsl_def lsl_lsu_prop_eq lsl_rpc_galois mem_Collect_eq o_apply rpc_def slsd_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">⨆</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊓</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">z</span><span class="main">}</span> <span class="main">≤</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_mono_iff Sup_subset_mono<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1" id="Quantale_Left_Sided-rpc_expl"><span class="command">lemma</span></span> rpc_expl<span class="main">:</span> <span class="quoted"><span class="quoted">"rpc <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊓</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>bool_unital_quantale<span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rpc <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> rpc <span class="free">x</span> <span class="free">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_atMost atMost_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lsl_rpc_galois <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rpc_expl_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Non-Preservation and Lack of Closure›</span></span>

<span class="keyword1"><span class="command">context</span></span> bool_ab_unital_quantale
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A few counterexamples deal in particular with lack of closure with respect to boolean complementation.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span>"</span></span> <span class="comment1">(*nitpick    *)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="main">⨆</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="bound">p</span> <span class="main">|</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">P</span><span class="main">}</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"rpc <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"rpc <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span> <span class="comment1">(*nitpick this rules out localic nuclei.*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span>"</span></span>  <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span><span class="main">)</span>"</span></span>  <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span>"</span></span>  <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span> <span class="free">y</span><span class="main">)</span>"</span></span>  <span class="comment1">(*nitpick*)</span>
  <span class="keyword1"><span class="command">oops</span></span>  

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of Quotient Algebras and Subalgebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally I replay Rosenthal's quotient and subalgebra proofs for nuclei and conuclei in the concrete setting of left-sided elements. Ideally
it should be sufficient to show that lsl is a (quantale with) nucleus and then pick up the quotient algebra proof from the nucleus section. But there is no
way of achieving this, apart from creating a type class for quantales with the lsl operation. This seems bizarre, since lsl is just a definition.
On the other hand, an approach in which interpretations are used instead of instantiations might do the job.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The first proof shows that lsu, as a conucleus, yields a subalgebra.›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> lsu_set <span class="main">=</span> <span class="quoted"><span class="quoted">"Fix <span class="main">(</span><span class="keyword1">ν<span class="hidden">⇧</span><sup>♮</sup></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Fix_lsu_iff lsu_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_lsu_set

<span class="keyword1"><span class="command">instantiation</span></span> lsu_set <span class="main">::</span> <span class="main">(</span><span class="quoted">unital_quantale</span><span class="main">)</span> <span class="quoted">quantale</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">times_lsu_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsu_set <span class="main">⇒</span> <span class="tfree">'a</span> lsu_set <span class="main">⇒</span> <span class="tfree">'a</span> lsu_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">times</span>
  <span class="keyword1"><span class="command">using</span></span> comp_closed_set_def lsu_comp_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">Inf_lsu_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsu_set set <span class="main">⇒</span> <span class="tfree">'a</span> lsu_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">Inf</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fix_lsl_lsu Inf_closed_set_def lsl_Inf_closed subset_eq<span class="main">)</span>
 
<span class="keyword1"><span class="command">lift_definition</span></span>  <span class="class_parameter">Sup_lsu_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsu_set set <span class="main">⇒</span> <span class="tfree">'a</span> lsu_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">Sup</span>
  <span class="keyword1"><span class="command">using</span></span> Sup_closed_set_def lsu_Sup_closed subsetI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 
<span class="keyword1"><span class="command">lift_definition</span></span>  <span class="class_parameter">bot_lsu_set</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsu_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_lsu_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsu_set <span class="main">⇒</span> <span class="tfree">'a</span> lsu_set <span class="main">⇒</span> <span class="tfree">'a</span> lsu_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">sup</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fix_lsu_iff lsu_sup_closed_var<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_lsu_set</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsu_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_lsu_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsu_set <span class="main">⇒</span> <span class="tfree">'a</span> lsu_set <span class="main">⇒</span> <span class="tfree">'a</span> lsu_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">inf</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fix_lsu_iff lsu_inf_closed_var<span class="main">)</span>
  
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_lsu_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsu_set <span class="main">⇒</span> <span class="tfree">'a</span> lsu_set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span>  <span class="class_parameter">less_lsu_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsu_set <span class="main">⇒</span> <span class="tfree">'a</span> lsu_set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc Inf_lower Inf_greatest Sup_upper Sup_least less_le_not_le Sup_distr Sup_distl<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This proof checks simply closure conditions, as one would expect for establishing a subalgebra.›</span></span>

<span class="keyword1"><span class="command">instance</span></span> lsu_set <span class="main">::</span> <span class="main">(</span><span class="quoted">bool_ab_unital_quantale</span><span class="main">)</span> <span class="quoted">distrib_ab_quantale</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> sup_inf_distrib1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 
<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> lsl_set <span class="main">=</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="keyword1">ν</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span> unital_quantale <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_lsl_set

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The final statement shows that lsu, as a nucleus, yields a quotient algebra.›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> lsl_set <span class="main">::</span> <span class="main">(</span><span class="quoted">ab_unital_quantale</span><span class="main">)</span> <span class="quoted">ab_unital_quantale</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">one_lsl_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ab_unital_quantale lsl_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">Inf_lsl_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsl_set set <span class="main">⇒</span> <span class="tfree">'a</span> lsl_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">Sup_lsl_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsl_set set <span class="main">⇒</span> <span class="tfree">'a</span> lsl_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_lsl_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsl_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_lsl_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsl_set <span class="main">⇒</span> <span class="tfree">'a</span> lsl_set <span class="main">⇒</span> <span class="tfree">'a</span> lsl_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">ν</span> <span class="bound">x</span> <span class="main">⊔</span> <span class="keyword1">ν</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> lsl_sup_closed_var<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span>   <span class="class_parameter">top_lsl_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsl_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lift_definition</span></span>  <span class="class_parameter">inf_lsl_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsl_set <span class="main">⇒</span> <span class="tfree">'a</span> lsl_set <span class="main">⇒</span> <span class="tfree">'a</span> lsl_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">ν</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lsl_inf_closed_var range_lsl_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_lsl_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsl_set <span class="main">⇒</span> <span class="tfree">'a</span> lsl_set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="keyword1">ν</span> <span class="bound">x</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_lsl_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsl_set <span class="main">⇒</span> <span class="tfree">'a</span> lsl_set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">ν</span> <span class="bound">x</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span>   <span class="class_parameter">times_lsl_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lsl_set <span class="main">⇒</span> <span class="tfree">'a</span> lsl_set <span class="main">⇒</span> <span class="tfree">'a</span> lsl_set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsl_local_eq mult.commute mult.left_commute<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
                     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Inf_lower lsl_iso_var range_lsl_iff<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Inf_greatest lsl_iso_var range_lsl_iff<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Sup_upper lsl_iso_var range_lsl_iff<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Sup_least lsl_iso_var range_lsl_iff<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> Sup_distl image_cong lsl_local_eq mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> Sup_distl image_cong lsl_local_eq mult.commute<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsl_def <span class="quasi_keyword">cong</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> image_cong_simp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lsl_local_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This proof checks preservation properties instead of closure ones.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span> 
</pre>
</div>