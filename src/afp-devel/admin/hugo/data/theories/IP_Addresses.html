<div id="NumberWang_IPv4">
<div class="head">
<h1>Theory NumberWang_IPv4</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> NumberWang_IPv4
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Word.html">HOL-Library.Word</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="NumberWang_IPv4-zdiv_mult_self"><span class="command">lemma</span></span> zdiv_mult_self<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>›</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span> <span class="free">m</span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Helper Lemmas for Low-Level Operations on Machine Words›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Needed for IPv4 Syntax›</span></span>

<span class="keyword1" id="NumberWang_IPv4-mod256"><span class="command">lemma</span></span> mod256<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">d</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="numeral">16777216</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">256</span> <span class="main">=</span> <span class="free">d</span> <span class="keyword1">mod</span> <span class="numeral">256</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> mod_mult_self2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">256</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">65536</span> <span class="main">*</span> <span class="free">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="numeral">65536</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">256</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">256</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">=</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">256</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mod_mult_self2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">256</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">256</span> <span class="main">*</span> <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">d</span> <span class="keyword1">mod</span> <span class="numeral">256</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mod_mult_self2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NumberWang_IPv4-div65536"><span class="command">lemma</span></span> div65536<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">(</span>int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">16777216</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">65536</span> <span class="keyword1">mod</span> <span class="numeral">256</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> zdiv_mult_self<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="numeral">65536</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">256</span> <span class="main">*</span> <span class="main">(</span>int <span class="free">a</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">16777216</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">65536</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">(</span>int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">65536</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> zdiv_mult_self<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">65536</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"int <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">65536</span> <span class="main">+</span> int <span class="free">b</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="free">b</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> helper<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">16777216</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">65536</span> <span class="main">=</span> int <span class="free">b</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NumberWang_IPv4-div256"><span class="command">lemma</span></span> div256<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">(</span>int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">16777216</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">256</span> <span class="keyword1">mod</span> <span class="numeral">256</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> zdiv_mult_self<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="numeral">256</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">65536</span> <span class="main">*</span> <span class="main">(</span>int <span class="free">a</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">16777216</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">256</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">(</span>int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">256</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> int <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> zdiv_mult_self<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">256</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">256</span> <span class="main">*</span> int <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">256</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">b</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> int <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> zdiv_mult_self<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"int <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">256</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"int <span class="free">c</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">d</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">256</span> <span class="main">+</span> int <span class="free">c</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">b</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> int <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="free">c</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">b</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> int <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> helper1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">d</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="numeral">16777216</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">256</span> <span class="main">=</span>
                          int <span class="free">c</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">b</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> int <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> mod_mult_self2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"int <span class="free">c</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">256</span> <span class="main">*</span> int <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="numeral">256</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">c</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">b</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> int <span class="free">a</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">256</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">c</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">256</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="free">c</span> <span class="keyword1">mod</span> <span class="numeral">256</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mod_mult_self2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"int <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="numeral">256</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"int <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mod_pos_pos_trivial<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> helper2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">c</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> int <span class="free">b</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> int <span class="free">a</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">256</span> <span class="main">=</span> int <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> helper1 helper2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="NumberWang_IPv6">
<div class="head">
<h1>Theory NumberWang_IPv6</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> NumberWang_IPv6
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Word_Lib/Word_Lemmas.html">Word_Lib.Word_Lemmas</a>
  <a href="../Word_Lib/Word_Syntax.html">Word_Lib.Word_Syntax</a>
  <a href="../Word_Lib/Reversed_Bit_Lists.html">Word_Lib.Reversed_Bit_Lists</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Helper Lemmas for Low-Level Operations on Machine Words›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Needed for IPv6 Syntax›</span></span>

<span class="keyword1" id="NumberWang_IPv6-length_drop_bl"><span class="command">lemma</span></span> length_drop_bl<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>dropWhile Not <span class="main">(</span>to_bl <span class="main">(</span>of_bl <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">bs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> length_takeWhile_Not_replicate_False<span class="main">:</span>
    <span class="quoted"><span class="quoted">"length <span class="main">(</span>takeWhile Not <span class="main">(</span>replicate <span class="skolem">n</span> False <span class="main">@</span> <span class="skolem">ls</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> length <span class="main">(</span>takeWhile Not <span class="skolem">ls</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">ls</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> takeWhile_append2<span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_rep_drop dropWhile_eq_drop length_takeWhile_Not_replicate_False<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NumberWang_IPv6-bl_drop_leading_zeros"><span class="command">lemma</span></span> bl_drop_leading_zeros<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>of_bl<span class="main">::</span> bool list <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">(</span>dropWhile Not <span class="free">bs</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span>of_bl<span class="main">::</span> bool list <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="free">bs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1" id="NumberWang_IPv6-bl_length_drop_bound"><span class="command">lemma</span></span> bl_length_drop_bound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>dropWhile Not <span class="free">bs</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>dropWhile Not <span class="main">(</span>to_bl <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span> bool list <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> bl_length_drop_twice<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"length <span class="main">(</span>dropWhile Not <span class="main">(</span>to_bl <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span> bool list <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">(</span>dropWhile Not <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       length <span class="main">(</span>dropWhile Not <span class="main">(</span>to_bl <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span> bool list <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bl_drop_leading_zeros<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> length_drop_bl
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>dropWhile Not <span class="main">(</span>to_bl <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span> bool list <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>dropWhile Not <span class="free">bs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> dual_order.trans<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> bl_length_drop_twice<span class="main">)</span>
   <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NumberWang_IPv6-length_drop_mask_outer"><span class="command">lemma</span></span> length_drop_mask_outer<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ip</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="free">n'</span> <span class="main">=</span> <span class="free">len</span> <span class="main">⟹</span> length <span class="main">(</span>dropWhile Not <span class="main">(</span>to_bl <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="main">(</span>mask <span class="free">n</span> <span class="main">&lt;&lt;</span> <span class="free">n'</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">len</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> word_and_mask_shiftl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> shiftl_shiftr1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> and_mask<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_size<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_drop_mask<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1" id="NumberWang_IPv6-length_drop_mask_inner"><span class="command">lemma</span></span> length_drop_mask_inner<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ip</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="free">n'</span> <span class="main">⟹</span> length <span class="main">(</span>dropWhile Not <span class="main">(</span>to_bl <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="main">(</span>mask <span class="free">n</span> <span class="main">&lt;&lt;</span> <span class="free">n'</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="free">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> word_and_mask_shiftl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> shiftl_shiftr3<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_size<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mask_twice<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_drop_mask<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="NumberWang_IPv6-mask128"><span class="command">lemma</span></span> mask128<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</span> <span class="main">=</span> <span class="main">(</span>mask <span class="numeral">128</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mask_eq<span class="main">)</span>


<span class="comment1">(*-------------- things for ipv6 syntax round trip property two ------------------*)</span>

<span class="comment1">(*n small, m large*)</span>
<span class="keyword1" id="NumberWang_IPv6-helper_masked_ucast_generic"><span class="command">lemma</span></span> helper_masked_ucast_generic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="numeral">16</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">128</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span> <span class="numeral">16</span> word <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="free">b</span> <span class="main">&lt;&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> mnh2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="numeral">0x10000</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="numeral">128</span> word"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> mnh3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">-</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> power_2_16_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">16</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="numeral">65535</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">16</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span><span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> power2_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="skolem">a</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="numeral">65536</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Nat.less_eq_Suc_le<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">65536</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">16</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> power2_rule <span class="quoted"><span class="quoted">‹<span class="numeral">16</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">65536</span> <span class="main">=</span> unat <span class="main">(</span><span class="numeral">65536</span><span class="main">::</span><span class="numeral">128</span> word<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> mnh2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unat <span class="skolem">x</span> <span class="main">&lt;</span>  unat <span class="main">(</span><span class="numeral">65536</span><span class="main">::</span><span class="numeral">128</span> word<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> Word.unat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"unat <span class="skolem">x</span> <span class="main">&lt;</span> <span class="numeral">65536</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> mnh3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unat <span class="skolem">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> power_2_16_nat <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">-</span> <span class="free">n</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> word_less_nat_alt<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> mnhelper2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">16</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> of_bl_length_less<span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> mnhelper3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> div_lt_mult<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> word_less_two_pow_divI<span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mnhelper2 p2_gt_0<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> ucast_bl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> shiftl_of_bl<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> of_bl_append<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> word_and_mask_shiftl<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> shiftr_div_2n_w<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_size<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> word_div_less<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> mnhelper3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="NumberWang_IPv6-unat_of_bl_128_16_less_helper"><span class="command">lemma</span></span> unat_of_bl_128_16_less_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unat <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">16</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> word_bl_Rep' <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">16</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unat <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> unat_of_bl_length<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1" id="NumberWang_IPv6-unat_of_bl_128_16_le_helper"><span class="command">lemma</span></span> unat_of_bl_128_16_le_helper<span class="main">:</span> <span class="quoted"><span class="quoted">"unat <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span> bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="main">(</span><span class="free">b</span><span class="main">::</span><span class="numeral">16</span> word<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">65535</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> unat_of_bl_128_16_less_helper<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"unat <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span> bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">65536</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">from</span></span> Suc_leI<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(*reverse*)</span>
 <span class="keyword1" id="NumberWang_IPv6-helper_masked_ucast_reverse_generic"><span class="command">lemma</span></span> helper_masked_ucast_reverse_generic<span class="main">:</span>
   <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
   <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="numeral">16</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="numeral">128</span> <span class="main">-</span> <span class="numeral">16</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span> <span class="numeral">16</span> word <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="free">b</span> <span class="main">&lt;&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

   <span class="keyword1"><span class="command">have</span></span> power_less_128_helper<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> unat <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">128</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">if</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="numeral">128</span> <span class="main">-</span> <span class="numeral">16</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
     <span class="keyword1"><span class="command">have</span></span> help_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">l</span> <span class="main">⟹</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">l</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">l</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_mult_power_less_eq semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">from</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> help_mult<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> order_less_le_trans<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> unat_of_bl_128_16_less_helper<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Power.power_increasing<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   <span class="keyword1"><span class="command">qed</span></span>

   <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="free">m</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> unat <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            <span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> unat <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"unat <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> help_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>nat<span class="main">)</span>  <span class="main">⟷</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> help_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Power.monoid_mult_class.power_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unat <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">::</span><span class="numeral">128</span> word<span class="main">)</span> <span class="main">*</span> unat <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">128</span><span class="main">)</span> <span class="main">=</span>
        <span class="numeral">2</span> <span class="main">^</span> <span class="free">m</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> unat <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">128</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> nat_mod_eq'<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> unat_power_lower<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power_less_128_helper<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> nat_mod_eq'<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> power_less_128_helper<span class="main">)</span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> unat_power_lower<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   <span class="keyword1"><span class="command">hence</span></span> ex_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> unat <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">::</span><span class="numeral">128</span> word<span class="main">)</span> <span class="main">*</span> unat <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">128</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">m</span> <span class="main">*</span> <span class="bound">k</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

   <span class="keyword1"><span class="command">hence</span></span> aligned<span class="main">:</span> <span class="quoted"><span class="quoted">"is_aligned <span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="free">m</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> is_aligned_iff_dvd_nat
     <span class="keyword1"><span class="command">unfolding</span></span> dvd_def
     <span class="keyword1"><span class="command">unfolding</span></span> shiftl_t2n
     <span class="keyword1"><span class="command">unfolding</span></span> Word.unat_word_ariths<span class="main">(</span>2<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>

   <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> of_bl_to_bl_shift_mask<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>of_bl<span class="main">::</span>bool list <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span>to_bl <span class="free">b</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">&amp;&amp;</span> mask <span class="main">(</span><span class="numeral">16</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_aligned_mask is_aligned_shiftl <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="comment1">(*sledgehammer*)</span>

   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> ucast_bl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> word_and_mask_shiftl<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> aligned_shiftr_mask_shiftl<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> aligned<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> of_bl_to_bl_shift_mask<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="NumberWang_IPv6-helper_masked_ucast_equal_generic"><span class="command">lemma</span></span> helper_masked_ucast_equal_generic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="numeral">128</span> <span class="main">-</span> <span class="numeral">16</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ucast <span class="main">(</span><span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span> <span class="numeral">16</span> word <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="free">b</span> <span class="main">&lt;&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ucast_mask<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ucast<span class="main">::</span> <span class="numeral">16</span> word <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="free">b</span> <span class="main">&amp;&amp;</span> mask <span class="numeral">16</span> <span class="main">=</span> ucast <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> take_bit_eq_mask<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ucast <span class="main">(</span><span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span> <span class="numeral">16</span> word <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="free">b</span> <span class="main">&amp;&amp;</span> mask <span class="main">(</span><span class="numeral">128</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">&amp;&amp;</span> mask <span class="numeral">16</span><span class="main">)</span> <span class="main">&amp;&amp;</span> mask <span class="main">(</span><span class="numeral">128</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_ucast word_size <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> word_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> word_and_mask_shiftl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> shiftl_shiftr3<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> shiftl_shiftr3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_size and.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="WordInterval">
<div class="head">
<h1>Theory WordInterval</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      WordInterval.thy
    Authors:    Julius Michaelis, Cornelius Diekmann
*)</span>
<span class="keyword1"><span class="command">theory</span></span> WordInterval
  <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="../Word_Lib/Word_Lemmas.html">Word_Lib.Word_Lemmas</a>"</span>
  <span class="quoted">"<a href="../Word_Lib/Next_and_Prev.html">Word_Lib.Next_and_Prev</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹WordInterval: Executable datatype for Machine Word Sets›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Stores ranges of machine words as interval. This has been proven quite efficient for
     IP Addresses.›</span></span>
<span class="comment1">(*NOTE: All algorithms here use a straight-forward implementation. There is a lot of room for
        improving the computation complexity, for example by making the WordInterval a balanced,
        sorted tree.*)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Syntax›</span></span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">typedef_overloaded</span><span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="quoted">len</span><span class="main">)</span> wordinterval <span class="main">=</span> WordInterval
                                        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word"</span></span> <span class="comment1">― ‹start (inclusive)›</span>
                                        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word"</span></span> <span class="comment1">― ‹end (inclusive)›</span>
                                  <span class="main">|</span> RangeUnion <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> wordinterval"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> wordinterval"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Semantics›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_to_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_to_set</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span><span class="main">)</span> <span class="main">=</span>
        <span class="main">{</span><span class="free"><span class="bound"><span class="entity">start</span></span></span> <span class="main">..</span> <span class="free"><span class="bound"><span class="entity">end</span></span></span><span class="main">}</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_to_set</span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">=</span>
        <span class="free">wordinterval_to_set</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">∪</span> <span class="free">wordinterval_to_set</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span>"</span></span>

<span class="comment1">(*Note: The runtime of all the operations could be improved, for example by keeping the tree sorted
  and balanced.*)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic operations›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∈›</span></span></span></span>›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_element</span> <span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_element</span> <span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">⟷</span>
                                            <span class="free">wordinterval_element</span> <span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">∨</span> <span class="free">wordinterval_element</span> <span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span>"</span></span>
  <span class="keyword1" id="WordInterval-wordinterval_element_set_eq"><span class="command">lemma</span></span> wordinterval_element_set_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_element <span class="free">el</span> <span class="free">rg</span> <span class="main">=</span> <span class="main">(</span><span class="free">el</span> <span class="main">∈</span> wordinterval_to_set <span class="free">rg</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">rg</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wordinterval_element.induct<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">wordinterval_union</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_union</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">=</span> RangeUnion <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span>"</span></span>
  <span class="keyword1" id="WordInterval-wordinterval_union_set_eq"><span class="command">lemma</span></span> wordinterval_union_set_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>wordinterval_union <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> wordinterval_to_set <span class="free">r1</span> <span class="main">∪</span> wordinterval_to_set <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_union_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_empty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_empty</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_empty</span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">wordinterval_empty</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">∧</span> <span class="free">wordinterval_empty</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span>"</span></span>
  <span class="keyword1" id="WordInterval-wordinterval_empty_set_eq"><span class="command">lemma</span></span> wordinterval_empty_set_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_empty <span class="free">r</span> <span class="main">⟷</span> wordinterval_to_set <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">Empty_WordInterval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Empty_WordInterval</span> <span class="main">≡</span> WordInterval <span class="main">1</span> <span class="main">0</span>"</span></span>
  <span class="keyword1" id="WordInterval-wordinterval_empty_Empty_WordInterval"><span class="command">lemma</span></span> wordinterval_empty_Empty_WordInterval<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_empty Empty_WordInterval"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Empty_WordInterval_def<span class="main">)</span>
  <span class="keyword1" id="WordInterval-Empty_WordInterval_set_eq"><span class="command">lemma</span></span> Empty_WordInterval_set_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set Empty_WordInterval <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Empty_WordInterval_def<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹WordInterval and Lists›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A list of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(start, end)›</span></span></span></span> tuples.›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹wordinterval to list›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wi2l</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len word <span class="main">×</span> <span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wi2l</span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">wi2l</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">@</span> <span class="free">wi2l</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wi2l</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹list to wordinterval›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">l2wi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">l2wi</span> <span class="main">[]</span> <span class="main">=</span> Empty_WordInterval"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">l2wi</span> <span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">l2wi</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">rs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>RangeUnion <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">l2wi</span> <span class="free"><span class="bound"><span class="entity">rs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


  <span class="keyword1" id="WordInterval-l2wi_append"><span class="command">lemma</span></span> l2wi_append<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>l2wi <span class="main">(</span><span class="free">l1</span><span class="main">@</span><span class="free">l2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                      wordinterval_to_set <span class="main">(</span>l2wi <span class="free">l1</span><span class="main">)</span> <span class="main">∪</span> wordinterval_to_set <span class="main">(</span>l2wi <span class="free">l2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">l2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>l2wi.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">e</span> <span class="skolem">l2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l2</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="WordInterval-l2wi_wi2l"><span class="command">lemma</span></span> l2wi_wi2l<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>l2wi <span class="main">(</span>wi2l <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> wordinterval_to_set <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2wi_append<span class="main">)</span>

  <span class="keyword1" id="WordInterval-l2wi"><span class="command">lemma</span></span> l2wi<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>l2wi <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">l</span><span class="main">.</span> <span class="main">{</span><span class="bound">i</span> <span class="main">..</span> <span class="bound">j</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> l2wi.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

  <span class="keyword1" id="WordInterval-wi2l"><span class="command">lemma</span></span> wi2l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>wi2l <span class="free">r</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">i</span> <span class="main">..</span> <span class="bound">j</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> wordinterval_to_set <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wi2l.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

  <span class="keyword1" id="WordInterval-l2wi_remdups"><span class="command">lemma</span></span> l2wi_remdups<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>l2wi <span class="main">(</span>remdups <span class="free">ls</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> wordinterval_to_set <span class="main">(</span>l2wi <span class="free">ls</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2wi<span class="main">)</span>

  <span class="keyword1" id="WordInterval-wi2l_empty"><span class="command">lemma</span></span> wi2l_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wi2l Empty_WordInterval <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Empty_WordInterval_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Optimizing and minimizing <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">::</span></span>len<span class="main"><span class="main">)</span></span> wordinterval"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>s›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Removing empty intervals›</span></span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_optimize_empty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span> wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_optimize_empty</span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">r1o</span> <span class="main">=</span> <span class="free">wordinterval_optimize_empty</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">;</span>
                                                           <span class="bound">r2o</span> <span class="main">=</span> <span class="free">wordinterval_optimize_empty</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span>
      <span class="keyword1">in</span> <span class="keyword1">if</span>
        wordinterval_empty <span class="bound">r1o</span>
      <span class="keyword1">then</span>
        <span class="bound">r2o</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span>
        wordinterval_empty <span class="bound">r2o</span>
      <span class="keyword1">then</span>
        <span class="bound">r1o</span>
      <span class="keyword1">else</span>
        RangeUnion <span class="bound">r1o</span> <span class="bound">r2o</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_optimize_empty</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="keyword1" id="WordInterval-wordinterval_optimize_empty_set_eq"><span class="command">lemma</span></span> wordinterval_optimize_empty_set_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>wordinterval_optimize_empty <span class="free">r</span><span class="main">)</span> <span class="main">=</span> wordinterval_to_set <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

  <span class="keyword1" id="WordInterval-wordinterval_optimize_empty_double"><span class="command">lemma</span></span> wordinterval_optimize_empty_double<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_optimize_empty <span class="main">(</span>wordinterval_optimize_empty <span class="free">r</span><span class="main">)</span> <span class="main">=</span> wordinterval_optimize_empty <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_empty_shallow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_empty_shallow</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_empty_shallow</span> <span class="main">(</span>RangeUnion <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">⟷</span> False"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-helper_optimize_shallow"><span class="command">lemma</span></span> helper_optimize_shallow<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_empty_shallow <span class="main">(</span>wordinterval_optimize_empty <span class="free">r</span><span class="main">)</span> <span class="main">=</span>
      wordinterval_empty <span class="main">(</span>wordinterval_optimize_empty <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_optimize_empty2</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_optimize_empty2</span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">r1o</span> <span class="main">=</span> wordinterval_optimize_empty <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">;</span>
                                                            <span class="bound">r2o</span> <span class="main">=</span> wordinterval_optimize_empty <span class="free"><span class="bound"><span class="entity">r2</span></span></span>
      <span class="keyword1">in</span> <span class="keyword1">if</span>
        wordinterval_empty_shallow <span class="bound">r1o</span>
      <span class="keyword1">then</span>
        <span class="bound">r2o</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span>
        wordinterval_empty_shallow <span class="bound">r2o</span>
      <span class="keyword1">then</span>
        <span class="bound">r1o</span>
      <span class="keyword1">else</span>
        RangeUnion <span class="bound">r1o</span> <span class="bound">r2o</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_optimize_empty2</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="keyword1" id="WordInterval-wordinterval_optimize_empty_code"><span class="command">lemma</span></span> wordinterval_optimize_empty_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_optimize_empty <span class="main">=</span> wordinterval_optimize_empty2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fun_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> r<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">r</span></span></span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">unfold</span> wordinterval_optimize_empty.simps wordinterval_optimize_empty2.simps
               Let_def helper_optimize_shallow<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Merging overlapping intervals›</span></span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">disjoint</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">disjoint</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">interval_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word <span class="main">×</span> <span class="tfree">'a</span> word <span class="main">⇒</span> <span class="tfree">'a</span> word set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">interval_of</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">..</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">declare</span></span> interval_of.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">disjoint_intervals</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">disjoint_intervals</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> disjoint <span class="main">(</span>interval_of <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>interval_of <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">not_disjoint_intervals</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">not_disjoint_intervals</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">¬</span> disjoint <span class="main">(</span>interval_of <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>interval_of <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"not_disjoint_intervals <span class="free">A</span> <span class="free">B</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">case</span> <span class="free">A</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">⇒</span> <span class="keyword1">case</span> <span class="free">B</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span><span class="bound">e'</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">e'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≤</span> <span class="bound">e</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">e</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≤</span> <span class="bound">e'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">B</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_disjoint_intervals_def interval_of.simps disjoint_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"disjoint_intervals <span class="free">A</span> <span class="free">B</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">case</span> <span class="free">A</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">⇒</span> <span class="keyword1">case</span> <span class="free">B</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s'</span><span class="main">,</span><span class="bound">e'</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s</span> <span class="main">&gt;</span> <span class="bound">e'</span> <span class="main">∨</span> <span class="bound">s'</span> <span class="main">&gt;</span> <span class="bound">e</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">&gt;</span> <span class="bound">e</span> <span class="main">∨</span> <span class="bound">s'</span> <span class="main">&gt;</span> <span class="bound">e'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">B</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_intervals_def interval_of.simps disjoint_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹BEGIN merging overlapping intervals›</span></span>
  <span class="comment1">(*result has no empty intervals and all are disjoint.
    merging things such as [1,7] [8,10] would still be possible*)</span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">merge_overlap</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">merge_overlap</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">merge_overlap</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
       <span class="keyword1">if</span> not_disjoint_intervals <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">)</span>
       <span class="keyword1">then</span> <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span> max <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span>
       <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">)</span><span class="main">#</span><span class="free">merge_overlap</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-not_disjoint_union"><span class="command">lemma</span></span> not_disjoint_union<span class="main">:</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> disjoint <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="free">e</span><span class="main">}</span> <span class="main">{</span><span class="free">s'</span><span class="main">..</span><span class="free">e'</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="free">e</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">s'</span><span class="main">..</span><span class="free">e'</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>min <span class="free">s</span> <span class="free">s'</span> <span class="main">..</span> max <span class="free">e</span> <span class="free">e'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_def min_def max_def<span class="main">)</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-disjoint_subset"><span class="command">lemma</span></span> disjoint_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">∪</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> disjoint_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-merge_overlap_helper1"><span class="command">lemma</span></span> merge_overlap_helper1<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_of <span class="free">A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="main">(</span>merge_overlap <span class="free">A</span> <span class="free">ss</span><span class="main">)</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ss</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x xs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_disjoint_intervals_def interval_of.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> not_disjoint_union<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> C<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="improper">xs</span><span class="main">.</span> interval_of <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> disjoint_subset<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-merge_overlap_helper2"><span class="command">lemma</span></span> merge_overlap_helper2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s'</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> <span class="main">¬</span> disjoint <span class="main">(</span>interval_of <span class="free">A</span><span class="main">)</span> <span class="main">(</span>interval_of <span class="bound">s'</span><span class="main">)</span> <span class="main">⟹</span>
          interval_of <span class="free">A</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="main">(</span>merge_overlap <span class="free">A</span> <span class="free">ss</span><span class="main">)</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ss</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x xs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_disjoint_intervals_def interval_of.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> not_disjoint_union<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-merge_overlap_length"><span class="command">lemma</span></span> merge_overlap_length<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s'</span> <span class="main">∈</span> set <span class="free">ss</span><span class="main">.</span> <span class="main">¬</span> disjoint <span class="main">(</span>interval_of <span class="free">A</span><span class="main">)</span> <span class="main">(</span>interval_of <span class="bound">s'</span><span class="main">)</span> <span class="main">⟹</span>
      length <span class="main">(</span>merge_overlap <span class="free">A</span> <span class="free">ss</span><span class="main">)</span> <span class="main">=</span> length <span class="free">ss</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ss</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x xs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_disjoint_intervals_def interval_of.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"merge_overlap <span class="main">(</span><span class="main">1</span><span class="main">::</span> <span class="numeral">16</span> word<span class="main">,</span><span class="numeral">2</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"merge_overlap <span class="main">(</span><span class="main">1</span><span class="main">::</span> <span class="numeral">16</span> word<span class="main">,</span><span class="numeral">2</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"merge_overlap <span class="main">(</span><span class="main">1</span><span class="main">::</span> <span class="numeral">16</span> word<span class="main">,</span><span class="numeral">2</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">function</span></span> <span class="entity">listwordinterval_compress</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word<span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">listwordinterval_compress</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">listwordinterval_compress</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
            <span class="keyword1">if</span> <span class="main">∀</span><span class="bound">s'</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">.</span> disjoint_intervals <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">s'</span>
            <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">#</span><span class="free">listwordinterval_compress</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span>
            <span class="keyword1">else</span> <span class="free">listwordinterval_compress</span> <span class="main">(</span>merge_overlap <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">pat_completeness</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">termination</span></span> <span class="quoted">listwordinterval_compress</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure length"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_measure<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> disjoint_intervals_def merge_overlap_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-listwordinterval_compress"><span class="command">lemma</span></span> listwordinterval_compress<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="main">(</span>listwordinterval_compress <span class="free">ss</span><span class="main">)</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ss</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> listwordinterval_compress.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_intervals_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> merge_overlap_helper2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"listwordinterval_compress <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">7</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-A_in_listwordinterval_compress"><span class="command">lemma</span></span> A_in_listwordinterval_compress<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> set <span class="main">(</span>listwordinterval_compress <span class="free">ss</span><span class="main">)</span> <span class="main">⟹</span>
    interval_of <span class="free">A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> listwordinterval_compress <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-listwordinterval_compress_disjoint"><span class="command">lemma</span></span> listwordinterval_compress_disjoint<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> set <span class="main">(</span>listwordinterval_compress <span class="free">ss</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">∈</span> set <span class="main">(</span>listwordinterval_compress <span class="free">ss</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="free">A</span> <span class="main">≠</span> <span class="free">B</span> <span class="main">⟹</span> disjoint <span class="main">(</span>interval_of <span class="free">A</span><span class="main">)</span> <span class="main">(</span>interval_of <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ss</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> listwordinterval_compress.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_intervals_def disjoint_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> A_in_listwordinterval_compress<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹END merging overlapping intervals›</span></span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹BEGIN merging adjacent intervals›</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">merge_adjacent</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">merge_adjacent</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">merge_adjacent</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
       <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="main">∧</span> word_next <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span>
       <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span>
       <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="main">∧</span> word_next <span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>
       <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span>
       <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">)</span><span class="main">#</span><span class="free">merge_adjacent</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-merge_adjacent_helper"><span class="command">lemma</span></span> merge_adjacent_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"interval_of <span class="free">A</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="main">(</span>merge_adjacent <span class="free">A</span> <span class="free">ss</span><span class="main">)</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ss</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x xs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  interval_of.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Un_assoc word_adjacent_union<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> word_adjacent_union<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> word_adjacent_union Un_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-merge_adjacent_length"><span class="command">lemma</span></span> merge_adjacent_length<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">e'</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> <span class="free">s</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≤</span> <span class="bound">e'</span> <span class="main">∧</span> <span class="main">(</span>word_next <span class="free">e</span> <span class="main">=</span> <span class="bound">s'</span> <span class="main">∨</span> word_next <span class="bound">e'</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span>
     <span class="main">⟹</span> length <span class="main">(</span>merge_adjacent <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="free">ss</span><span class="main">)</span> <span class="main">=</span> length <span class="free">ss</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ss</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x xs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">function</span></span> <span class="entity">listwordinterval_adjacent</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word<span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> word <span class="main">×</span> <span class="tfree">'a</span> word<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">listwordinterval_adjacent</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">listwordinterval_adjacent</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
            <span class="keyword1">if</span> <span class="main">∀</span><span class="main">(</span><span class="bound">s'</span><span class="main">,</span><span class="bound">e'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≤</span> <span class="bound">e'</span> <span class="main">∧</span> <span class="main">(</span>word_next <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="bound">s'</span> <span class="main">∨</span> word_next <span class="bound">e'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>
            <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">#</span><span class="free">listwordinterval_adjacent</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span>
            <span class="keyword1">else</span> <span class="free">listwordinterval_adjacent</span> <span class="main">(</span>merge_adjacent <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">pat_completeness</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">termination</span></span> <span class="quoted">listwordinterval_adjacent</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure length"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_measure<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> merge_adjacent_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-listwordinterval_adjacent"><span class="command">lemma</span></span> listwordinterval_adjacent<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="main">(</span>listwordinterval_adjacent <span class="free">ss</span><span class="main">)</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ss</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> listwordinterval_adjacent.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> merge_adjacent_helper<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"listwordinterval_adjacent <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="numeral">16</span> word<span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span><span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹END merging adjacent intervals›</span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">wordinterval_compress</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> wordinterval <span class="main">⇒</span> <span class="tfree">'a</span> wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_compress</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span>
      l2wi <span class="main">(</span>remdups <span class="main">(</span>listwordinterval_adjacent <span class="main">(</span>listwordinterval_compress
        <span class="main">(</span>wi2l <span class="main">(</span>wordinterval_optimize_empty <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correctness: Compression preserves semantics›</span></span>
  <span class="keyword1" id="WordInterval-wordinterval_compress"><span class="command">lemma</span></span> wordinterval_compress<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>wordinterval_compress <span class="free">r</span><span class="main">)</span> <span class="main">=</span> wordinterval_to_set <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_compress_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> interval_of'<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_of <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">s</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">{</span><span class="bound">s</span> <span class="main">..</span> <span class="bound">e</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_of.simps<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>l2wi <span class="main">(</span>remdups <span class="main">(</span>listwordinterval_adjacent
              <span class="main">(</span>listwordinterval_compress <span class="main">(</span>wi2l <span class="main">(</span>wordinterval_optimize_empty <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>listwordinterval_adjacent <span class="main">(</span>listwordinterval_compress
                <span class="main">(</span>wi2l <span class="main">(</span>wordinterval_optimize_empty <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> interval_of <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interval_of' l2wi<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span>set <span class="main">(</span>wi2l <span class="main">(</span>wordinterval_optimize_empty <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> interval_of <span class="bound">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> listwordinterval_compress listwordinterval_adjacent<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>wi2l <span class="main">(</span>wordinterval_optimize_empty <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">i</span><span class="main">..</span><span class="bound">j</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_of'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> wordinterval_to_set <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wi2l<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wordinterval_to_set
        <span class="main">(</span>l2wi <span class="main">(</span>remdups <span class="main">(</span>listwordinterval_adjacent <span class="main">(</span>listwordinterval_compress
            <span class="main">(</span>wi2l <span class="main">(</span>wordinterval_optimize_empty <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">=</span> wordinterval_to_set <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Example›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>wi2l <span class="main">∘</span> <span class="main">(</span>wordinterval_compress <span class="main">::</span> <span class="numeral">32</span> wordinterval <span class="main">⇒</span> <span class="numeral">32</span> wordinterval<span class="main">)</span> <span class="main">∘</span> l2wi<span class="main">)</span>
          <span class="main">[</span><span class="main">(</span><span class="numeral">70</span><span class="main">,</span> <span class="numeral">80001</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">150</span><span class="main">,</span> <span class="numeral">8000</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">42</span><span class="main">,</span><span class="numeral">41</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">56</span><span class="main">,</span> <span class="numeral">200</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">10</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span>
          <span class="main">[</span><span class="main">(</span><span class="numeral">56</span><span class="main">,</span> <span class="numeral">80001</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wordinterval_compress <span class="main">(</span>RangeUnion <span class="main">(</span>RangeUnion <span class="main">(</span>WordInterval <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span> <span class="numeral">5</span><span class="main">)</span>
                                                        <span class="main">(</span>WordInterval <span class="numeral">8</span> <span class="numeral">10</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>WordInterval <span class="numeral">3</span> <span class="numeral">7</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       WordInterval <span class="main">1</span> <span class="numeral">10</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Further operations›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⋃›</span></span></span></span>›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">wordinterval_Union</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> wordinterval list <span class="main">⇒</span> <span class="tfree">'a</span> wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_Union</span> <span class="free"><span class="bound"><span class="entity">ws</span></span></span> <span class="main">=</span> wordinterval_compress <span class="main">(</span>foldr wordinterval_union <span class="free"><span class="bound"><span class="entity">ws</span></span></span> Empty_WordInterval<span class="main">)</span>"</span></span>

  <span class="keyword1" id="WordInterval-wordinterval_Union"><span class="command">lemma</span></span> wordinterval_Union<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>wordinterval_Union <span class="free">ws</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">w</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">ws</span><span class="main">)</span><span class="main">.</span> wordinterval_to_set <span class="bound">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ws</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_compress wordinterval_Union_def<span class="main">)</span>


<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_setminus'</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span> wordinterval <span class="main">⇒</span> <span class="tfree">'a</span> wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_setminus'</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="free"><span class="bound"><span class="entity">me</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
      <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">me</span></span></span> <span class="keyword1">then</span> WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">me</span></span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>
        <span class="keyword1">then</span>
          WordInterval <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>word_prev <span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>
        <span class="keyword1">then</span>
          WordInterval <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>word_next <span class="free"><span class="bound"><span class="entity">me</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">me</span></span></span> <span class="main">=</span> max_word <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>
        <span class="keyword1">else</span>
          RangeUnion <span class="main">(</span>WordInterval <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">(</span>word_prev <span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span><span class="main">)</span>
                     <span class="main">(</span>WordInterval <span class="main">(</span>word_next <span class="free"><span class="bound"><span class="entity">me</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">me</span></span></span> <span class="main">=</span> max_word <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span>
        <span class="main">)</span>"</span></span> <span class="main">|</span>
     <span class="quoted"><span class="quoted">"<span class="free">wordinterval_setminus'</span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span>
        RangeUnion <span class="main">(</span><span class="free">wordinterval_setminus'</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">wordinterval_setminus'</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span><span class="main">|</span>
     <span class="quoted"><span class="quoted">"<span class="free">wordinterval_setminus'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">=</span>
        <span class="free">wordinterval_setminus'</span> <span class="main">(</span><span class="free">wordinterval_setminus'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span>"</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-wordinterval_setminus'_rr_set_eq"><span class="command">lemma</span></span> wordinterval_setminus'_rr_set_eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set<span class="main">(</span>wordinterval_setminus' <span class="main">(</span>WordInterval <span class="free">s</span> <span class="free">e</span><span class="main">)</span> <span class="main">(</span>WordInterval <span class="free">ms</span> <span class="free">me</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    wordinterval_to_set <span class="main">(</span>WordInterval <span class="free">s</span> <span class="free">e</span><span class="main">)</span> <span class="main">-</span> wordinterval_to_set <span class="main">(</span>WordInterval <span class="free">ms</span> <span class="free">me</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> wordinterval_setminus'.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&lt;</span> <span class="free">s</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">me</span> <span class="main">&lt;</span> <span class="free">ms</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">me</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">ms</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free"><span class="free">ms</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">≤</span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free">s</span></span></span></span>"</span></span></span></span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">me</span></span></span></span></span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span> max_word"</span></span></span></span></span></span></span></span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_next_unfold word_prev_unfold min_def max_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
                                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
                          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
                         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
                       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
                     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
                   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">uint_arith</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-wordinterval_setminus'_set_eq"><span class="command">lemma</span></span> wordinterval_setminus'_set_eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>wordinterval_setminus' <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="main">=</span>
      wordinterval_to_set <span class="free">r1</span> <span class="main">-</span> wordinterval_to_set <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wordinterval_setminus'.induct<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> wordinterval_setminus'_rr_set_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1" id="WordInterval-wordinterval_setminus'_empty_struct"><span class="command">lemma</span></span> wordinterval_setminus'_empty_struct<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_empty <span class="free">r2</span> <span class="main">⟹</span> wordinterval_setminus' <span class="free">r1</span> <span class="free">r2</span> <span class="main">=</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wordinterval_setminus'.induct<span class="main">)</span> <span class="operator">auto</span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">wordinterval_setminus</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_setminus</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">=</span> wordinterval_compress <span class="main">(</span>wordinterval_setminus' <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="WordInterval-wordinterval_setminus_set_eq"><span class="command">lemma</span></span> wordinterval_setminus_set_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>wordinterval_setminus <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="main">=</span>
    wordinterval_to_set <span class="free">r1</span> <span class="main">-</span> wordinterval_to_set <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_setminus_def wordinterval_compress wordinterval_setminus'_set_eq<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wordinterval_UNIV</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wordinterval_UNIV</span> <span class="main">≡</span> WordInterval <span class="main">0</span> max_word"</span></span>
<span class="keyword1" id="WordInterval-wordinterval_UNIV_set_eq"><span class="command">lemma</span></span> wordinterval_UNIV_set_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set wordinterval_UNIV <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_UNIV_def
  <span class="keyword1"><span class="command">using</span></span> max_word_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_invert</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wordinterval_invert</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> wordinterval_setminus wordinterval_UNIV <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
<span class="keyword1" id="WordInterval-wordinterval_invert_set_eq"><span class="command">lemma</span></span> wordinterval_invert_set_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>wordinterval_invert <span class="free">r</span><span class="main">)</span> <span class="main">=</span> UNIV <span class="main">-</span> wordinterval_to_set <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="WordInterval-wordinterval_invert_UNIV_empty"><span class="command">lemma</span></span> wordinterval_invert_UNIV_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wordinterval_empty <span class="main">(</span>wordinterval_invert wordinterval_UNIV<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="WordInterval-wi2l_univ"><span class="command">lemma</span></span> wi2l_univ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wi2l wordinterval_UNIV <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> max_word<span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_UNIV_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∩›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free">s</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">..</span> <span class="free">e</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">s'</span> <span class="main">..</span> <span class="free">e'</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">s</span> <span class="main">&gt;</span> <span class="free">e'</span> <span class="main">∨</span> <span class="free">s'</span> <span class="main">&gt;</span> <span class="free">e</span> <span class="main">∨</span> <span class="free">s</span> <span class="main">&gt;</span> <span class="free">e</span> <span class="main">∨</span> <span class="free">s'</span> <span class="main">&gt;</span> <span class="free">e'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">linarith</span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_intersection'</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_intersection'</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
        <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span>
        <span class="keyword1">then</span>
          Empty_WordInterval
        <span class="keyword1">else</span>
          WordInterval <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span> <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">)</span>
        <span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_intersection'</span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span>
        RangeUnion <span class="main">(</span><span class="free">wordinterval_intersection'</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">wordinterval_intersection'</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span><span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_intersection'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">=</span>
        RangeUnion <span class="main">(</span><span class="free">wordinterval_intersection'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">wordinterval_intersection'</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="WordInterval-wordinterval_intersection'_set_eq"><span class="command">lemma</span></span> wordinterval_intersection'_set_eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>wordinterval_intersection' <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="main">=</span>
      wordinterval_to_set <span class="free">r1</span> <span class="main">∩</span> wordinterval_to_set <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wordinterval_intersection'.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wordinterval_intersection'
          <span class="main">(</span>RangeUnion <span class="main">(</span>RangeUnion <span class="main">(</span>WordInterval <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>WordInterval <span class="numeral">8</span> <span class="numeral">10</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span>WordInterval <span class="main">1</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>WordInterval <span class="main">1</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span>
          RangeUnion <span class="main">(</span>RangeUnion <span class="main">(</span>WordInterval <span class="main">1</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>WordInterval <span class="main">1</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>WordInterval <span class="main">1</span> <span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">wordinterval_intersection</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_intersection</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">≡</span> wordinterval_compress <span class="main">(</span>wordinterval_intersection' <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="WordInterval-wordinterval_intersection_set_eq"><span class="command">lemma</span></span> wordinterval_intersection_set_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>wordinterval_intersection <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="main">=</span>
      wordinterval_to_set <span class="free">r1</span> <span class="main">∩</span> wordinterval_to_set <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_intersection_def
                 wordinterval_compress wordinterval_intersection'_set_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wordinterval_intersection
          <span class="main">(</span>RangeUnion <span class="main">(</span>RangeUnion <span class="main">(</span>WordInterval <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>WordInterval <span class="numeral">8</span> <span class="numeral">10</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span>WordInterval <span class="main">1</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>WordInterval <span class="main">1</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span>
          WordInterval <span class="main">1</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wordinterval_subset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wordinterval_subset</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">≡</span> wordinterval_empty <span class="main">(</span>wordinterval_setminus <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1" id="WordInterval-wordinterval_subset_set_eq"><span class="command">lemma</span></span> wordinterval_subset_set_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"wordinterval_subset <span class="free">r1</span> <span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>wordinterval_to_set <span class="free">r1</span> <span class="main">⊆</span> wordinterval_to_set <span class="free">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wordinterval_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wordinterval_eq</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">=</span> <span class="main">(</span>wordinterval_subset <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">∧</span> wordinterval_subset <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1" id="WordInterval-wordinterval_eq_set_eq"><span class="command">lemma</span></span> wordinterval_eq_set_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wordinterval_eq <span class="free">r1</span> <span class="free">r2</span> <span class="main">⟷</span> wordinterval_to_set <span class="free">r1</span> <span class="main">=</span> wordinterval_to_set <span class="free">r2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">thm</span></span> iffD1<span class="main">[</span><span class="operator">OF</span> wordinterval_eq_set_eq<span class="main">]</span>
<span class="comment1">(*declare iffD1[OF wordinterval_eq_set_eq, simp]*)</span>

<span class="keyword1" id="WordInterval-wordinterval_eq_comm"><span class="command">lemma</span></span> wordinterval_eq_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_eq <span class="free">r1</span> <span class="free">r2</span> <span class="main">⟷</span> wordinterval_eq <span class="free">r2</span> <span class="free">r1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1" id="WordInterval-wordinterval_to_set_alt"><span class="command">lemma</span></span> wordinterval_to_set_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="free">r</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> wordinterval_element <span class="bound">x</span> <span class="free">r</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_element_set_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="WordInterval-wordinterval_un_empty"><span class="command">lemma</span></span> wordinterval_un_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wordinterval_empty <span class="free">r1</span> <span class="main">⟹</span> wordinterval_eq <span class="main">(</span>wordinterval_union <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="free">r2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> wordinterval_eq_set_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1" id="WordInterval-wordinterval_un_emty_b"><span class="command">lemma</span></span> wordinterval_un_emty_b<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wordinterval_empty <span class="free">r2</span> <span class="main">⟹</span> wordinterval_eq <span class="main">(</span>wordinterval_union <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="free">r1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> wordinterval_eq_set_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="WordInterval-wordinterval_Diff_triv"><span class="command">lemma</span></span> wordinterval_Diff_triv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wordinterval_empty <span class="main">(</span>wordinterval_intersection <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> wordinterval_eq <span class="main">(</span>wordinterval_setminus <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_eq_set_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A size of the datatype, does not correspond to the cardinality of the corresponding set›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_size</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> wordinterval <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wordinterval_size</span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">wordinterval_size</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free">wordinterval_size</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">wordinterval_size</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="WordInterval-wordinterval_size_length"><span class="command">lemma</span></span> wordinterval_size_length<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_size <span class="free">r</span> <span class="main">=</span> length <span class="main">(</span>wi2l <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="WordInterval-Ex_wordinterval_nonempty"><span class="command">lemma</span></span> Ex_wordinterval_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len wordinterval<span class="main">)</span><span class="main">.</span> <span class="free">y</span> <span class="main">∈</span> wordinterval_to_set <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> wordinterval_to_set wordinterval_UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="WordInterval-wordinterval_eq_reflp"><span class="command">lemma</span></span> wordinterval_eq_reflp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflp wordinterval_eq"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> reflpI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> wordinterval_eq_set_eq<span class="main">)</span>
<span class="keyword1" id="WordInterval-wordintervalt_eq_symp"><span class="command">lemma</span></span> wordintervalt_eq_symp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symp wordinterval_eq"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sympI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_eq_comm<span class="main">)</span>
<span class="keyword1" id="WordInterval-wordinterval_eq_transp"><span class="command">lemma</span></span> wordinterval_eq_transp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"transp wordinterval_eq"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> transpI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> wordinterval_eq_set_eq<span class="main">)</span>

<span class="keyword1" id="WordInterval-wordinterval_eq_equivp"><span class="command">lemma</span></span> wordinterval_eq_equivp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivp wordinterval_eq"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> equivpI wordinterval_eq_reflp wordintervalt_eq_symp wordinterval_eq_transp<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The smallest element in the interval›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_lowest_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ord <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">is_lowest_element</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span>
  	<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> complete_lattice"</span></span>
  	<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  	<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">=</span> Inf <span class="free">S</span> <span class="main">⟹</span> is_lowest_element <span class="free">x</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_lowest_element_def<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_lower eq_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span>
  	<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> linorder"</span></span>
  	<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  	<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_lowest_element <span class="free">x</span> <span class="free">S</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> Min <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_lowest_element_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Min_eqI<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Min.coboundedI assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dual_order.antisym is_lowest_element_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Smallest element in the interval›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_lowest_element</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span> word option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_lowest_element</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">then</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_lowest_element</span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free">wordinterval_lowest_element</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free">wordinterval_lowest_element</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="keyword1">of</span>
          <span class="main">(</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="keyword1">if</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="keyword1">then</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span>
          <span class="main">(</span>None<span class="main">,</span> Some <span class="bound">b</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="bound">b</span> <span class="main">|</span>
          <span class="main">(</span>Some <span class="bound">a</span><span class="main">,</span> None<span class="main">)</span> <span class="main">⇒</span> Some <span class="bound">a</span> <span class="main">|</span>
          <span class="main">(</span>None<span class="main">,</span> None<span class="main">)</span> <span class="main">⇒</span> None<span class="main">)</span>"</span></span>

  <span class="keyword1" id="WordInterval-wordinterval_lowest_none_empty"><span class="command">lemma</span></span> wordinterval_lowest_none_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="free">r</span> <span class="main">=</span> None <span class="main">⟷</span> wordinterval_empty <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> WordInterval <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> RangeUnion <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1" id="WordInterval-wordinterval_lowest_element_correct_A"><span class="command">lemma</span></span> wordinterval_lowest_element_correct_A<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="free">r</span> <span class="main">=</span> Some <span class="free">x</span> <span class="main">⟹</span> is_lowest_element <span class="free">x</span> <span class="main">(</span>wordinterval_to_set <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_lowest_element_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wordinterval_lowest_element.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> rs re x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">rs</span> <span class="main">≤</span> <span class="improper">re</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> wordinterval_lowest_element.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> A B x<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span>     <span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="improper">B</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="improper"><span class="improper">A</span></span>"</span></span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_lowest_none_empty<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1" id="WordInterval-wordinterval_lowest_element_set_eq"><span class="command">lemma</span></span> wordinterval_lowest_element_set_eq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> wordinterval_empty <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>wordinterval_lowest_element <span class="free">r</span> <span class="main">=</span> Some <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_lowest_element <span class="free">x</span> <span class="main">(</span>wordinterval_to_set <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="comment1">(*unfolding is_lowest_element_def*)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="free">r</span> <span class="main">=</span> Some <span class="free">x</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_lowest_element <span class="free">x</span> <span class="main">(</span>wordinterval_to_set <span class="free">r</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> wordinterval_lowest_element_correct_A wordinterval_lowest_none_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_lowest_element <span class="free">x</span> <span class="main">(</span>wordinterval_to_set <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>wordinterval_lowest_element <span class="free">r</span> <span class="main">=</span> Some <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wordinterval_lowest_element.induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_lowest_element_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">A</span> <span class="skolem">B</span> <span class="skolem">x</span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> is_lowest_RangeUnion<span class="main">:</span> <span class="quoted"><span class="quoted">"is_lowest_element <span class="skolem">x</span> <span class="main">(</span>wordinterval_to_set <span class="skolem">A</span> <span class="main">∪</span> wordinterval_to_set <span class="skolem">B</span><span class="main">)</span> <span class="main">⟹</span>
          is_lowest_element <span class="skolem">x</span> <span class="main">(</span>wordinterval_to_set <span class="skolem">A</span><span class="main">)</span> <span class="main">∨</span> is_lowest_element <span class="skolem">x</span> <span class="main">(</span>wordinterval_to_set <span class="skolem">B</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_lowest_element_def<span class="main">)</span>

         <span class="comment1">(*why ⋀ A B?*)</span>
         <span class="keyword1"><span class="command">have</span></span> wordinterval_lowest_element_RangeUnion<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> wordinterval_lowest_element <span class="bound">A</span> <span class="main">=</span> Some <span class="bound">a</span> <span class="main">⟹</span>
                  wordinterval_lowest_element <span class="bound">B</span> <span class="main">=</span> Some <span class="bound">b</span> <span class="main">⟹</span>
                  wordinterval_lowest_element <span class="main">(</span>RangeUnion <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>min <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wordinterval_lowest_element_correct_A <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_lowest_element_def min_def<span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span>     <span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="skolem">B</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="skolem"><span class="skolem">A</span></span>"</span></span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_lowest_element_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> wordinterval_empty <span class="skolem">A</span> <span class="main">∧</span> <span class="main">¬</span> wordinterval_empty <span class="skolem">B</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
         <span class="keyword1"><span class="command">using</span></span> arg_cong<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted">Not</span><span class="main">,</span> <span class="operator">OF</span> wordinterval_lowest_none_empty<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wordinterval_lowest_element_RangeUnion<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split_asm <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> is_lowest_RangeUnion<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_lowest_element_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_lowest_none_empty<span class="main">)</span>

        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_lowest_element_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_lowest_none_empty<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> wordinterval_lowest_element_correct_A<span class="main">[</span><span class="operator">simplified</span> is_lowest_element_def<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff not_le<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Cardinality approximation for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">::</span></span>len<span class="main"><span class="main">)</span></span> wordinterval"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>s›</span></span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="WordInterval-card_atLeastAtMost_word"><span class="command">lemma</span></span> card_atLeastAtMost_word<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="free">e</span><span class="main">}</span> <span class="main">=</span> Suc <span class="main">(</span>unat <span class="free">e</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>unat <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="free">e</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> Word.word_less_nat_alt<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> upto_enum_set_conv2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> List.card_set<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> remdups_enum_upto<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wordinterval_card</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> wordinterval <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_card</span> <span class="main">(</span>WordInterval <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>unat <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>unat <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wordinterval_card</span> <span class="main">(</span>RangeUnion <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">wordinterval_card</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free">wordinterval_card</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

  <span class="keyword1" id="WordInterval-wordinterval_card"><span class="command">lemma</span></span> wordinterval_card<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_card <span class="free">r</span> <span class="main">≥</span> card <span class="main">(</span>wordinterval_to_set <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> WordInterval <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_atLeastAtMost_word<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RangeUnion <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>wordinterval_to_set <span class="skolem">r1</span> <span class="main">∪</span> wordinterval_to_set <span class="skolem">r2</span><span class="main">)</span> <span class="main">≤</span>
              card <span class="main">(</span>wordinterval_to_set <span class="skolem">r1</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>wordinterval_to_set <span class="skolem">r2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Finite_Set.card_Un_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> RangeUnion <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹With <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> wordinterval_compress<span class="antiquote"><span class="antiquote">}</span></span></span></span> it should be possible to get the exact cardinality›</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Hs_Compat">
<div class="head">
<h1>Theory Hs_Compat</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Hs_Compat
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Definitions inspired by the Haskell World.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uncurry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uncurry</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hs_Compat-uncurry_simp"><span class="command">lemma</span></span> uncurry_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uncurry <span class="free">f</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uncurry_def<span class="main">)</span>

<span class="keyword1" id="Hs_Compat-uncurry_curry_id"><span class="command">lemma</span></span> uncurry_curry_id<span class="main">:</span> <span class="quoted"><span class="quoted">"uncurry <span class="main">∘</span> curry <span class="main">=</span> id"</span></span> <span class="quoted"><span class="quoted">"curry <span class="main">∘</span> uncurry <span class="main">=</span> id"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Hs_Compat-uncurry_split"><span class="command">lemma</span></span> uncurry_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>uncurry <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x1</span><span class="main">,</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="Hs_Compat-uncurry_split_asm"><span class="command">lemma</span></span> uncurry_split_asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>uncurry <span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> uncurry_split<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> uncurry_splits <span class="main">=</span> uncurry_split uncurry_split_asm

<span class="keyword1" id="Hs_Compat-uncurry_case_stmt"><span class="command">lemma</span></span> uncurry_case_stmt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="free">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> uncurry <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IP_Address">
<div class="head">
<h1>Theory IP_Address</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      IP_Address.thy
    Authors:    Cornelius Diekmann
*)</span>
<span class="keyword1"><span class="command">theory</span></span> IP_Address
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../Word_Lib/Word_Lemmas.html">Word_Lib.Word_Lemmas</a>
    <a href="../Word_Lib/Word_Syntax.html">Word_Lib.Word_Syntax</a>
    <a href="../Word_Lib/Reversed_Bit_Lists.html">Word_Lib.Reversed_Bit_Lists</a>
    <a href="Hs_Compat.html">Hs_Compat</a>
    <a href="WordInterval.html">WordInterval</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Modelling IP Adresses›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An IP address is basically an unsigned integer.
    We model IP addresses of arbitrary lengths.

    We will write <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'i</span></span><span class="main"><span class="main">::</span></span>len word"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for IP addresses of length <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">LENGTH</span></span><span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'i</span></span><span class="main"><span class="main">::</span></span>len<span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
    We use the convention to write <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'i</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> whenever we mean IP addresses instead of generic words.
    When we will later have theorems with several polymorphic types in it (e.g. arbitrarily
    extensible packets), this notation makes it easier to spot that type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'i</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is for
    IP addresses.

    The files <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹IPv4.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹IPv6.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span> concrete this for IPv4 and IPv6.›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The maximum IP address›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_ip_addr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">max_ip_addr</span> <span class="main">≡</span> of_nat <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>len_of<span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="IP_Address-max_ip_addr_max_word"><span class="command">lemma</span></span> max_ip_addr_max_word<span class="main">:</span> <span class="quoted"><span class="quoted">"max_ip_addr <span class="main">=</span> max_word"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> max_ip_addr_def of_nat_mask_eq <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> mask_eq_exp_minus_1<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1" id="IP_Address-max_ip_addr_max"><span class="command">lemma</span></span> max_ip_addr_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> max_ip_addr"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_ip_addr_max_word<span class="main">)</span>
  <span class="keyword1" id="IP_Address-range_0_max_UNIV"><span class="command">lemma</span></span> range_0_max_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> max_ip_addr<span class="main">}</span>"</span></span> <span class="comment1">(*not in the simp set, for a reason*)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_ip_addr_max_word<span class="main">)</span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'i</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">=</span> len_of<span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>word_size<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Sets of IP Addresses›</span></span>
  <span class="comment1">(*Warning, not executable!*)</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Specifying sets with network masks: 192.168.0.0 255.255.255.0›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipset_from_netmask</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>len word <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>len word set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipset_from_netmask</span> <span class="free"><span class="bound"><span class="entity">addr</span></span></span> <span class="free"><span class="bound"><span class="entity">netmask</span></span></span> <span class="main">≡</span>
      <span class="keyword1">let</span>
        <span class="bound">network_prefix</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">addr</span></span></span> <span class="keyword1">AND</span> <span class="free"><span class="bound"><span class="entity">netmask</span></span></span><span class="main">)</span>
      <span class="keyword1">in</span>
        <span class="main">{</span><span class="bound">network_prefix</span> <span class="main">..</span> <span class="bound">network_prefix</span> <span class="keyword1">OR</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="free"><span class="bound"><span class="entity">netmask</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Example (pseudo syntax):
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ipset_from_netmask<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>192.168.1.129  255.255.255.0›</span></span></span></span> =
        <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>{192.168.1.0 .. 192.168.1.255}›</span></span></span></span>›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A network mask of all ones (i.e. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">::</span></span><span class="tfree"><span class="tfree">'i</span></span><span class="main"><span class="main">::</span></span>len word"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>).›</span></span>
  <span class="keyword1" id="IP_Address-ipset_from_netmask_minusone"><span class="command">lemma</span></span> ipset_from_netmask_minusone<span class="main">:</span>
    <span class="quoted"><span class="quoted">"ipset_from_netmask <span class="free">ip</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">ip</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_netmask_def<span class="main">)</span>
  <span class="keyword1" id="IP_Address-ipset_from_netmask_maxword"><span class="command">lemma</span></span> ipset_from_netmask_maxword<span class="main">:</span>
    <span class="quoted"><span class="quoted">"ipset_from_netmask <span class="free">ip</span> max_word <span class="main">=</span> <span class="main">{</span><span class="free">ip</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_netmask_def<span class="main">)</span>

  <span class="keyword1" id="IP_Address-ipset_from_netmask_zero"><span class="command">lemma</span></span> ipset_from_netmask_zero<span class="main">:</span>
    <span class="quoted"><span class="quoted">"ipset_from_netmask <span class="free">ip</span> <span class="main">0</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_netmask_def<span class="main">)</span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Specifying sets in Classless Inter-domain Routing (CIDR) notation: 192.168.0.0/24›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipset_from_cidr</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>len word set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipset_from_cidr</span> <span class="free"><span class="bound"><span class="entity">addr</span></span></span> <span class="free"><span class="bound"><span class="entity">pflength</span></span></span> <span class="main">≡</span>
       ipset_from_netmask <span class="free"><span class="bound"><span class="entity">addr</span></span></span> <span class="main">(</span><span class="main">(</span>mask <span class="free"><span class="bound"><span class="entity">pflength</span></span></span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="main">(</span>len_of<span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">pflength</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Example (pseudo syntax):
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ipset_from_cidr<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>192.168.1.129 24›</span></span></span></span> = <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>{192.168.1.0 .. 192.168.1.255}›</span></span></span></span>›</span></span>

  <span class="comment1">(*does this simplify stuff?*)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="free">ipcidr</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">base</span><span class="main">,</span> <span class="bound">len</span><span class="main">)</span> <span class="main">⇒</span> ipset_from_cidr <span class="bound">base</span> <span class="bound">len</span><span class="main">)</span> <span class="main">=</span> uncurry ipset_from_cidr <span class="free">ipcidr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uncurry_case_stmt<span class="main">)</span>

  <span class="keyword1" id="IP_Address-ipset_from_cidr_0"><span class="command">lemma</span></span> ipset_from_cidr_0<span class="main">:</span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">ip</span> <span class="main">0</span> <span class="main">=</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_def ipset_from_netmask_def Let_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A prefix length of word size gives back the singleton set with the IP address.
       Example: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>192.168.1.2/32 = {192.168.1.2}›</span></span></span></span>›</span></span>
  <span class="keyword1" id="IP_Address-ipset_from_cidr_wordlength"><span class="command">lemma</span></span> ipset_from_cidr_wordlength<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">ip</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">ip</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_def ipset_from_netmask_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Alternative definition: Considering words as bit lists:›</span></span>
  <span class="keyword1" id="IP_Address-ipset_from_cidr_bl"><span class="command">lemma</span></span> ipset_from_cidr_bl<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">addr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">addr</span> <span class="free">pflength</span> <span class="main">≡</span>
            ipset_from_netmask <span class="free">addr</span> <span class="main">(</span>of_bl <span class="main">(</span><span class="main">(</span>replicate <span class="free">pflength</span> True<span class="main">)</span> <span class="main">@</span>
                                            <span class="main">(</span>replicate <span class="main">(</span><span class="main">(</span>len_of<span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">pflength</span><span class="main">)</span><span class="main">)</span> False<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_def mask_bl shiftl_of_bl<span class="main">)</span>

  <span class="keyword1" id="IP_Address-ipset_from_cidr_alt"><span class="command">lemma</span></span> ipset_from_cidr_alt<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">pre</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">pre</span> <span class="free">len</span> <span class="main">=</span>
            <span class="main">{</span><span class="free">pre</span> <span class="keyword1">AND</span> <span class="main">(</span>mask <span class="free">len</span> <span class="main">&lt;&lt;</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span>
             <span class="main">..</span>
             <span class="free">pre</span> <span class="keyword1">OR</span> mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_def ipset_from_netmask_def Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_oa_dist<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NOT_mask_shifted_lenword<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="IP_Address-ipset_from_cidr_alt2"><span class="command">lemma</span></span> ipset_from_cidr_alt2<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">base</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">base</span> <span class="free">len</span> <span class="main">=</span>
           ipset_from_netmask <span class="free">base</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> NOT_mask_shifted_lenword <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> word_not_not<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In CIDR notation, we cannot express the empty set.›</span></span>
  <span class="keyword1" id="IP_Address-ipset_from_cidr_not_empty"><span class="command">lemma</span></span> ipset_from_cidr_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">base</span> <span class="free">len</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_alt bitmagic_zeroLast_leq_or1Last<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Though we can write 192.168.1.2/24, we say that 192.168.0.0/24 is well-formed.›</span></span>
  <span class="keyword1" id="IP_Address-ipset_from_cidr_base_wellforemd"><span class="command">lemma</span></span> ipset_from_cidr_base_wellforemd<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">base</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="keyword1">AND</span> <span class="free">base</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">base</span> <span class="free">l</span> <span class="main">=</span> <span class="main">{</span><span class="free">base</span> <span class="main">..</span> <span class="free">base</span> <span class="keyword1">OR</span> mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> maskshift_eq_not_mask_generic<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mask <span class="free">l</span> <span class="main">&lt;&lt;</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'i</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">=</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> NOT_mask_shifted_lenword <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> word_not_not<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">base</span> <span class="keyword1">AND</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">base</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mask_eq_0_eq_x<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms word_bw_comms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">base</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">base</span> <span class="keyword1">AND</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">OR</span> mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span>
                <span class="free">base</span> <span class="keyword1">OR</span> mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipset_from_netmask <span class="free">base</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">{</span><span class="free">base</span> <span class="main">..</span> <span class="free">base</span> <span class="main">||</span> mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_netmask_def Let_def ** *<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_def maskshift_eq_not_mask_generic<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1" id="IP_Address-ipset_from_cidr_large_pfxlen"><span class="command">lemma</span></span> ipset_from_cidr_large_pfxlen<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ip</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">ip</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{</span><span class="free">ip</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> obviously<span class="main">:</span> <span class="quoted"><span class="quoted">"mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> ipset_from_cidr_base_wellforemd<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> obviously<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="IP_Address-ipset_from_netmask_base_mask_consume"><span class="command">lemma</span></span> ipset_from_netmask_base_mask_consume<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">base</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_netmask <span class="main">(</span><span class="free">base</span> <span class="keyword1">AND</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">(</span><span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">=</span>
             ipset_from_netmask <span class="free">base</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ipset_from_netmask_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Another definition of CIDR notation:
       All IP address which are equal on the first <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">len</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> bits›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ip_cidr_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'i</span> word set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ip_cidr_set</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span>
      <span class="main">{</span><span class="bound">j</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">AND</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">AND</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The definitions are equal›</span></span>
  <span class="keyword1" id="IP_Address-ipset_from_cidr_eq_ip_cidr_set"><span class="command">lemma</span></span> ipset_from_cidr_eq_ip_cidr_set<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">base</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">base</span> <span class="free">len</span> <span class="main">=</span> ip_cidr_set <span class="free">base</span> <span class="free">len</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> maskshift_eq_not_mask_generic<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mask <span class="free">len</span> <span class="main">&lt;&lt;</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">=</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> NOT_mask_shifted_lenword <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> word_not_not<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"mask <span class="main">(</span><span class="skolem">len</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="keyword1">AND</span> <span class="skolem">base</span> <span class="keyword1">AND</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="skolem">len</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">len</span> <span class="skolem">m</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">base</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_bw_lcs<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span> <span class="keyword1">AND</span> <span class="skolem">pfxm_p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
           <span class="main">(</span><span class="skolem">a</span> <span class="main">∈</span> ipset_from_netmask <span class="skolem">pfxm_p</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span>
           <span class="main">(</span><span class="skolem">pfxm_p</span> <span class="main">=</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">AND</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">pfxm_p</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> ipset_from_cidr_alt2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> zero_base_lsb_imp_set_eq_as_bit_operation<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> ipset_from_cidr_base_wellforemd<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">[</span><span class="operator">OF</span> 1<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">base</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> ipset_from_netmask <span class="free">base</span> <span class="main">(</span><span class="main">~~</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span>
       <span class="main">(</span><span class="free">base</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_netmask_base_mask_consume<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> word_bw_comms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">" <span class="main">~~</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ip_cidr_set_def ipset_from_cidr_def
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  maskshift_eq_not_mask_generic<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="IP_Address-ip_cidr_set_change_base"><span class="command">lemma</span></span> ip_cidr_set_change_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> ip_cidr_set <span class="free">i</span> <span class="free">r</span> <span class="main">⟹</span> ip_cidr_set <span class="free">j</span> <span class="free">r</span> <span class="main">=</span> ip_cidr_set <span class="free">i</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ip_cidr_set_def<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹IP Addresses as WordIntervals›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The nice thing is: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'i</span></span> wordinterval"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>s are executable.›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">iprange_single</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word <span class="main">⇒</span> <span class="tfree">'i</span> wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">iprange_single</span> <span class="free"><span class="bound"><span class="entity">ip</span></span></span> <span class="main">≡</span> WordInterval <span class="free"><span class="bound"><span class="entity">ip</span></span></span> <span class="free"><span class="bound"><span class="entity">ip</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">iprange_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'i</span><span class="main">::</span>len word <span class="main">×</span> <span class="tfree">'i</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span> wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">iprange_interval</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ip_start</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ip_end</span></span></span><span class="main">)</span> <span class="main">=</span> WordInterval <span class="free"><span class="bound"><span class="entity">ip_start</span></span></span> <span class="free"><span class="bound"><span class="entity">ip_end</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">declare</span></span> iprange_interval.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

  <span class="keyword1" id="IP_Address-iprange_interval_uncurry"><span class="command">lemma</span></span> iprange_interval_uncurry<span class="main">:</span> <span class="quoted"><span class="quoted">"iprange_interval <span class="free">ipcidr</span> <span class="main">=</span> uncurry WordInterval <span class="free">ipcidr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ipcidr</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprange_interval.simps<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>iprange_single <span class="free">ip</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">ip</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprange_single_def<span class="main">)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>iprange_interval <span class="main">(</span><span class="free">ip1</span><span class="main">,</span> <span class="free">ip2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">ip1</span> <span class="main">..</span> <span class="free">ip2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprange_interval.simps<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Now we can use the set operations on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'i</span></span><span class="main"><span class="main">::</span></span>len wordinterval"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>s›</span></span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">wordinterval_to_set</span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">wordinterval_element</span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">wordinterval_union</span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">wordinterval_empty</span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">wordinterval_setminus</span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">wordinterval_UNIV</span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">wordinterval_invert</span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">wordinterval_intersection</span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">wordinterval_subset</span>
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">wordinterval_eq</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹IP Addresses in CIDR Notation›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We want to convert IP addresses in CIDR notation to intervals.
    We already have <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ipset_from_cidr<span class="antiquote"><span class="antiquote">}</span></span></span></span>, which gives back a non-executable set.
    We want to convert to something we can store in an <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'i</span></span> wordinterval"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">ipcidr_to_interval_start</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'i</span><span class="main">::</span>len word <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>len word"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipcidr_to_interval_start</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pre</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">len</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
      <span class="keyword1">let</span> <span class="bound">netmask</span> <span class="main">=</span> <span class="main">(</span>mask <span class="free"><span class="bound"><span class="entity">len</span></span></span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">len</span></span></span><span class="main">)</span><span class="main">;</span>
          <span class="bound">network_prefix</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pre</span></span></span> <span class="keyword1">AND</span> <span class="bound">netmask</span><span class="main">)</span>
      <span class="keyword1">in</span> <span class="bound">network_prefix</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">ipcidr_to_interval_end</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'i</span><span class="main">::</span>len word <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span><span class="main">::</span>len word"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipcidr_to_interval_end</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pre</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">len</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
      <span class="keyword1">let</span> <span class="bound">netmask</span> <span class="main">=</span> <span class="main">(</span>mask <span class="free"><span class="bound"><span class="entity">len</span></span></span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">len</span></span></span><span class="main">)</span><span class="main">;</span>
          <span class="bound">network_prefix</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pre</span></span></span> <span class="keyword1">AND</span> <span class="bound">netmask</span><span class="main">)</span>
      <span class="keyword1">in</span> <span class="bound">network_prefix</span> <span class="keyword1">OR</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="bound">netmask</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipcidr_to_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'i</span><span class="main">::</span>len word <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'i</span> word <span class="main">×</span> <span class="tfree">'i</span> word<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipcidr_to_interval</span> <span class="free"><span class="bound"><span class="entity">cidr</span></span></span> <span class="main">≡</span> <span class="main">(</span>ipcidr_to_interval_start <span class="free"><span class="bound"><span class="entity">cidr</span></span></span><span class="main">,</span> ipcidr_to_interval_end <span class="free"><span class="bound"><span class="entity">cidr</span></span></span><span class="main">)</span>"</span></span>


  <span class="keyword1" id="IP_Address-ipset_from_cidr_ipcidr_to_interval"><span class="command">lemma</span></span> ipset_from_cidr_ipcidr_to_interval<span class="main">:</span>
    <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">base</span> <span class="free">len</span> <span class="main">=</span>
      <span class="main">{</span>ipcidr_to_interval_start <span class="main">(</span><span class="free">base</span><span class="main">,</span><span class="free">len</span><span class="main">)</span> <span class="main">..</span> ipcidr_to_interval_end <span class="main">(</span><span class="free">base</span><span class="main">,</span><span class="free">len</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def ipcidr_to_interval_def ipset_from_cidr_def ipset_from_netmask_def<span class="main">)</span>
  <span class="keyword1"><span class="command">declare</span></span> ipcidr_to_interval_start.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> ipcidr_to_interval_end.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

  <span class="keyword1" id="IP_Address-ipcidr_to_interval"><span class="command">lemma</span></span> ipcidr_to_interval<span class="main">:</span>
    <span class="quoted"><span class="quoted">"ipcidr_to_interval <span class="main">(</span><span class="free">base</span><span class="main">,</span> <span class="free">len</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="main">⟹</span> ipset_from_cidr <span class="free">base</span> <span class="free">len</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span> <span class="main">..</span> <span class="free">e</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipcidr_to_interval_def ipset_from_cidr_ipcidr_to_interval<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipcidr_tuple_to_wordinterval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'i</span><span class="main">::</span>len word <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span> wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipcidr_tuple_to_wordinterval</span> <span class="free"><span class="bound"><span class="entity">iprng</span></span></span> <span class="main">≡</span> iprange_interval <span class="main">(</span>ipcidr_to_interval <span class="free"><span class="bound"><span class="entity">iprng</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="IP_Address-wordinterval_to_set_ipcidr_tuple_to_wordinterval"><span class="command">lemma</span></span> wordinterval_to_set_ipcidr_tuple_to_wordinterval<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>ipcidr_tuple_to_wordinterval <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ipset_from_cidr <span class="free">b</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ipcidr_tuple_to_wordinterval_def ipset_from_cidr_ipcidr_to_interval
              ipcidr_to_interval_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprange_interval.simps<span class="main">)</span>

  <span class="keyword1" id="IP_Address-wordinterval_to_set_ipcidr_tuple_to_wordinterval_uncurry"><span class="command">lemma</span></span> wordinterval_to_set_ipcidr_tuple_to_wordinterval_uncurry<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>ipcidr_tuple_to_wordinterval <span class="free">ipcidr</span><span class="main">)</span> <span class="main">=</span> uncurry ipset_from_cidr <span class="free">ipcidr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ipcidr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_to_set_ipcidr_tuple_to_wordinterval<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipcidr_union_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'i</span><span class="main">::</span>len word <span class="main">×</span> nat<span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'i</span> word<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipcidr_union_set</span> <span class="free"><span class="bound"><span class="entity">ips</span></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="main">(</span><span class="bound">base</span><span class="main">,</span> <span class="bound">len</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ips</span></span></span><span class="main">.</span> ipset_from_cidr <span class="bound">base</span> <span class="bound">len</span>"</span></span>

  <span class="keyword1" id="IP_Address-ipcidr_union_set_uncurry"><span class="command">lemma</span></span> ipcidr_union_set_uncurry<span class="main">:</span>
    <span class="quoted"><span class="quoted">"ipcidr_union_set <span class="free">ips</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">ipcidr</span> <span class="main">∈</span> <span class="free">ips</span><span class="main">.</span> uncurry ipset_from_cidr <span class="bound">ipcidr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipcidr_union_set_def uncurry_case_stmt<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Clever Operations on IP Addresses in CIDR Notation›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Intersecting two intervals may result in a new interval.
    Example: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>{1..10} ∩ {5..20} = {5..10}›</span></span></span></span>

    Intersecting two IP address ranges represented as CIDR ranges results either in the empty set
    or the smaller of the two ranges. It will never create a new range.
    ›</span></span>
  <span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="comment1">(*contributed by Lars Noschinski*)</span>
    <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="IP_Address-less_and_not_mask_eq"><span class="command">lemma</span></span> less_and_not_mask_eq<span class="main">:</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> len<span class="main">)</span> word"</span></span>
      <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="free">r2</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="free">r1</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="free">r1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">AND</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="free">r1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="free">r1</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?w</span> <span class="main">&amp;&amp;</span> <span class="main">_</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> and_not_mask_twice max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">=</span> <span class="free">x</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="free">r2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="free">r1</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="free">r1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> and_not_mask_twice max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1" id="IP_Address-ip_cidr_set_less"><span class="command">lemma</span></span> ip_cidr_set_less<span class="main">:</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="free">r2</span> <span class="main">⟹</span> ip_cidr_set <span class="free">i</span> <span class="free">r2</span> <span class="main">⊆</span> ip_cidr_set <span class="free">i</span> <span class="free">r1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ip_cidr_set_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_and_not_mask_eq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?r2.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">r2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="IP_Address-ip_cidr_set_intersect_subset_helper"><span class="command">lemma</span></span> ip_cidr_set_intersect_subset_helper<span class="main">:</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i1</span> <span class="free">r1</span> <span class="free">i2</span> <span class="free">r2</span>
      <span class="keyword2"><span class="keyword">assumes</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"ip_cidr_set <span class="free">i1</span> <span class="free">r1</span> <span class="main">∩</span> ip_cidr_set <span class="free">i2</span> <span class="free">r2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ip_cidr_set <span class="free">i2</span> <span class="free">r2</span> <span class="main">⊆</span> ip_cidr_set <span class="free">i1</span> <span class="free">r1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> disj <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> ip_cidr_set <span class="free">i1</span> <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> ip_cidr_set <span class="free">i2</span> <span class="free">r2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r1</span> <span class="main">≤</span> <span class="free">r2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> ip_cidr_set <span class="skolem">j</span> <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> ip_cidr_set <span class="skolem">j</span> <span class="free">r1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ip_cidr_set_change_base ip_cidr_set_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ip_cidr_set <span class="free">i2</span> <span class="free">r2</span> <span class="main">⊆</span> ip_cidr_set <span class="free">i1</span> <span class="free">r1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> ip_cidr_set <span class="free">i2</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> ip_cidr_set <span class="free">i2</span> <span class="free">r2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> ip_cidr_set <span class="skolem">j</span> <span class="free">r2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ip_cidr_set_change_base <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ip_cidr_set <span class="skolem">j</span> <span class="free">r2</span> <span class="main">⊆</span> ip_cidr_set <span class="skolem">j</span> <span class="free">r1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r1</span> <span class="main">≤</span> <span class="free">r2</span>›</span></span> ip_cidr_set_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ip_cidr_set <span class="free">i1</span> <span class="free">r1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> ip_cidr_set <span class="free">i1</span> <span class="free">r1</span>›</span></span> ip_cidr_set_change_base <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> ip_cidr_set <span class="free">i1</span> <span class="free">r1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1" id="IP_Address-ip_cidr_set_notsubset_empty_inter"><span class="command">lemma</span></span> ip_cidr_set_notsubset_empty_inter<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> ip_cidr_set <span class="free">i1</span> <span class="free">r1</span> <span class="main">⊆</span> ip_cidr_set <span class="free">i2</span> <span class="free">r2</span> <span class="main">⟹</span>
       <span class="main">¬</span> ip_cidr_set <span class="free">i2</span> <span class="free">r2</span> <span class="main">⊆</span> ip_cidr_set <span class="free">i1</span> <span class="free">r1</span> <span class="main">⟹</span>
       ip_cidr_set <span class="free">i1</span> <span class="free">r1</span> <span class="main">∩</span> ip_cidr_set <span class="free">i2</span> <span class="free">r2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> ip_cidr_set_intersect_subset_helper <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> ip_cidr_set_intersect_subset_helper <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>


  <span class="keyword1" id="IP_Address-ip_cidr_intersect"><span class="command">lemma</span></span> ip_cidr_intersect<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">¬</span> ipset_from_cidr <span class="free">b2</span> <span class="free">m2</span> <span class="main">⊆</span> ipset_from_cidr <span class="free">b1</span> <span class="free">m1</span> <span class="main">⟹</span>
      <span class="main">¬</span> ipset_from_cidr <span class="free">b1</span> <span class="free">m1</span> <span class="main">⊆</span> ipset_from_cidr <span class="free">b2</span> <span class="free">m2</span> <span class="main">⟹</span>
      ipset_from_cidr <span class="free">b1</span> <span class="free">m1</span> <span class="main">∩</span> ipset_from_cidr <span class="free">b2</span> <span class="free">m2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_eq_ip_cidr_set<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ip_cidr_set_notsubset_empty_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Computing the intersection of two IP address ranges in CIDR notation›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">ipcidr_conjunct</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'i</span><span class="main">::</span>len word <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'i</span> word <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'i</span> word <span class="main">×</span> nat<span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipcidr_conjunct</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">base1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">base2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
       <span class="keyword1">if</span>
         ipset_from_cidr <span class="free"><span class="bound"><span class="entity">base1</span></span></span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="main">∩</span> ipset_from_cidr <span class="free"><span class="bound"><span class="entity">base2</span></span></span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="main">=</span> <span class="main">{}</span>
       <span class="keyword1">then</span>
         None
       <span class="keyword1">else</span> <span class="keyword1">if</span>
         ipset_from_cidr <span class="free"><span class="bound"><span class="entity">base1</span></span></span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="main">⊆</span> ipset_from_cidr <span class="free"><span class="bound"><span class="entity">base2</span></span></span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span>
       <span class="keyword1">then</span>
         Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">base1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main">)</span>
       <span class="keyword1">else</span>
         Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">base2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main">)</span>
      <span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Intersecting with an address with prefix length zero always yields a non-empty result.›</span></span>
  <span class="keyword1" id="IP_Address-ipcidr_conjunct_any"><span class="command">lemma</span></span> ipcidr_conjunct_any<span class="main">:</span> <span class="quoted"><span class="quoted">"ipcidr_conjunct <span class="free">a</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> None"</span></span> <span class="quoted"><span class="quoted">"ipcidr_conjunct <span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="free">b</span> <span class="main">≠</span> None"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_0 ipset_from_cidr_not_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_0 ipset_from_cidr_not_empty<span class="main">)</span>

  <span class="keyword1" id="IP_Address-ipcidr_conjunct_correct"><span class="command">lemma</span></span> ipcidr_conjunct_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> ipcidr_conjunct <span class="main">(</span><span class="free">b1</span><span class="main">,</span> <span class="free">m1</span><span class="main">)</span> <span class="main">(</span><span class="free">b2</span><span class="main">,</span> <span class="free">m2</span><span class="main">)</span>
                                          <span class="keyword1">of</span> Some <span class="main">(</span><span class="bound">bx</span><span class="main">,</span> <span class="bound">mx</span><span class="main">)</span> <span class="main">⇒</span> ipset_from_cidr <span class="bound">bx</span> <span class="bound">mx</span>
                                          <span class="main">|</span>  None <span class="main">⇒</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span>
                                   <span class="main">(</span>ipset_from_cidr <span class="free">b1</span> <span class="free">m1</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>ipset_from_cidr <span class="free">b2</span> <span class="free">m2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ip_cidr_intersect <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">declare</span></span> ipcidr_conjunct.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Code Equations›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Executable definition using word intervals›</span></span>
  <span class="keyword1" id="IP_Address-ipcidr_conjunct_word"><span class="command">lemma</span></span> ipcidr_conjunct_word<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ipcidr_conjunct <span class="free">ips1</span> <span class="free">ips2</span> <span class="main">=</span> <span class="main">(</span>
     <span class="keyword1">if</span>
      wordinterval_empty <span class="main">(</span>wordinterval_intersection
                            <span class="main">(</span>ipcidr_tuple_to_wordinterval <span class="free">ips1</span><span class="main">)</span> <span class="main">(</span>ipcidr_tuple_to_wordinterval <span class="free">ips2</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">then</span>
       None
     <span class="keyword1">else</span> <span class="keyword1">if</span>
       wordinterval_subset <span class="main">(</span>ipcidr_tuple_to_wordinterval <span class="free">ips1</span><span class="main">)</span> <span class="main">(</span>ipcidr_tuple_to_wordinterval <span class="free">ips2</span><span class="main">)</span>
     <span class="keyword1">then</span>
       Some <span class="free">ips1</span>
     <span class="keyword1">else</span>
       Some <span class="free">ips2</span>
     <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ips1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">ips2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> b1 m1 b2 m2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_to_set_ipcidr_tuple_to_wordinterval ipcidr_conjunct.simps
             <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="comment1">(*with the code_unfold lemma before, this works!*)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipcidr_conjunct <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">ipcidr_conjunct</span></span> <span class="keyword2"><span class="keyword">checking</span></span> SML

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹making element check executable›</span></span>
  <span class="keyword1" id="IP_Address-addr_in_ipset_from_netmask_code"><span class="command">lemma</span></span> addr_in_ipset_from_netmask_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">addr</span> <span class="main">∈</span> <span class="main">(</span>ipset_from_netmask <span class="free">base</span> <span class="free">netmask</span><span class="main">)</span> <span class="main">⟷</span>
      <span class="main">(</span><span class="free">base</span> <span class="keyword1">AND</span> <span class="free">netmask</span><span class="main">)</span> <span class="main">≤</span> <span class="free">addr</span> <span class="main">∧</span> <span class="free">addr</span> <span class="main">≤</span> <span class="main">(</span><span class="free">base</span> <span class="keyword1">AND</span> <span class="free">netmask</span><span class="main">)</span> <span class="keyword1">OR</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="free">netmask</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_netmask_def Let_def<span class="main">)</span>
  <span class="keyword1" id="IP_Address-addr_in_ipset_from_cidr_code"><span class="command">lemma</span></span> addr_in_ipset_from_cidr_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">addr</span><span class="main">::</span><span class="tfree">'i</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ipset_from_cidr <span class="free">pre</span> <span class="free">len</span><span class="main">)</span> <span class="main">⟷</span>
       <span class="main">(</span><span class="free">pre</span> <span class="keyword1">AND</span> <span class="main">(</span><span class="main">(</span>mask <span class="free">len</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">addr</span> <span class="main">∧</span>
        <span class="free">addr</span> <span class="main">≤</span> <span class="free">pre</span> <span class="keyword1">OR</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ipset_from_cidr_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IPv4">
<div class="head">
<h1>Theory IPv4</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      IPv4.thy
    Authors:    Cornelius Diekmann, Julius Michaelis
*)</span>
<span class="keyword1"><span class="command">theory</span></span> IPv4
<span class="keyword2"><span class="keyword">imports</span></span> <a href="IP_Address.html">IP_Address</a>
        <a href="NumberWang_IPv4.html">NumberWang_IPv4</a>
        <span class="comment1">(* include "HOL-Library.Code_Target_Nat" if you need to work with actual numbers.*)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="IPv4-take_bit_word_beyond_length_eq"><span class="command">lemma</span></span> take_bit_word_beyond_length_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹take_bit <span class="free">n</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w</span>›</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span><span class="main">::</span>len word›</span></span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹IPv4 Adresses›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An IPv4 address is basically a 32 bit unsigned integer.›</span></span>
  <span class="keyword1"><span class="command">type_synonym</span></span> ipv4addr <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">32</span> word"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conversion between natural numbers and IPv4 adresses›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_of_ipv4addr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv4addr <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">nat_of_ipv4addr</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> unat <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipv4addr_of_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ipv4addr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipv4addr_of_nat</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span>  of_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The maximum IPv4 addres›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_ipv4_addr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv4addr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">max_ipv4_addr</span> <span class="main">≡</span> ipv4addr_of_nat <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="IPv4-max_ipv4_addr_number"><span class="command">lemma</span></span> max_ipv4_addr_number<span class="main">:</span> <span class="quoted"><span class="quoted">"max_ipv4_addr <span class="main">=</span> <span class="numeral">4294967295</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> max_ipv4_addr_def ipv4addr_of_nat_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"max_ipv4_addr <span class="main">=</span> <span class="numeral">0b11111111111111111111111111111111</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> max_ipv4_addr_number<span class="main">)</span>
  <span class="keyword1" id="IPv4-max_ipv4_addr_max_word"><span class="command">lemma</span></span> max_ipv4_addr_max_word<span class="main">:</span> <span class="quoted"><span class="quoted">"max_ipv4_addr <span class="main">=</span> max_word"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_ipv4_addr_number<span class="main">)</span>
  <span class="keyword1" id="IPv4-max_ipv4_addr_max"><span class="command">lemma</span></span> max_ipv4_addr_max<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> max_ipv4_addr"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_ipv4_addr_max_word<span class="main">)</span>
  <span class="keyword1" id="IPv4-UNIV_ipv4addrset"><span class="command">lemma</span></span> UNIV_ipv4addrset<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> max_ipv4_addr<span class="main">}</span>"</span></span> <span class="comment1">(*not in the simp set, for a reason*)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_ipv4_addr_max_word<span class="main">)</span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹identity functions›</span></span>
  <span class="keyword1" id="IPv4-nat_of_ipv4addr_ipv4addr_of_nat_mod"><span class="command">lemma</span></span> nat_of_ipv4addr_ipv4addr_of_nat_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_of_ipv4addr <span class="main">(</span>ipv4addr_of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def nat_of_ipv4addr_def unat_of_nat take_bit_eq_mod<span class="main">)</span>
  <span class="keyword1" id="IPv4-nat_of_ipv4addr_ipv4addr_of_nat"><span class="command">lemma</span></span> nat_of_ipv4addr_ipv4addr_of_nat<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> nat_of_ipv4addr max_ipv4_addr <span class="main">⟧</span> <span class="main">⟹</span> nat_of_ipv4addr <span class="main">(</span>ipv4addr_of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_of_ipv4addr_ipv4addr_of_nat_mod max_ipv4_addr_def<span class="main">)</span>
  <span class="keyword1" id="IPv4-ipv4addr_of_nat_nat_of_ipv4addr"><span class="command">lemma</span></span> ipv4addr_of_nat_nat_of_ipv4addr<span class="main">:</span> <span class="quoted"><span class="quoted">"ipv4addr_of_nat <span class="main">(</span>nat_of_ipv4addr <span class="free">addr</span><span class="main">)</span> <span class="main">=</span> <span class="free">addr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def nat_of_ipv4addr_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Representing IPv4 Adresses (Syntax)›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">ipv4addr_of_dotdecimal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">×</span> nat <span class="main">×</span> nat <span class="main">×</span> nat <span class="main">⇒</span> ipv4addr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipv4addr_of_dotdecimal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">=</span> ipv4addr_of_nat <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">+</span> <span class="numeral">16777216</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">dotdecimal_of_ipv4addr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv4addr <span class="main">⇒</span> nat <span class="main">×</span> nat <span class="main">×</span> nat <span class="main">×</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">dotdecimal_of_ipv4addr</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span>nat_of_ipv4addr <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&gt;&gt;</span> <span class="numeral">24</span><span class="main">)</span> <span class="keyword1">AND</span> <span class="numeral">0xFF</span><span class="main">)</span><span class="main">,</span>
                                    nat_of_ipv4addr <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&gt;&gt;</span> <span class="numeral">16</span><span class="main">)</span> <span class="keyword1">AND</span> <span class="numeral">0xFF</span><span class="main">)</span><span class="main">,</span>
                                    nat_of_ipv4addr <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&gt;&gt;</span> <span class="numeral">8</span><span class="main">)</span> <span class="keyword1">AND</span> <span class="numeral">0xFF</span><span class="main">)</span><span class="main">,</span>
                                    nat_of_ipv4addr <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">AND</span> <span class="numeral">0xff</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">declare</span></span> ipv4addr_of_dotdecimal.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> dotdecimal_of_ipv4addr.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Examples:›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span> <span class="numeral">168</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3232235521</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_dotdecimal.simps ipv4addr_of_nat_def<span class="main">)</span>
    <span class="comment1">(*could be solved by eval, but needs "HOL-Library.Code_Target_Nat"*)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dotdecimal_of_ipv4addr <span class="numeral">3232235521</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">192</span><span class="main">,</span> <span class="numeral">168</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dotdecimal_of_ipv4addr.simps nat_of_ipv4addr_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹a different notation for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipv4addr_of_dotdecimal</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
  <span class="keyword1" id="IPv4-ipv4addr_of_dotdecimal_bit"><span class="command">lemma</span></span> ipv4addr_of_dotdecimal_bit<span class="main">:</span>
    <span class="quoted"><span class="quoted">"ipv4addr_of_dotdecimal <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span>ipv4addr_of_nat <span class="free">a</span> <span class="main">&lt;&lt;</span> <span class="numeral">24</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>ipv4addr_of_nat <span class="free">b</span> <span class="main">&lt;&lt;</span> <span class="numeral">16</span><span class="main">)</span> <span class="main">+</span>
       <span class="main">(</span>ipv4addr_of_nat <span class="free">c</span> <span class="main">&lt;&lt;</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">+</span> ipv4addr_of_nat <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4addr_of_nat <span class="free">a</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">24</span> <span class="main">=</span> ipv4addr_of_nat <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="numeral">16777216</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def shiftl_t2n<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4addr_of_nat <span class="free">b</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">16</span> <span class="main">=</span> ipv4addr_of_nat <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="numeral">65536</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def shiftl_t2n<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4addr_of_nat <span class="free">c</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">8</span> <span class="main">=</span> ipv4addr_of_nat <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="numeral">256</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def shiftl_t2n<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ipv4addr_of_nat_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> ipv4addr_of_nat <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> word_succ <span class="main">(</span>ipv4addr_of_nat <span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Abs_fnat_hom_Suc of_nat_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipv4addr_of_nat <span class="skolem">x</span> <span class="main">+</span> ipv4addr_of_nat <span class="skolem">y</span> <span class="main">=</span> ipv4addr_of_nat <span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_suc word_succ_p1<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">from</span></span> this a b c
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_dotdecimal.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">ipv4addr_of_nat</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">_</span></span></span></span></span></span></span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="IPv4-size_ipv4addr"><span class="command">lemma</span></span> size_ipv4addr<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="main">(</span><span class="free">x</span><span class="main">::</span>ipv4addr<span class="main">)</span> <span class="main">=</span> <span class="numeral">32</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>word_size<span class="main">)</span>

  <span class="keyword1" id="IPv4-dotdecimal_of_ipv4addr_ipv4addr_of_dotdecimal"><span class="command">lemma</span></span> dotdecimal_of_ipv4addr_ipv4addr_of_dotdecimal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="numeral">256</span><span class="main">;</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="numeral">256</span><span class="main">;</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="numeral">256</span><span class="main">;</span> <span class="free">d</span> <span class="main">&lt;</span> <span class="numeral">256</span> <span class="main">⟧</span> <span class="main">⟹</span>
    dotdecimal_of_ipv4addr <span class="main">(</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&lt;</span> <span class="numeral">256</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="numeral">256</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&lt;</span> <span class="numeral">256</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&lt;</span> <span class="numeral">256</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&lt;</span> <span class="numeral">256</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span>  <span class="quoted"><span class="quoted">"nat_of_ipv4addr <span class="main">(</span><span class="main">(</span>ipv4addr_of_nat <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="numeral">16777216</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="numeral">24</span><span class="main">)</span> <span class="keyword1">AND</span> mask <span class="numeral">8</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def nat_of_ipv4addr_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_bit_take_bit nat_take_bit_eq <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> take_bit_eq_mask<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_bit_eq_div take_bit_eq_mod<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> ipv4addr_of_nat_AND_mask8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4addr_of_nat <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">AND</span> mask <span class="numeral">8</span> <span class="main">=</span> <span class="main">(</span>ipv4addr_of_nat <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">mod</span> <span class="numeral">256</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> take_bit_eq_mask<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_bit_eq_mod of_nat_mod<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span>
      <span class="quoted"><span class="quoted">"nat_of_ipv4addr <span class="main">(</span><span class="main">(</span>ipv4addr_of_nat <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="numeral">16777216</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="numeral">16</span><span class="main">)</span> <span class="keyword1">AND</span> mask <span class="numeral">8</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def nat_of_ipv4addr_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_bit_take_bit <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> take_bit_eq_mask<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> div65536
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_bit_eq_div take_bit_eq_mod<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span>
      <span class="quoted"><span class="quoted">"nat_of_ipv4addr <span class="main">(</span><span class="main">(</span>ipv4addr_of_nat <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="numeral">16777216</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="numeral">8</span><span class="main">)</span> <span class="keyword1">AND</span> mask <span class="numeral">8</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def nat_of_ipv4addr_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_bit_take_bit <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> take_bit_eq_mask<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> div256
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_bit_eq_div take_bit_eq_mod<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">&lt;</span> <span class="numeral">256</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_of_ipv4addr <span class="main">(</span>ipv4addr_of_nat <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="numeral">65536</span> <span class="main">*</span> <span class="free">b</span> <span class="main">+</span> <span class="numeral">16777216</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">AND</span> mask <span class="numeral">8</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_AND_mask8 ipv4addr_of_nat_def nat_of_ipv4addr_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> take_bit_eq_mask<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_bit_eq_mod nat_mod_distrib nat_add_distrib nat_mult_distrib mod256<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> a b c d <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_dotdecimal.simps dotdecimal_of_ipv4addr.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mask_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="IPv4-ipv4addr_of_dotdecimal_dotdecimal_of_ipv4addr"><span class="command">lemma</span></span> ipv4addr_of_dotdecimal_dotdecimal_of_ipv4addr<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4addr_of_dotdecimal <span class="main">(</span>dotdecimal_of_ipv4addr <span class="free">ip</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> ip_and_mask8_bl_drop24<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ip</span><span class="main">::</span>ipv4addr<span class="main">)</span> <span class="keyword1">AND</span> mask <span class="numeral">8</span> <span class="main">=</span> of_bl <span class="main">(</span>drop <span class="numeral">24</span> <span class="main">(</span>to_bl <span class="free">ip</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_drop_to_bl size_ipv4addr<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> List_rev_drop_geqn<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">(</span>take <span class="skolem">n</span> <span class="main">(</span>rev <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List.rev_drop<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> and_mask_bl_take<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>of_bl <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">AND</span> mask <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_bl <span class="main">(</span>rev <span class="main">(</span>take <span class="skolem">n</span> <span class="main">(</span>rev <span class="main">(</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List_rev_drop_geqn of_bl_drop<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ipv4addr_and_255<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">AND</span> <span class="numeral">255</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">AND</span> mask <span class="numeral">8</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">ipv4addr</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mask_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> bit_equality<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">ip</span> <span class="main">&gt;&gt;</span> <span class="numeral">24</span><span class="main">)</span> <span class="keyword1">AND</span> <span class="numeral">0xFF</span> <span class="main">&lt;&lt;</span> <span class="numeral">24</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">ip</span> <span class="main">&gt;&gt;</span> <span class="numeral">16</span><span class="main">)</span> <span class="keyword1">AND</span> <span class="numeral">0xFF</span> <span class="main">&lt;&lt;</span> <span class="numeral">16</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">ip</span> <span class="main">&gt;&gt;</span> <span class="numeral">8</span><span class="main">)</span> <span class="keyword1">AND</span> <span class="numeral">0xFF</span> <span class="main">&lt;&lt;</span> <span class="numeral">8</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFF</span><span class="main">)</span> <span class="main">=</span>
       of_bl <span class="main">(</span>take <span class="numeral">8</span> <span class="main">(</span>to_bl <span class="free">ip</span><span class="main">)</span> <span class="main">@</span> take <span class="numeral">8</span> <span class="main">(</span>drop <span class="numeral">8</span> <span class="main">(</span>to_bl <span class="free">ip</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> take <span class="numeral">8</span> <span class="main">(</span>drop <span class="numeral">16</span> <span class="main">(</span>to_bl <span class="free">ip</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> drop <span class="numeral">24</span> <span class="main">(</span>to_bl <span class="free">ip</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_and_255<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shiftr_slice<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> slice_take' size_ipv4addr<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> and_mask_bl_take<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List_rev_drop_geqn<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_take<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shiftl_of_bl<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_bl_append<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ip_and_mask8_bl_drop24<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> blip_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">blip</span><span class="main">.</span> length <span class="bound">blip</span> <span class="main">=</span> <span class="numeral">32</span> <span class="main">⟹</span>
      <span class="bound">blip</span> <span class="main">=</span> <span class="main">(</span>take <span class="numeral">8</span> <span class="bound">blip</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>take <span class="numeral">8</span> <span class="main">(</span>drop <span class="numeral">8</span> <span class="bound">blip</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>take <span class="numeral">8</span> <span class="main">(</span>drop <span class="numeral">16</span> <span class="bound">blip</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>take <span class="numeral">8</span> <span class="main">(</span>drop <span class="numeral">24</span> <span class="bound">blip</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rename_tac</span> blip<span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">blip</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="comment1">(*I'm so sorry for this ...*)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipv4addr_of_dotdecimal <span class="main">(</span>dotdecimal_of_ipv4addr <span class="free">ip</span><span class="main">)</span> <span class="main">=</span> of_bl <span class="main">(</span>to_bl <span class="free">ip</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> blip_split<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_dotdecimal_bit dotdecimal_of_ipv4addr.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_nat_of_ipv4addr<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bit_equality<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> word_bl.Rep_inverse<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="IPv4-ipv4addr_of_dotdecimal_eqE"><span class="command">lemma</span></span> ipv4addr_of_dotdecimal_eqE<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> ipv4addr_of_dotdecimal <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span> <span class="main">=</span> ipv4addr_of_dotdecimal <span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="free">g</span><span class="main">,</span><span class="free">h</span><span class="main">)</span><span class="main">;</span>
       <span class="free">a</span> <span class="main">&lt;</span> <span class="numeral">256</span><span class="main">;</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="numeral">256</span><span class="main">;</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="numeral">256</span><span class="main">;</span> <span class="free">d</span> <span class="main">&lt;</span> <span class="numeral">256</span><span class="main">;</span> <span class="free">e</span> <span class="main">&lt;</span> <span class="numeral">256</span><span class="main">;</span> <span class="free">f</span> <span class="main">&lt;</span> <span class="numeral">256</span><span class="main">;</span> <span class="free">g</span> <span class="main">&lt;</span> <span class="numeral">256</span><span class="main">;</span> <span class="free">h</span> <span class="main">&lt;</span> <span class="numeral">256</span> <span class="main">⟧</span> <span class="main">⟹</span>
         <span class="free">a</span> <span class="main">=</span> <span class="free">e</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="free">g</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">=</span> <span class="free">h</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Pair_inject dotdecimal_of_ipv4addr_ipv4addr_of_dotdecimal<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹IP Ranges: Examples›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV <span class="main">::</span> ipv4addr set<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> max_ipv4_addr<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UNIV_ipv4addrset<span class="main">)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">42</span><span class="main">::</span>ipv4addr<span class="main">)</span> <span class="main">∈</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

  <span class="comment1">(*Warning, not executable!*)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipset_from_netmask <span class="main">(</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span><span class="numeral">168</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">42</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">255</span><span class="main">,</span><span class="numeral">255</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">{</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span><span class="numeral">168</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">..</span> ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span><span class="numeral">168</span><span class="main">,</span><span class="numeral">255</span><span class="main">,</span><span class="numeral">255</span><span class="main">)</span><span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_netmask_def ipv4addr_of_dotdecimal.simps ipv4addr_of_nat_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipset_from_netmask <span class="main">(</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span><span class="numeral">168</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">42</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UNIV_ipv4addrset ipset_from_netmask_def ipv4addr_of_dotdecimal.simps
                 ipv4addr_of_nat_def max_ipv4_addr_max_word<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹192.168.0.0/24›</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">addr</span> <span class="main">::</span> <span class="quoted">ipv4addr</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">addr</span> <span class="free">pflength</span> <span class="main">=</span>
            ipset_from_netmask <span class="free">addr</span> <span class="main">(</span><span class="main">(</span>mask <span class="free">pflength</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">32</span> <span class="main">-</span> <span class="free">pflength</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="main">(</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span><span class="numeral">168</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">42</span><span class="main">)</span><span class="main">)</span> <span class="numeral">16</span> <span class="main">=</span>
          <span class="main">{</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span><span class="numeral">168</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">..</span> ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span><span class="numeral">168</span><span class="main">,</span><span class="numeral">255</span><span class="main">,</span><span class="numeral">255</span><span class="main">)</span><span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_alt mask_eq ipv4addr_of_dotdecimal.simps ipv4addr_of_nat_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">ip</span> <span class="main">∈</span> <span class="main">(</span>ipset_from_cidr <span class="main">(</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_0<span class="main">)</span>

  <span class="keyword1" id="IPv4-ipv4set_from_cidr_32"><span class="command">lemma</span></span> ipv4set_from_cidr_32<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">addr</span> <span class="main">::</span> <span class="quoted">ipv4addr</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">addr</span> <span class="numeral">32</span> <span class="main">=</span> <span class="main">{</span><span class="free">addr</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_alt take_bit_word_beyond_length_eq <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> take_bit_eq_mask<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span>  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">pre</span> <span class="main">::</span> <span class="quoted">ipv4addr</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_cidr <span class="free">pre</span> <span class="free">len</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">pre</span> <span class="keyword1">AND</span> <span class="main">(</span><span class="main">(</span>mask <span class="free">len</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">32</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">..</span> <span class="free">pre</span> <span class="keyword1">OR</span> <span class="main">(</span>mask <span class="main">(</span><span class="numeral">32</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_alt ipset_from_cidr_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹making element check executable›</span></span>
  <span class="keyword1" id="IPv4-addr_in_ipv4set_from_netmask_code"><span class="command">lemma</span></span> addr_in_ipv4set_from_netmask_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">addr</span> <span class="main">::</span> <span class="quoted">ipv4addr</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">addr</span> <span class="main">∈</span> <span class="main">(</span>ipset_from_netmask <span class="free">base</span> <span class="free">netmask</span><span class="main">)</span> <span class="main">⟷</span>
            <span class="main">(</span><span class="free">base</span> <span class="keyword1">AND</span> <span class="free">netmask</span><span class="main">)</span> <span class="main">≤</span> <span class="free">addr</span> <span class="main">∧</span> <span class="free">addr</span> <span class="main">≤</span> <span class="main">(</span><span class="free">base</span> <span class="keyword1">AND</span> <span class="free">netmask</span><span class="main">)</span> <span class="keyword1">OR</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="free">netmask</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addr_in_ipset_from_netmask_code<span class="main">)</span>
  <span class="keyword1" id="IPv4-addr_in_ipv4set_from_cidr_code"><span class="command">lemma</span></span> addr_in_ipv4set_from_cidr_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">addr</span> <span class="main">::</span> <span class="quoted">ipv4addr</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">addr</span> <span class="main">∈</span> <span class="main">(</span>ipset_from_cidr <span class="free">pre</span> <span class="free">len</span><span class="main">)</span> <span class="main">⟷</span>
              <span class="main">(</span><span class="free">pre</span> <span class="keyword1">AND</span> <span class="main">(</span><span class="main">(</span>mask <span class="free">len</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">32</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">addr</span> <span class="main">∧</span> <span class="free">addr</span> <span class="main">≤</span> <span class="free">pre</span> <span class="keyword1">OR</span> <span class="main">(</span>mask <span class="main">(</span><span class="numeral">32</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addr_in_ipset_from_cidr_code<span class="main">)</span>

  <span class="comment1">(*small numbers because we didn't load Code_Target_Nat. Should work by eval*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span><span class="numeral">168</span><span class="main">,</span><span class="numeral">42</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ipset_from_cidr <span class="main">(</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span><span class="numeral">168</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="numeral">16</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv4addr_of_nat_def ipset_from_cidr_def ipv4addr_of_dotdecimal.simps
    ipset_from_netmask_def mask_eq_exp_minus_1 word_le_def take_bit_minus_one_eq_mask<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipv4range_UNIV</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">32</span> wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv4range_UNIV</span> <span class="main">≡</span> wordinterval_UNIV"</span></span>

  <span class="keyword1" id="IPv4-ipv4range_UNIV_set_eq"><span class="command">lemma</span></span> ipv4range_UNIV_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set ipv4range_UNIV <span class="main">=</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ipv4range_UNIV_def wordinterval_UNIV_set_eq<span class="main">)</span>


  <span class="keyword1"><span class="command">thm</span></span> iffD1<span class="main">[</span><span class="operator">OF</span> wordinterval_eq_set_eq<span class="main">]</span>
  <span class="comment1">(*TODO: probably the following is a good idea?*)</span>
  <span class="comment1">(*
  declare iffD1[OF wordinterval_eq_set_eq, cong]
  *)</span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>LENGTH('a)›</span></span></span></span> is 32 for IPv4 addresses.›</span></span>
  <span class="keyword1" id="IPv4-ipv4cidr_to_interval_simps"><span class="command">lemma</span></span> ipv4cidr_to_interval_simps<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ipcidr_to_interval <span class="main">(</span><span class="main">(</span><span class="free">pre</span><span class="main">::</span>ipv4addr<span class="main">)</span><span class="main">,</span> <span class="free">len</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
      <span class="keyword1">let</span> <span class="bound">netmask</span> <span class="main">=</span> <span class="main">(</span>mask <span class="free">len</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">32</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">;</span>
          <span class="bound">network_prefix</span> <span class="main">=</span> <span class="main">(</span><span class="free">pre</span> <span class="keyword1">AND</span> <span class="bound">netmask</span><span class="main">)</span>
      <span class="keyword1">in</span> <span class="main">(</span><span class="bound">network_prefix</span><span class="main">,</span> <span class="bound">network_prefix</span> <span class="keyword1">OR</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="bound">netmask</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipcidr_to_interval_def Let_def ipcidr_to_interval_start.simps ipcidr_to_interval_end.simps<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IPv6">
<div class="head">
<h1>Theory IPv6</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      IPv6.thy
    Authors:    Cornelius Diekmann
*)</span>
<span class="keyword1"><span class="command">theory</span></span> IPv6
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="IP_Address.html">IP_Address</a>
    <a href="NumberWang_IPv6.html">NumberWang_IPv6</a>
    <span class="comment1">(* include "HOL-Library.Code_Target_Nat" if you need to work with actual numbers.*)</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹IPv6 Addresses›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An IPv6 address is basically a 128 bit unsigned integer. RFC 4291, Section 2.›</span></span>
  <span class="keyword1"><span class="command">type_synonym</span></span> ipv6addr <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">128</span> word"</span></span>
 
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conversion between natural numbers and IPv6 adresses›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_of_ipv6addr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv6addr <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">nat_of_ipv6addr</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> unat <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipv6addr_of_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ipv6addr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_of_nat</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span>  of_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_of_nat <span class="free">n</span> <span class="main">=</span> word_of_int <span class="main">(</span>int <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6addr_of_nat_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The maximum IPv6 address›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_ipv6_addr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv6addr"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">max_ipv6_addr</span> <span class="main">≡</span> ipv6addr_of_nat <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">128</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="IPv6-max_ipv6_addr_number"><span class="command">lemma</span></span> max_ipv6_addr_number<span class="main">:</span> <span class="quoted"><span class="quoted">"max_ipv6_addr <span class="main">=</span> <span class="numeral">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> max_ipv6_addr_def ipv6addr_of_nat_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"max_ipv6_addr <span class="main">=</span> <span class="numeral">340282366920938463463374607431768211455</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> max_ipv6_addr_number<span class="main">)</span>
  <span class="keyword1" id="IPv6-max_ipv6_addr_max_word"><span class="command">lemma</span></span> max_ipv6_addr_max_word<span class="main">:</span> <span class="quoted"><span class="quoted">"max_ipv6_addr <span class="main">=</span> max_word"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_ipv6_addr_number<span class="main">)</span>
  <span class="keyword1" id="IPv6-max_ipv6_addr_max"><span class="command">lemma</span></span> max_ipv6_addr_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> max_ipv6_addr"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_ipv6_addr_max_word<span class="main">)</span>
  <span class="keyword1" id="IPv6-UNIV_ipv6addrset"><span class="command">lemma</span></span> UNIV_ipv6addrset<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> max_ipv6_addr<span class="main">}</span>"</span></span> <span class="comment1">(*not in the simp set, for a reason*)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_ipv6_addr_max_word<span class="main">)</span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹identity functions›</span></span>
  <span class="keyword1" id="IPv6-nat_of_ipv6addr_ipv6addr_of_nat_mod"><span class="command">lemma</span></span> nat_of_ipv6addr_ipv6addr_of_nat_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_of_ipv6addr <span class="main">(</span>ipv6addr_of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">128</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6addr_of_nat_def nat_of_ipv6addr_def unat_of_nat take_bit_eq_mod<span class="main">)</span>
  <span class="keyword1" id="IPv6-nat_of_ipv6addr_ipv6addr_of_nat"><span class="command">lemma</span></span> nat_of_ipv6addr_ipv6addr_of_nat<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> nat_of_ipv6addr max_ipv6_addr <span class="main">⟹</span> nat_of_ipv6addr <span class="main">(</span>ipv6addr_of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_of_ipv6addr_ipv6addr_of_nat_mod max_ipv6_addr_def<span class="main">)</span>
  <span class="keyword1" id="IPv6-ipv6addr_of_nat_nat_of_ipv6addr"><span class="command">lemma</span></span> ipv6addr_of_nat_nat_of_ipv6addr<span class="main">:</span> <span class="quoted"><span class="quoted">"ipv6addr_of_nat <span class="main">(</span>nat_of_ipv6addr <span class="free">addr</span><span class="main">)</span> <span class="main">=</span> <span class="free">addr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6addr_of_nat_def nat_of_ipv6addr_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Syntax of IPv6 Adresses›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹RFC 4291, Section 2.2.: Text Representation of Addresses›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Quoting the RFC (note: errata exists):›</span></span>
  <span class="keyword1"><span class="command">text_raw</span></span><span class="quoted"><span class="plain_text">‹
  \begin{verbatim}
   1. The preferred form is x:x:x:x:x:x:x:x, where the 'x's are one to
      four hexadecimal digits of the eight 16-bit pieces of the address.
      Examples:
         ABCD:EF01:2345:6789:ABCD:EF01:2345:6789
         2001:DB8:0:0:8:800:200C:417A
  \end{verbatim}
›</span></span>
  <span class="keyword1"><span class="command">datatype</span></span> ipv6addr_syntax <span class="main">=</span> 
    IPv6AddrPreferred <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>

  <span class="keyword1"><span class="command">text_raw</span></span><span class="quoted"><span class="plain_text">‹
  \begin{verbatim}
   2. [...] In order to make writing addresses containing zero
      bits easier, a special syntax is available to compress the zeros.
      The use of "::" indicates one or more groups of 16 bits of zeros.
      The "::" can only appear once in an address.  The "::" can also be
      used to compress leading or trailing zeros in an address.

      For example, the following addresses
         2001:DB8:0:0:8:800:200C:417A   a unicast address
         FF01:0:0:0:0:0:0:101           a multicast address
         0:0:0:0:0:0:0:1                the loopback address
         0:0:0:0:0:0:0:0                the unspecified address

      may be represented as
         2001:DB8::8:800:200C:417A      a unicast address
         FF01::101                      a multicast address
         ::1                            the loopback address
         ::                             the unspecified address
  \end{verbatim}
›</span></span>
  <span class="comment1">(*datatype may take some minutes to load*)</span>
  <span class="keyword1"><span class="command">datatype</span></span> ipv6addr_syntax_compressed <span class="main">=</span>
  <span class="comment1">― ‹using <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">unit</span><span class="antiquote">}</span></span> for the omission <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"::"</span><span class="antiquote">}</span></span>. 

     Naming convention of the datatype: 
      The first number is the position where the omission occurs.
      The second number is the length of the specified address pieces.
        I.e. `8 minus the second number' pieces are omitted.›</span>
    IPv6AddrCompressed1_0 <span class="quoted">unit</span>
  <span class="main">|</span> IPv6AddrCompressed1_1 <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed1_2 <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed1_3 <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed1_4 <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> 
  <span class="main">|</span> IPv6AddrCompressed1_5 <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed1_6 <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed1_7 <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>

  <span class="main">|</span> IPv6AddrCompressed2_1 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span>
  <span class="main">|</span> IPv6AddrCompressed2_2 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed2_3 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed2_4 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed2_5 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed2_6 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed2_7 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>

  <span class="main">|</span> IPv6AddrCompressed3_2 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span>
  <span class="main">|</span> IPv6AddrCompressed3_3 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed3_4 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed3_5 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed3_6 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed3_7 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>

  <span class="main">|</span> IPv6AddrCompressed4_3 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span>
  <span class="main">|</span> IPv6AddrCompressed4_4 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed4_5 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed4_6 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed4_7 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>

  <span class="main">|</span> IPv6AddrCompressed5_4 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span>
  <span class="main">|</span> IPv6AddrCompressed5_5 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed5_6 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed5_7 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>

  <span class="main">|</span> IPv6AddrCompressed6_5 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span>
  <span class="main">|</span> IPv6AddrCompressed6_6 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>
  <span class="main">|</span> IPv6AddrCompressed6_7 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>

  <span class="main">|</span> IPv6AddrCompressed7_6 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span>
  <span class="main">|</span> IPv6AddrCompressed7_7 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span>

  <span class="main">|</span> IPv6AddrCompressed8_7 <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word"</span></span> <span class="quoted">unit</span>

  <span class="comment1">(*RFC 5952:
    """
    4.  A Recommendation for IPv6 Text Representation
    4.2.2.  Handling One 16-Bit 0 Field
       The symbol "::" MUST NOT be used to shorten just one 16-bit 0 field.
       For example, the representation 2001:db8:0:1:1:1:1:1 is correct, but
       2001:db8::1:1:1:1:1 is not correct.
    """

    So we could remove all IPv6AddrCompressed*_7 constructors.
    But these are `recommendations', we might still see these non-recommended definitions.
    "[...] all implementations must accept and be able to handle any legitimate RFC 4291 format."
  *)</span>

  <span class="comment1">(*More convenient parser helper function for compressed IPv6 addresses:
    Input list (from parser):
      Some 16word ⟶ address piece
      None ⟶ omission '::'
    
  
   Basically, the parser must only do the following (python syntax):
     split the string which is an ipv6 address at ':'
     map empty string to None
     map everything else to Some (string_to_16word str)
     sanitize empty strings at the start and the end (see toString and parser theories)
   Example:
     "1:2:3".split(":")  = ['1', '2', '3']
     ":2:3:4".split(":") = ['', '2', '3', '4']
     ":2::3".split(":")  = ['', '2', '', '3']
     "1:2:3:".split(":") = ['1', '2', '3', '']
  *)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">parse_ipv6_address_compressed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">16</span> word<span class="main">)</span> option<span class="main">)</span> list <span class="main">⇒</span> ipv6addr_syntax_compressed option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">parse_ipv6_address_compressed</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="keyword1">of</span> 
      <span class="main">[</span>None<span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed1_0 <span class="main">()</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="bound">a</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed1_1 <span class="main">()</span> <span class="bound">a</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed1_2 <span class="main">()</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed1_3 <span class="main">()</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed1_4 <span class="main">()</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed1_5 <span class="main">()</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed1_6 <span class="main">()</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">,</span> Some <span class="bound">g</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed1_7 <span class="main">()</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span>
  
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> None<span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed2_1 <span class="bound">a</span> <span class="main">()</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">b</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed2_2 <span class="bound">a</span> <span class="main">()</span> <span class="bound">b</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed2_3 <span class="bound">a</span> <span class="main">()</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed2_4 <span class="bound">a</span> <span class="main">()</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed2_5 <span class="bound">a</span> <span class="main">()</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed2_6 <span class="bound">a</span> <span class="main">()</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">,</span> Some <span class="bound">g</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed2_7 <span class="bound">a</span> <span class="main">()</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span>
  
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> None<span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed3_2 <span class="bound">a</span> <span class="bound">b</span> <span class="main">()</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">c</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed3_3 <span class="bound">a</span> <span class="bound">b</span> <span class="main">()</span> <span class="bound">c</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed3_4 <span class="bound">a</span> <span class="bound">b</span> <span class="main">()</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed3_5 <span class="bound">a</span> <span class="bound">b</span> <span class="main">()</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed3_6 <span class="bound">a</span> <span class="bound">b</span> <span class="main">()</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">,</span> Some <span class="bound">g</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed3_7 <span class="bound">a</span> <span class="bound">b</span> <span class="main">()</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span>
  
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> None<span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed4_3 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">()</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">d</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed4_4 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">()</span> <span class="bound">d</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed4_5 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">()</span> <span class="bound">d</span> <span class="bound">e</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed4_6 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">()</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">,</span> Some <span class="bound">g</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed4_7 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">()</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span>
  
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> None<span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed5_4 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">()</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">e</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed5_5 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">()</span> <span class="bound">e</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed5_6 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">()</span> <span class="bound">e</span> <span class="bound">f</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">,</span> Some <span class="bound">g</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed5_7 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">()</span> <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span>
  
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> None<span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed6_5 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="main">()</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">f</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed6_6 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="main">()</span> <span class="bound">f</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">f</span><span class="main">,</span> Some <span class="bound">g</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed6_7 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="main">()</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span>
  
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">,</span> None<span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed7_6 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span> <span class="main">()</span><span class="main">)</span>
    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">,</span> None<span class="main">,</span> Some <span class="bound">g</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed7_7 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span> <span class="main">()</span> <span class="bound">g</span><span class="main">)</span>

    <span class="main">|</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span> Some <span class="bound">b</span><span class="main">,</span> Some <span class="bound">c</span><span class="main">,</span> Some <span class="bound">d</span><span class="main">,</span> Some <span class="bound">e</span><span class="main">,</span> Some <span class="bound">f</span><span class="main">,</span> Some <span class="bound">g</span><span class="main">,</span> None<span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrCompressed8_7 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="main">()</span><span class="main">)</span>
    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None <span class="comment1">― ‹invalid ipv6 copressed address.›</span>
<span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">ipv6addr_syntax_compressed_to_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv6addr_syntax_compressed <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="numeral">16</span> word<span class="main">)</span> option<span class="main">)</span> list"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed1_0 <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>None<span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed1_1 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed1_2 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed1_3 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed1_4 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed1_5 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed1_6 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed1_7 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">]</span>"</span></span>
  
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed2_1 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> None<span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed2_2 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed2_3 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed2_4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed2_5 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed2_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed2_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">]</span>"</span></span>
  
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed3_2 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> None<span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed3_3 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed3_4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed3_5 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed3_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed3_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">]</span>"</span></span>
  
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed4_3 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> None<span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed4_4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed4_5 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed4_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed4_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">]</span>"</span></span>
  
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed5_4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> None<span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed5_5 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed5_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed5_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">]</span>"</span></span>
  
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed6_5 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> None<span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed6_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed6_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">]</span>"</span></span>
  
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed7_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> None<span class="main">]</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed7_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> None<span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">]</span>"</span></span>

    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_syntax_compressed_to_list</span> <span class="main">(</span>IPv6AddrCompressed8_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">[</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> Some <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span> None<span class="main">]</span>"</span></span>


<span class="comment1">(*for all ipv6_syntax, there is a corresponding list representation*)</span>
<span class="keyword1" id="IPv6-parse_ipv6_address_compressed_exists"><span class="command">lemma</span></span> parse_ipv6_address_compressed_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ss</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"parse_ipv6_address_compressed <span class="free">ss</span> <span class="main">=</span> Some <span class="free">ipv6_syntax</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span> <span class="main">=</span> ipv6addr_syntax_compressed_to_list <span class="free">ipv6_syntax</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"parse_ipv6_address_compressed <span class="skolem">ss</span> <span class="main">=</span> Some <span class="free">ipv6_syntax</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ipv6_syntax</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> parse_ipv6_address_compressed_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IPv6-parse_ipv6_address_compressed_identity"><span class="command">lemma</span></span> parse_ipv6_address_compressed_identity<span class="main">:</span>
      <span class="quoted"><span class="quoted">"parse_ipv6_address_compressed <span class="main">(</span>ipv6addr_syntax_compressed_to_list <span class="main">(</span><span class="free">ipv6_syntax</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ipv6_syntax</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ipv6_syntax</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> parse_ipv6_address_compressed_def<span class="main">)</span>


<span class="keyword1" id="IPv6-parse_ipv6_address_compressed_someE"><span class="command">lemma</span></span> parse_ipv6_address_compressed_someE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"parse_ipv6_address_compressed <span class="free">as</span> <span class="main">=</span> Some <span class="free">ipv6</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed1_0 <span class="main">()</span><span class="main">)</span>"</span></span>  <span class="main">|</span>
    <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="free">a</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed1_1 <span class="main">()</span> <span class="free">a</span><span class="main">)</span>"</span></span>  <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed1_2 <span class="main">()</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>  <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed1_3 <span class="main">()</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed1_4 <span class="main">()</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed1_5 <span class="main">()</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed1_6 <span class="main">()</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">,</span> Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">,</span> Some <span class="free">g</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed1_7 <span class="main">()</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  
    <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> None<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed2_1 <span class="free">a</span> <span class="main">()</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">b</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed2_2 <span class="free">a</span> <span class="main">()</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed2_3 <span class="free">a</span> <span class="main">()</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed2_4 <span class="free">a</span> <span class="main">()</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed2_5 <span class="free">a</span> <span class="main">()</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed2_6 <span class="free">a</span> <span class="main">()</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">,</span> Some <span class="free">g</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed2_7 <span class="free">a</span> <span class="main">()</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  
    <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> None<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed3_2 <span class="free">a</span> <span class="free">b</span> <span class="main">()</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">c</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed3_3 <span class="free">a</span> <span class="free">b</span> <span class="main">()</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed3_4 <span class="free">a</span> <span class="free">b</span> <span class="main">()</span> <span class="free">c</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed3_5 <span class="free">a</span> <span class="free">b</span> <span class="main">()</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed3_6 <span class="free">a</span> <span class="free">b</span> <span class="main">()</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">,</span> Some <span class="free">g</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed3_7 <span class="free">a</span> <span class="free">b</span> <span class="main">()</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> None<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed4_3 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">()</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">d</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed4_4 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">()</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed4_5 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">()</span> <span class="free">d</span> <span class="free">e</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed4_6 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">()</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">,</span> Some <span class="free">g</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed4_7 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">()</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> None<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed5_4 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">()</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed5_5 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">()</span> <span class="free">e</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed5_6 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">()</span> <span class="free">e</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">,</span> Some <span class="free">g</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed5_7 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">()</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> None<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed6_5 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="main">()</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">f</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed6_6 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="main">()</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">f</span><span class="main">,</span> Some <span class="free">g</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed6_7 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="main">()</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">,</span> None<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed7_6 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="main">()</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">,</span> None<span class="main">,</span> Some <span class="free">g</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed7_7 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="main">()</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span>

    <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">=</span> <span class="main">[</span>Some <span class="free">a</span><span class="main">,</span> Some <span class="free">b</span><span class="main">,</span> Some <span class="free">c</span><span class="main">,</span> Some <span class="free">d</span><span class="main">,</span> Some <span class="free">e</span><span class="main">,</span> Some <span class="free">f</span><span class="main">,</span> Some <span class="free">g</span><span class="main">,</span> None<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipv6</span> <span class="main">=</span> <span class="main">(</span>IPv6AddrCompressed8_7 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="main">()</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">unfolding</span></span> parse_ipv6_address_compressed_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.split_asm option.split_asm<span class="main">)</span> <span class="comment1">(* takes a minute *)</span>

<span class="keyword1" id="IPv6-parse_ipv6_address_compressed_identity2"><span class="command">lemma</span></span> parse_ipv6_address_compressed_identity2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"ipv6addr_syntax_compressed_to_list <span class="free">ipv6_syntax</span> <span class="main">=</span> <span class="free">ls</span> <span class="main">⟷</span>
        <span class="main">(</span>parse_ipv6_address_compressed <span class="free">ls</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ipv6_syntax</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> parse_ipv6_address_compressed_someE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ipv6_syntax</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parse_ipv6_address_compressed_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Valid IPv6 compressed notation:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> at most one omission
  <span class="antiquoted"><span class="antiquoted">▪</span></span> at most 7 pieces
›</span></span>
<span class="keyword1" id="IPv6-RFC_4291_format"><span class="command">lemma</span></span> RFC_4291_format<span class="main">:</span> <span class="quoted"><span class="quoted">"parse_ipv6_address_compressed <span class="free">as</span> <span class="main">≠</span> None <span class="main">⟷</span>
       length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">=</span> None<span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> None<span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">7</span>"</span></span>
       <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">addr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"parse_ipv6_address_compressed <span class="free">as</span> <span class="main">=</span> Some <span class="skolem">addr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> parse_ipv6_address_compressed_someE<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> parse_ipv6_address_compressed_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split list.split if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text_raw</span></span><span class="quoted"><span class="plain_text">‹
  \begin{verbatim}
  3. An alternative form that is sometimes more convenient when dealing
      with a mixed environment of IPv4 and IPv6 nodes is
      x:x:x:x:x:x:d.d.d.d, where the 'x's are the hexadecimal values of
      the six high-order 16-bit pieces of the address, and the 'd's are
      the decimal values of the four low-order 8-bit pieces of the
      address (standard IPv4 representation).  Examples:

         0:0:0:0:0:0:13.1.68.3
         0:0:0:0:0:FFFF:129.144.52.38

      or in compressed form:

         ::13.1.68.3
         ::FFFF:129.144.52.38
  \end{verbatim}

  This is currently not supported by our library!
›</span></span>
  <span class="comment1">(*TODO*)</span>
  <span class="comment1">(*TODO: oh boy, they can also be compressed*)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Semantics›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">ipv6preferred_to_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv6addr_syntax <span class="main">⇒</span> ipv6addr"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipv6preferred_to_int</span> <span class="main">(</span>IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ucast <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">16</span> <span class="main">*</span> <span class="numeral">7</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">OR</span>
                                                                <span class="main">(</span>ucast <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">16</span> <span class="main">*</span> <span class="numeral">6</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">OR</span>
                                                                <span class="main">(</span>ucast <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">16</span> <span class="main">*</span> <span class="numeral">5</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">OR</span>
                                                                <span class="main">(</span>ucast <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">16</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">OR</span>
                                                                <span class="main">(</span>ucast <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">16</span> <span class="main">*</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">OR</span>
                                                                <span class="main">(</span>ucast <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">16</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">OR</span>
                                                                <span class="main">(</span>ucast <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">16</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">OR</span>
                                                                <span class="main">(</span>ucast <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">&lt;&lt;</span> <span class="main">(</span><span class="numeral">16</span> <span class="main">*</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6preferred_to_int <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0xDB8</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x8</span> <span class="numeral">0x800</span> <span class="numeral">0x200C</span> <span class="numeral">0x417A</span><span class="main">)</span> <span class="main">=</span> 
          <span class="numeral">42540766411282592856906245548098208122</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6preferred_to_int <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0xFF01</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x101</span><span class="main">)</span> <span class="main">=</span> 
          <span class="numeral">338958331222012082418099330867817087233</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">declare</span></span> ipv6preferred_to_int.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">int_to_ipv6preferred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv6addr <span class="main">⇒</span> ipv6addr_syntax"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">int_to_ipv6preferred</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> IPv6AddrPreferred <span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF0000000000000000000000000000</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="numeral">16</span><span class="main">*</span><span class="numeral">7</span><span class="main">)</span><span class="main">)</span>
                                                <span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF000000000000000000000000</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="numeral">16</span><span class="main">*</span><span class="numeral">6</span><span class="main">)</span><span class="main">)</span>
                                                <span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF00000000000000000000</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="numeral">16</span><span class="main">*</span><span class="numeral">5</span><span class="main">)</span><span class="main">)</span>
                                                <span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF0000000000000000</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="numeral">16</span><span class="main">*</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span>
                                                <span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF000000000000</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="numeral">16</span><span class="main">*</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span>
                                                <span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF00000000</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="numeral">16</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                                                <span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF0000</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="numeral">16</span><span class="main">*</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>
                                                <span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"int_to_ipv6preferred <span class="numeral">42540766411282592856906245548098208122</span> <span class="main">=</span>
         IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0xDB8</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x8</span> <span class="numeral">0x800</span> <span class="numeral">0x200C</span> <span class="numeral">0x417A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1" id="IPv6-word128_masks_ipv6pieces"><span class="command">lemma</span></span> word128_masks_ipv6pieces<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0xFFFF0000000000000000000000000000</span><span class="main">::</span>ipv6addr<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mask <span class="numeral">16</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">112</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0xFFFF000000000000000000000000</span><span class="main">::</span>ipv6addr<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mask <span class="numeral">16</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">96</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0xFFFF00000000000000000000</span><span class="main">::</span>ipv6addr<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mask <span class="numeral">16</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">80</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0xFFFF0000000000000000</span><span class="main">::</span>ipv6addr<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mask <span class="numeral">16</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">64</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0xFFFF000000000000</span><span class="main">::</span>ipv6addr<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mask <span class="numeral">16</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">48</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0xFFFF00000000</span><span class="main">::</span>ipv6addr<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mask <span class="numeral">16</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">32</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0xFFFF0000</span><span class="main">::</span>ipv6addr<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mask <span class="numeral">16</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">16</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0xFFFF</span><span class="main">::</span>ipv6addr<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mask <span class="numeral">16</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mask_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correctness: round trip property one›</span></span>
  <span class="keyword1" id="IPv6-ipv6preferred_to_int_int_to_ipv6preferred"><span class="command">lemma</span></span> ipv6preferred_to_int_int_to_ipv6preferred<span class="main">:</span>
    <span class="quoted"><span class="quoted">"ipv6preferred_to_int <span class="main">(</span>int_to_ipv6preferred <span class="free">ip</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> and_mask_shift_helper<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">AND</span> <span class="main">(</span>mask <span class="skolem">m</span> <span class="main">&lt;&lt;</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="skolem">n</span> <span class="main">&lt;&lt;</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">w</span> <span class="keyword1">AND</span> <span class="main">(</span>mask <span class="skolem">m</span> <span class="main">&lt;&lt;</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">w</span><span class="main">::</span><span class="quoted">ipv6addr</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_aligned_shift is_aligned_shiftr_shiftl shiftr_and_eq_shiftl<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ucast_ipv6_piece_rule<span class="main">:</span>
      <span class="quoted"><span class="quoted">"length <span class="main">(</span>dropWhile Not <span class="main">(</span>to_bl <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">16</span> <span class="main">⟹</span> <span class="main">(</span>ucast<span class="main">::</span><span class="numeral">16</span> word <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span><span class="numeral">128</span> word <span class="main">⇒</span> <span class="numeral">16</span> word<span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">w</span><span class="main">::</span><span class="quoted">ipv6addr</span> 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> ucast_short_ucast_long_ingoreLeadingZero<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ucast_ipv6_piece<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> <span class="main">≤</span> <span class="numeral">128</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">⟹</span> 
      <span class="main">(</span>ucast<span class="main">::</span><span class="numeral">16</span> word <span class="main">⇒</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span><span class="numeral">128</span> word <span class="main">⇒</span> <span class="numeral">16</span> word<span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="keyword1">AND</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;&gt;</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">w</span> <span class="keyword1">AND</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">w</span><span class="main">::</span><span class="quoted">ipv6addr</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> ucast_ipv6_piece_rule<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> length_drop_mask_inner<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> and_mask_shift_helper<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword1"><span class="command">have</span></span> ucast16_ucast128_masks_highest_bits<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span>ipv6addr <span class="main">⇒</span> <span class="numeral">16</span> word<span class="main">)</span> <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF0000000000000000000000000000</span> <span class="main">&gt;&gt;</span> <span class="numeral">112</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">112</span><span class="main">)</span> <span class="main">=</span> 
             <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF0000000000000000000000000000</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span>ipv6addr <span class="main">⇒</span> <span class="numeral">16</span> word<span class="main">)</span> <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF000000000000000000000000</span> <span class="main">&gt;&gt;</span> <span class="numeral">96</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">96</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF000000000000000000000000</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span>ipv6addr <span class="main">⇒</span> <span class="numeral">16</span> word<span class="main">)</span> <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF00000000000000000000</span> <span class="main">&gt;&gt;</span> <span class="numeral">80</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">80</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF00000000000000000000</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span>ipv6addr <span class="main">⇒</span> <span class="numeral">16</span> word<span class="main">)</span> <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF0000000000000000</span> <span class="main">&gt;&gt;</span> <span class="numeral">64</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">64</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF0000000000000000</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span>ipv6addr <span class="main">⇒</span> <span class="numeral">16</span> word<span class="main">)</span> <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF000000000000</span> <span class="main">&gt;&gt;</span> <span class="numeral">48</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">48</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF000000000000</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span>ipv6addr <span class="main">⇒</span> <span class="numeral">16</span> word<span class="main">)</span> <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF00000000</span> <span class="main">&gt;&gt;</span> <span class="numeral">32</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">32</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF00000000</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span>ipv6addr <span class="main">⇒</span> <span class="numeral">16</span> word<span class="main">)</span> <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF0000</span> <span class="main">&gt;&gt;</span> <span class="numeral">16</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="numeral">16</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF0000</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="main">(</span><span class="operator">subst</span> word128_masks_ipv6pieces<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ucast_ipv6_piece<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">have</span></span> ucast16_ucast128_masks_highest_bits0<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>ucast <span class="main">(</span><span class="main">(</span>ucast<span class="main">::</span>ipv6addr <span class="main">⇒</span> <span class="numeral">16</span> word<span class="main">)</span> <span class="main">(</span><span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip</span> <span class="keyword1">AND</span> <span class="numeral">0xFFFF</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> word128_masks_ipv6pieces<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> ucast_short_ucast_long_ingoreLeadingZero<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_drop_mask<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> mask_len_word<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">w</span> <span class="keyword1">AND</span> mask <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">w</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mask_eq_iff<span class="main">)</span> 

    <span class="keyword1"><span class="command">have</span></span> ipv6addr_16word_pieces_compose_or<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="free">ip</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="numeral">112</span><span class="main">)</span> <span class="main">||</span>
             <span class="free">ip</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="numeral">96</span><span class="main">)</span> <span class="main">||</span>
             <span class="free">ip</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="numeral">80</span><span class="main">)</span> <span class="main">||</span>
             <span class="free">ip</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="numeral">64</span><span class="main">)</span> <span class="main">||</span>
             <span class="free">ip</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="numeral">48</span><span class="main">)</span> <span class="main">||</span>
             <span class="free">ip</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="numeral">32</span><span class="main">)</span> <span class="main">||</span>
             <span class="free">ip</span> <span class="main">&amp;&amp;</span> <span class="main">(</span>mask <span class="numeral">16</span> <span class="main">&lt;&lt;</span> <span class="numeral">16</span><span class="main">)</span> <span class="main">||</span>
             <span class="free">ip</span> <span class="main">&amp;&amp;</span> mask <span class="numeral">16</span> <span class="main">=</span>
             <span class="free">ip</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> word_ao_dist2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mask_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mask128<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> mask_len_word<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6preferred_to_int.simps int_to_ipv6preferred_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ucast16_ucast128_masks_highest_bits ucast16_ucast128_masks_highest_bits0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word128_masks_ipv6pieces<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ipv6addr_16word_pieces_compose_or<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correctness: round trip property two›</span></span>
  <span class="keyword1" id="IPv6-int_to_ipv6preferred_ipv6preferred_to_int"><span class="command">lemma</span></span> int_to_ipv6preferred_ipv6preferred_to_int<span class="main">:</span> <span class="quoted"><span class="quoted">"int_to_ipv6preferred <span class="main">(</span>ipv6preferred_to_int <span class="free">ip</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> ucast_shift_simps<span class="main">=</span>helper_masked_ucast_generic helper_masked_ucast_reverse_generic
                           helper_masked_ucast_generic<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
                           helper_masked_ucast_equal_generic 
    <span class="keyword1"><span class="command">note</span></span> ucast_simps<span class="main">=</span>helper_masked_ucast_reverse_generic<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
                     helper_masked_ucast_equal_generic<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ip</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b c d e f g h<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6preferred_to_int.simps int_to_ipv6preferred_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word128_masks_ipv6pieces<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_ao_dist ucast_shift_simps ucast_simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹compressed to preferred format›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ipv6addr_c2p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv6addr_syntax_compressed <span class="main">⇒</span> ipv6addr_syntax"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed1_0 <span class="main">()</span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed1_1 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed1_2 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed1_3 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed1_4 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed1_5 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed1_6 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed1_7 <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>

  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed2_1 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed2_2 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed2_3 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed2_4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed2_5 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed2_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed2_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>

  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed3_2 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed3_3 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed3_4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed3_5 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed3_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed3_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>

  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed4_3 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed4_4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed4_5 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed4_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed4_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>

  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed5_4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed5_5 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed5_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed5_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>

  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed6_5 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed6_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">0</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed6_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>

  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed7_6 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed7_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">()</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span>"</span></span>

  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_c2p</span> <span class="main">(</span>IPv6AddrCompressed8_7 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">()</span><span class="main">)</span> <span class="main">=</span> IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">0</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipv6_unparsed_compressed_to_preferred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">16</span> word<span class="main">)</span> option<span class="main">)</span> list <span class="main">⇒</span> ipv6addr_syntax option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ipv6_unparsed_compressed_to_preferred</span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span>
      length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">=</span> None<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">∨</span> length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> None<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">7</span>
    <span class="keyword1">then</span>
      None
    <span class="keyword1">else</span>
      <span class="keyword1">let</span>
        <span class="bound">before_omission</span> <span class="main">=</span> map the <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">)</span><span class="main">;</span>
        <span class="bound">after_omission</span> <span class="main">=</span> map the <span class="main">(</span>drop <span class="main">1</span> <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> None<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">num_omissions</span> <span class="main">=</span> <span class="numeral">8</span> <span class="main">-</span> <span class="main">(</span>length <span class="bound">before_omission</span> <span class="main">+</span> length <span class="bound">after_omission</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">expanded</span> <span class="main">=</span> <span class="bound">before_omission</span> <span class="main">@</span> <span class="main">(</span>replicate <span class="bound">num_omissions</span> <span class="main">0</span><span class="main">)</span> <span class="main">@</span> <span class="bound">after_omission</span>
      <span class="keyword1">in</span>
        <span class="keyword1">case</span> <span class="bound">expanded</span> <span class="keyword1">of</span> <span class="main">[</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">f</span><span class="main">,</span><span class="bound">g</span><span class="main">,</span><span class="bound">h</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrPreferred <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="bound">h</span><span class="main">)</span>
                         <span class="main">|</span> <span class="main"><span class="bound">_</span></span>               <span class="main">⇒</span> None
      <span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6_unparsed_compressed_to_preferred
    <span class="main">[</span>Some <span class="numeral">0x2001</span><span class="main">,</span> Some <span class="numeral">0xDB8</span><span class="main">,</span> None<span class="main">,</span> Some <span class="numeral">0x8</span><span class="main">,</span> Some <span class="numeral">0x800</span><span class="main">,</span> Some <span class="numeral">0x200C</span><span class="main">,</span> Some <span class="numeral">0x417A</span><span class="main">]</span>
      <span class="main">=</span> Some <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0xDB8</span> <span class="main">0</span> <span class="main">0</span> <span class="numeral">8</span> <span class="numeral">0x800</span> <span class="numeral">0x200C</span> <span class="numeral">0x417A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6_unparsed_compressed_to_preferred <span class="main">[</span>None<span class="main">]</span> <span class="main">=</span> Some <span class="main">(</span>IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6_unparsed_compressed_to_preferred <span class="main">[]</span> <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


  <span class="keyword1" id="IPv6-ipv6_unparsed_compressed_to_preferred_identity1"><span class="command">lemma</span></span> ipv6_unparsed_compressed_to_preferred_identity1<span class="main">:</span>
   <span class="quoted"><span class="quoted">"ipv6_unparsed_compressed_to_preferred <span class="main">(</span>ipv6addr_syntax_compressed_to_list <span class="free">ipv6compressed</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ipv6prferred</span>
    <span class="main">⟷</span> ipv6addr_c2p <span class="free">ipv6compressed</span> <span class="main">=</span> <span class="free">ipv6prferred</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ipv6compressed</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_unparsed_compressed_to_preferred_def numeral_eq_Suc<span class="main">)</span> <span class="comment1">(*1s*)</span>
 
  <span class="keyword1" id="IPv6-ipv6_unparsed_compressed_to_preferred_identity2"><span class="command">lemma</span></span> ipv6_unparsed_compressed_to_preferred_identity2<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"ipv6_unparsed_compressed_to_preferred <span class="free">ls</span> <span class="main">=</span> Some <span class="free">ipv6prferred</span>
     <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ipv6compressed</span><span class="main">.</span> parse_ipv6_address_compressed <span class="free">ls</span> <span class="main">=</span> Some <span class="bound">ipv6compressed</span> <span class="main">∧</span>
                           ipv6addr_c2p <span class="bound">ipv6compressed</span> <span class="main">=</span> <span class="free">ipv6prferred</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"parse_ipv6_address_compressed <span class="free">ls</span> <span class="main">≠</span> None"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> RFC_4291_format<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_unparsed_compressed_to_preferred_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> ipv6compressed<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ipv6compressed</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv6addr_syntax_compressed_to_list <span class="improper">ipv6compressed</span> <span class="main">=</span> <span class="free">ls</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
    <span class="keyword1"><span class="command">using</span></span> parse_ipv6_address_compressed_identity2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">presburger</span>
   <span class="keyword1"><span class="command">using</span></span> ipv6_unparsed_compressed_to_preferred_identity1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> ipv6compressed<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv6addr_syntax_compressed_to_list <span class="improper">ipv6compressed</span> <span class="main">=</span> <span class="free">ls</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command">using</span></span> parse_ipv6_address_compressed_identity2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">using</span></span> ipv6_unparsed_compressed_to_preferred_identity1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹IPv6 Pretty Printing (converting to compressed format)›</span></span>
<span class="keyword1"><span class="command">text_raw</span></span><span class="quoted"><span class="plain_text">‹
RFC5952:
\begin{verbatim}
4.  A Recommendation for IPv6 Text Representation

   A recommendation for a canonical text representation format of IPv6
   addresses is presented in this section.  The recommendation in this
   document is one that complies fully with [RFC4291], is implemented by
   various operating systems, and is human friendly.  The recommendation
   in this section SHOULD be followed by systems when generating an
   address to be represented as text, but all implementations MUST
   accept and be able to handle any legitimate [RFC4291] format.  It is
   advised that humans also follow these recommendations when spelling
   an address.

4.1.  Handling Leading Zeros in a 16-Bit Field

   Leading zeros MUST be suppressed.  For example, 2001:0db8::0001 is
   not acceptable and must be represented as 2001:db8::1.  A single 16-
   bit 0000 field MUST be represented as 0.

4.2.  "::" Usage

4.2.1.  Shorten as Much as Possible

   The use of the symbol "::" MUST be used to its maximum capability.
   For example, 2001:db8:0:0:0:0:2:1 must be shortened to 2001:db8::2:1.
   Likewise, 2001:db8::0:1 is not acceptable, because the symbol "::"
   could have been used to produce a shorter representation 2001:db8::1.

4.2.2.  Handling One 16-Bit 0 Field

   The symbol "::" MUST NOT be used to shorten just one 16-bit 0 field.
   For example, the representation 2001:db8:0:1:1:1:1:1 is correct, but
   2001:db8::1:1:1:1:1 is not correct.

4.2.3.  Choice in Placement of "::"

   When there is an alternative choice in the placement of a "::", the
   longest run of consecutive 16-bit 0 fields MUST be shortened (i.e.,
   the sequence with three consecutive zero fields is shortened in 2001:
   0:0:1:0:0:0:1).  When the length of the consecutive 16-bit 0 fields
   are equal (i.e., 2001:db8:0:0:1:0:0:1), the first sequence of zero
   bits MUST be shortened.  For example, 2001:db8::1:0:0:1 is correct
   representation.

4.3.  Lowercase

   The characters "a", "b", "c", "d", "e", and "f" in an IPv6 address
   MUST be represented in lowercase.
\end{verbatim}
›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹See <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹IP_Address_toString.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span> for examples and test cases.›</span></span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">function</span></span> <span class="entity">goup_by_zeros</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word list <span class="main">⇒</span> <span class="numeral">16</span> word list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">goup_by_zeros</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">goup_by_zeros</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
        <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span>
        <span class="keyword1">then</span> takeWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">goup_by_zeros</span> <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1">else</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">#</span><span class="main">(</span><span class="free">goup_by_zeros</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">pat_completeness</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">termination</span></span> <span class="quoted">goup_by_zeros</span>
	 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span><span class="main">)</span>"</span></span><span class="main">)</span>
	   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
	 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_imp_less_Suc length_dropWhile_le<span class="main">)</span>
	
	<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"goup_by_zeros <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span>
	        <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
	<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
	
	<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>goup_by_zeros <span class="free">ls</span><span class="main">)</span> <span class="main">=</span> <span class="free">ls</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>goup_by_zeros.induct<span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
	
	<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∉</span> set <span class="main">(</span>goup_by_zeros <span class="free">ls</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>goup_by_zeros.induct<span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
	  
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">List_replace1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">List_replace1</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">List_replace1</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free">List_replace1</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
    
	<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"List_replace1 <span class="free">a</span> <span class="free">a</span> <span class="free">ls</span> <span class="main">=</span> <span class="free">ls</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span><span class="main">)</span> <span class="operator">simp_all</span>
	
	<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> set <span class="free">ls</span> <span class="main">⟹</span> List_replace1 <span class="free">a</span> <span class="free">b</span> <span class="free">ls</span> <span class="main">=</span> <span class="free">ls</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span><span class="main">)</span> <span class="operator">simp_all</span>
	
	<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">ls</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>List_replace1 <span class="free">a</span> <span class="free">b</span> <span class="free">ls</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ls</span></span><span class="main">)</span>
	   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
	  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
	  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
	<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">List_explode</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
	  <span class="quoted"><span class="quoted">"<span class="free">List_explode</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
	  <span class="quoted"><span class="quoted">"<span class="free">List_explode</span> <span class="main">(</span><span class="main">[]</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> None<span class="main">#</span><span class="free">List_explode</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span> <span class="main">|</span>
	  <span class="quoted"><span class="quoted">"<span class="free">List_explode</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs2</span></span></span><span class="main">)</span> <span class="main">=</span> map Some <span class="free"><span class="bound"><span class="entity">xs1</span></span></span><span class="main">@</span><span class="free">List_explode</span> <span class="free"><span class="bound"><span class="entity">xs2</span></span></span>"</span></span>
	  
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"List_explode <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">::</span>int<span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span>Some <span class="main">0</span><span class="main">,</span> Some <span class="numeral">2</span><span class="main">,</span> Some <span class="numeral">3</span><span class="main">,</span> None<span class="main">,</span> Some <span class="numeral">3</span><span class="main">,</span> Some <span class="numeral">4</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="IPv6-List_explode_def"><span class="command">lemma</span></span> List_explode_def<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"List_explode <span class="free">xss</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">[</span>None<span class="main">]</span> <span class="keyword1">else</span> map Some <span class="bound">xs</span><span class="main">)</span> <span class="free">xss</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xss</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List_explode.induct<span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
	  
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="IPv6-List_explode_no_empty"><span class="command">lemma</span></span> List_explode_no_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∉</span> set <span class="free">xss</span> <span class="main">⟹</span> List_explode <span class="free">xss</span> <span class="main">=</span> map Some <span class="main">(</span>concat <span class="free">xss</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xss</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List_explode.induct<span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="IPv6-List_explode_replace1"><span class="command">lemma</span></span> List_explode_replace1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∉</span> set <span class="free">xss</span> <span class="main">⟹</span> <span class="free">foo</span> <span class="main">∈</span> set <span class="free">xss</span> <span class="main">⟹</span>
          List_explode <span class="main">(</span>List_replace1 <span class="free">foo</span> <span class="main">[]</span> <span class="free">xss</span><span class="main">)</span> <span class="main">=</span>
            map Some <span class="main">(</span>concat <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">≠</span> <span class="free">foo</span><span class="main">)</span> <span class="free">xss</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>None<span class="main">]</span> <span class="main">@</span>
              map Some <span class="main">(</span>concat <span class="main">(</span>tl <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">≠</span> <span class="free">foo</span><span class="main">)</span> <span class="free">xss</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xss</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List_explode.induct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List_explode_no_empty<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">ipv6_preferred_to_compressed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv6addr_syntax <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="numeral">16</span> word<span class="main">)</span> option<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ipv6_preferred_to_compressed</span> <span class="main">(</span>IPv6AddrPreferred <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">lss</span> <span class="main">=</span> goup_by_zeros <span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">]</span><span class="main">;</span>
        <span class="bound">max_zero_seq</span> <span class="main">=</span> foldr <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> max <span class="main">(</span>length <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="bound">lss</span> <span class="main">0</span><span class="main">;</span>
        <span class="bound">shortened</span> <span class="main">=</span> <span class="keyword1">if</span> <span class="bound">max_zero_seq</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="keyword1">then</span> List_replace1 <span class="main">(</span>replicate <span class="bound">max_zero_seq</span> <span class="main">0</span><span class="main">)</span> <span class="main">[]</span> <span class="bound">lss</span> <span class="keyword1">else</span> <span class="bound">lss</span>
    <span class="keyword1">in</span>
      List_explode <span class="bound">shortened</span>
    <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">declare</span></span> ipv6_preferred_to_compressed.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="IPv6-foldr_max_length"><span class="command">lemma</span></span> foldr_max_length<span class="main">:</span> <span class="quoted"><span class="quoted">"foldr <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> max <span class="main">(</span>length <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">lss</span> <span class="free">n</span> <span class="main">=</span> fold max <span class="main">(</span>map length <span class="free">lss</span><span class="main">)</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> List.foldr_fold<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">lss</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="IPv6-List_explode_goup_by_zeros"><span class="command">lemma</span></span> List_explode_goup_by_zeros<span class="main">:</span> <span class="quoted"><span class="quoted">"List_explode <span class="main">(</span>goup_by_zeros <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> map Some <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> goup_by_zeros.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> map_append takeWhile_dropWhile_id<span class="main">)</span>
  
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">max_zero_streak</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> foldr <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> max <span class="main">(</span>length <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>goup_by_zeros <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">0</span>"</span></span>    

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="IPv6-max_zero_streak_def2"><span class="command">lemma</span></span> max_zero_streak_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"max_zero_streak <span class="free">xs</span> <span class="main">=</span> fold max <span class="main">(</span>map length <span class="main">(</span>goup_by_zeros <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> max_zero_streak_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foldr_max_length<span class="main">)</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="IPv6-ipv6_preferred_to_compressed_pull_out_if"><span class="command">lemma</span></span> ipv6_preferred_to_compressed_pull_out_if<span class="main">:</span>
    <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> max_zero_streak <span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="free">g</span><span class="main">,</span><span class="free">h</span><span class="main">]</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="keyword1">then</span>
      List_explode <span class="main">(</span>List_replace1 <span class="main">(</span>replicate <span class="main">(</span>max_zero_streak <span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="free">g</span><span class="main">,</span><span class="free">h</span><span class="main">]</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>goup_by_zeros <span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="free">g</span><span class="main">,</span><span class="free">h</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span>
      map Some <span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="free">g</span><span class="main">,</span><span class="free">h</span><span class="main">]</span>
    <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_preferred_to_compressed.simps max_zero_streak_def List_explode_goup_by_zeros<span class="main">)</span>

    
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>None<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0xDB8</span> <span class="main">0</span> <span class="main">0</span> <span class="numeral">8</span> <span class="numeral">0x800</span> <span class="numeral">0x200C</span> <span class="numeral">0x417A</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">[</span>Some <span class="numeral">0x2001</span><span class="main">,</span> Some <span class="numeral">0xDB8</span><span class="main">,</span> None<span class="main">,</span>           Some <span class="numeral">8</span><span class="main">,</span> Some <span class="numeral">0x800</span><span class="main">,</span> Some <span class="numeral">0x200C</span><span class="main">,</span> Some <span class="numeral">0x417A</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0xDB8</span> <span class="main">0</span> <span class="numeral">3</span> <span class="numeral">8</span> <span class="numeral">0x800</span> <span class="numeral">0x200C</span> <span class="numeral">0x417A</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">[</span>Some <span class="numeral">0x2001</span><span class="main">,</span> Some <span class="numeral">0xDB8</span><span class="main">,</span> Some <span class="main">0</span><span class="main">,</span> Some <span class="numeral">3</span><span class="main">,</span> Some <span class="numeral">8</span><span class="main">,</span> Some <span class="numeral">0x800</span><span class="main">,</span> Some <span class="numeral">0x200C</span><span class="main">,</span> Some <span class="numeral">0x417A</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="comment1">(*the output should even conform to RFC5952, ...*)</span>
  <span class="keyword1" id="IPv6-ipv6_preferred_to_compressed_RFC_4291_format"><span class="command">lemma</span></span> ipv6_preferred_to_compressed_RFC_4291_format<span class="main">:</span>
    <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="free">ip</span> <span class="main">=</span> <span class="free">as</span> <span class="main">⟹</span> 
          length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">=</span> None<span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> length <span class="free">as</span> <span class="main">=</span> <span class="numeral">8</span>
          <span class="main">∨</span>
          length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">=</span> None<span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> None<span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">7</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ip</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_preferred_to_compressed_pull_out_if<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b c d e f g h
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span>
         <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_zero_streak_def<span class="main">)</span> <span class="comment1">(*1min*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="comment1">― ‹Idea for the following proof:›</span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="free">f</span> <span class="free">g</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> None<span class="main">#</span><span class="free">xs</span> <span class="main">⟹</span>
      <span class="free">xs</span> <span class="main">=</span> map Some <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="free">g</span><span class="main">,</span><span class="free">h</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free"><span class="free">c</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">d</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">f</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">g</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">h</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_preferred_to_compressed_pull_out_if max_zero_streak_def<span class="main">)</span> <span class="comment1">(*20s*)</span>


 
  <span class="keyword1" id="IPv6-ipv6_preferred_to_compressed"><span class="command">lemma</span></span> ipv6_preferred_to_compressed<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ipv6_unparsed_compressed_to_preferred <span class="main">(</span>ipv6_preferred_to_compressed <span class="free">ip</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ip'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ip</span> <span class="main">=</span> <span class="free">ip'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ipv6compressed</span><span class="main">.</span>
         parse_ipv6_address_compressed <span class="main">(</span>ipv6_preferred_to_compressed <span class="free">ip</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">ipv6compressed</span> <span class="main">∧</span>
         ipv6addr_c2p <span class="bound">ipv6compressed</span> <span class="main">=</span> <span class="free">ip'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ipv6_unparsed_compressed_to_preferred_identity2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> ip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ip</span> <span class="main">=</span> IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ip</span></span><span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> ipv6_preferred_to_compressed_None1<span class="main">:</span>
      <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> None<span class="main">#</span><span class="skolem">xs</span> <span class="main">⟹</span>
        <span class="main">(</span>map Some <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">f</span><span class="main">,</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">⟹</span> <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xs</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_preferred_to_compressed_pull_out_if max_zero_streak_def<span class="main">)</span> <span class="comment1">(*5s*)</span>
    <span class="keyword1"><span class="command">have</span></span> ipv6_preferred_to_compressed_None2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Some <span class="skolem">a'</span><span class="main">)</span><span class="main">#</span>None<span class="main">#</span><span class="skolem">xs</span> <span class="main">⟹</span>
        <span class="main">(</span>map Some <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">f</span><span class="main">,</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">⟹</span> <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a'</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xs</span> <span class="skolem">a'</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_preferred_to_compressed_pull_out_if max_zero_streak_def<span class="main">)</span> <span class="comment1">(*5s*)</span>
    <span class="keyword1"><span class="command">have</span></span> ipv6_preferred_to_compressed_None3<span class="main">:</span>
      <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Some <span class="skolem">a'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">b'</span><span class="main">)</span><span class="main">#</span>None<span class="main">#</span><span class="skolem">xs</span> <span class="main">⟹</span>
        <span class="main">(</span>map Some <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">f</span><span class="main">,</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">⟹</span> <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xs</span> <span class="skolem">a'</span> <span class="skolem">b'</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_preferred_to_compressed_pull_out_if max_zero_streak_def<span class="main">)</span> <span class="comment1">(*5s*)</span>
    <span class="keyword1"><span class="command">have</span></span> ipv6_preferred_to_compressed_None4<span class="main">:</span>
      <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Some <span class="skolem">a'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">b'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">c'</span><span class="main">)</span><span class="main">#</span>None<span class="main">#</span><span class="skolem">xs</span> <span class="main">⟹</span>
        <span class="main">(</span>map Some <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">f</span><span class="main">,</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">⟹</span> <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xs</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_preferred_to_compressed_pull_out_if max_zero_streak_def<span class="main">)</span> <span class="comment1">(*5s*)</span>
    <span class="keyword1"><span class="command">have</span></span> ipv6_preferred_to_compressed_None5<span class="main">:</span>
      <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Some <span class="skolem">a'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">b'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">c'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">d'</span><span class="main">)</span><span class="main">#</span>None<span class="main">#</span><span class="skolem">xs</span> <span class="main">⟹</span>
        <span class="main">(</span>map Some <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">f</span><span class="main">,</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">⟹</span> <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xs</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_preferred_to_compressed_pull_out_if max_zero_streak_def<span class="main">)</span> <span class="comment1">(*5s*)</span>
    <span class="keyword1"><span class="command">have</span></span> ipv6_preferred_to_compressed_None6<span class="main">:</span>
      <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Some <span class="skolem">a'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">b'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">c'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">d'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">e'</span><span class="main">)</span><span class="main">#</span>None<span class="main">#</span><span class="skolem">xs</span> <span class="main">⟹</span>
        <span class="main">(</span>map Some <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="skolem">f</span><span class="main">,</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">⟹</span> <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span> <span class="skolem">e'</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xs</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span> <span class="skolem">e'</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_preferred_to_compressed_pull_out_if max_zero_streak_def<span class="main">)</span> <span class="comment1">(*5s*)</span>
    <span class="keyword1"><span class="command">have</span></span> ipv6_preferred_to_compressed_None7<span class="main">:</span>
      <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Some <span class="skolem">a'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">b'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">c'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">d'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">e'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">f'</span><span class="main">)</span><span class="main">#</span>None<span class="main">#</span><span class="skolem">xs</span> <span class="main">⟹</span>
        <span class="main">(</span>map Some <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">h</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">⟹</span> <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span> <span class="skolem">e'</span> <span class="skolem">f'</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span>"</span></span>  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xs</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span> <span class="skolem">e'</span> <span class="skolem">f'</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_preferred_to_compressed_pull_out_if max_zero_streak_def<span class="main">)</span> <span class="comment1">(*5s*)</span>
    <span class="keyword1"><span class="command">have</span></span> ipv6_preferred_to_compressed_None8<span class="main">:</span>
      <span class="quoted"><span class="quoted">"ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Some <span class="skolem">a'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">b'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">c'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">d'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">e'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">f'</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>Some <span class="skolem">g'</span><span class="main">)</span><span class="main">#</span>None<span class="main">#</span><span class="skolem">xs</span> <span class="main">⟹</span>
        <span class="main">(</span>map Some <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="skolem">h</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">⟹</span> <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span> <span class="skolem">e'</span> <span class="skolem">f'</span> <span class="skolem">g'</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">ip'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xs</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span> <span class="skolem">e'</span> <span class="skolem">f'</span> <span class="skolem">g'</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">e</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipv6_preferred_to_compressed_pull_out_if max_zero_streak_def<span class="main">)</span> <span class="comment1">(*5s*)</span>

    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"parse_ipv6_address_compressed <span class="main">(</span>ipv6_preferred_to_compressed <span class="main">(</span>IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span>
                <span class="main">=</span> Some <span class="skolem">ipv6compressed</span> <span class="main">⟹</span>
       ipv6addr_c2p <span class="skolem">ipv6compressed</span> <span class="main">=</span> <span class="free">ip'</span> <span class="main">⟹</span>
       IPv6AddrPreferred <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">=</span> <span class="free">ip'</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ipv6compressed</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> parse_ipv6_address_compressed_someE<span class="main">)</span>
                                         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
                                         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> ipv6_preferred_to_compressed_None1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> ipv6_preferred_to_compressed_None2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> ipv6_preferred_to_compressed_None3<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> ipv6_preferred_to_compressed_None4<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> ipv6_preferred_to_compressed_None5<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> ipv6_preferred_to_compressed_None6<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> ipv6_preferred_to_compressed_None7<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> ipv6_preferred_to_compressed_None8<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 ip <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Prefix_Match">
<div class="head">
<h1>Theory Prefix_Match</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Prefix_Match.thy
    Authors:    Julius Michaelis, Cornelius Diekmann
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Prefix_Match
<span class="keyword2"><span class="keyword">imports</span></span> <a href="IP_Address.html">IP_Address</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Prefix Match›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The main difference between the prefix match defined here and CIDR notation is a validity
  constraint imposed on prefix matches.

  For example, 192.168.42.42/16 is valid CIDR notation whereas for a prefix match,
  it must be 192.168.0.0/16.

  I.e. the last bits of the prefix must be set to zero.
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">typedef_overloaded</span><span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> prefix_match <span class="main">=</span> PrefixMatch <span class="main">(</span><span class="free"><span class="entity">pfxm_prefix</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">pfxm_length</span></span><span class="main">:</span> <span class="quoted">nat</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pfxm_mask</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> prefix_match <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len word"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pfxm_mask</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> mask <span class="main">(</span>len_of <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> pfxm_length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">valid_prefix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> prefix_match <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_prefix</span> <span class="free"><span class="bound"><span class="entity">pf</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>pfxm_mask <span class="free"><span class="bound"><span class="entity">pf</span></span></span><span class="main">)</span> <span class="keyword1">AND</span> pfxm_prefix <span class="free"><span class="bound"><span class="entity">pf</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Note that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> valid_prefix<span class="antiquote"><span class="antiquote">}</span></span></span></span> looks very elegant as a definition. However, it hides something nasty:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_prefix <span class="main">(</span>PrefixMatch <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span> <span class="numeral">42</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹When zeroing all least significant bits which exceed the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> pfxm_length<span class="antiquote"><span class="antiquote">}</span></span></span></span>,
     you get a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> valid_prefix<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1" id="Prefix_Match-mk_valid_prefix"><span class="command">lemma</span></span> mk_valid_prefix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">base</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_prefix <span class="main">(</span>PrefixMatch <span class="main">(</span><span class="free">base</span> <span class="keyword1">AND</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span>len_of <span class="keyword1">TYPE</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="free">len</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">len</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mask <span class="main">(</span><span class="skolem">len</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span> <span class="keyword1">AND</span> <span class="skolem">base</span> <span class="keyword1">AND</span> <span class="keyword1">NOT</span> <span class="main">(</span>mask <span class="main">(</span><span class="skolem">len</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">len</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">base</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_bw_lcs<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_prefix_def pfxm_mask_def pfxm_length_def pfxm_prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span> prefix_match"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> usually requires <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> valid_prefix<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
      When we allow working on arbitrary IPs in CIDR notation,
      we will use the type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'i</span></span><span class="main"><span class="main">::</span></span>len word <span class="main"><span class="main">×</span></span> nat<span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> directly.›</span></span>

<span class="keyword1" id="Prefix_Match-valid_prefix_00"><span class="command">lemma</span></span> valid_prefix_00<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_prefix <span class="main">(</span>PrefixMatch <span class="main">0</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_prefix_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prefix_match_to_CIDR</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'i</span><span class="main">::</span>len<span class="main">)</span> prefix_match <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'i</span> word <span class="main">×</span> nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prefix_match_to_CIDR</span> <span class="free"><span class="bound"><span class="entity">pfx</span></span></span> <span class="main">≡</span> <span class="main">(</span>pfxm_prefix <span class="free"><span class="bound"><span class="entity">pfx</span></span></span><span class="main">,</span> pfxm_length <span class="free"><span class="bound"><span class="entity">pfx</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prefix_Match-prefix_match_to_CIDR_def2"><span class="command">lemma</span></span> prefix_match_to_CIDR_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"prefix_match_to_CIDR <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">pfx</span><span class="main">.</span> <span class="main">(</span>pfxm_prefix <span class="bound">pfx</span><span class="main">,</span> pfxm_length <span class="bound">pfx</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> prefix_match_to_CIDR_def fun_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">prefix_match_dtor</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">of</span> PrefixMatch <span class="bound">p</span> <span class="bound">l</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some more or less random linear order on prefixes.
     Only used for serialization at the time of this writing.›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> prefix_match <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">)</span> <span class="quoted">linorder</span>
<span class="keyword2"><span class="keyword">begin</span></span>
	<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> pfxm_length <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> pfxm_length <span class="free"><span class="bound"><span class="entity">b</span></span></span>
                         <span class="keyword1">then</span> pfxm_prefix <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> pfxm_prefix <span class="free"><span class="bound"><span class="entity">b</span></span></span>
                         <span class="keyword1">else</span> pfxm_length <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&gt;</span> pfxm_length <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span>
	                       <span class="main">(</span><span class="keyword1">if</span> pfxm_length <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> pfxm_length <span class="free"><span class="bound"><span class="entity">b</span></span></span>
	                        <span class="keyword1">then</span> pfxm_prefix <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> pfxm_prefix <span class="free"><span class="bound"><span class="entity">b</span></span></span>
	                        <span class="keyword1">else</span> pfxm_length <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&gt;</span> pfxm_length <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_prefix_match_def less_prefix_match_def prefix_match.expand
                  <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"sorted_list_of_set
 <span class="main">{</span>PrefixMatch <span class="main">0</span> <span class="numeral">32</span> <span class="main">::</span> <span class="numeral">32</span> prefix_match<span class="main">,</span>
  PrefixMatch <span class="numeral">42</span> <span class="numeral">32</span><span class="main">,</span>
  PrefixMatch <span class="main">0</span> <span class="main">0</span><span class="main">,</span>
  PrefixMatch <span class="main">0</span> <span class="main">1</span><span class="main">,</span>
  PrefixMatch <span class="numeral">12</span> <span class="numeral">31</span><span class="main">}</span> <span class="main">=</span>
    <span class="main">[</span>PrefixMatch <span class="main">0</span> <span class="numeral">32</span><span class="main">,</span> PrefixMatch <span class="numeral">0x2A</span> <span class="numeral">32</span><span class="main">,</span> PrefixMatch <span class="numeral">0xC</span> <span class="numeral">31</span><span class="main">,</span> PrefixMatch <span class="main">0</span> <span class="main">1</span><span class="main">,</span> PrefixMatch <span class="main">0</span> <span class="main">0</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Prefix_Match-valid_prefix_E"><span class="command">lemma</span></span> valid_prefix_E<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_prefix <span class="free">pf</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>pfxm_mask <span class="free">pf</span><span class="main">)</span> <span class="keyword1">AND</span> pfxm_prefix <span class="free">pf</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> valid_prefix_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Prefix_Match-valid_prefix_alt"><span class="command">lemma</span></span> valid_prefix_alt<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len prefix_match"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_prefix <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>pfxm_prefix <span class="free">p</span> <span class="keyword1">AND</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> pfxm_length <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_prefix_def
  <span class="keyword1"><span class="command">unfolding</span></span> mask_eq
  <span class="keyword1"><span class="command">using</span></span> word_bw_comms<span class="main">(</span>1<span class="main">)</span>
   arg_cong<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>pfxm_prefix <span class="free">p</span> <span class="keyword1">AND</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">]</span>
   shiftl_1
  <span class="keyword1"><span class="command">unfolding</span></span> pfxm_prefix_def pfxm_mask_def mask_eq
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Address Semantics›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Matching on a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">::</span></span>len prefix_match"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Think of routing tables.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">prefix_match_semantics</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">prefix_match_semantics</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> pfxm_prefix <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="keyword1">NOT</span> <span class="main">(</span>pfxm_mask <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="keyword1">AND</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1" id="Prefix_Match-same_length_prefixes_distinct"><span class="command">lemma</span></span> same_length_prefixes_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_prefix <span class="free">pfx1</span> <span class="main">⟹</span> valid_prefix <span class="free">pfx2</span> <span class="main">⟹</span> <span class="free">pfx1</span> <span class="main">≠</span> <span class="free">pfx2</span> <span class="main">⟹</span> pfxm_length <span class="free">pfx1</span> <span class="main">=</span> pfxm_length <span class="free">pfx2</span> <span class="main">⟹</span> prefix_match_semantics <span class="free">pfx1</span> <span class="free">w</span> <span class="main">⟹</span> prefix_match_semantics <span class="free">pfx2</span> <span class="free">w</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pfxm_mask_def prefix_match.expand prefix_match_semantics_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Relation between prefix and set›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">prefix_to_wordset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len prefix_match <span class="main">⇒</span> <span class="tfree">'a</span> word set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">prefix_to_wordset</span> <span class="free"><span class="bound"><span class="entity">pfx</span></span></span> <span class="main">=</span> <span class="main">{</span>pfxm_prefix <span class="free"><span class="bound"><span class="entity">pfx</span></span></span> <span class="main">..</span> pfxm_prefix <span class="free"><span class="bound"><span class="entity">pfx</span></span></span> <span class="keyword1">OR</span> pfxm_mask <span class="free"><span class="bound"><span class="entity">pfx</span></span></span><span class="main">}</span>"</span></span>
  
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Prefix_Match-pfx_not_empty"><span class="command">lemma</span></span> pfx_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_prefix <span class="free">pfx</span> <span class="main">⟹</span> prefix_to_wordset <span class="free">pfx</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> valid_prefix_def prefix_to_wordset_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_word_or2<span class="main">)</span>
  
  <span class="keyword1" id="Prefix_Match-zero_prefix_match_all"><span class="command">lemma</span></span> zero_prefix_match_all<span class="main">:</span>
    <span class="quoted"><span class="quoted">"valid_prefix <span class="free">m</span> <span class="main">⟹</span> pfxm_length <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> prefix_match_semantics <span class="free">m</span> <span class="free">ip</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pfxm_mask_def mask_2pm1 valid_prefix_alt prefix_match_semantics_def<span class="main">)</span>
  
  <span class="keyword1" id="Prefix_Match-prefix_to_wordset_subset_ipset_from_cidr"><span class="command">lemma</span></span> prefix_to_wordset_subset_ipset_from_cidr<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"prefix_to_wordset <span class="free">pfx</span> <span class="main">⊆</span> ipset_from_cidr <span class="main">(</span>pfxm_prefix <span class="free">pfx</span><span class="main">)</span> <span class="main">(</span>pfxm_length <span class="free">pfx</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_to_wordset_def addr_in_ipset_from_cidr_code<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> order_trans word_and_le2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pfxm_mask_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Equivalence Proofs›</span></span>
  <span class="keyword1"><span class="command">theorem</span></span> prefix_match_semantics_wordset<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_prefix <span class="free">pfx</span>"</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prefix_match_semantics <span class="free">pfx</span> <span class="free">a</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">∈</span> prefix_to_wordset <span class="free">pfx</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> valid_prefix_def pfxm_mask_def prefix_match_semantics_def prefix_to_wordset_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">pfx</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> base len<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> base<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">base</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> len<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">len</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> zero_base_lsb_imp_set_eq_as_bit_operation<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Prefix_Match-valid_prefix_ipset_from_netmask_ipset_from_cidr"><span class="command">lemma</span></span> valid_prefix_ipset_from_netmask_ipset_from_cidr<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipset_from_netmask <span class="main">(</span>pfxm_prefix <span class="free">pfx</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="main">(</span>pfxm_mask <span class="free">pfx</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            ipset_from_cidr <span class="main">(</span>pfxm_prefix <span class="free">pfx</span><span class="main">)</span> <span class="main">(</span>pfxm_length <span class="free">pfx</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">pfx</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_alt2 pfxm_mask_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  <span class="keyword1" id="Prefix_Match-prefix_match_semantics_ipset_from_netmask"><span class="command">lemma</span></span> prefix_match_semantics_ipset_from_netmask<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_prefix <span class="free">pfx</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prefix_match_semantics <span class="free">pfx</span> <span class="free">a</span> <span class="main">⟷</span>
            <span class="free">a</span> <span class="main">∈</span> ipset_from_netmask <span class="main">(</span>pfxm_prefix <span class="free">pfx</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="main">(</span>pfxm_mask <span class="free">pfx</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> prefix_match_semantics_wordset<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> valid_prefix_ipset_from_netmask_ipset_from_cidr
    <span class="keyword1"><span class="command">unfolding</span></span> prefix_to_wordset_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> ipset_from_cidr_base_wellforemd<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_prefix_def pfxm_mask_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pfxm_mask_def<span class="main">)</span>
    
  <span class="keyword1" id="Prefix_Match-prefix_match_semantics_ipset_from_netmask2"><span class="command">lemma</span></span> prefix_match_semantics_ipset_from_netmask2<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_prefix <span class="free">pfx</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prefix_match_semantics <span class="free">pfx</span> <span class="main">(</span><span class="free">a</span> <span class="main">::</span> <span class="tfree">'i</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">⟷</span>
            <span class="free">a</span> <span class="main">∈</span> ipset_from_cidr <span class="main">(</span>pfxm_prefix <span class="free">pfx</span><span class="main">)</span> <span class="main">(</span>pfxm_length <span class="free">pfx</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> prefix_match_semantics_ipset_from_netmask<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> pfxm_mask_def ipset_from_cidr_def
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> NOT_mask_shifted_lenword word_not_not<span class="main">)</span>

  <span class="keyword1" id="Prefix_Match-prefix_to_wordset_ipset_from_cidr"><span class="command">lemma</span></span> prefix_to_wordset_ipset_from_cidr<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_prefix <span class="main">(</span><span class="free">pfx</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>len prefix_match<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prefix_to_wordset <span class="free">pfx</span> <span class="main">=</span> ipset_from_cidr <span class="main">(</span>pfxm_prefix <span class="free">pfx</span><span class="main">)</span> <span class="main">(</span>pfxm_length <span class="free">pfx</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> helper3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="keyword1">OR</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">OR</span> <span class="skolem">y</span> <span class="keyword1">AND</span> <span class="keyword1">NOT</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_oa_dist2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> prefix_match_semantics_ipset_from_netmask<span class="main">:</span>
           <span class="quoted"><span class="quoted">"<span class="main">(</span>prefix_to_wordset <span class="free">pfx</span><span class="main">)</span> <span class="main">=</span> ipset_from_netmask <span class="main">(</span>pfxm_prefix <span class="free">pfx</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="main">(</span>pfxm_mask <span class="free">pfx</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> prefix_to_wordset_def ipset_from_netmask_def Let_def
      <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> valid_prefix_E<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> bit.conj_commute mask_eq_0_eq_x<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mask <span class="skolem">len</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">len</span> <span class="main">=</span> <span class="main">~~</span> <span class="main">(</span>mask <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">len</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">len</span> <span class="keyword1"><span class="command">using</span></span> NOT_mask_shifted_lenword <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> word_not_not<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pfxm_length <span class="free">pfx</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> mask_def2_symmetric<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mask <span class="main">(</span>pfxm_length <span class="free">pfx</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">&lt;&lt;</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> pfxm_length <span class="free">pfx</span><span class="main">)</span> <span class="main">=</span>
          <span class="keyword1">NOT</span> <span class="main">(</span>pfxm_mask <span class="free">pfx</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> pfxm_mask_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
      <span class="keyword1"><span class="command">have</span></span> ipset_from_netmask_prefix<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"ipset_from_netmask <span class="main">(</span>pfxm_prefix <span class="free">pfx</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">NOT</span> <span class="main">(</span>pfxm_mask <span class="free">pfx</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          ipset_from_cidr <span class="main">(</span>pfxm_prefix <span class="free">pfx</span><span class="main">)</span> <span class="main">(</span>pfxm_length <span class="free">pfx</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> ipset_from_netmask_def ipset_from_cidr_alt
       <span class="keyword1"><span class="command">unfolding</span></span> pfxm_mask_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
       <span class="keyword1"><span class="command">unfolding</span></span> mask_def2_symmetric
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> Let_def
       <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> valid_prefix_def<span class="main">]</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> helper3 word_bw_comms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ipset_from_netmask_prefix local.prefix_match_semantics_ipset_from_netmask<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">prefix_to_wordinterval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len prefix_match <span class="main">⇒</span> <span class="tfree">'a</span> wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">prefix_to_wordinterval</span> <span class="free"><span class="bound"><span class="entity">pfx</span></span></span> <span class="main">≡</span> WordInterval <span class="main">(</span>pfxm_prefix <span class="free"><span class="bound"><span class="entity">pfx</span></span></span><span class="main">)</span> <span class="main">(</span>pfxm_prefix <span class="free"><span class="bound"><span class="entity">pfx</span></span></span> <span class="keyword1">OR</span> pfxm_mask <span class="free"><span class="bound"><span class="entity">pfx</span></span></span><span class="main">)</span>"</span></span>
  
  <span class="keyword1" id="Prefix_Match-prefix_to_wordinterval_set_eq"><span class="command">lemma</span></span> prefix_to_wordinterval_set_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>prefix_to_wordinterval <span class="free">pfx</span><span class="main">)</span> <span class="main">=</span> prefix_to_wordset <span class="free">pfx</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> prefix_to_wordinterval_def prefix_to_wordset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword1" id="Prefix_Match-prefix_to_wordinterval_def2"><span class="command">lemma</span></span> prefix_to_wordinterval_def2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"prefix_to_wordinterval <span class="free">pfx</span> <span class="main">=</span>
      iprange_interval <span class="main">(</span><span class="main">(</span>pfxm_prefix <span class="free">pfx</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>pfxm_prefix <span class="free">pfx</span> <span class="keyword1">OR</span> pfxm_mask <span class="free">pfx</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> iprange_interval.simps prefix_to_wordinterval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">corollary</span></span> prefix_to_wordinterval_ipset_from_cidr<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_prefix <span class="free">pfx</span> <span class="main">⟹</span>
    wordinterval_to_set <span class="main">(</span>prefix_to_wordinterval <span class="free">pfx</span><span class="main">)</span> <span class="main">=</span>
      ipset_from_cidr <span class="main">(</span>pfxm_prefix <span class="free">pfx</span><span class="main">)</span> <span class="main">(</span>pfxm_length <span class="free">pfx</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prefix_to_wordset_ipset_from_cidr prefix_to_wordinterval_set_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1" id="Prefix_Match-prefix_never_empty"><span class="command">lemma</span></span> prefix_never_empty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len prefix_match"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"<span class="main">¬</span> wordinterval_empty <span class="main">(</span>prefix_to_wordinterval <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_word_or2 prefix_to_wordinterval_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Getting a lowest element›</span></span>
  <span class="keyword1" id="Prefix_Match-ipset_from_cidr_lowest"><span class="command">lemma</span></span> ipset_from_cidr_lowest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> ipset_from_cidr <span class="free">a</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ip_cidr_set_def ipset_from_cidr_eq_ip_cidr_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="comment1">(*this is why I call the previous lemma 'lowest'*)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_prefix <span class="main">(</span>PrefixMatch <span class="free">a</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> is_lowest_element <span class="free">a</span> <span class="main">(</span>ipset_from_cidr <span class="free">a</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_lowest_element_def ipset_from_cidr_lowest<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipset_from_cidr_eq_ip_cidr_set ip_cidr_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_prefix_def pfxm_mask_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_zero eq_iff mask_out_sub_mask word_and_le2 word_bw_comms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CIDR_Split">
<div class="head">
<h1>Theory CIDR_Split</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      CIDR_Split.thy
    Authors:    Julius Michaelis, Cornelius Diekmann
*)</span>
<span class="keyword1"><span class="command">theory</span></span> CIDR_Split
<span class="keyword2"><span class="keyword">imports</span></span> <a href="IP_Address.html">IP_Address</a>
        <a href="Prefix_Match.html">Prefix_Match</a>
        <a href="Hs_Compat.html">Hs_Compat</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹CIDR Split Motivation (Example for IPv4)›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹When talking about ranges of IP addresses, we can make the ranges explicit by listing their elements.›</span></span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>of_nat <span class="main">∘</span> nat<span class="main">)</span> <span class="main">[</span><span class="main">1</span> <span class="main">..</span> <span class="numeral">4</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">]</span><span class="main">::</span> <span class="numeral">32</span> word list<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipv4addr_upto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">32</span> word <span class="main">⇒</span> <span class="numeral">32</span> word <span class="main">⇒</span> <span class="numeral">32</span> word list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipv4addr_upto</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span> map <span class="main">(</span>of_nat <span class="main">∘</span> nat<span class="main">)</span> <span class="main">[</span>int <span class="main">(</span>unat <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">..</span> int <span class="main">(</span>unat <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-ipv4addr_upto"><span class="command">lemma</span></span> ipv4addr_upto<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>ipv4addr_upto <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">i</span> <span class="main">..</span> <span class="free">j</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> int_interval_eq_image<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>int <span class="skolem">m</span><span class="main">..</span>int <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> int <span class="main">`</span> <span class="main">{</span><span class="skolem">m</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> image_eqI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">int</span> <span class="quoted"><span class="quoted">"nat <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">k</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> helpX<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∘</span> nat<span class="main">)</span> <span class="main">`</span> <span class="main">{</span>int <span class="bound">i</span><span class="main">..</span>int <span class="bound">j</span><span class="main">}</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound">i</span> <span class="main">..</span> <span class="bound">j</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp int_interval_eq_image<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> hlp<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≤</span> word_of_nat <span class="main">(</span>nat <span class="skolem">xa</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹word_of_nat <span class="main">(</span>nat <span class="skolem">xa</span><span class="main">)</span> <span class="main">≤</span> <span class="free">j</span>›</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">‹uint <span class="free">i</span> <span class="main">≤</span> <span class="skolem">xa</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xa</span> <span class="main">≤</span> uint <span class="free">j</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xa</span> <span class="main">::</span> <span class="quoted">int</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> uint_nonnegative <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹uint <span class="free">i</span> <span class="main">≤</span> <span class="skolem">xa</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">xa</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xa</span> <span class="main">≤</span> uint <span class="free">j</span>›</span></span> uint_bounded <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xa</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">32</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> xa<span class="main">:</span> <span class="quoted"><span class="quoted">‹take_bit <span class="numeral">32</span> <span class="skolem">xa</span> <span class="main">=</span> <span class="skolem">xa</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_bit_int_eq_self<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> xa <span class="quoted"><span class="quoted">‹uint <span class="free">i</span> <span class="main">≤</span> <span class="skolem">xa</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≤</span> word_of_nat <span class="main">(</span>nat <span class="skolem">xa</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> xa <span class="quoted"><span class="quoted">‹<span class="skolem">xa</span> <span class="main">≤</span> uint <span class="free">j</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹word_of_nat <span class="main">(</span>nat <span class="skolem">xa</span><span class="main">)</span> <span class="main">≤</span> <span class="free">j</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ipv4addr_upto_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hlp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> atLeastAtMost_iff image_iff unat_eq_nat_uint word_less_eq_iff_unsigned word_unat.Rep_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ipv4addr_upto<span class="antiquote"><span class="antiquote">}</span></span></span></span> gives back a list of all the ips in the list.
        This list can be pretty huge! In the following, we will use CIDR notation (e.g. 192.168.0.0/24)
        to describe the list more compactly.›</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹CIDR Split›</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-find_SomeD"><span class="command">lemma</span></span> find_SomeD<span class="main">:</span> <span class="quoted"><span class="quoted">"find <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> Some <span class="free">y</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> set <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="comment1">(*pfxes needs a dummy parameter. The first parameter is a dummy that we have the 'a::len0 type and
  can refer to its length.*)</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">pfxes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len0 itself <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pfxes</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> map nat <span class="main">[</span><span class="main">0</span><span class="main">..</span>int<span class="main">(</span>len_of <span class="keyword1">TYPE</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"pfxes <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span> <span class="main">=</span> map nat <span class="main">[</span><span class="main">0</span> <span class="main">..</span> <span class="numeral">32</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">largest_contained_prefix</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> len<span class="main">)</span> word<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">let</span> <span class="bound">cs</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> PrefixMatch <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>pfxes <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="comment1">― ‹anything that is a subset should also be a valid prefix. but try proving that.›</span>
      <span class="bound">cfs</span> <span class="main">=</span> find <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> valid_prefix <span class="bound">s</span> <span class="main">∧</span> wordinterval_subset <span class="main">(</span>prefix_to_wordinterval <span class="bound">s</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="bound">cs</span> <span class="keyword1">in</span>
  <span class="bound">cfs</span><span class="main">)</span>
"</span></span>
<span class="comment1">(* The joke is that it is always Some, given that a ∈ r. *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Split off one prefix:›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">wordinterval_CIDR_split1</span>
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span> prefix_match option <span class="main">×</span> <span class="tfree">'a</span> wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wordinterval_CIDR_split1</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">(</span>
   <span class="keyword1">let</span> <span class="bound">ma</span> <span class="main">=</span> wordinterval_lowest_element <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">in</span>
   <span class="keyword1">case</span> <span class="bound">ma</span> <span class="keyword1">of</span> 
      None <span class="main">⇒</span> <span class="main">(</span>None<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">|</span>
      Some <span class="bound">a</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> largest_contained_prefix <span class="bound">a</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">of</span> 
        None <span class="main">⇒</span> <span class="main">(</span>None<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">|</span>
        Some <span class="bound">m</span> <span class="main">⇒</span> <span class="main">(</span>Some <span class="bound">m</span><span class="main">,</span> wordinterval_setminus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>prefix_to_wordinterval <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-wordinterval_CIDR_split1_innard_helper"><span class="command">lemma</span></span> wordinterval_CIDR_split1_innard_helper<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="free">r</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟹</span> 
  largest_contained_prefix <span class="free">a</span> <span class="free">r</span> <span class="main">≠</span> None"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="free">r</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span>len_of<span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span>Pair <span class="free">a</span><span class="main">)</span> <span class="main">(</span>pfxes <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pfxes_def set_map set_upto
    <span class="keyword1"><span class="command">using</span></span> Set.image_iff atLeastAtMost_iff int_eq_iff order_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> <span class="comment1">(*400ms*)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_prefix <span class="main">(</span>PrefixMatch <span class="free">a</span> <span class="main">(</span>len_of<span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_prefix_def pfxm_mask_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>prefix_to_wordinterval <span class="main">(</span>PrefixMatch <span class="free">a</span> <span class="main">(</span>len_of<span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> prefix_to_wordinterval_def pfxm_mask_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> wordinterval_to_set <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a wordinterval_lowest_element_set_eq wordinterval_lowest_none_empty
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_lowest_element_def option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>prefix_to_wordinterval <span class="main">(</span>PrefixMatch <span class="free">a</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> wordinterval_to_set <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> largest_contained_prefix_def Let_def
    <span class="keyword1"><span class="command">using</span></span> b c d <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_None_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-r_split1_not_none"><span class="command">lemma</span></span> r_split1_not_none<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> wordinterval_empty <span class="free">r</span> <span class="main">⟹</span> fst <span class="main">(</span>wordinterval_CIDR_split1 <span class="free">r</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_CIDR_split1_def Let_def
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="free">r</span>"</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_lowest_none_empty 
          <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> wordinterval_CIDR_split1_innard_helper<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-largest_contained_prefix_subset"><span class="command">lemma</span></span> largest_contained_prefix_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"largest_contained_prefix <span class="free">a</span> <span class="free">r</span> <span class="main">=</span> Some <span class="free">p</span> <span class="main">⟹</span> wordinterval_to_set <span class="main">(</span>prefix_to_wordinterval <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> wordinterval_to_set <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> largest_contained_prefix_def Let_def
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> find_SomeD<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-wordinterval_CIDR_split1_snd"><span class="command">lemma</span></span> wordinterval_CIDR_split1_snd<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="free">r</span> <span class="main">=</span> <span class="main">(</span>Some <span class="free">s</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">=</span> wordinterval_setminus <span class="free">r</span> <span class="main">(</span>prefix_to_wordinterval <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_CIDR_split1_def Let_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-largest_contained_prefix_subset_s1D"><span class="command">lemma</span></span> largest_contained_prefix_subset_s1D<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="free">r</span> <span class="main">=</span> <span class="main">(</span>Some <span class="free">s</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">⟹</span> wordinterval_to_set <span class="main">(</span>prefix_to_wordinterval <span class="free">s</span><span class="main">)</span> <span class="main">⊆</span> wordinterval_to_set <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> largest_contained_prefix_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>wordinterval_lowest_element <span class="free">r</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_CIDR_split1_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">theorem</span></span> wordinterval_CIDR_split1_preserve<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="free">r</span> <span class="main">=</span> <span class="main">(</span>Some <span class="free">s</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">⟹</span> wordinterval_eq <span class="main">(</span>wordinterval_union <span class="main">(</span>prefix_to_wordinterval <span class="free">s</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> wordinterval_eq_set_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="free">r</span> <span class="main">=</span> <span class="main">(</span>Some <span class="free">s</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ud<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> wordinterval_setminus <span class="free">r</span> <span class="main">(</span>prefix_to_wordinterval <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> as<span class="main">[</span><span class="operator">THEN</span> wordinterval_CIDR_split1_snd<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> largest_contained_prefix_subset_s1D<span class="main">[</span><span class="operator">OF</span> as<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>wordinterval_union <span class="main">(</span>prefix_to_wordinterval <span class="free">s</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> wordinterval_to_set <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ud <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-wordinterval_CIDR_split1_some_r_ne"><span class="command">lemma</span></span> wordinterval_CIDR_split1_some_r_ne<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="free">r</span> <span class="main">=</span> <span class="main">(</span>Some <span class="free">s</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> wordinterval_empty <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="free">r</span> <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_lowest_none_empty <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> not_not <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="free">r</span> <span class="main">=</span> <span class="main">(</span>None<span class="main">,</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_CIDR_split1_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-wordinterval_CIDR_split1_distinct"><span class="command">lemma</span></span> wordinterval_CIDR_split1_distinct<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="free">r</span> <span class="main">=</span> <span class="main">(</span>Some <span class="free">s</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">⟹</span>
           wordinterval_empty <span class="main">(</span>wordinterval_intersection <span class="main">(</span>prefix_to_wordinterval <span class="free">s</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_lowest_element <span class="free">r</span> <span class="main">≠</span> None"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wordinterval_CIDR_split1_some_r_ne 1 wordinterval_lowest_none_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> wordinterval_setminus <span class="free">r</span> <span class="main">(</span>prefix_to_wordinterval <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">elim</span> wordinterval_CIDR_split1_snd<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-wordinterval_CIDR_split1_distinct2"><span class="command">lemma</span></span> wordinterval_CIDR_split1_distinct2<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="free">r</span> <span class="main">=</span> <span class="main">(</span>Some <span class="free">s</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">⟹</span>
          wordinterval_empty <span class="main">(</span>wordinterval_intersection <span class="main">(</span>prefix_to_wordinterval <span class="free">s</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> wordinterval_CIDR_split1_distinct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">wordinterval_CIDR_split_prefixmatch</span>
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span> prefix_match list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wordinterval_CIDR_split_prefixmatch</span> <span class="free"><span class="bound"><span class="entity">rs</span></span></span> <span class="main">=</span> <span class="main">(</span>
      <span class="keyword1">if</span>
        <span class="main">¬</span> wordinterval_empty <span class="free"><span class="bound"><span class="entity">rs</span></span></span>
      <span class="keyword1">then</span> <span class="keyword1">case</span> wordinterval_CIDR_split1 <span class="free"><span class="bound"><span class="entity">rs</span></span></span>
                      <span class="keyword1">of</span> <span class="main">(</span>Some <span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s</span> <span class="main">#</span> <span class="free">wordinterval_CIDR_split_prefixmatch</span> <span class="bound">u</span>
                      <span class="main">|</span>   <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">[]</span>
      <span class="keyword1">else</span>
        <span class="main">[]</span>
      <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">wordinterval_CIDR_split_prefixmatch</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span>card <span class="main">∘</span> wordinterval_to_set<span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> wf_measure<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> in_measure comp_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> vernichter <span class="main">=</span> wordinterval_empty_set_eq wordinterval_intersection_set_eq wordinterval_union_set_eq wordinterval_eq_set_eq
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">rs</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> some <span class="main">=</span> 1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> 1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> prefix_never_empty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>prefix_to_wordinterval <span class="skolem">x2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vernichter <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_CIDR_split1_preserve<span class="main">[</span><span class="operator">OF</span> some<span class="main">,</span> <span class="operator">unfolded</span> vernichter<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> card_Un_disjoint<span class="main">[</span><span class="operator">OF</span> finite finite wordinterval_CIDR_split1_distinct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> some<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> vernichter<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-unfold_rsplit_case"><span class="command">lemma</span></span> unfold_rsplit_case<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> su<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Some <span class="free">s</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> wordinterval_CIDR_split1 <span class="free">rs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> wordinterval_CIDR_split1 <span class="free">rs</span> <span class="keyword1">of</span> <span class="main">(</span>None<span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">[]</span>
                                            <span class="main">|</span> <span class="main">(</span>Some <span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s</span> <span class="main">#</span> wordinterval_CIDR_split_prefixmatch <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">#</span> wordinterval_CIDR_split_prefixmatch <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> su <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> split_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split_prefixmatch
          <span class="main">(</span>RangeUnion <span class="main">(</span>WordInterval <span class="main">(</span><span class="numeral">0x40000000</span><span class="main">)</span> <span class="numeral">0x5FEFBBCC</span><span class="main">)</span> <span class="main">(</span>WordInterval <span class="numeral">0x5FEEBB1C</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span>
       <span class="main">=</span> <span class="main">[</span>PrefixMatch <span class="main">(</span><span class="numeral">0x40000000</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span> <span class="numeral">2</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="main">(</span>WordInterval <span class="main">0</span> <span class="main">(</span><span class="numeral">0xFFFFFFFE</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">32</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">declare</span></span> wordinterval_CIDR_split_prefixmatch.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">theorem</span></span> wordinterval_CIDR_split_prefixmatch<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="free">r</span><span class="main">)</span><span class="main">.</span> prefix_to_wordset <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wordinterval_CIDR_split_prefixmatch.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">rs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"wordinterval_empty <span class="skolem">rs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_CIDR_split_prefixmatch.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="skolem">rs</span> <span class="main">=</span> <span class="main">(</span>Some <span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r_split1_not_none<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> mIH<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="skolem">y</span><span class="main">)</span><span class="main">.</span> prefix_to_wordset <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">[</span><span class="operator">OF</span> False s1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> refl<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="skolem">rs</span> <span class="main">=</span> prefix_to_wordset <span class="skolem">x</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="skolem">y</span><span class="main">)</span><span class="main">.</span> prefix_to_wordset <span class="bound">x</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> mIH<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> ud<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> wordinterval_setminus <span class="skolem">rs</span> <span class="main">(</span>prefix_to_wordinterval <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> wordinterval_CIDR_split1_snd<span class="main">[</span><span class="operator">OF</span> s1<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"prefix_to_wordset <span class="skolem">x</span> <span class="main">⊆</span> wordinterval_to_set <span class="skolem">rs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> largest_contained_prefix_subset_s1D<span class="main">[</span><span class="operator">OF</span> s1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="skolem">rs</span> <span class="main">=</span> prefix_to_wordset <span class="skolem">x</span> <span class="main">∪</span> wordinterval_to_set <span class="skolem">y</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> ud <span class="keyword1"><span class="command">using</span></span> ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> wordinterval_CIDR_split_prefixmatch.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> if_P<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span> s1 prod.simps option.simps *<span class="main">)</span> <span class="comment1">(* WOOOOO simplifier bug (* try making this a simp add: *) *)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CIDR_Split-wordinterval_CIDR_split_prefixmatch_all_valid_Ball"><span class="command">lemma</span></span> wordinterval_CIDR_split_prefixmatch_all_valid_Ball<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">∈</span>set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="free">r</span><span class="main">)</span><span class="main">.</span> valid_prefix <span class="bound">e</span> <span class="main">∧</span> pfxm_length <span class="bound">e</span> <span class="main">≤</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="comment1">(* The induction is somewhat verbose, so it is less annoying to write the two down at once *)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wordinterval_CIDR_split_prefixmatch.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">rs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"wordinterval_empty <span class="skolem">rs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="skolem">rs</span> <span class="main">=</span> <span class="main">(</span>Some <span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> r_split1_not_none<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_prefix <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_CIDR_split1_def Let_def largest_contained_prefix_def
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> find_SomeD <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"pfxm_length <span class="skolem">x</span> <span class="main">≤</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> s1 <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_CIDR_split1_def Let_def largest_contained_prefix_def pfxes_def
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> find_SomeD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_le_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> mIH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="skolem">y</span><span class="main">)</span><span class="main">.</span> valid_prefix <span class="bound">a</span> <span class="main">∧</span> pfxm_length <span class="bound">a</span> <span class="main">≤</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">[</span><span class="operator">OF</span> False s1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> refl<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> i1 i2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> wordinterval_CIDR_split_prefixmatch.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> if_P<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span> s1 prod.simps option.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_CIDR_split_prefixmatch.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-wordinterval_CIDR_split_prefixmatch_all_valid_less_Ball_hlp"><span class="command">lemma</span></span> wordinterval_CIDR_split_prefixmatch_all_valid_less_Ball_hlp<span class="main">:</span>
	<span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">[</span><span class="bound">s</span><span class="main">←</span>map <span class="main">(</span>PrefixMatch <span class="free">x2</span><span class="main">)</span> <span class="main">(</span>pfxes <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len0<span class="main">)</span><span class="main">)</span> <span class="main">.</span> valid_prefix <span class="bound">s</span> <span class="main">∧</span> wordinterval_to_set <span class="main">(</span>prefix_to_wordinterval <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> wordinterval_to_set <span class="free">rs</span><span class="main">]</span> <span class="main">⟹</span> pfxm_length <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pfxes_def<span class="main">)</span> <span class="operator">presburger</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Since <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> wordinterval_CIDR_split_prefixmatch<span class="antiquote"><span class="antiquote">}</span></span></span></span> only returns valid prefixes, we can safely convert it to CIDR lists›</span></span>
<span class="comment1">(* actually, just valid_prefix doesn't mean that the prefix length is sane. Fortunately, wordinterval_CIDR_split_prefixmatch_all_valid_Ball does entail that *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_prefix <span class="main">(</span>PrefixMatch <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="numeral">16</span> word<span class="main">)</span> <span class="numeral">20</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_prefix_def<span class="main">)</span>

<span class="keyword1" id="CIDR_Split-wordinterval_CIDR_split_disjunct"><span class="command">lemma</span></span> wordinterval_CIDR_split_disjunct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span>
  prefix_to_wordset <span class="free">a</span> <span class="main">∩</span> prefix_to_wordset <span class="free">b</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wordinterval_CIDR_split_prefixmatch.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">rs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> prema<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="skolem">rs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="var">?os</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> premb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="var">?os</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"wordinterval_empty <span class="skolem">rs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="skolem">rs</span> <span class="main">=</span> <span class="main">(</span>Some <span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> r_split1_not_none<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> mi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?rs</span>"</span></span><span class="main">)</span> 
      <span class="keyword2"><span class="keyword">if</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?os</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="keyword1"><span class="command">using</span></span> p s1 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> wordinterval_CIDR_split_prefixmatch.simps<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> if_P<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?rs</span> <span class="main">⟹</span> prefix_to_wordset <span class="skolem">k</span> <span class="main">⊆</span> wordinterval_to_set <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> 
      <span class="comment1">(* this is actually a quite general statement, might make a lemma out of it *)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_CIDR_split_prefixmatch <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"prefix_to_wordset <span class="skolem">x</span> <span class="main">∩</span> wordinterval_to_set <span class="skolem">y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wordinterval_CIDR_split1_snd<span class="main">[</span><span class="operator">OF</span> s1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> a<span class="main">[</span><span class="operator">OF</span> mi<span class="main"><span class="main">[</span></span><span class="operator">OF</span> as<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> premb<span class="main"><span class="main">]</span></span><span class="main">]</span> b
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> a<span class="main">[</span><span class="operator">OF</span> mi<span class="main"><span class="main">[</span></span><span class="operator">OF</span> as<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prema<span class="main"><span class="main">]</span></span><span class="main">]</span> b
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="comment1">(* Nothing to do case *)</span>
      <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="var">?rs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="var">?rs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> as mi prema premb <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prefix_to_wordset <span class="free">a</span> <span class="main">∩</span> prefix_to_wordset <span class="free">b</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False s1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> refl i<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fact</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="comment1">(* impossible case *)</span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split_prefixmatch <span class="skolem">rs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_CIDR_split_prefixmatch.simps<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> prema <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CIDR_Split-wordinterval_CIDR_split_distinct"><span class="command">lemma</span></span> wordinterval_CIDR_split_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="comment1">(* wish this was a corollary *)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wordinterval_CIDR_split_prefixmatch.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">rs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"wordinterval_empty <span class="skolem">rs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_CIDR_split1 <span class="skolem">rs</span> <span class="main">=</span> <span class="main">(</span>Some <span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> r_split1_not_none<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> mIH<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">[</span><span class="operator">OF</span> False s1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> refl<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix_to_wordset <span class="skolem">x</span> <span class="main">∩</span> wordinterval_to_set <span class="skolem">y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wordinterval_CIDR_split1_snd<span class="main">[</span><span class="operator">OF</span> s1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_CIDR_split_prefixmatch <span class="keyword1"><span class="command">using</span></span> prefix_never_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> s1
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> wordinterval_CIDR_split_prefixmatch.simps<span class="main">)</span>
        <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_P<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span> mIH i1 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_CIDR_split_prefixmatch.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CIDR_Split-wordinterval_CIDR_split_existential"><span class="command">lemma</span></span> wordinterval_CIDR_split_existential<span class="main">:</span>
	<span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> wordinterval_to_set <span class="free">w</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> prefix_to_wordset <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> wordinterval_CIDR_split_prefixmatch<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Versions for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ipset_from_cidr<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cidr_split</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'i</span> word <span class="main">×</span> nat<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cidr_split</span> <span class="free"><span class="bound"><span class="entity">rs</span></span></span> <span class="main">≡</span> map prefix_match_to_CIDR <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="free"><span class="bound"><span class="entity">rs</span></span></span><span class="main">)</span>"</span></span>
                                        
<span class="keyword1"><span class="command">corollary</span></span> cidr_split_prefix<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len wordinterval"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>cidr_split <span class="free">r</span><span class="main">)</span><span class="main">.</span> uncurry ipset_from_cidr <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> wordinterval_to_set <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_CIDR_split_prefixmatch<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> cidr_split_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_match_to_CIDR_def2 wordinterval_CIDR_split_prefixmatch<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> prefix_to_wordset_ipset_from_cidr wordinterval_CIDR_split_prefixmatch_all_valid_Ball <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">corollary</span></span> cidr_split_prefix_single<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">start</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>cidr_split <span class="main">(</span>iprange_interval <span class="main">(</span><span class="free">start</span><span class="main">,</span> <span class="free">end</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> uncurry ipset_from_cidr <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">start</span><span class="main">..</span><span class="free">end</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wordinterval_to_set.simps<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> cidr_split_prefix iprange_interval.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="CIDR_Split-interval_in_splitD"><span class="command">lemma</span></span> interval_in_splitD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">∈</span> <span class="free">foo</span> <span class="main">⟹</span> prefix_to_wordset <span class="free">xa</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>prefix_to_wordset <span class="main">`</span> <span class="free">foo</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="CIDR_Split-cidrsplit_no_overlaps"><span class="command">lemma</span></span> cidrsplit_no_overlaps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>
        <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="free">wi</span><span class="main">)</span><span class="main">;</span>
        <span class="free">xa</span> <span class="main">∈</span> set <span class="main">(</span>wordinterval_CIDR_split_prefixmatch <span class="free">wi</span><span class="main">)</span><span class="main">;</span> 
        <span class="free">pt</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>pfxm_mask <span class="free">x</span><span class="main">)</span> <span class="main">=</span> pfxm_prefix <span class="free">x</span><span class="main">;</span>
        <span class="free">pt</span> <span class="main">&amp;&amp;</span> <span class="main">~~</span> <span class="main">(</span>pfxm_mask <span class="free">xa</span><span class="main">)</span> <span class="main">=</span> pfxm_prefix <span class="free">xa</span>
        <span class="main">⟧</span>
       <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">xa</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
	<span class="keyword3"><span class="command">case</span></span> 1
	<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prefix_match_semantics <span class="free">x</span> <span class="free">pt</span>"</span></span> <span class="quoted"><span class="quoted">"prefix_match_semantics <span class="free">xa</span> <span class="free">pt</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prefix_match_semantics_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_bw_comms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
	<span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_prefix <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"valid_prefix <span class="free">xa</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1-2<span class="main">)</span> wordinterval_CIDR_split_prefixmatch_all_valid_Ball <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
	<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">pt</span> <span class="main">∈</span> prefix_to_wordset <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">pt</span> <span class="main">∈</span> prefix_to_wordset <span class="free">xa</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> prefix_match_semantics_wordset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
	<span class="keyword1"><span class="command">with</span></span> wordinterval_CIDR_split_disjunct<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="WordInterval_Sorted">
<div class="head">
<h1>Theory WordInterval_Sorted</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> WordInterval_Sorted
<span class="keyword2"><span class="keyword">imports</span></span> <a href="WordInterval.html">WordInterval</a>
        <a href="../Automatic_Refinement/Misc.html">Automatic_Refinement.Misc</a> <span class="comment1">(*Mergesort. TODO: dependnecy! we need a mergesort afp entry!!*)</span>
        <span class="quoted">"<a href="../../HOL/HOL-Library/Product_Lexorder.html">HOL-Library.Product_Lexorder</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(*has afp mergesort dependency*)</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Use this and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> wordinterval_compress<span class="antiquote"><span class="antiquote">}</span></span></span></span> before pretty-printing.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wordinterval_sort</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len wordinterval <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len wordinterval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wordinterval_sort</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> l2wi <span class="main">(</span>mergesort_remdups <span class="main">(</span>wi2l <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="WordInterval_Sorted-wordinterval_sort"><span class="command">lemma</span></span> wordinterval_sort<span class="main">:</span> <span class="quoted"><span class="quoted">"wordinterval_to_set <span class="main">(</span>wordinterval_sort <span class="free">w</span><span class="main">)</span> <span class="main">=</span> wordinterval_to_set <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wordinterval_sort_def wi2l l2wi mergesort_remdups_correct<span class="main">)</span>

<span class="comment1">(*A wordinterval is essentially a tree.
  We could vastly improve the computational complexity for all operations!*)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IP_Address_Parser">
<div class="head">
<h1>Theory IP_Address_Parser</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> IP_Address_Parser
<span class="keyword2"><span class="keyword">imports</span></span> <a href="IP_Address.html">IP_Address</a>
        <a href="IPv4.html">IPv4</a>
        <a href="IPv6.html">IPv6</a>
        <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Nat.html">HOL-Library.Code_Target_Nat</a>"</span> <span class="comment1">(*!!*)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Parsing IP Addresses›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹IPv4 Parser›</span></span>

<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">extract_int</span> <span class="entity">ss</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">ss</span> |&gt; implode |&gt; Int.fromString
                                <span class="keyword2"><span class="keyword">of</span></span> SOME <span class="entity">i</span> <span class="main">=&gt;</span> <span class="entity">i</span>
                                <span class="main">|</span>  NONE   <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> Fail <span class="inner_quoted">"unparsable int"</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_nat</span> <span class="entity">maxval</span> <span class="entity">i</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">i</span> &lt; <span class="inner_numeral">0</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">i</span> &gt; <span class="entity">maxval</span>
            <span class="keyword2"><span class="keyword">then</span></span>
              <span class="keyword3"><span class="keyword">raise</span></span> Fail<span class="main">(</span><span class="inner_quoted">"nat ("</span>^Int.toString <span class="entity">i</span>^<span class="inner_quoted">") must be between 0 and "</span>^Int.toString <span class="entity">maxval</span><span class="main">)</span>
            <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="entity">HOLogic.mk_number</span> <span class="entity">HOLogic.natT</span> <span class="entity">i</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">mk_nat255</span> <span class="main">=</span> <span class="entity">mk_nat</span> <span class="inner_numeral">255</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_quadrupel</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="entity">a</span><span class="main">,</span><span class="entity">b</span><span class="main">)</span><span class="main">,</span><span class="entity">c</span><span class="main">)</span><span class="main">,</span><span class="entity">d</span><span class="main">)</span> <span class="main">=</span> <span class="entity">HOLogic.mk_prod</span>
           <span class="main">(</span><span class="entity">mk_nat255</span> <span class="entity">a</span><span class="main">,</span> <span class="entity">HOLogic.mk_prod</span> <span class="main">(</span><span class="entity">mk_nat255</span> <span class="entity">b</span><span class="main">,</span> <span class="entity">HOLogic.mk_prod</span> <span class="main">(</span><span class="entity">mk_nat255</span> <span class="entity">c</span><span class="main">,</span> <span class="entity">mk_nat255</span> <span class="entity">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">in</span></span> 
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_ipv4addr</span> <span class="entity">ip</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> ipv4addr_of_dotdecimal<span class="antiquote">}</span></span> $ <span class="entity">mk_quadrupel</span> <span class="entity">ip</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">parser_ipv4</span> <span class="main">=</span> <span class="main">(</span>Scan.many1 Symbol.is_ascii_digit &gt;&gt; <span class="entity">extract_int</span><span class="main">)</span> --| <span class="main">(</span>$$ <span class="inner_quoted">"."</span><span class="main">)</span> --
                  <span class="main">(</span>Scan.many1 Symbol.is_ascii_digit &gt;&gt; <span class="entity">extract_int</span><span class="main">)</span> --| <span class="main">(</span>$$ <span class="inner_quoted">"."</span><span class="main">)</span> --
                  <span class="main">(</span>Scan.many1 Symbol.is_ascii_digit &gt;&gt; <span class="entity">extract_int</span><span class="main">)</span> --| <span class="main">(</span>$$ <span class="inner_quoted">"."</span><span class="main">)</span> --
                  <span class="main">(</span>Scan.many1 Symbol.is_ascii_digit &gt;&gt; <span class="entity">extract_int</span><span class="main">)</span><span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">ip_term</span><span class="main">,</span> <span class="entity">rest</span><span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">"10.8.0.255"</span> |&gt; raw_explode |&gt; Scan.finite Symbol.stopper <span class="main">(</span><span class="entity">parser_ipv4</span> &gt;&gt; <span class="entity">mk_ipv4addr</span><span class="main">)</span><span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">rest</span> &lt;&gt; <span class="main">[</span><span class="main">]</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="keyword3"><span class="keyword">raise</span></span> Fail <span class="inner_quoted">"did not parse everything"</span> <span class="keyword2"><span class="keyword">else</span></span> writeln <span class="inner_quoted">"parsed"</span><span class="main">;</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span>
            <span class="entity">Code_Evaluation.dynamic_value_strict</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="entity">ip_term</span>
            &lt;&gt; <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">168296703</span><span class="main">::</span>ipv4addr"</span><span class="antiquote">}</span></span>
          <span class="keyword2"><span class="keyword">then</span></span>
            <span class="keyword3"><span class="keyword">raise</span></span> Fail <span class="inner_quoted">"parser failed"</span>
          <span class="keyword2"><span class="keyword">else</span></span>
            writeln <span class="inner_quoted">"test passed"</span><span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹IPv6 Parser›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_ipv6addr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span> word option list <span class="main">⇒</span> ipv6addr_syntax option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">mk_ipv6addr</span> <span class="free"><span class="bound"><span class="entity">partslist</span></span></span> <span class="main">=</span> <span class="main">(</span>
      <span class="keyword1">let</span> <span class="comment1">― ‹remove empty lists to the beginning and end if omission occurs at start/end›</span>
          <span class="comment1">― ‹to join over <span class="antiquoted"><span class="operator">▩</span><span class="raw_text">‹:›</span></span> properly›</span>
          <span class="bound">fix_start</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ps</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">ps</span> <span class="keyword1">of</span> None<span class="main">#</span>None<span class="main">#</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> tl <span class="bound">ps</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">ps</span><span class="main">)</span><span class="main">;</span>
          <span class="bound">fix_end</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ps</span><span class="main">.</span> <span class="keyword1">case</span> rev <span class="bound">ps</span> <span class="keyword1">of</span> None<span class="main">#</span>None<span class="main">#</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> butlast <span class="bound">ps</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">ps</span><span class="main">)</span><span class="main">;</span>
          <span class="bound">ps</span> <span class="main">=</span> <span class="main">(</span><span class="bound">fix_end</span> <span class="main">∘</span> <span class="bound">fix_start</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">partslist</span></span></span>
      <span class="keyword1">in</span>
      <span class="keyword1">if</span> length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">=</span> None<span class="main">)</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>
      <span class="keyword1">then</span> ipv6_unparsed_compressed_to_preferred <span class="bound">ps</span>
      <span class="keyword1">else</span> <span class="keyword1">case</span> <span class="bound">ps</span> <span class="keyword1">of</span> <span class="main">[</span>Some <span class="bound">a</span><span class="main">,</span>Some <span class="bound">b</span><span class="main">,</span>Some <span class="bound">c</span><span class="main">,</span>Some <span class="bound">d</span><span class="main">,</span>Some <span class="bound">e</span><span class="main">,</span>Some <span class="bound">f</span><span class="main">,</span>Some <span class="bound">g</span><span class="main">,</span>Some <span class="bound">h</span><span class="main">]</span>
                              <span class="main">⇒</span> Some <span class="main">(</span>IPv6AddrPreferred <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="bound">h</span><span class="main">)</span>
                   <span class="main">|</span>  <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None
      <span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">fromHexString</span> <span class="main">=</span> StringCvt.scanString <span class="main">(</span>Int.scan StringCvt.HEX<span class="main">)</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">extract_int</span> <span class="entity">ss</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">ss</span> <span class="keyword2"><span class="keyword">of</span></span> <span class="inner_quoted">""</span> <span class="main">=&gt;</span> NONE
                               <span class="main">|</span>  <span class="entity">xs</span> <span class="main">=&gt;</span>
                          <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">xs</span> |&gt; <span class="entity">fromHexString</span>
                                <span class="keyword2"><span class="keyword">of</span></span> SOME <span class="entity">i</span> <span class="main">=&gt;</span> SOME <span class="entity">i</span>
                                <span class="main">|</span>  NONE   <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> Fail <span class="inner_quoted">"unparsable int"</span><span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">mk_ipv6addr</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">p</span> <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">p</span> <span class="keyword2"><span class="keyword">of</span></span> NONE <span class="main">=&gt;</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> None <span class="main">(</span><span class="quoted">"<span class="numeral">16</span> word"</span><span class="main">)</span><span class="antiquote">}</span></span>
                                        <span class="main">|</span>  SOME <span class="entity">i</span> <span class="main">=&gt;</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> Some <span class="main">(</span><span class="quoted">"<span class="numeral">16</span> word"</span><span class="main">)</span><span class="antiquote">}</span></span> $
                                                      <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> of_int <span class="main">(</span><span class="quoted">"<span class="numeral">16</span> word"</span><span class="main">)</span><span class="antiquote">}</span></span> $
                                                                  <span class="entity">HOLogic.mk_number</span> <span class="entity">HOLogic.intT</span> <span class="entity">i</span><span class="main">)</span>
                        <span class="main">)</span>
                 #&gt; <span class="entity">HOLogic.mk_list</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"<span class="numeral">16</span> word option"</span><span class="antiquote">}</span></span>
                 <span class="comment1">(*TODO: never use THE! is there some option_dest?*)</span>
                 #&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> ipv6preferred_to_int<span class="antiquote">}</span></span> $
                                   <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> the <span class="main">(</span><span class="quoted">"ipv6addr_syntax"</span><span class="main">)</span><span class="antiquote">}</span></span> $ <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> mk_ipv6addr<span class="antiquote">}</span></span> $ <span class="entity">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">parser_ipv6</span> <span class="main">=</span> Scan.many1 <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> Symbol.is_ascii_hex <span class="entity">x</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">x</span> <span class="main">=</span> <span class="inner_quoted">":"</span><span class="main">)</span>
                      &gt;&gt; <span class="main">(</span>implode #&gt; space_explode <span class="inner_quoted">":"</span> #&gt; map <span class="entity">extract_int</span><span class="main">)</span>
                  <span class="comment1">(* a different implementation which returns a list of exploded strings:
                    Scan.repeat ((Scan.many Symbol.is_ascii_hex &gt;&gt; extract_int) --| ($$ ":"))
                   @@@ (Scan.many Symbol.is_ascii_hex &gt;&gt; extract_int &gt;&gt; (fn p =&gt; [p]))*)</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">parse_ipv6</span> <span class="main">=</span> raw_explode
                   #&gt; Scan.finite Symbol.stopper <span class="main">(</span><span class="entity">parser_ipv6</span> &gt;&gt; <span class="entity">mk_ipv6addr</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">unit_test</span> <span class="main">(</span><span class="entity">ip_string</span><span class="main">,</span> <span class="entity">ip_result</span><span class="main">)</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">ip_term</span><span class="main">,</span> <span class="entity">rest</span><span class="main">)</span> <span class="main">=</span> <span class="entity">ip_string</span> |&gt; <span class="entity">parse_ipv6</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">rest</span> &lt;&gt; <span class="main">[</span><span class="main">]</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="keyword3"><span class="keyword">raise</span></span> Fail <span class="inner_quoted">"did not parse everything"</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="entity">Code_Evaluation.dynamic_value_strict</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="entity">ip_term</span> |&gt; Syntax.pretty_term <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> |&gt; Pretty.writeln<span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span>
              <span class="entity">Code_Evaluation.dynamic_value_strict</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="entity">ip_term</span> &lt;&gt; <span class="entity">ip_result</span>
            <span class="keyword2"><span class="keyword">then</span></span>
              <span class="keyword3"><span class="keyword">raise</span></span> Fail <span class="inner_quoted">"parser failed"</span>
            <span class="keyword2"><span class="keyword">else</span></span>
              writeln <span class="main">(</span><span class="inner_quoted">"test passed for "</span>^<span class="entity">ip_string</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="main">(</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> map <span class="entity">unit_test</span>
          <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"10:ab:FF:0::FF:4:255"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">83090298060623265259947972050027093</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"2001:db8::8:800:200c:417a"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">42540766411282592856906245548098208122</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"ff01::101"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">338958331222012082418099330867817087233</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"::8:800:200c:417a"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">2260596444381562</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"2001:db8::"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">42540766411282592856903984951653826560</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"ff00::"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">338953138925153547590470800371487866880</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"fe80::"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">338288524927261089654018896841347694592</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"1::"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">5192296858534827628530496329220096</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"1::"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">5192296858534827628530496329220096</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"::"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">0</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"::1"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">1</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"2001:db8:0:1:1:1:1:1"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">42540766411282592875351010504635121665</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">,</span><span class="main">(</span><span class="inner_quoted">"ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="numeral">340282366920938463463374607431768211455</span><span class="main">::</span>ipv6addr"</span><span class="antiquote">}</span></span><span class="main">)</span>
          <span class="main">]</span><span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
›</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Lib_Numbers_toString">
<div class="head">
<h1>Theory Lib_Numbers_toString</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Lib_Numbers_toString
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Printing Numbers›</span></span>

<span class="comment1">(*http://stackoverflow.com/questions/23864965/string-of-nat-in-isabelle*)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">string_of_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">string_of_nat</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="numeral">10</span> <span class="keyword1">then</span> <span class="main">[</span>char_of <span class="main">(</span><span class="numeral">48</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">]</span> <span class="keyword1">else</span> 
     <span class="free">string_of_nat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="numeral">10</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>char_of <span class="main">(</span><span class="numeral">48</span> <span class="main">+</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">mod</span> <span class="numeral">10</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">string_of_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">string_of_int</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="inner_quoted">''-''</span> <span class="main">@</span> string_of_nat <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> 
     string_of_nat <span class="main">(</span>nat <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"string_of_nat <span class="numeral">123456</span> <span class="main">=</span> <span class="inner_quoted">''123456''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">declare</span></span> string_of_nat.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Lib_Word_toString">
<div class="head">
<h1>Theory Lib_Word_toString</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Lib_Word_toString
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Lib_Numbers_toString.html">Lib_Numbers_toString</a>
        <a href="../Word_Lib/Word_Lemmas.html">Word_Lib.Word_Lemmas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Printing Machine Words›</span></span>

<span class="comment1">(*imitation of http://stackoverflow.com/questions/23864965/string-of-nat-in-isabelle*)</span>
<span class="comment1">(*parameters:
    lc = lower-case
    w  = word to print*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">string_of_word_single</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>len word <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">string_of_word_single</span> <span class="free"><span class="bound"><span class="entity">lc</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="keyword1">if</span>
       <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">&lt;</span> <span class="numeral">10</span>
     <span class="keyword1">then</span>
       <span class="main">[</span>char_of <span class="main">(</span><span class="numeral">48</span> <span class="main">+</span> unat <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span><span class="main">]</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span>
       <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">&lt;</span> <span class="numeral">36</span>
     <span class="keyword1">then</span>
       <span class="main">[</span>char_of <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">lc</span></span></span> <span class="keyword1">then</span> <span class="numeral">87</span> <span class="keyword1">else</span> <span class="numeral">55</span><span class="main">)</span> <span class="main">+</span> unat <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span><span class="main">]</span>
     <span class="keyword1">else</span>
       undefined<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Example:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">word_upto</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> map <span class="main">(</span>of_nat <span class="main">∘</span> nat<span class="main">)</span> <span class="main">[</span><span class="bound">i</span> <span class="main">..</span> <span class="bound">j</span><span class="main">]</span><span class="main">)</span> <span class="main">::</span> int <span class="main">⇒</span> int <span class="main">⇒</span> <span class="numeral">32</span> word list<span class="main">)</span>
       <span class="keyword1">in</span> map <span class="main">(</span>string_of_word_single False<span class="main">)</span> <span class="main">(</span><span class="bound">word_upto</span> <span class="main">1</span> <span class="numeral">35</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">[</span><span class="inner_quoted">''1''</span><span class="main">,</span> <span class="inner_quoted">''2''</span><span class="main">,</span> <span class="inner_quoted">''3''</span><span class="main">,</span> <span class="inner_quoted">''4''</span><span class="main">,</span> <span class="inner_quoted">''5''</span><span class="main">,</span> <span class="inner_quoted">''6''</span><span class="main">,</span> <span class="inner_quoted">''7''</span><span class="main">,</span> <span class="inner_quoted">''8''</span><span class="main">,</span> <span class="inner_quoted">''9''</span><span class="main">,</span>
   <span class="inner_quoted">''A''</span><span class="main">,</span> <span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''C''</span><span class="main">,</span> <span class="inner_quoted">''D''</span><span class="main">,</span> <span class="inner_quoted">''E''</span><span class="main">,</span> <span class="inner_quoted">''F''</span><span class="main">,</span> <span class="inner_quoted">''G''</span><span class="main">,</span> <span class="inner_quoted">''H''</span><span class="main">,</span> <span class="inner_quoted">''I''</span><span class="main">,</span>
   <span class="inner_quoted">''J''</span><span class="main">,</span> <span class="inner_quoted">''K''</span><span class="main">,</span> <span class="inner_quoted">''L''</span><span class="main">,</span> <span class="inner_quoted">''M''</span><span class="main">,</span> <span class="inner_quoted">''N''</span><span class="main">,</span> <span class="inner_quoted">''O''</span><span class="main">,</span> <span class="inner_quoted">''P''</span><span class="main">,</span> <span class="inner_quoted">''Q''</span><span class="main">,</span> <span class="inner_quoted">''R''</span><span class="main">,</span>
   <span class="inner_quoted">''S''</span><span class="main">,</span> <span class="inner_quoted">''T''</span><span class="main">,</span> <span class="inner_quoted">''U''</span><span class="main">,</span> <span class="inner_quoted">''V''</span><span class="main">,</span> <span class="inner_quoted">''W''</span><span class="main">,</span> <span class="inner_quoted">''X''</span><span class="main">,</span> <span class="inner_quoted">''Y''</span><span class="main">,</span> <span class="inner_quoted">''Z''</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="comment1">(* parameters: lowercase, base, minimum length - 1, to-be-serialized word *)</span> 
<span class="keyword1"><span class="command">function</span></span> <span class="entity">string_of_word</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> len<span class="main">)</span> word <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> len<span class="main">)</span> word <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">string_of_word</span> <span class="free"><span class="bound"><span class="entity">lc</span></span></span> <span class="free"><span class="bound"><span class="entity">base</span></span></span> <span class="free"><span class="bound"><span class="entity">ml</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span>
       <span class="free"><span class="bound"><span class="entity">base</span></span></span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span>
     <span class="keyword1">then</span>
       undefined
     <span class="keyword1">else</span> <span class="keyword1">if</span>
       <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">base</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">ml</span></span></span> <span class="main">=</span> <span class="main">0</span>
     <span class="keyword1">then</span>
       string_of_word_single <span class="free"><span class="bound"><span class="entity">lc</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>
     <span class="keyword1">else</span>
       <span class="free">string_of_word</span> <span class="free"><span class="bound"><span class="entity">lc</span></span></span> <span class="free"><span class="bound"><span class="entity">base</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ml</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">base</span></span></span><span class="main">)</span> <span class="main">@</span> string_of_word_single <span class="free"><span class="bound"><span class="entity">lc</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">base</span></span></span><span class="main">)</span>
     <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">hex_string_of_word</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> string_of_word True <span class="main">(</span><span class="numeral">16</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>len<span class="main">)</span> word<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">hex_string_of_word0</span> <span class="main">≡</span> hex_string_of_word <span class="main">0</span>"</span></span>
<span class="comment1">(* be careful though, these functions only make sense with words &gt; length 4.
   With 4 bits, base 16 is not representable. *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">dec_string_of_word0</span> <span class="main">≡</span> string_of_word True <span class="numeral">10</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">string_of_word</span>
	<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> unat <span class="bound">d</span> <span class="main">+</span> <span class="bound">c</span><span class="main">)</span>"</span></span><span class="main">)</span>
	 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_measure<span class="main">)</span>
	<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> in_measure<span class="main">)</span>
	<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
	<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> base ml n
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">ml</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_Suc_le unat_div<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">base</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> unat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> div_less_dividend_word<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_less word_le_nat_alt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">declare</span></span> string_of_word.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"hex_string_of_word0 <span class="main">(</span><span class="numeral">0xdeadbeef42</span> <span class="main">::</span> <span class="numeral">42</span> word<span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''deadbeef42''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"hex_string_of_word <span class="main">1</span> <span class="main">(</span><span class="numeral">0x1</span> <span class="main">::</span> <span class="numeral">5</span> word<span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''01''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"hex_string_of_word <span class="numeral">8</span> <span class="main">(</span><span class="numeral">0xff</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''0000000ff''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dec_string_of_word0 <span class="main">(</span><span class="numeral">8</span><span class="main">::</span><span class="numeral">32</span> word<span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''8''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dec_string_of_word0 <span class="main">(</span><span class="numeral">3</span><span class="main">::</span><span class="numeral">2</span> word<span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''11''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dec_string_of_word0 <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span><span class="numeral">8</span> word<span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''255''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1" id="Lib_Word_toString-string_of_word_single_atoi"><span class="command">lemma</span></span> string_of_word_single_atoi<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">10</span> <span class="main">⟹</span> string_of_word_single True <span class="free">n</span> <span class="main">=</span> <span class="main">[</span>char_of <span class="main">(</span><span class="numeral">48</span> <span class="main">+</span> unat <span class="free">n</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> string_of_word_single_def<span class="main">)</span>

<span class="comment1">(*TODO: move!*)</span>
<span class="keyword1" id="Lib_Word_toString-bintrunc_pos_eq"><span class="command">lemma</span></span> bintrunc_pos_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> bintrunc <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> bintr_lt2p <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_pos_pos_trivial no_bintr_alt1<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>


<span class="comment1">(*The following lemma [symmetric] as [code_unfold] may give some cool speedup*)</span>
<span class="keyword1" id="Lib_Word_toString-string_of_word_base_ten_zeropad"><span class="command">lemma</span></span> string_of_word_base_ten_zeropad<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len word"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lena<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">5</span>"</span></span> <span class="comment1">(*word must be long enough to encode 10 = 0xA*)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">base</span> <span class="main">=</span> <span class="numeral">10</span> <span class="main">⟹</span> <span class="free">zero</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> string_of_word True <span class="free">base</span> <span class="free">zero</span> <span class="free">w</span> <span class="main">=</span> string_of_nat <span class="main">(</span>unat <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted">True</span> <span class="quoted"><span class="free">base</span></span> <span class="quoted"><span class="free">zero</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> string_of_word.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">base</span> <span class="skolem">ml</span> <span class="skolem">n</span><span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span>  Word.word_less_no<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span>  Word.uint_bintrunc<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">5</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> bintrunc <span class="skolem">n</span> <span class="numeral">10</span> <span class="main">=</span> <span class="numeral">10</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> bintrunc_pos_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Nat.dec_induct<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> lena <span class="keyword1"><span class="command">have</span></span> unat_ten<span class="main">:</span> <span class="quoted"><span class="quoted">"unat <span class="main">(</span><span class="numeral">0xA</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">=</span> <span class="numeral">10</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">5</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> bintrunc <span class="skolem">n</span> <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> bintrunc_pos_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Nat.dec_induct<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> lena <span class="keyword1"><span class="command">have</span></span> unat_two<span class="main">:</span> <span class="quoted"><span class="quoted">"unat <span class="main">(</span><span class="numeral">2</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> unat_mod_ten<span class="main">:</span> <span class="quoted"><span class="quoted">"unat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">0xA</span><span class="main">)</span> <span class="main">=</span> unat <span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">10</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Word.unat_mod<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> unat_ten<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    
  <span class="keyword1"><span class="command">have</span></span> unat_div_ten<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>unat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">0xA</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> unat <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">10</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Word.unat_div<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> unat_ten<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> n_less_ten_unat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="numeral">0xA</span> <span class="main">⟹</span> <span class="main">(</span>unat <span class="skolem">n</span> <span class="main">&lt;</span> <span class="numeral">10</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> unat_less_helper<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">0xA</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="numeral">10</span> <span class="main">≤</span> unat <span class="skolem">n</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> Word.word_le_nat_alt<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> unat_ten<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> n_less_ten_unat_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="numeral">0xA</span> <span class="main">⟹</span> <span class="main">¬</span> unat <span class="skolem">n</span> <span class="main">&lt;</span> <span class="numeral">10</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> not_wordlength_too_small<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lena <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">0xA</span><span class="main">::</span><span class="tfree">'a</span> word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> word_le_nat_alt<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> unat_ten unat_two<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> unat_two<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> ten_not_less_two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="numeral">0xA</span><span class="main">::</span><span class="tfree">'a</span> word<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Word.word_less_no Word.uint_bintrunc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="skolem">base</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 not_wordlength_too_small <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="numeral">0xA</span> <span class="main">⟹</span> string_of_word True <span class="numeral">0xA</span> <span class="main">0</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">0xA</span><span class="main">)</span> <span class="main">=</span> string_of_nat <span class="main">(</span>unat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">0xA</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="numeral">0xA</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> string_of_word.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> string_of_nat.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_less_ten_unat<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_wordlength_too_small ten_not_less_two string_of_word_single_atoi<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> sym<span class="main">[</span><span class="operator">OF</span> IH<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> string_of_word.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> string_of_nat.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_wordlength_too_small ten_not_less_two<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> string_of_word_single_atoi<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word.word_mod_less_divisor<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> unat_ten word_gt_0_no <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unat_mod_ten<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> n_less_ten_unat_not<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unat_div_ten<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> string_of_nat.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*TODO: one for all words?*)</span>
<span class="keyword1" id="Lib_Word_toString-dec_string_of_word0"><span class="command">lemma</span></span> dec_string_of_word0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dec_string_of_word0 <span class="main">(</span><span class="free">w8</span><span class="main">::</span> <span class="numeral">8</span> word<span class="main">)</span> <span class="main">=</span> string_of_nat <span class="main">(</span>unat <span class="free">w8</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"dec_string_of_word0 <span class="main">(</span><span class="free">w16</span><span class="main">::</span> <span class="numeral">16</span> word<span class="main">)</span> <span class="main">=</span> string_of_nat <span class="main">(</span>unat <span class="free">w16</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"dec_string_of_word0 <span class="main">(</span><span class="free">w32</span><span class="main">::</span> <span class="numeral">32</span> word<span class="main">)</span> <span class="main">=</span> string_of_nat <span class="main">(</span>unat <span class="free">w32</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"dec_string_of_word0 <span class="main">(</span><span class="free">w64</span><span class="main">::</span> <span class="numeral">64</span> word<span class="main">)</span> <span class="main">=</span> string_of_nat <span class="main">(</span>unat <span class="free">w64</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"dec_string_of_word0 <span class="main">(</span><span class="free">w128</span><span class="main">::</span> <span class="numeral">128</span> word<span class="main">)</span> <span class="main">=</span> string_of_nat <span class="main">(</span>unat <span class="free">w128</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dec_string_of_word0_def
  <span class="keyword1"><span class="command">using</span></span> string_of_word_base_ten_zeropad <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Lib_List_toString">
<div class="head">
<h1>Theory Lib_List_toString</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Lib_List_toString
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Lib_Numbers_toString.html">Lib_Numbers_toString</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Printing Lists›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">intersperse</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">intersperse</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">intersperse</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">intersperse</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free">intersperse</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="comment1">(*this is similar to space_implode or Data.List.intersperse (in Haskell)*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_separated_toString</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> string<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_separated_toString</span> <span class="free"><span class="bound"><span class="entity">sep</span></span></span> <span class="free"><span class="bound"><span class="entity">toStr</span></span></span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="main">=</span> concat <span class="main">(</span>splice <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">toStr</span></span></span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">)</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">sep</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A slightly more efficient code equation, which is actually not really faster (in certain languages)›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">list_separated_toString_helper</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> string<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_separated_toString_helper</span> <span class="free"><span class="bound"><span class="entity">sep</span></span></span> <span class="free"><span class="bound"><span class="entity">toStr</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="inner_quoted">''''</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">list_separated_toString_helper</span> <span class="free"><span class="bound"><span class="entity">sep</span></span></span> <span class="free"><span class="bound"><span class="entity">toStr</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">toStr</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">list_separated_toString_helper</span> <span class="free"><span class="bound"><span class="entity">sep</span></span></span> <span class="free"><span class="bound"><span class="entity">toStr</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">toStr</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">sep</span></span></span><span class="main">@</span><span class="free">list_separated_toString_helper</span> <span class="free"><span class="bound"><span class="entity">sep</span></span></span> <span class="free"><span class="bound"><span class="entity">toStr</span></span></span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span>"</span></span>
<span class="keyword1" id="Lib_List_toString-list_separated_toString_helper"><span class="command">lemma</span></span> list_separated_toString_helper<span class="main">:</span> <span class="quoted"><span class="quoted">"list_separated_toString <span class="main">=</span> list_separated_toString_helper"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">sep</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">toStr</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> char list<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ls</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_separated_toString <span class="skolem">sep</span> <span class="skolem">toStr</span> <span class="skolem">ls</span> <span class="main">=</span> list_separated_toString_helper <span class="skolem">sep</span> <span class="skolem">toStr</span> <span class="skolem">ls</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">sep</span></span> <span class="quoted"><span class="skolem">toStr</span></span> <span class="quoted"><span class="skolem">ls</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_separated_toString_helper.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_separated_toString_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lib_List_toString-list_separated_toString_intersperse"><span class="command">lemma</span></span> list_separated_toString_intersperse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"intersperse <span class="free">sep</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> list_separated_toString <span class="main">[</span><span class="free">sep</span><span class="main">]</span> <span class="free">f</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_separated_toString_helper<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">sep</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_separated_toString_helper.induct<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_toString</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> string<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_toString</span> <span class="free"><span class="bound"><span class="entity">toStr</span></span></span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="main">=</span> <span class="inner_quoted">''[''</span><span class="main">@</span> list_separated_toString <span class="inner_quoted">'', ''</span> <span class="free"><span class="bound"><span class="entity">toStr</span></span></span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="main">@</span><span class="inner_quoted">'']''</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"list_toString string_of_nat <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span> <span class="main">=</span> <span class="inner_quoted">''[1, 2, 3]''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IP_Address_toString">
<div class="head">
<h1>Theory IP_Address_toString</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> IP_Address_toString
<span class="keyword2"><span class="keyword">imports</span></span> <a href="IP_Address.html">IP_Address</a> <a href="IPv4.html">IPv4</a> <a href="IPv6.html">IPv6</a>
        <a href="Lib_Word_toString.html">Lib_Word_toString</a>
        <a href="Lib_List_toString.html">Lib_List_toString</a>
        <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Nat.html">HOL-Library.Code_Target_Nat</a>"</span> <span class="comment1">(*!!*)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Pretty Printing IP Addresses›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Generic Pretty Printer›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Generic function. Whenever possible, use IPv4 or IPv6 pretty printing!›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipaddr_generic_toString</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span><span class="main">::</span>len word <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipaddr_generic_toString</span> <span class="free"><span class="bound"><span class="entity">ip</span></span></span> <span class="main">≡</span>
      <span class="inner_quoted">''[IP address (''</span> <span class="main">@</span> string_of_nat <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'i</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="inner_quoted">'' bit): ''</span> <span class="main">@</span> dec_string_of_word0 <span class="free"><span class="bound"><span class="entity">ip</span></span></span> <span class="main">@</span> <span class="inner_quoted">'']''</span>"</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipaddr_generic_toString <span class="main">(</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span><span class="numeral">168</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''[IP address (32 bit): 3232235521]''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹IPv4 Pretty Printing›</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">dotteddecimal_toString</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">×</span> nat <span class="main">×</span> nat <span class="main">×</span> nat <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">dotteddecimal_toString</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">=</span>
      string_of_nat <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">@</span><span class="inner_quoted">''.''</span><span class="main">@</span>string_of_nat <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">@</span><span class="inner_quoted">''.''</span><span class="main">@</span>string_of_nat <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">@</span><span class="inner_quoted">''.''</span><span class="main">@</span>string_of_nat <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipv4addr_toString</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv4addr <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipv4addr_toString</span> <span class="free"><span class="bound"><span class="entity">ip</span></span></span> <span class="main">=</span> dotteddecimal_toString <span class="main">(</span>dotdecimal_of_ipv4addr <span class="free"><span class="bound"><span class="entity">ip</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv4addr_toString <span class="main">(</span>ipv4addr_of_dotdecimal <span class="main">(</span><span class="numeral">192</span><span class="main">,</span> <span class="numeral">168</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''192.168.0.1''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correctness Theorems:›</span></span>
  <span class="keyword1"><span class="command">thm</span></span> dotdecimal_of_ipv4addr_ipv4addr_of_dotdecimal
      ipv4addr_of_dotdecimal_dotdecimal_of_ipv4addr



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹IPv6 Pretty Printing›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipv6addr_toString</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv6addr <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ipv6addr_toString</span> <span class="free"><span class="bound"><span class="entity">ip</span></span></span> <span class="main">=</span> <span class="main">(</span>
      <span class="keyword1">let</span> <span class="bound">partslist</span> <span class="main">=</span> ipv6_preferred_to_compressed <span class="main">(</span>int_to_ipv6preferred <span class="free"><span class="bound"><span class="entity">ip</span></span></span><span class="main">)</span><span class="main">;</span>
          <span class="comment1">― ‹add empty lists to the beginning and end if omission occurs at start/end›</span>
          <span class="comment1">― ‹to join over <span class="antiquoted"><span class="operator">▩</span><span class="raw_text">‹:›</span></span> properly›</span>
          <span class="bound">fix_start</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ps</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">ps</span> <span class="keyword1">of</span> None<span class="main">#</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">#</span><span class="bound">ps</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">ps</span><span class="main">)</span><span class="main">;</span>
          <span class="bound">fix_end</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ps</span><span class="main">.</span> <span class="keyword1">case</span> rev <span class="bound">ps</span> <span class="keyword1">of</span> None<span class="main">#</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">ps</span><span class="main">@</span><span class="main">[</span>None<span class="main">]</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">ps</span><span class="main">)</span>
      <span class="keyword1">in</span> list_separated_toString <span class="inner_quoted">'':''</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">pt</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">pt</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="inner_quoted">''''</span>
                      <span class="main">|</span>  Some <span class="bound">w</span> <span class="main">⇒</span> hex_string_of_word0 <span class="bound">w</span><span class="main">)</span>
        <span class="main">(</span><span class="main">(</span><span class="bound">fix_end</span> <span class="main">∘</span> <span class="bound">fix_start</span><span class="main">)</span> <span class="bound">partslist</span><span class="main">)</span>
      <span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0xDB8</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x8</span> <span class="numeral">0x800</span> <span class="numeral">0x200C</span> <span class="numeral">0x417A</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> <span class="inner_quoted">''2001:db8::8:800:200c:417a''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">― ‹a unicast address›</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0xFF01</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0101</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="inner_quoted">''ff01::101''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">― ‹a multicast address›</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int <span class="main">(</span>IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="numeral">0x8</span> <span class="numeral">0x800</span> <span class="numeral">0x200C</span> <span class="numeral">0x417A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="inner_quoted">''::8:800:200c:417a''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0xDB8</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="inner_quoted">''2001:db8::''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> 
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0xFF00</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="inner_quoted">''ff00::''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">― ‹Multicast›</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0xFE80</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="inner_quoted">''fe80::''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">― ‹Link-Local unicast›</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int <span class="main">(</span>IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="inner_quoted">''::''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">― ‹unspecified address›</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int <span class="main">(</span>IPv6AddrPreferred <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="inner_quoted">''::1''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">― ‹loopback address›</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int
          <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0xdb8</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="inner_quoted">''2001:db8::1''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">― ‹Section 4.1 of RFC5952›</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int
          <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0xdb8</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x2</span> <span class="numeral">0x1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="inner_quoted">''2001:db8::2:1''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">― ‹Section 4.2.1 of RFC5952›</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int
          <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0xdb8</span> <span class="numeral">0x0</span> <span class="numeral">0x1</span> <span class="numeral">0x1</span> <span class="numeral">0x1</span> <span class="numeral">0x1</span> <span class="numeral">0x1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="inner_quoted">''2001:db8:0:1:1:1:1:1''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">― ‹Section 4.2.2 of RFC5952›</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int
          <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x1</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="inner_quoted">''2001:0:0:1::1''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">― ‹Section 4.2.3 of RFC5952›</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int
          <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0x2001</span> <span class="numeral">0xdb8</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x1</span> <span class="numeral">0x0</span> <span class="numeral">0x0</span> <span class="numeral">0x1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="inner_quoted">''2001:db8::1:0:0:1''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">― ‹Section 4.2.3 of RFC5952›</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString max_ipv6_addr <span class="main">=</span> <span class="inner_quoted">''ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ipv6addr_toString <span class="main">(</span>ipv6preferred_to_int
           <span class="main">(</span>IPv6AddrPreferred <span class="numeral">0xffff</span> <span class="numeral">0xffff</span> <span class="numeral">0xffff</span> <span class="numeral">0xffff</span> <span class="numeral">0xffff</span> <span class="numeral">0xffff</span> <span class="numeral">0xffff</span> <span class="numeral">0xffff</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="inner_quoted">''ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correctness Theorems:›</span></span>
  <span class="keyword1"><span class="command">thm</span></span> ipv6_preferred_to_compressed
      ipv6_preferred_to_compressed_RFC_4291_format
      ipv6_unparsed_compressed_to_preferred_identity1
      ipv6_unparsed_compressed_to_preferred_identity2
      RFC_4291_format
      ipv6preferred_to_int_int_to_ipv6preferred
      int_to_ipv6preferred_ipv6preferred_to_int


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Prefix_Match_toString">
<div class="head">
<h1>Theory Prefix_Match_toString</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Prefix_Match_toString
<span class="keyword2"><span class="keyword">imports</span></span> <a href="IP_Address_toString.html">IP_Address_toString</a> <a href="Prefix_Match.html">Prefix_Match</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prefix_match_32_toString</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">32</span> prefix_match <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prefix_match_32_toString</span> <span class="free"><span class="bound"><span class="entity">pfx</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">pfx</span></span></span> <span class="keyword1">of</span> PrefixMatch <span class="bound">p</span> <span class="bound">l</span> <span class="main">⇒</span> ipv4addr_toString <span class="bound">p</span> <span class="main">@</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">l</span> <span class="main">≠</span> <span class="numeral">32</span> <span class="keyword1">then</span> <span class="inner_quoted">''/''</span> <span class="main">@</span> string_of_nat <span class="bound">l</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prefix_match_128_toString</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">128</span> prefix_match <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prefix_match_128_toString</span> <span class="free"><span class="bound"><span class="entity">pfx</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">pfx</span></span></span> <span class="keyword1">of</span> PrefixMatch <span class="bound">p</span> <span class="bound">l</span> <span class="main">⇒</span> ipv6addr_toString <span class="bound">p</span> <span class="main">@</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">l</span> <span class="main">≠</span> <span class="numeral">128</span> <span class="keyword1">then</span> <span class="inner_quoted">''/''</span> <span class="main">@</span> string_of_nat <span class="bound">l</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>