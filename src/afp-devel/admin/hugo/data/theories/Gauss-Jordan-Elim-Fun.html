<div id="Gauss_Jordan_Elim_Fun">
<div class="head">
<h1>Theory Gauss_Jordan_Elim_Fun</h1>
</div>
<pre class="source"><span class="comment1">(*  Gauss-Jordan elimination for matrices represented as functions
    Author: Tobias Nipkow
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Gauss-Jordan elimination algorithm›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Gauss_Jordan_Elim_Fun
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Matrices are functions:›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> matrix <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In order to restrict to finite matrices, a matrix is usually combined
with one or two natural numbers indicating the maximal row and column of the
matrix.

Gauss-Jordan elimination is parameterized with a natural number <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>. It indicates that the matrix <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>A›</span></span></span></span> has <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> rows and columns.
In fact, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>A›</span></span></span></span> is the augmented matrix with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n+1›</span></span></span></span> columns. Column
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> is the ``right-hand side'', i.e.\ the constant vector <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span>. The result is the unit matrix augmented with the solution in column
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>; see the correctness theorem below.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">gauss_jordan</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span>matrix <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>matrix option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">gauss_jordan</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span> <span class="main">=</span> Some<span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">gauss_jordan</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">case</span> dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">]</span> <span class="keyword1">of</span>
   <span class="main">[]</span> <span class="main">⇒</span> None <span class="main">|</span>
   <span class="bound">p</span> <span class="main">#</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">Ap'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">p</span> <span class="bound">j</span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">;</span>
         <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="bound">p</span> <span class="keyword1">then</span> <span class="bound">Ap'</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">*</span> <span class="bound">Ap'</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">in</span> <span class="free">gauss_jordan</span> <span class="main">(</span>Fun.swap <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">A'</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some auxiliary functions:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">solution</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span>matrix <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">solution</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">j</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span>matrix <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">unit</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">≤</span><span class="bound">j</span> <span class="main">⟶</span> <span class="bound">j</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gauss_Jordan_Elim_Fun-solution_swap"><span class="command">lemma</span></span> solution_swap<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"solution <span class="main">(</span>Fun.swap <span class="free">p1</span> <span class="free">p2</span> <span class="free">A</span><span class="main">)</span> <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> solution <span class="free">A</span> <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p1</span><span class="main">=</span><span class="free">p2</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms False <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solution_def Fun.swap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> solution_def<span class="main">)</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">n</span>"</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">A</span> <span class="skolem">i</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="skolem">i</span> <span class="free">n</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="free">p1</span>"</span></span>
       <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> assms False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solution_def Fun.swap_def<span class="main">)</span>
     <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≠</span><span class="free">p1</span>"</span></span>
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="free">p2</span>"</span></span>
         <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> assms False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solution_def Fun.swap_def<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≠</span><span class="free">p2</span>"</span></span>
         <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">≠</span><span class="free">p1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&lt;</span><span class="free">n</span>›</span></span> assms False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solution_def Fun.swap_def<span class="main">)</span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Converting these apply scripts makes them blow up - see above *)</span>

<span class="keyword1" id="Gauss_Jordan_Elim_Fun-solution_upd1"><span class="command">lemma</span></span> solution_upd1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> solution <span class="main">(</span><span class="free">A</span><span class="main">(</span><span class="free">p</span><span class="main">:=</span><span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">A</span> <span class="free">p</span> <span class="bound">j</span> <span class="main">/</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> solution <span class="free">A</span> <span class="free">n</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">&lt;</span><span class="free">n</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solution_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solution_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span><span class="main">=</span><span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_divide_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> eq_divide_eq <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_divide_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> eq_divide_eq <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Gauss_Jordan_Elim_Fun-solution_upd_but1"><span class="command">lemma</span></span> solution_upd_but1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">ap</span> <span class="main">=</span> <span class="free">A</span> <span class="free">p</span><span class="main">;</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">≠</span><span class="free">p</span> <span class="main">⟶</span> <span class="free">a</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">A</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">;</span> <span class="free">p</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
 solution <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="free">p</span> <span class="keyword1">then</span> <span class="free">ap</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">a</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">-</span> <span class="free">c</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">ap</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span> <span class="free">x</span> <span class="main">=</span>
 solution <span class="free">A</span> <span class="free">n</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solution_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> sum_subtractf sum_distrib_left<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span><span class="main">=</span><span class="free">p</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> sum_subtractf sum_distrib_left<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> all_conj_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Correctness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The correctness proof:›</span></span>

<span class="keyword1" id="Gauss_Jordan_Elim_Fun-gauss_jordan_lemma"><span class="command">lemma</span></span> gauss_jordan_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">≤</span><span class="free">n</span> <span class="main">⟹</span> unit <span class="free">A</span> <span class="free">m</span> <span class="free">n</span> <span class="main">⟹</span> gauss_jordan <span class="free">A</span> <span class="free">m</span> <span class="main">=</span> Some <span class="free">B</span> <span class="main">⟹</span>
  unit <span class="free">B</span> <span class="main">0</span> <span class="free">n</span> <span class="main">∧</span> solution <span class="free">A</span> <span class="free">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">B</span> <span class="bound">j</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a</span> <span class="keyword1">then</span> <span class="skolem">b</span> <span class="keyword1">else</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a</span> <span class="keyword1">then</span> <span class="skolem">b</span><span class="main">*</span><span class="skolem">d</span> <span class="keyword1">else</span> <span class="skolem">c</span><span class="main">*</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_def solution_def sum.If_cases<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ap'</span> <span class="free">p</span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">A</span> <span class="free">p</span> <span class="bound">j</span> <span class="main">/</span> <span class="skolem">A</span> <span class="free">p</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A'</span> <span class="free">p</span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="free">p</span> <span class="keyword1">then</span> <span class="var">?Ap'</span> <span class="free">p</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">-</span> <span class="skolem">A</span> <span class="bound">i</span> <span class="skolem">m</span> <span class="main">*</span> <span class="var">?Ap'</span> <span class="free">p</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gauss_jordan <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">B</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">ks</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">i</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">#</span><span class="skolem">ks</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    rec<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_jordan <span class="main">(</span>Fun.swap <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">(</span><span class="var">?A'</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">=</span> Some <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≤</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dropWhile_eq_Cons_conv <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>upt_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_upt atLeast0AtMost atLeastLessThanSuc_atLeastAtMost atMost_iff in_set_conv_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≤</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&lt;</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">m</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unit <span class="main">(</span>Fun.swap <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">(</span><span class="var">?A'</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> p
    <span class="keyword1"><span class="command">unfolding</span></span> unit_def Fun.swap_def Suc_le_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_less<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc.hyps<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">≤</span><span class="free">n</span>›</span></span> this rec<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">&lt;</span><span class="free">n</span>›</span></span> p
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solution_swap solution_upd1 solution_upd_but1<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> <span class="var">?Ap'</span> <span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> gauss_jordan_correct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"gauss_jordan <span class="free">A</span> <span class="free">n</span> <span class="main">=</span> Some <span class="free">B</span> <span class="main">⟹</span> solution <span class="free">A</span> <span class="free">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">B</span> <span class="bound">j</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>gauss_jordan_lemma<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span> unit_def  <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">solution2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span>matrix <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">solution2</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">j</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">usolution</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span>
  solution2 <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> solution2 <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gauss_Jordan_Elim_Fun-non_null_if_pivot"><span class="command">lemma</span></span> non_null_if_pivot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"usolution <span class="free">A</span> <span class="free">m</span> <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">A</span> <span class="bound">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">A</span> <span class="bound">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span><span class="main">&lt;</span><span class="free">m</span> <span class="main">⟹</span> <span class="free">A</span> <span class="bound">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">≠</span><span class="free">q</span> <span class="main">⟶</span> <span class="skolem">y</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">x</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="skolem">i</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">A</span> <span class="skolem">i</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> solution2_def usolution_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&lt;</span><span class="free">m</span>›</span></span><span class="main">]</span> 2
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> <span class="free">A</span> <span class="skolem">i</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="skolem">i</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"solution2 <span class="free">A</span> <span class="free">m</span> <span class="free">n</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solution2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"solution2 <span class="free">A</span> <span class="free">m</span> <span class="free">n</span> <span class="main">(</span><span class="free">x</span><span class="main">(</span><span class="free">q</span><span class="main">:=</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"solution2 <span class="free">A</span> <span class="free">m</span> <span class="free">n</span> <span class="main">(</span><span class="free">x</span><span class="main">(</span><span class="free">q</span><span class="main">:=</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> zero_neq_one <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usolution_def<span class="main">)</span>
       <span class="main">(</span><span class="operator">metis</span> fun_upd_same zero_neq_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gauss_Jordan_Elim_Fun-lem1"><span class="command">lemma</span></span> lem1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>field"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Gauss_Jordan_Elim_Fun-lem2"><span class="command">lemma</span></span> lem2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>field"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Complete›</span></span>

<span class="keyword1" id="Gauss_Jordan_Elim_Fun-gauss_jordan_complete"><span class="command">lemma</span></span> gauss_jordan_complete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> usolution <span class="free">A</span> <span class="free">m</span> <span class="free">n</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">B</span><span class="main">.</span> gauss_jordan <span class="free">A</span> <span class="free">m</span> <span class="main">=</span> Some <span class="bound">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">m</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≤</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&lt;</span>Suc <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> non_null_if_pivot<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">&lt;</span>Suc <span class="skolem">m</span>›</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">&lt;</span>Suc <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">p'</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">i</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeast0LessThan<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> lessThan_iff linorder_neqE_nat not_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">i</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">#</span><span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≤</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dropWhile_eq_Cons_conv <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> upt_Suc<span class="main">)</span>
       <span class="main">(</span><span class="operator">metis</span> set_upt atLeast0AtMost atLeastLessThanSuc_atLeastAtMost atMost_iff in_set_conv_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> Suc <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ap'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="bound">j</span> <span class="main">/</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="skolem">p</span> <span class="keyword1">then</span> <span class="var">?Ap'</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">-</span> <span class="skolem">A</span> <span class="bound">i</span> <span class="skolem">m</span> <span class="main">*</span> <span class="var">?Ap'</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Fun.swap <span class="skolem">p</span> <span class="skolem">m</span> <span class="var">?A'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"solution2 <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usolution_def<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> le_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> Suc <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">i</span> <span class="bound">j</span> <span class="main">-</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="skolem">m</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="bound">j</span> <span class="main">/</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">.</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">x</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">-</span>
      <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">.</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">x</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">x</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="skolem">m</span> <span class="main">/</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> sum_subtractf sum_divide_distrib
                    sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="free">n</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="skolem">m</span> <span class="main">/</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A le_m
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solution2_def <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sum.op_ivl_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">i</span> <span class="bound">j</span> <span class="main">-</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="skolem">m</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="bound">j</span> <span class="main">/</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span>
      <span class="skolem">A</span> <span class="skolem">i</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="free">n</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="skolem">m</span> <span class="main">/</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"solution2 <span class="var">?A</span> <span class="skolem">m</span> <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solution2_def Fun.swap_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"solution2 <span class="var">?A</span> <span class="skolem">m</span> <span class="free">n</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">(</span><span class="skolem">m</span> <span class="main">:=</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="free">n</span> <span class="main">/</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"solution2 <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">n</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> solution2_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">m</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">.</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="bound">j</span> <span class="main">*</span> <span class="var">?y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> p <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> a<span class="main">[</span><span class="operator">unfolded</span> solution2_def<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> p<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">m</span> <span class="skolem">m</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="free">n</span> <span class="main">+</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">y</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">m</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">m</span> <span class="free">n</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">A</span> <span class="skolem">m</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">y</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fun.swap_def <span class="dynamic"><span class="dynamic">field_simps</span></span> sum_subtractf lem1 lem2 sum_divide_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
                     <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> a<span class="main">[</span><span class="operator">unfolded</span> solution2_def<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> p<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">i</span> <span class="skolem">m</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="free">n</span> <span class="main">+</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">y</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">i</span> <span class="free">n</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">y</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">A</span> <span class="skolem">p</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fun.swap_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
              <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> sum_subtractf lem1 lem2 sum_divide_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="skolem">p</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹usolution <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">n</span> <span class="free">x</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>Suc <span class="skolem">m</span><span class="main">.</span> <span class="var">?y</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">x</span> <span class="bound">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usolution_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">y</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">x</span> <span class="bound">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> less_SucI nat_neq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"usolution <span class="var">?A</span> <span class="skolem">m</span> <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> usolution_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc.IH<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">≤</span><span class="free">n</span>›</span></span> this<span class="main">]</span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Future work: extend the proof to matrix inversion.›</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> unit

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>