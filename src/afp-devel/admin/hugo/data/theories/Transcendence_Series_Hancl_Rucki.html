<div id="Transcendence_Series">
<div class="head">
<h1>Theory Transcendence_Series</h1>
</div>
<pre class="source"><span class="comment1">(* Title:     Transcendence_Series.thy
   Authors:   Angeliki Koutsoukou-Argyraki and Wenda Li, University of Cambridge
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The transcendence of certain infinite series›</span></span>
<span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Transcendence_Series"</span> <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../../HOL/HOL-Analysis/Multivariate_Analysis.html">HOL-Analysis.Multivariate_Analysis</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial.html">HOL-Computational_Algebra.Polynomial</a>"</span>
    <a href="../Prime_Number_Theorem/Prime_Number_Theorem_Library.html">Prime_Number_Theorem.Prime_Number_Theorem_Library</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We formalise the proofs of two transcendence criteria by J. Han\v{c}l and P. Rucki that
assert the transcendence of the sums of certain infinite series built up by sequences that 
fulfil certain properties (Theorems 2.1 and 2.2 in \cite{hancl2005}, HanclRucki1 and HanclRucki2 
here respectively). Both proofs make use of Roth's celebrated theorem on diophantine approximations 
to algebraic numbers from 1955 \cite{roth_1955} which we assume and implement within the locale 
RothsTheorem.

A small mistake was detected in the original proof of Theorem 2.1, and the authors gave us a fix for the problem (by email). 
Our formalised proof incorporates this correction (see the Remark in the proof of HanclRucki1).
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>

<span class="keyword1" id="Transcendence_Series-powr_less_inverse_iff"><span class="command">lemma</span></span> powr_less_inverse_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">z</span> <span class="keyword1">powr</span> <span class="main">(</span>inverse <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> powr_less_mono2<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="free">y</span>"</span></span><span class="main">]</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">z</span> <span class="keyword1">powr</span> inverse <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>powr_powr<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">z</span> <span class="keyword1">powr</span> inverse <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> powr_less_mono2<span class="main">[</span><span class="operator">OF</span> _ _ *<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>powr_powr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Transcendence_Series-powr_less_inverse_iff'"><span class="command">lemma</span></span> powr_less_inverse_iff'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">&lt;</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">z</span> <span class="keyword1">powr</span> <span class="main">(</span>inverse <span class="free">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> powr_less_inverse_iff<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"inverse <span class="free">y</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Transcendence_Series-powr_less_eq_inverse_iff"><span class="command">lemma</span></span> powr_less_eq_inverse_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="keyword1">powr</span> <span class="main">(</span>inverse <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms not_less powr_less_inverse_iff'<span class="main">)</span>

<span class="keyword1" id="Transcendence_Series-powr_less_eq_inverse_iff'"><span class="command">lemma</span></span> powr_less_eq_inverse_iff'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">z</span> <span class="keyword1">powr</span> <span class="main">(</span>inverse <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms powr_less_eq_inverse_iff<span class="main">)</span>

<span class="keyword1" id="Transcendence_Series-tendsto_PInfty_mono"><span class="command">lemma</span></span> tendsto_PInfty_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ereal <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">∞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ereal <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> comp_def tendsto_PInfty_eq_at_top
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> filterlim_at_top_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Transcendence_Series-limsup_infinity_imp_Inf_many"><span class="command">lemma</span></span> limsup_infinity_imp_Inf_many<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"limsup <span class="free">f</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">&gt;</span> ereal <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> INFM_nat
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="skolem">k</span><span class="main">.</span> ereal <span class="skolem">m</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="skolem">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">≤</span> ereal <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">≤</span> ereal <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_at_top_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"limsup <span class="free">f</span> <span class="main">≤</span> ereal <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Limsup_bounded <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Transcendence_Series-snd_quotient_plus_leq"><span class="command">lemma</span></span> snd_quotient_plus_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">de</span><span class="main">≡</span><span class="main">(</span>snd <span class="keyword1">o</span> quotient_of<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">de</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">de</span> <span class="free">x</span> <span class="main">*</span> <span class="free">de</span> <span class="free">y</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>                                
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">y</span><span class="main">=</span><span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> surj_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy quotient_of_denom_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> de_def comp_def rat_plus_code xy 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Rat.normalize_def Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> div_by_1 gcd_pos_int int_div_less_self mult_eq_0_iff mult_sign_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Transcendence_Series-quotient_of_inj"><span class="command">lemma</span></span> quotient_of_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj quotient_of"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inj_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_of_inject<span class="main">)</span>

<span class="keyword1" id="Transcendence_Series-infinite_inj_imageE"><span class="command">lemma</span></span> infinite_inj_imageE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms inj_on_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Transcendence_Series-incseq_tendsto_limsup"><span class="command">lemma</span></span> incseq_tendsto_limsup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>complete_linorder<span class="main">,</span>linorder_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"incseq <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⇢</span> limsup <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> LIMSEQ_SUP assms convergent_def convergent_ereal tendsto_Limsup 
          trivial_limit_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Main proofs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Since the proof of Roth's theorem has not been formalized yet, we formalize the statement in a locale 
      and use it as an assumption.›</span></span>
<span class="keyword1"><span class="command">locale</span></span> RothsTheorem <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> RothsTheorem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ξ</span> <span class="bound">κ</span><span class="main">.</span> algebraic <span class="bound">ξ</span> <span class="main">∧</span> <span class="bound">ξ</span> <span class="main">∉</span> <span class="main">ℚ</span> <span class="main">∧</span> infinite <span class="main">{</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> 
            coprime <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="main">¦</span><span class="bound">ξ</span> <span class="main">-</span> of_int <span class="bound">p</span> <span class="main">/</span> of_int <span class="bound">q</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">q</span> <span class="keyword1">powr</span> <span class="bound">κ</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">κ</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RothsTheorem<span class="main">)</span> HanclRucki1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">δ</span> <span class="main">::</span><span class="quoted">real</span> 
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">aa</span><span class="main">≡</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">bb</span><span class="main">≡</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">b</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">k</span><span class="main">.</span> <span class="free">a</span> <span class="bound">k</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">k</span><span class="main">.</span> <span class="free">b</span> <span class="bound">k</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> limsup_infy<span class="main">:</span><span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">.</span> <span class="free">aa</span> <span class="bound">i</span><span class="main">)</span><span class="keyword1">powr</span><span class="main">(</span><span class="numeral">2</span><span class="main">+</span><span class="free">δ</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">bb</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> liminf_1<span class="main">:</span><span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> algebraic<span class="main">(</span>suminf  <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> summable<span class="main">:</span><span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ratio_test_convergence<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">aa</span> <span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bb</span> <span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">unfolding</span></span> aa_def bb_def <span class="keyword1"><span class="command">using</span></span> a_pos b_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">bb</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="free">bb</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">n</span> <span class="main">/</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> liminf_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">aa</span> <span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bb</span> <span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="keyword1"><span class="command">unfolding</span></span> aa_def bb_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_pos b_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ab_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">aa</span> <span class="skolem">k</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bb</span> <span class="skolem">k</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">unfolding</span></span> aa_def bb_def <span class="keyword1"><span class="command">using</span></span> a_pos b_pos 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_one_le_iff_zero_less<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≡</span> liminf <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">(</span><span class="free">aa</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">bb</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">B</span> <span class="keyword1">of</span> ereal <span class="bound">m</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">&lt;</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> liminf_1 <span class="keyword1"><span class="command">unfolding</span></span> M_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def B_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> ereal.split<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Remark:
In the original proof of Theorem 2.1 in \cite{hancl2005}
it was claimed in p.534 that from assumption (3) (i.e. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> liminf_1<span class="antiquote"><span class="antiquote">}</span></span></span></span>),
we obtain that:
$\forall A&gt;1~\exists k_0~ \forall k &gt; k_0~ \frac{1}{A} \frac{b_k}{ a_k} &gt; \frac{ b_{k+1}}{ a_{k+1}} $,
 however note the counterexample  where
$a_{k+1}= k (a_1 a_2 ... a_k)^{\lceil 2+ \delta \rceil}$ if k is odd, and
$a_{k+1} = 2 a_k$ otherwise, with $b_k =1$ for all $k$.
In commmunication by email the authors suggested to replace the claim 
$\forall A&gt;1~\exists k_0~ \forall k &gt; k_0~ \frac{1}{A} \frac{b_k}{ a_k} &gt; \frac{ b_{k+1}}{ a_{k+1}} $
with
$\exists A&gt;1~\exists k_0~ \forall k &gt; k_0~ \frac{1}{A} \frac{b_k}{ a_k} &gt; \frac{ b_{k+1}}{ a_{k+1}} $
which solves the problem and the proof proceeds as in the paper.
The witness for $\exists A&gt;1 $ is denoted by $M$ here.›</span></span>

  <span class="keyword1"><span class="command">have</span></span> bb_aa_event<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">k</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span><span class="main">&gt;</span> <span class="free">bb</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_LiminfD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">&lt;</span> <span class="skolem">B</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> B_def<span class="main"><span class="main">]</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">field_simps</span></span>›</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> bb_aa_p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">k</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="free">bb</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="bound">p</span><span class="main">)</span><span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="bound">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">M</span><span class="main">^</span><span class="bound">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k0</span></span> <span class="keyword2"><span class="keyword">where</span></span> k0_ineq<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">k0</span><span class="main">.</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">M</span> <span class="main">*</span> <span class="main">(</span><span class="free">bb</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> bb_aa_event <span class="keyword1"><span class="command">unfolding</span></span> eventually_sequentially
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bb</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">p</span><span class="main">)</span><span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">M</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">bb</span> <span class="skolem">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≥</span><span class="skolem">k0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> Suc <span class="skolem">p</span><span class="main">)</span>  <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">M</span> <span class="main">*</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">p</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> k0_ineq<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="skolem">p</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">M</span> <span class="main">^</span><span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">bb</span> <span class="skolem">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc <span class="quoted"><span class="quoted">‹<span class="skolem">M</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ξ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> suminf <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ξ_Inf_many<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span>  <span class="main">1</span> <span class="main">/</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">i</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">unfolding</span></span> ξ_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> suminf_minus_initial_segment<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">OF</span> summable<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> atLeast0AtMost lessThan_Suc_atMost <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">¦</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">bb</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>
                            <span class="main">&lt;</span>  <span class="main">1</span> <span class="main">/</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">p</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">p</span><span class="main">)</span>
                                          <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">M</span> <span class="main">^</span> <span class="bound">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">M</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">M</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">&lt;</span> ereal <span class="main">(</span><span class="free">aa</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">i</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bb_aa_p<span class="main">[</span><span class="operator">THEN</span> sequentially_offset<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> cofinite_eq_sequentially
        <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> limsup_infy<span class="main">[</span><span class="operator">THEN</span> limsup_infinity_imp_Inf_many<span class="main">,</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">M</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">M</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> Q_def <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">bb</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>
                            <span class="main">&lt;</span>  <span class="main">1</span> <span class="main">/</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> summable_M<span class="main">:</span><span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">M</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> summable_ratio_test<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">M</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> suminf_nonneg<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> summable_ignore_initial_segment<span class="main">[</span><span class="operator">OF</span> summable<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> 
                      <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">M</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> suminf_le<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> summable_ignore_initial_segment<span class="main">[</span><span class="operator">OF</span> summable<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> summable_mult2<span class="main">[</span><span class="operator">OF</span> summable_M<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">" <span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">M</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> suminf_mult2<span class="main">[</span><span class="operator">OF</span> summable_M<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">" <span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">M</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">M</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> suminf_geometric<span class="main">)</span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span><span class="main">&gt;</span><span class="main">1</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> 
                            prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_less_cancel_left_pos<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ab_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">k</span></span>"</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> INFM_conjI INFM_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pq</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> quotient_of <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≡</span> fst <span class="main">∘</span> <span class="skolem">pq</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> snd <span class="main">∘</span> <span class="skolem">pq</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> coprime_pq<span class="main">:</span><span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">p</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> q_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pq_sum<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">k</span> <span class="main">/</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">b</span> <span class="bound">i</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="skolem">k</span><span class="main">,</span> <span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def q_def pq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> quotient_of_coprime<span class="main">[</span><span class="operator">OF</span> eq<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">p</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> eq<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">b</span> <span class="bound">i</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> of_rat <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_sum of_rat_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 rat_of_int <span class="main">(</span><span class="skolem">p</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span><span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> eq<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">k</span> <span class="main">/</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">b</span> <span class="bound">i</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>of_rat_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> ξ_Inf_many2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="skolem">p</span> <span class="bound">k</span> <span class="main">/</span> <span class="skolem">q</span> <span class="bound">k</span><span class="main">¦</span> <span class="main">&lt;</span>  <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ξ_Inf_many
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> INFM_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> real_of_int <span class="main">(</span><span class="skolem">p</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span><span class="main">¦</span> 
              <span class="main">=</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pq_sum <span class="keyword1"><span class="command">unfolding</span></span> aa_def bb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">k</span> <span class="main">≤</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def pq_def aa_def 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rat_divide_code of_int_rat quotient_of_Fract<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> ab_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">,</span><span class="operator">unfolded</span> aa_def bb_def<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Let_def normalize_def 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_by_1 gcd_pos_int less_imp_le less_trans nonneg1_imp_zdiv_pos_iff 
                not_less zdiv_mono2<span class="main">)</span>  
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">de</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">de</span> <span class="main">≡</span>snd <span class="main">∘</span> quotient_of"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="skolem">q</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="skolem">de</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span>Suc <span class="skolem">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> q_def pq_def de_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">de</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">+</span> of_int <span class="main">(</span><span class="free">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">de</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">*</span> <span class="skolem">de</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>          
          <span class="keyword1"><span class="command">using</span></span> snd_quotient_plus_leq<span class="main">[</span><span class="operator">folded</span> de_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">de</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> q_def pq_def de_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="main">*</span> snd <span class="main">(</span>Rat.normalize <span class="main">(</span><span class="free">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">,</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rat_divide_code of_int_rat quotient_of_Fract de_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">aa</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ab_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">k</span></span>"</span></span></span><span class="main">]</span> q_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span>"</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">unfolding</span></span> normalize_def aa_def bb_def Let_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_by_1 int_one_le_iff_zero_less less_trans 
                  nonneg1_imp_zdiv_pos_iff not_less zdiv_mono2 zero_less_one<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span>  prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="main">*</span> <span class="free">aa</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc ab_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">k</span></span>"</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>Suc <span class="skolem">k</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.atLeast0_atMost_Suc<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">δ</span>›</span></span> frac_le of_int_0 of_int_le_iff powr_gt_zero 
                  powr_mono2 q_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> real_of_int <span class="main">(</span><span class="skolem">p</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pqs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pqs</span> <span class="main">≡</span><span class="main">{</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> coprime <span class="bound">p</span> <span class="bound">q</span> 
      <span class="main">∧</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> real_of_int <span class="bound">p</span> <span class="main">/</span> real_of_int <span class="bound">q</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ξ_infinite<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="skolem">pqs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span>  <span class="main">(</span><span class="skolem">p</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span>  <span class="main">(</span><span class="skolem">q</span> <span class="bound">k</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">q</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="skolem">p</span> <span class="bound">k</span> <span class="main">/</span> <span class="skolem">q</span> <span class="bound">k</span><span class="main">¦</span> <span class="main">&lt;</span>  <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ξ_Inf_many2 <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Inf_many_def A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">k</span><span class="main">,</span> <span class="skolem">q</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> g_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_pos b_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_def f_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="main">-</span> sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> sum <span class="skolem">g</span> <span class="main">{</span><span class="skolem">x</span><span class="main">&lt;..</span><span class="skolem">y</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span>  Groups_Big.sum_diff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">sum</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ordered_comm_monoid_add_class.sum_pos<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>›</span></span> g_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="main">-</span> sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">&lt;</span> sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strict_mono_imp_inj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>quotient_of <span class="keyword1">o</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_compose quotient_of_inj<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">k</span><span class="main">,</span> <span class="skolem">q</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def p_def q_def pq_def comp_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> g_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>subset_inj_on<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">k</span><span class="main">,</span> <span class="skolem">q</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">pqs</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> A_def pqs_def <span class="keyword1"><span class="command">using</span></span> coprime_pq q_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> infinite_inj_imageE<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">pqs</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> ξ_mn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="skolem">m</span> <span class="main">/</span> of_int <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">m</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> mn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="skolem">m</span> <span class="main">/</span> of_nat <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">m</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Rats_abs_nat_div_natE<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">∈</span> <span class="main">ℚ</span>›</span></span> Rats_abs_nat_div_natE<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">n'</span></span><span class="main">::</span><span class="quoted">int</span> 
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span><span class="main">=</span><span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ξ</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> nat <span class="skolem">m</span> <span class="keyword1">else</span> <span class="main">-</span>nat <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">=</span>nat <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="skolem">m'</span> <span class="main">/</span> of_int <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">m'</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pqs</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="skolem">m</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span><span class="skolem">pqs</span> <span class="main">∧</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span>fst <span class="bound">x</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">0</span><span class="main">&lt;</span>snd <span class="bound">x</span> <span class="main">∧</span> snd <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">pqs</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≡</span> fst <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span>snd <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pq_less<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">/</span> <span class="skolem">q</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">pqs</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def q_def pqs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> q_lt_n<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≠</span><span class="skolem">p</span> <span class="main">∨</span> <span class="skolem">n</span><span class="main">≠</span><span class="skolem">q</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹coprime <span class="skolem">m</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">p</span> <span class="skolem">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_rat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> fst_conv int_one_le_iff_zero_less mult.commute normalize_stable 
                not_one_le_zero quotient_of_Fract snd_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">/</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">/</span><span class="skolem">q</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>  
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left' diff_diff_eq2 diff_zero less_irrefl not_le of_int_diff 
                of_int_lessD of_int_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pq_less <span class="keyword1"><span class="command">unfolding</span></span> ξ_mn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> powr_numeral<span class="main">)</span>
            <span class="keyword1"><span class="command">unfolding</span></span> power2_eq_square <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≤</span> real_of_int <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">1</span> <span class="main">/</span>  <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> power2_eq_square <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≠</span><span class="skolem">p</span> <span class="main">∨</span> <span class="skolem">n</span><span class="main">≠</span><span class="skolem">q</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qn</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qn</span> <span class="main">≡</span> <span class="skolem">q</span><span class="main">/</span><span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">qn</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qn</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qn_def <span class="keyword1"><span class="command">using</span></span> q_lt_n<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">≠</span><span class="skolem">p</span> <span class="main">∨</span> <span class="skolem">n</span><span class="main">≠</span><span class="skolem">q</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">m</span><span class="main">/</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">/</span> <span class="skolem">q</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pq_less <span class="keyword1"><span class="command">unfolding</span></span> ξ_mn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">p</span> <span class="main">/</span> <span class="skolem">q</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">/</span><span class="skolem">n</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">m</span><span class="main">/</span><span class="skolem">n</span><span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">/</span><span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">/</span><span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">m</span><span class="main">/</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> abs_diff_less_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span><span class="main">-</span> <span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> qn_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span><span class="main">-</span> <span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">qn</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qn</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≥</span><span class="main">0</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_eq_real_def mult_nonneg_nonneg neg_le_0_iff_le of_int_0_le_iff order_trans<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span><span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">qn</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qn</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≥</span><span class="main">0</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_le_one_le<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> of_int_0_le_iff zero_le_mult_iff<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span><span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">pqs</span><span class="main">.</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> fst <span class="bound">x</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> 
                          <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> snd <span class="bound">x</span> <span class="main">∧</span> snd <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">pqs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span><span class="skolem">pqs</span> <span class="main">∧</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span>fst <span class="bound">x</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">0</span><span class="main">&lt;</span>snd <span class="bound">x</span> <span class="main">∧</span> snd <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span><span class="main">..</span><span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span><span class="skolem">pqs</span> <span class="main">∧</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span>fst <span class="bound">x</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">0</span><span class="main">&lt;</span>snd <span class="bound">x</span> <span class="main">∧</span> snd <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">}</span> <span class="main">⊆</span> 
                <span class="main">(</span><span class="main">{</span><span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span><span class="main">..</span><span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> rev_finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ξ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> RothsTheorem<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ξ</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span>"</span></span><span class="main">,</span><span class="operator">folded</span> pqs_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> RothsTheorem<span class="main">)</span> HanclRucki2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">δ</span> <span class="free">ε</span> <span class="main">::</span><span class="quoted">real</span> 
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">aa</span><span class="main">≡</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">bb</span><span class="main">≡</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">b</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">k</span><span class="main">.</span> <span class="free">a</span> <span class="bound">k</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">k</span><span class="main">.</span> <span class="free">b</span> <span class="bound">k</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ε</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> limsup_infi<span class="main">:</span><span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span><span class="main">(</span><span class="free">aa</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">.</span> <span class="free">aa</span> <span class="bound">i</span><span class="main">)</span><span class="keyword1">powr</span><span class="main">(</span><span class="numeral">2</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="free">ε</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span>
          <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ratio_large<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span> <span class="bound">k</span> <span class="main">≥</span> <span class="free">t</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">(</span> <span class="free">aa</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="free">bb</span><span class="main">(</span> <span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">≥</span>  <span class="main">(</span><span class="main">(</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">/</span><span class="free">bb</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> algebraic<span class="main">(</span>suminf <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span><span class="free">aa</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>  "</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> aa_bb_pos<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">aa</span> <span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bb</span> <span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">unfolding</span></span> aa_def bb_def <span class="keyword1"><span class="command">using</span></span> a_pos b_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> summable<span class="main">:</span><span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c0</span><span class="main">≡</span><span class="main">(</span><span class="free">aa</span> <span class="free">t</span><span class="main">/</span><span class="free">bb</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ab_k<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">aa</span> <span class="skolem">k</span> <span class="main">/</span> <span class="free">bb</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">c0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≥</span><span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">t</span><span class="main">≤</span><span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">aa</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="free">bb</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span>
              <span class="main">≥</span> <span class="main">(</span> <span class="free">aa</span> <span class="skolem">k</span><span class="main">/</span><span class="free">bb</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> ratio_large<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="skolem">c0</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c0</span> <span class="main">+</span> <span class="free">t</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c0_def
        <span class="keyword1"><span class="command">using</span></span> aa_bb_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">linarith</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">c0</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> summable_hurwitz_zeta_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">+</span><span class="free">ε</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c0</span><span class="main">+</span><span class="free">t</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> powr_minus_divide<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> summable_offset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bb</span> <span class="skolem">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">c0</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≥</span><span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">aa</span> <span class="free">t</span> <span class="main">/</span> <span class="free">bb</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">aa</span> <span class="bound">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">bb</span> <span class="bound">k</span>›</span></span> less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">+</span> <span class="skolem">c0</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c0_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">aa</span> <span class="skolem">k</span> <span class="main">/</span> <span class="free">bb</span> <span class="skolem">k</span> <span class="main">≥</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">c0</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> ab_k<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> powr_less_eq_inverse_iff'<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span> <span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">aa</span> <span class="skolem">k</span> <span class="main">/</span> <span class="free">bb</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> inverse <span class="main">(</span><span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">c0</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> le_imp_inverse_le<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">+</span> <span class="skolem">c0</span> <span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_eq_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> summable_comparison_test'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> N<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> aa_bb_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">M</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">.</span> <span class="free">aa</span> <span class="bound">i</span><span class="main">)</span>
                  <span class="keyword1">powr</span><span class="main">(</span><span class="numeral">2</span><span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">i</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">ε</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> tt_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> tt_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> powr_gt_zero<span class="main"><span class="keyword3">,</span></span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aa_bb_pos<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> order_less_irrefl prod_pos<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">aa</span> <span class="bound">k</span>›</span></span> order_less_irrefl prod_pos<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">aa</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">tt</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> limsup_infinity_imp_Inf_many<span class="main">[</span><span class="operator">OF</span> limsup_infi<span class="main">,</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> tt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">M</span> <span class="main">*</span> <span class="skolem">tt</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> INFM_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> tt_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">M</span> <span class="main">*</span> <span class="skolem">tt</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">&gt;</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> INFM_mono powr_less_mono2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 2<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> pos_add_strict less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="skolem">i</span>  <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">unfolding</span></span> tt_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>powr_powr<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> INFM_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> nonzero_mult_div_cancel_left powr_divide powr_mult powr_one_eq_one
                that tt_pos zero_less_divide_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">k</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span>  <span class="main">(</span><span class="main">(</span> <span class="free">aa</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="bound">s</span><span class="main">)</span><span class="main">/</span><span class="free">bb</span><span class="main">(</span> <span class="bound">k</span><span class="main">+</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> 
                    <span class="main">(</span><span class="main">(</span><span class="main">(</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">/</span><span class="free">bb</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span><span class="bound">s</span><span class="main">)</span><span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">aa</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">bb</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">k</span><span class="main">+</span><span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">ff</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">s</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">k</span> <span class="main">+</span> Suc <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">ff</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span>Suc <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ratio_large<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="skolem">s</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹ <span class="free">t</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ff</span> <span class="skolem">k</span><span class="main">+</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">ff</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">+</span><span class="free">ε</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">rotated</span> 2<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>powr_powr<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_pos aa_def b_pos bb_def le_less<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">+</span>real <span class="bound">r</span><span class="main">)</span><span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">ε</span> <span class="main">*</span><span class="main">(</span><span class="skolem">z</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">ε</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">+</span> real <span class="bound">i</span><span class="main">)</span><span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">+</span> <span class="bound">r</span><span class="main">)</span><span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">/</span> <span class="free">ε</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">z</span><span class="main">-</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">/</span> <span class="free">ε</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> powr_has_integral_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">ε</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">z</span><span class="main">-</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">ε</span><span class="main">)</span> <span class="main">/</span> <span class="free">ε</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> has_integral_closure<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> negligible_convex_frontier<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_cong<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> 1<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> powr_minus_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> frac_le powr_mono2 powr_nonneg_iff that<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">ε</span> <span class="main">/</span> <span class="free">ε</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> decreasing_sum_le_integral<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">z</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">powr</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">ε</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">/</span></span> <span class="free"><span class="free">ε</span></span>"</span></span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">ε</span> <span class="main">/</span> <span class="free">ε</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">ε</span> <span class="main">*</span><span class="main">(</span><span class="skolem">z</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">ε</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">ε</span> <span class="main">*</span><span class="main">(</span><span class="skolem">z</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">ε</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span><span class="main">(</span> <span class="free">aa</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">bb</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">∞</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span><span class="main">≡</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">(</span><span class="free">aa</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">bb</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"limsup <span class="skolem">ff</span> <span class="main">=</span>  <span class="main">∞</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">i</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">ε</span> <span class="main">+</span> <span class="free">δ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">unfolding</span></span> tt_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ge_one_powr_ge_zero<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> linordered_nonzero_semiring_class.prod_ge_1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_pos aa_def int_one_le_iff_zero_less<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> less_imp_le<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>  <span class="main">(</span><span class="free">aa</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">tt</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">≤</span> limsup <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>  <span class="free">aa</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> Limsup_mono eventuallyI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> order.order_iff_strict<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aa_bb_pos<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> div_by_1 frac_less2 less_irrefl less_numeral_extra<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
            not_le<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> limsup <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>  <span class="free">aa</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">bb</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> limsup_shift<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">(</span><span class="free">aa</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">tt</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">≤</span> limsup <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">(</span><span class="free">aa</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">bb</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">(</span><span class="free">aa</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">tt</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> limsup_infi <span class="keyword1"><span class="command">unfolding</span></span> tt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">using</span></span> ereal_infty_less_eq2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">∞</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> limsup_shift_k<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"incseq <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> incseq_SucI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">gg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gg</span><span class="main">≡</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">aa</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">bb</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">gg</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> 
                <span class="main">≤</span> <span class="main">(</span><span class="skolem">gg</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ratio_large<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="free">t</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> gg_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">gg</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">≤</span> <span class="main">(</span><span class="skolem">gg</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gg</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">≤</span> <span class="skolem">gg</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> aa_bb_pos<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> aa_bb_pos<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> divide_pos_pos gg_def 
                powr_less_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">ff</span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> gg_def ff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> incseq_tendsto_limsup
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ff_def 
      <span class="keyword1"><span class="command">unfolding</span></span> tendsto_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> eventually_sequentially_seg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ξ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> suminf <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">k</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span><span class="main">¦</span> 
                        <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">ε</span> <span class="main">*</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> 8<span class="main">[</span><span class="operator">THEN</span> sequentially_offset<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main">]</span>
            u<span class="main">[</span><span class="operator">unfolded</span> tendsto_PInfty<span class="main">,</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">THEN</span> sequentially_offset
                        <span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">ε</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">ε</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">≡</span> <span class="main">(</span><span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">&gt;</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">aa</span> <span class="skolem">k</span> <span class="main">/</span> <span class="free">bb</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_pos aa_def b_pos bb_def divide_eq_0_iff less_irrefl 
                of_int_eq_0_iff powr_gt_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ratio_large<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="free">t</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> tt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">i</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ξ_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> suminf_minus_initial_segment<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">OF</span> summable<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> atLeast0AtMost lessThan_Suc_atMost <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> suminf_pos<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> summable<span class="main">[</span><span class="operator">THEN</span> summable_ignore_initial_segment<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_pos aa_def b_pos bb_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">tt</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_le<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">aa</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> real <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bb</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">ff</span> <span class="skolem">k</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">k</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">≤</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span> <span class="main">)</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> elim<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">k</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> elim<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> of_nat_0_le_iff powr_gt_zero ratio_large<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="skolem">ff</span> <span class="skolem">k</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span> <span class="main">≥</span>  <span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> le_imp_inverse_le<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_eq_divide<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">tt</span> <span class="main">+</span> real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ff_def tt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">bb</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> summable<span class="main">[</span><span class="operator">THEN</span> summable_ignore_initial_segment<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">tt</span> <span class="main">+</span> real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> 9<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">tt</span><span class="main">&gt;</span><span class="main">1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">ε</span> <span class="main">*</span><span class="main">(</span><span class="skolem">tt</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">ε</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> 9<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">tt</span></span><span class="main"><span class="main">&gt;</span></span><span class="main"><span class="main">1</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">ε</span> <span class="main">*</span><span class="skolem">tt</span> <span class="keyword1">powr</span> <span class="free">ε</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">ε</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">ε</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> elim<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">ε</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">ε</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">tt</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> tt_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> powr_less_mono2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 2<span class="main"><span class="main">,</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>powr_powr <span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> powr_one<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">tt</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">tt</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="keyword1">powr</span> <span class="free">ε</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">tt</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">ε</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> powr_less_mono2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 2<span class="main"><span class="main">,</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">ε</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tt</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>powr_powr powr_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tt</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="numeral">2</span> <span class="main">/</span> <span class="free">ε</span> <span class="main">*</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> tt_def 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>powr_powr <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> powr_divide less_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pq</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> quotient_of <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≡</span> fst <span class="main">∘</span> <span class="skolem">pq</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> snd <span class="main">∘</span> <span class="skolem">pq</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> coprime_pq<span class="main">:</span><span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">p</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> q_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pq_sum<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">k</span> <span class="main">/</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">b</span> <span class="bound">i</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="skolem">k</span><span class="main">,</span> <span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def q_def pq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> quotient_of_coprime<span class="main">[</span><span class="operator">OF</span> eq<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">p</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> eq<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">b</span> <span class="bound">i</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> of_rat <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_sum of_rat_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 rat_of_int <span class="main">(</span><span class="skolem">p</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span><span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> eq<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">k</span> <span class="main">/</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">b</span> <span class="bound">i</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>of_rat_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> ξ_Inf_many<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="skolem">p</span> <span class="bound">k</span> <span class="main">/</span> <span class="skolem">q</span> <span class="bound">k</span><span class="main">¦</span> <span class="main">&lt;</span>  <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="bound">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>
              <span class="main">&lt;</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 7<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> <span class="free">ε</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">/</span> <span class="free">ε</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>powr_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span><span class="bound">k</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span><span class="main">¦</span>
                <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">ε</span> <span class="main">*</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 10<span class="main">[</span><span class="operator">unfolded</span> cofinite_eq_sequentially<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> INFM_conjI<span class="main">[</span><span class="operator">OF</span> * **<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> INFM_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bb</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">&lt;</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                          <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span><span class="main">¦</span> 
                        <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">ε</span> <span class="main">*</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> real_of_int <span class="main">(</span><span class="skolem">p</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="skolem">q</span> <span class="skolem">k</span><span class="main">)</span><span class="main">¦</span> 
              <span class="main">=</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="free">bb</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">aa</span> <span class="bound">k</span><span class="main">)</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pq_sum <span class="keyword1"><span class="command">unfolding</span></span> aa_def bb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">bb</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">aa</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span>  <span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> <span class="free">ε</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_strict_left_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> asm <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">k</span> <span class="main">≤</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 0
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def pq_def aa_def 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rat_divide_code of_int_rat quotient_of_Fract<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> aa_bb_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">,</span><span class="operator">unfolded</span> aa_def bb_def<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Let_def normalize_def 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_by_1 less_imp_le less_trans nonneg1_imp_zdiv_pos_iff 
                not_less zdiv_mono2<span class="main">)</span>  
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">de</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">de</span> <span class="main">≡</span> snd <span class="main">∘</span> quotient_of"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="skolem">q</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="skolem">de</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span>Suc <span class="skolem">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> q_def pq_def de_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">de</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">+</span> of_int <span class="main">(</span><span class="free">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">de</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">*</span> <span class="skolem">de</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>          
            <span class="keyword1"><span class="command">using</span></span> snd_quotient_plus_leq<span class="main">[</span><span class="operator">folded</span> de_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">de</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> q_def pq_def de_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="main">*</span> snd <span class="main">(</span>Rat.normalize <span class="main">(</span><span class="free">b</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">,</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rat_divide_code of_int_rat quotient_of_Fract de_def<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">aa</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> aa_bb_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">k</span></span>"</span></span></span><span class="main">]</span> q_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span>"</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">unfolding</span></span> normalize_def aa_def bb_def Let_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_by_1 int_one_le_iff_zero_less less_trans 
                  nonneg1_imp_zdiv_pos_iff not_less zdiv_mono2 zero_less_one<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span>  prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span> <span class="main">*</span> <span class="free">aa</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Suc aa_bb_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">k</span></span>"</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> prod <span class="free">aa</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>Suc <span class="skolem">k</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.atLeast0_atMost_Suc<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> divide_left_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono2<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> q_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> 
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>powr_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aa_bb_pos<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_irrefl<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span>  <span class="skolem">p</span> <span class="skolem">k</span> <span class="main">/</span> <span class="skolem">q</span> <span class="skolem">k</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span>  <span class="skolem">q</span> <span class="skolem">k</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pqs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pqs</span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> coprime <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> real_of_int <span class="bound">p</span> <span class="main">/</span> real_of_int <span class="bound">q</span><span class="main">¦</span> 
                  <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ξ_infinite<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="skolem">pqs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span>  <span class="main">(</span><span class="skolem">p</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span>  <span class="main">(</span><span class="skolem">q</span> <span class="bound">k</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">q</span> <span class="bound">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">note</span></span> ξ_Inf_many
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Inf_many_def A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">k</span><span class="main">,</span> <span class="skolem">q</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> rat_of_int <span class="main">(</span><span class="free">b</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> g_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_pos b_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_def f_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="main">-</span> sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> sum <span class="skolem">g</span> <span class="main">{</span><span class="skolem">x</span><span class="main">&lt;..</span><span class="skolem">y</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span>  Groups_Big.sum_diff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">sum</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ordered_comm_monoid_add_class.sum_pos<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>›</span></span> g_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="main">-</span> sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">&lt;</span> sum <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strict_mono_imp_inj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>quotient_of <span class="keyword1">o</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_compose quotient_of_inj<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">k</span><span class="main">,</span> <span class="skolem">q</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def p_def q_def pq_def comp_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> g_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>subset_inj_on<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span> <span class="bound">k</span><span class="main">,</span> <span class="skolem">q</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">pqs</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> A_def pqs_def <span class="keyword1"><span class="command">using</span></span> coprime_pq q_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> infinite_inj_imageE<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">pqs</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> ξ_mn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="skolem">m</span> <span class="main">/</span> of_int <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">m</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> mn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="skolem">m</span> <span class="main">/</span> of_nat <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">m</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Rats_abs_nat_div_natE<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ξ</span> <span class="main">∈</span> <span class="main">ℚ</span>›</span></span> Rats_abs_nat_div_natE<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">n'</span></span><span class="main">::</span><span class="quoted">int</span> 
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span><span class="main">=</span><span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ξ</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> nat <span class="skolem">m</span> <span class="keyword1">else</span> <span class="main">-</span>nat <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">=</span>nat <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ξ</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="skolem">m'</span> <span class="main">/</span> of_int <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">m'</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pqs</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="skolem">m</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span><span class="skolem">pqs</span> <span class="main">∧</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span>fst <span class="bound">x</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">0</span><span class="main">&lt;</span>snd <span class="bound">x</span> <span class="main">∧</span> snd <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">pqs</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≡</span> fst <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span>snd <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pq_less<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">/</span> <span class="skolem">q</span><span class="main">¦</span> 
          <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">pqs</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def q_def pqs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> q_lt_n<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≠</span><span class="skolem">p</span> <span class="main">∨</span> <span class="skolem">n</span><span class="main">≠</span><span class="skolem">q</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹coprime <span class="skolem">m</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">p</span> <span class="skolem">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_rat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> fst_conv int_one_le_iff_zero_less mult.commute normalize_stable 
                not_one_le_zero quotient_of_Fract snd_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">/</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">/</span><span class="skolem">q</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>  
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left' diff_diff_eq2 diff_zero less_irrefl not_le of_int_diff 
                of_int_lessD of_int_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pq_less <span class="keyword1"><span class="command">unfolding</span></span> ξ_mn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> powr_numeral<span class="main">)</span>
            <span class="keyword1"><span class="command">unfolding</span></span> power2_eq_square <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> 
                          <span class="main">≤</span> real_of_int <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">1</span> <span class="main">/</span>  <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> power2_eq_square <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≠</span><span class="skolem">p</span> <span class="main">∨</span> <span class="skolem">n</span><span class="main">≠</span><span class="skolem">q</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qn</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qn</span> <span class="main">≡</span> <span class="skolem">q</span><span class="main">/</span><span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">qn</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qn</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qn_def <span class="keyword1"><span class="command">using</span></span> q_lt_n<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">≠</span><span class="skolem">p</span> <span class="main">∨</span> <span class="skolem">n</span><span class="main">≠</span><span class="skolem">q</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">m</span><span class="main">/</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">/</span> <span class="skolem">q</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> pq_less <span class="keyword1"><span class="command">unfolding</span></span> ξ_mn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">p</span> <span class="main">/</span> <span class="skolem">q</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">/</span><span class="skolem">n</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">m</span><span class="main">/</span><span class="skolem">n</span><span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">/</span><span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">/</span><span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">m</span><span class="main">/</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> abs_diff_less_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span><span class="main">-</span> <span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">p</span> 
            <span class="main">∧</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> qn_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span><span class="main">-</span> <span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">qn</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qn</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> mult_nonneg_nonneg of_int_nonneg<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">-</span> <span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span><span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qn</span><span class="main">*</span><span class="skolem">m</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">qn</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qn</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if mult_left_le_one_le<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_eq_real_def mult_pos_neg neg_0_less_iff_less of_int_less_0_iff order_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">/</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span><span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≤</span> <span class="skolem">q</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">pqs</span><span class="main">.</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> fst <span class="bound">x</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> 
                          <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> snd <span class="bound">x</span> <span class="main">∧</span> snd <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">pqs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span><span class="skolem">pqs</span> <span class="main">∧</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span>fst <span class="bound">x</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">0</span><span class="main">&lt;</span>snd <span class="bound">x</span> <span class="main">∧</span> snd <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span><span class="main">..</span><span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span><span class="skolem">pqs</span> <span class="main">∧</span> <span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span>fst <span class="bound">x</span> <span class="main">∧</span> fst <span class="bound">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">0</span><span class="main">&lt;</span>snd <span class="bound">x</span> <span class="main">∧</span> snd <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">}</span> <span class="main">⊆</span> 
                <span class="main">(</span><span class="main">{</span><span class="main">-</span> <span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span><span class="main">..</span><span class="main">¦</span><span class="skolem">m</span><span class="main">¦</span> <span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ξ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> RothsTheorem<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ξ</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">*</span> <span class="free">ε</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">ε</span><span class="main">)</span>"</span></span><span class="main">,</span><span class="operator">folded</span> pqs_def<span class="main">]</span> 
      <span class="quoted"><span class="quoted">‹<span class="free">δ</span> <span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ε</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mult_le_0_iff not_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Acknowledgements›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A.K.-A. and W.L. were supported by the ERC Advanced Grant ALEXANDRIA (Project 742178)
 funded by the European Research Council and led by Professor Lawrence Paulson
 at the University of Cambridge, UK. Thanks to Iosif Pinelis for his clarification on
MathOverflow regarding the summmability of the series in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] RothsTheorem.HanclRucki2<span class="antiquote"><span class="antiquote">}</span></span></span></span>
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://mathoverflow.net/questions/323069/why-is-this-series-summable"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
and to Manuel Eberl for his helpful comments.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>