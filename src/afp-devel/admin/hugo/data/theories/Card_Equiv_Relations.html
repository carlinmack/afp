<div id="Card_Equiv_Relations">
<div class="head">
<h1>Theory Card_Equiv_Relations</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cardinality of Equivalence Relations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Card_Equiv_Relations
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Card_Partitions/Card_Partitions.html">Card_Partitions.Card_Partitions</a>
  <a href="../Bell_Numbers_Spivey/Bell_Numbers.html">Bell_Numbers_Spivey.Bell_Numbers</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bijection between Equivalence Relations and Set Partitions›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Possibly Interesting Theorem for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="../../HOL/HOL/Equiv_Relations.html"></a><a href="../../HOL/HOL/Equiv_Relations.html">HOL.Equiv_Relations</a><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theorem was historically useful in this theory, but
is now after some proof refactoring not needed here anymore.
Possibly it is an interesting fact about equivalence relations, though.
›</span></span>

<span class="keyword1" id="Card_Equiv_Relations-equiv_quotient_eq_quotient_on_UNIV"><span class="command">lemma</span></span> equiv_quotient_eq_quotient_on_UNIV<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">//</span> <span class="free">R</span> <span class="main">=</span> <span class="main">(</span>UNIV <span class="main">//</span> <span class="free">R</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"UNIV <span class="main">//</span> <span class="free">R</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> UNIV <span class="main">//</span> <span class="free">R</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> quotientE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> equiv_class_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> <span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> quotientI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">//</span> <span class="free">R</span> <span class="main">⊆</span> UNIV <span class="main">//</span> <span class="free">R</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> in_quotient_imp_non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> UNIV <span class="main">//</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I assms proj_Eps proj_preserves<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> UNIV <span class="main">//</span> <span class="free">R</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Dedicated Facts for Bijection Proof›</span></span>

<span class="comment1">(* TODO: rename to fit Disjoint_Sets' naming scheme and move to Disjoint_Sets *)</span>
<span class="keyword1" id="Card_Equiv_Relations-equiv_relation_of_partition_of"><span class="command">lemma</span></span> equiv_relation_of_partition_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span> <span class="main">=</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xy</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xy</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xy</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">z</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> quotientE<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xy</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xy</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> <span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">z</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_class_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xy</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xy</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xy</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xy</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xy</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">//</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_class_eq_iff quotientI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> equiv_class_eq_iff equiv_class_self<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xy</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="free">A</span> <span class="main">//</span> <span class="free">R</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xy</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Bijection Proof›</span></span>

<span class="keyword1" id="Card_Equiv_Relations-bij_betw_partition_of"><span class="command">lemma</span></span> bij_betw_partition_of<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">R</span><span class="main">∈</span><span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span> <span class="main">=</span> <span class="bound">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_relation_of_partition_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span><span class="main">∈</span><span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="main">//</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span> <span class="main">=</span> <span class="bound">P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partition_on_eq_quotient<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> partition_on_quotient <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_partition_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Card_Equiv_Relations-bij_betw_partition_of_equiv_with_k_classes"><span class="command">lemma</span></span> bij_betw_partition_of_equiv_with_k_classes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_byWitness<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">R</span><span class="main">∈</span><span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span> <span class="main">=</span> <span class="bound">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_relation_of_partition_of<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span><span class="main">∈</span><span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="main">//</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span> <span class="main">=</span> <span class="bound">P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partition_on_eq_quotient<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> partition_on_quotient <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="bound">P</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_partition_on <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partition_on_eq_quotient<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finiteness of Equivalence Relations›</span></span>

<span class="keyword1" id="Card_Equiv_Relations-finite_equiv"><span class="command">lemma</span></span> finite_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_partition_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> finitely_many_partition_on <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_finite<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality of Equivalence Relations›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> card_equiv_rel_eq_card_partitions<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_partition_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> card_equiv_rel_eq_Bell<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span> <span class="main">=</span> Bell <span class="main">(</span>card <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Bell_altdef card_equiv_rel_eq_card_partitions <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">corollary</span></span> card_equiv_rel_eq_sum_Stirling<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span> <span class="main">=</span> sum <span class="main">(</span>Stirling <span class="main">(</span>card <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">{..</span>card <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms card_equiv_rel_eq_Bell Bell_Stirling_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> card_equiv_k_classes_eq_card_partitions_k_parts<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> <span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_partition_of_equiv_with_k_classes<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">P</span><span class="main">.</span> partition_on <span class="free">A</span> <span class="bound">P</span> <span class="main">∧</span> card <span class="bound">P</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="free">A</span> <span class="bound">R</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">A</span> <span class="main">//</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">=</span> Stirling <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> card_equiv_k_classes_eq_card_partitions_k_parts
  card_partition_on<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Card_Partial_Equiv_Relations">
<div class="head">
<h1>Theory Card_Partial_Equiv_Relations</h1>
</div>
<pre class="source"><span class="comment1">(*  Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cardinality of Partial Equivalence Relations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Card_Partial_Equiv_Relations
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Card_Equiv_Relations.html">Card_Equiv_Relations</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Partial Equivalence Relation›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">partial_equiv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">partial_equiv</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">×</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> sym <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> trans <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Card_Partial_Equiv_Relations-partial_equivI"><span class="command">lemma</span></span> partial_equivI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">×</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partial_equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> partial_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Card_Partial_Equiv_Relations-partial_equiv_iff"><span class="command">lemma</span></span> partial_equiv_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"partial_equiv <span class="free">A</span> <span class="free">R</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">A'</span></span> <span class="main">⊆</span> <span class="free">A</span><span class="main">.</span> equiv <span class="bound">A'</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"partial_equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹partial_equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">``</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> partial_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equiv <span class="main">(</span><span class="free">R</span> <span class="main">``</span> <span class="free">A</span><span class="main">)</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equivI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹partial_equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> partial_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹partial_equiv <span class="free">A</span> <span class="free">R</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> partial_equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="main">(</span><span class="free">R</span> <span class="main">``</span> <span class="free">A</span><span class="main">)</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> refl_onI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">``</span> <span class="free">A</span> <span class="main">×</span> <span class="free">R</span> <span class="main">``</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">``</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹partial_equiv <span class="free">A</span> <span class="free">R</span>›</span></span>
            partial_equiv_def sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">``</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span> <span class="main">``</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">``</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">``</span> <span class="free">A</span> <span class="main">×</span> <span class="free">R</span> <span class="main">``</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">``</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sym <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> symE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹trans <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> transE<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">A'</span></span><span class="main">⊆</span><span class="free">A</span><span class="main">.</span> equiv <span class="bound">A'</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">A'</span></span><span class="main">⊆</span><span class="free">A</span><span class="main">.</span> equiv <span class="bound">A'</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"equiv <span class="skolem">A'</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"partial_equiv <span class="free">A</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> partial_equivI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="skolem">A'</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">×</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> equiv_class_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="skolem">A'</span> <span class="free">R</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> equivE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="skolem">A'</span> <span class="free">R</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> equivE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Construction of all Partial Equivalence Relations for a Given Set›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">all_partial_equivs_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">all_partial_equivs_on</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span>
    <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">k</span> <span class="main">←</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>card <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span><span class="main">;</span>
      <span class="bound">A'</span> <span class="main">←</span> <span class="main">{</span><span class="bound">A'</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> card <span class="bound">A'</span> <span class="main">=</span> <span class="bound">k</span><span class="main">}</span><span class="main">;</span>
      <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="bound">A'</span> <span class="bound">R</span><span class="main">}</span>
    <span class="main">}</span>"</span></span>

<span class="keyword1" id="Card_Partial_Equiv_Relations-all_partial_equivs_on"><span class="command">lemma</span></span> all_partial_equivs_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"all_partial_equivs_on <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> partial_equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"all_partial_equivs_on <span class="free">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> partial_equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> all_partial_equivs_on <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"equiv <span class="skolem">A'</span> <span class="skolem">R</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> all_partial_equivs_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partial_equiv <span class="free">A</span> <span class="skolem">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> partial_equiv_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> partial_equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">R</span><span class="main">.</span> partial_equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span> <span class="main">⊆</span> all_partial_equivs_on <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">R</span><span class="main">.</span> partial_equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"equiv <span class="skolem">A'</span> <span class="skolem">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> partial_equiv_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mem_Collect_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">A'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>card <span class="free">A</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> all_partial_equivs_on <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> all_partial_equivs_on_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> atLeastAtMost_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Injectivity of the Set Construction›</span></span>

<span class="keyword1" id="Card_Partial_Equiv_Relations-equiv_inject"><span class="command">lemma</span></span> equiv_inject<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">B</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">×</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">×</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_type<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_equiv_class<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mem_Sigma_iff subset_antisym subset_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Card_Partial_Equiv_Relations-injectivity"><span class="command">lemma</span></span> injectivity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A'</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="free">A'</span> <span class="main">=</span> <span class="free">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A''</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="free">A''</span> <span class="main">=</span> <span class="free">k'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"equiv <span class="free">A'</span> <span class="free">R</span> <span class="main">∧</span> equiv <span class="free">A''</span> <span class="free">R'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">=</span> <span class="free">R'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A'</span> <span class="main">=</span> <span class="free">A''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="free">k'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span> <span class="main">=</span> <span class="free">R'</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A'</span> <span class="main">=</span> <span class="free">A''</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="free">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality Theorem of Partial Equivalence Relations›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> card_partial_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">R</span><span class="main">.</span> partial_equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span> <span class="main">=</span> Bell <span class="main">(</span>card <span class="free">A</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?expr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">k</span> <span class="main">←</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>card <span class="free">A</span><span class="main">}</span><span class="main">;</span>
      <span class="bound">A'</span> <span class="main">←</span> <span class="main">{</span><span class="bound">A'</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">A'</span> <span class="main">=</span> <span class="bound">k</span><span class="main">}</span><span class="main">;</span>
      <span class="main">{</span><span class="bound">R</span><span class="main">.</span> equiv <span class="bound">A'</span> <span class="bound">R</span><span class="main">}</span>
    <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">R</span><span class="main">.</span> partial_equiv <span class="free">A</span> <span class="bound">R</span><span class="main">}</span> <span class="main">=</span> card <span class="main">(</span>all_partial_equivs_on <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_partial_equivs_on<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>all_partial_equivs_on <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?expr</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> all_partial_equivs_on_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?expr</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span>card <span class="free">A</span><span class="main">.</span> <span class="main">(</span>card <span class="free">A</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> Bell <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⤜</span> <span class="var">?comp</span>"</span></span> <span class="main">=</span> <span class="var"><span class="quoted"><span class="var">?expr</span></span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
      <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{..</span>card <span class="free">A</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?expr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?comp</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⤜</span> <span class="var">?comp</span>"</span></span> <span class="main">=</span> <span class="var"><span class="quoted"><span class="var">?expr</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A'</span>
        <span class="keyword3"><span class="command">assume</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">A'</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">A'</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">A'</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?expr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?comp</span> <span class="skolem">A'</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?expr</span> <span class="main">=</span> Bell <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">A'</span> <span class="main">=</span> <span class="skolem">k</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_equiv_rel_eq_Bell<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?expr</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_equiv<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?expr</span> <span class="main">∧</span> card <span class="var">?expr</span> <span class="main">=</span> Bell <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> inner <span class="main">=</span> this
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disjoint_family_on <span class="var">?comp</span> <span class="var">?S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">injectivity_solver</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> injectivity<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?S</span> <span class="main">=</span> card <span class="free">A</span> <span class="keyword1">choose</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_subsets<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?expr</span> <span class="main">=</span> <span class="main">(</span>card <span class="free">A</span> <span class="keyword1">choose</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> Bell <span class="skolem">k</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?formula</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_bind_constant<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?expr</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?S</span>›</span></span> inner <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_bind<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?expr</span> <span class="main">∧</span> card <span class="var">?expr</span> <span class="main">=</span> <span class="var">?formula</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disjoint_family_on <span class="var">?comp</span> <span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">injectivity_solver</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> injectivity<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?expr</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span>card <span class="free">A</span><span class="main">.</span> <span class="main">(</span>card <span class="free">A</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> Bell <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_bind<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>card <span class="free">A</span><span class="main">.</span> <span class="main">(</span>card <span class="free">A</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> Bell <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Bell <span class="main">(</span>card <span class="free">A</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Bell_recursive_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>