<div id="Introduction">
<div class="head">
<h1>Theory Introduction</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">‚Äï‚Äπ ********************************************************************
 * Project         : CSP-RefTK - A Refinement Toolkit for HOL-CSP
 * Version         : 1.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *
 * This file       : An Introduction
 *
 * Copyright (c) 2020 Universit√© Paris-Saclay, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************‚Ä∫</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‚ÄπContext‚Ä∫</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Introduction
    <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOLCF/HOLCF.html">HOLCF</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‚ÄπIntroduction‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‚Äπ
Communicating Sequential Processes CSP is a language 
to specify and verify patterns of interaction of concurrent systems.
Together with CCS and LOTOS, it belongs to the family of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">‚àó</span></span>‚Äπprocess algebras‚Ä∫</span></span>. 
CSP's rich theory comprises denotational, operational and algebraic semantic facets 
and has influenced programming languages such as Limbo, Crystal, Clojure and
most notably Golang <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "donovan2015go"<span class="antiquote"><span class="antiquote">}</span></span></span></span>. CSP has been applied in 
industry as a tool for specifying and verifying the concurrent aspects of hardware 
systems, such as the T9000 transputer <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Barret95"<span class="antiquote"><span class="antiquote">}</span></span></span></span>. 

The theory of CSP, in particular the denotational Failure/Divergence Denotational Semantics,
has been initially proposed in the book by Tony Hoare <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Hoare:1985:CSP:3921"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, but evolved
substantially since <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "BrookesHR84" <span class="quasi_keyword"><span class="quasi_keyword">and</span></span> "brookes-roscoe85" <span class="quasi_keyword"><span class="quasi_keyword">and</span></span> "roscoe:csp:1998"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Verification of CSP properties has been centered around the notion of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">‚àó</span></span>‚Äπprocess refinement orderings‚Ä∫</span></span>,
most notably <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>_‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub>_‚Ä∫</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>_‚äë_‚Ä∫</span></span></span></span>. The latter turns the denotational domain of CSP into a Scott cpo 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "scott:cpo:1972"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, which yields semantics for the fixed point operator <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>Œºx. f(x)‚Ä∫</span></span></span></span> provided 
that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>f‚Ä∫</span></span></span></span> is continuous with respect to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>_‚äë_‚Ä∫</span></span></span></span>. Since it is possible to express deadlock-freeness and 
livelock-freeness as a refinement problem, the verification of properties has been reduced 
traditionally to a model-checking problem for a finite set of events <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>A‚Ä∫</span></span></span></span>.

We are interested in verification techniques for arbitrary event sets <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>A‚Ä∫</span></span></span></span> or arbitrarily 
parameterized processes. Such processes can be used to model dense-timed processes, processes 
with dynamic thread creation, and processes with unbounded thread-local variables and buffers.
Events may even be higher-order objects such as functions or again processes, paving the way
for the modeling of re-programmable compute servers or dynamic distributed computing architectures.
However, this adds substantial complexity to the process theory: when it comes to study the 
interplay of different denotational models, refinement-orderings, and side-conditions for 
continuity, paper-and-pencil proofs easily reach their limits of precision. 

Several attempts have been undertaken to develop the formal theory of CSP in an interactive proof system, 
mostly in Isabelle/HOL <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Camilleri91" <span class="quasi_keyword"><span class="quasi_keyword">and</span></span> "tej.ea:corrected:1997" <span class="quasi_keyword"><span class="quasi_keyword">and</span></span>  "IsobeRoggenbach2010"<span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
This work is based on the most recent instance in this line, HOL-CSP 2.0, which has been published 
as AFP submission  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "HOL-CSP-AFP"<span class="antiquote"><span class="antiquote">}</span></span></span></span> and whose development is hosted at 
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">üåê</span></span>‚Äπhttps://gitlri.lri.fr/burkhart.wolff/hol-csp2.0‚Ä∫</span></span>. 

The present AFP Module is an add-on on this work and develops some support for 
<span class="antiquoted"><span class="antiquoted">‚ñ∏</span></span> advanced induction schemes (mutual fixed-point Induction, K-induction),
<span class="antiquoted"><span class="antiquoted">‚ñ∏</span></span> bridge-Lemmas between the classical refinement relations in the FD-semantics,
  which allow for reduced refinement proof complexity in certain cases, and
<span class="antiquoted"><span class="antiquoted">‚ñ∏</span></span> a theory of explicit state normalisation which allows for proofs over certain
  communicating networks of arbitrary size.

\newpage
‚Ä∫</span></span>



<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‚ÄπThe Global Architecture of CSP\_RefTk‚Ä∫</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‚Äπ
\begin{figure}[ht]
  \centering
  \includegraphics[width=0.60\textwidth]{figures/session_graph.pdf}
	\caption{The overall architecture: HOLCF, HOL-CSP, and CSP\_RefTk}
	\label{fig:fig1}
\end{figure}
‚Ä∫</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‚ÄπThe global architecture of CSP\_RefTk is shown in \autoref{fig:fig1}.
The entire package resides on: 
<span class="antiquoted"><span class="antiquoted">‚ñ∏</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">session</span><span class="hidden">&gt;</span></span></span>‚ÄπHOL-Eisbach‚Ä∫</span></span> from the Isabelle/HOL distribution,
<span class="antiquoted"><span class="antiquoted">‚ñ∏</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">session</span><span class="hidden">&gt;</span></span></span>‚ÄπHOLCF‚Ä∫</span></span> from the Isabelle/HOL distribution, and
<span class="antiquoted"><span class="antiquoted">‚ñ∏</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">session</span><span class="hidden">&gt;</span></span></span>‚ÄπHOL-CSP‚Ä∫</span></span> 2.0 from the Isabelle Archive of Formal Proofs.

<span class="antiquoted"><span class="operator"><span class="antiquoted"><span class="operator">‚á§</span></span></span></span> The theories <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">‚ñ©</span></span><span class="raw_text"><span class="raw_text">‚ÄπAssertion_ext‚Ä∫</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">‚ñ©</span></span><span class="raw_text"><span class="raw_text">‚ÄπFixind_ext‚Ä∫</span></span></span></span> are extensions of the 
corresponding theories in <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">session</span><span class="hidden">&gt;</span></span></span>‚ÄπHOL-CSP‚Ä∫</span></span>.‚Ä∫</span></span>


<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Assertions_ext">
<div class="head">
<h1>Theory Assertions_ext</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">‚Äï‚Äπ ******************************************************************** 
 * Project         : CSP-RefTK - A Refinement Toolkit for HOL-CSP
 * Version         : 1.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *
 * This file       : Assertions on DF and LF and their Relations
 *
 * Copyright (c) 2020 Universit√© Paris-Saclay, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************‚Ä∫</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‚ÄπBasic CSP\_RefTk-Theories‚Ä∫</span></span>

<span class="keyword1"><span class="command">theory</span></span> Assertions_ext
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../HOL-CSP/Assertions.html">HOL-CSP.Assertions</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπPreliminaries‚Ä∫</span></span>

<span class="keyword1" id="Assertions_ext-DF"><span class="command">lemma</span></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold <span class="main">:</span> <span class="quoted"><span class="quoted">"DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">‚äì</span> <span class="bound">z</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚Üí</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span> <span class="main">‚äì</span> SKIP<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπAll refinements definitions‚Ä∫</span></span>

<span class="keyword1"><span class="command">thm</span></span> failure_divergence_refine_def<span class="main">[</span><span class="operator">simplified</span> le_ref_def<span class="main">]</span> trace_refine_def failure_refine_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">divergence_refine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">‚áí</span> <span class="tfree">'a</span> process <span class="main">‚áí</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">‚äë<span class="hidden">‚á©</span><sub>D</sub></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">‚â°</span> D <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">‚äÜ</span> D <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">trace_divergence_refine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">‚áí</span> <span class="tfree">'a</span> process <span class="main">‚áí</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">‚â°</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">‚àß</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπRelations between refinements‚Ä∫</span></span>

<span class="keyword1" id="Assertions_ext-le_F_T"><span class="command">lemma</span></span> le_F_T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_subset_imp_T_subset failure_refine_def trace_refine_def<span class="main">)</span> 

<span class="keyword1" id="Assertions_ext-FD_F"><span class="command">lemma</span></span> FD_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failure_divergence_refine_def failure_refine_def le_ref_def<span class="main">)</span>
  
<span class="keyword1" id="Assertions_ext-FD_D"><span class="command">lemma</span></span> FD_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divergence_refine_def failure_divergence_refine_def le_ref_def<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-DT_D"><span class="command">lemma</span></span> DT_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-DT_T"><span class="command">lemma</span></span> DT_T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-F_D_FD"><span class="command">lemma</span></span> F_D_FD<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divergence_refine_def failure_divergence_refine_def failure_refine_def le_ref_def<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-D_T_DT"><span class="command">lemma</span></span> D_T_DT<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπSome obvious refinements‚Ä∫</span></span>

<span class="keyword1" id="Assertions_ext-bot_FD"><span class="command">lemma</span></span> bot_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ä•</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failure_divergence_refine_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> bot_F<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ä•</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bot_D<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ä•</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bot_T<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ä•</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bot_DT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ä•</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FD_F FD_D le_F_T D_T_DT<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-STOP_leDT"><span class="command">lemma</span></span> STOP_leDT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> STOP"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_STOP D_T_DT Nil_elem_T T_STOP divergence_refine_def trace_refine_def<span class="main">)</span>

<span class="comment1">‚Äï‚ÄπFor refinement proofs, we need admissibility and monotony starting with idempotency and 
  transitivity‚Ä∫</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπIdempotency‚Ä∫</span></span>

<span class="keyword1" id="Assertions_ext-idem_F"><span class="command">lemma</span></span> idem_F<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failure_refine_def<span class="main">)</span> 

<span class="keyword1" id="Assertions_ext-idem_D"><span class="command">lemma</span></span> idem_D<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divergence_refine_def<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-idem_T"><span class="command">lemma</span></span> idem_T<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_refine_def<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-idem_FD"><span class="command">lemma</span></span> idem_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failure_divergence_refine_def<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-idem_DT"><span class="command">lemma</span></span> idem_DT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπTransitivity‚Ä∫</span></span>

<span class="keyword1" id="Assertions_ext-trans_F"><span class="command">lemma</span></span> trans_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">Q</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">S</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> failure_refine_def order_trans<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-trans_D"><span class="command">lemma</span></span> trans_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">Q</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">S</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> divergence_refine_def order_trans<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-trans_T"><span class="command">lemma</span></span> trans_T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">Q</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">S</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> trace_refine_def order_trans<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-trans_FD"><span class="command">lemma</span></span> trans_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">Q</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">S</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> failure_divergence_refine_def order_trans<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-trans_DT"><span class="command">lemma</span></span> trans_DT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">Q</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">S</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> trace_divergence_refine_def order_trans trans_D trans_T<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπAdmissibility‚Ä∫</span></span>

<span class="keyword1" id="Assertions_ext-le_F_adm"><span class="command">lemma</span></span> le_F_adm<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="free">u</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>cpo<span class="main">)</span> <span class="main">‚áí</span> <span class="tfree">'b</span> process<span class="main">)</span> <span class="main">‚üπ</span> monofun <span class="free">v</span> <span class="main">‚üπ</span> adm<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="free">u</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont2contlubE adm_def failure_refine_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"cont <span class="free">u</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"monofun <span class="free">v</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="skolem">Y</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">i</span><span class="main">.</span> F <span class="main">(</span><span class="free">v</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">‚äÜ</span> F <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="main">(</span><span class="free">v</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span>  <span class="main">‚äë</span> <span class="free">v</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_ub_thelub monofunE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="free">v</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">‚äÜ</span> F <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> 4 le_approx_lemma_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="free">u</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> F_LUB<span class="main">[</span><span class="operator">OF</span> ch2ch_cont<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 3<span class="main"><span class="main">]</span></span><span class="main">]</span> limproc_is_thelub<span class="main">[</span><span class="operator">OF</span> ch2ch_cont<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 3<span class="main"><span class="main">]</span></span><span class="main">]</span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-le_T_adm"><span class="command">lemma</span></span> le_T_adm<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="free">u</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>cpo<span class="main">)</span> <span class="main">‚áí</span> <span class="tfree">'b</span> process<span class="main">)</span> <span class="main">‚üπ</span> monofun <span class="free">v</span> <span class="main">‚üπ</span> adm<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="free">u</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont2contlubE adm_def trace_refine_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"cont <span class="free">u</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"monofun <span class="free">v</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="skolem">Y</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">i</span><span class="main">.</span> T <span class="main">(</span><span class="free">v</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">‚äÜ</span> T <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">‚àà</span> T <span class="main">(</span><span class="free">v</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span>  <span class="main">‚äë</span> <span class="free">v</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_ub_thelub monofunE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"T <span class="main">(</span><span class="free">v</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">‚äÜ</span> T <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> 4 le_approx_lemma_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> T <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="free">u</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T_LUB<span class="main">[</span><span class="operator">OF</span> ch2ch_cont<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 3<span class="main"><span class="main">]</span></span><span class="main">]</span> limproc_is_thelub<span class="main">[</span><span class="operator">OF</span> ch2ch_cont<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 3<span class="main"><span class="main">]</span></span><span class="main">]</span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-le_D_adm"><span class="command">lemma</span></span> le_D_adm<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="free">u</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>cpo<span class="main">)</span> <span class="main">‚áí</span> <span class="tfree">'b</span> process<span class="main">)</span> <span class="main">‚üπ</span> monofun <span class="free">v</span> <span class="main">‚üπ</span> adm<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="free">u</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont2contlubE adm_def divergence_refine_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"cont <span class="free">u</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"monofun <span class="free">v</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="skolem">Y</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">i</span><span class="main">.</span> D <span class="main">(</span><span class="free">v</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">‚äÜ</span> D <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">‚àà</span> D <span class="main">(</span><span class="free">v</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span>  <span class="main">‚äë</span> <span class="free">v</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_ub_thelub monofunE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"D <span class="main">(</span><span class="free">v</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">‚äÜ</span> D <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> 4 le_approx1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> D <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="free">u</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D_LUB<span class="main">[</span><span class="operator">OF</span> ch2ch_cont<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 3<span class="main"><span class="main">]</span></span><span class="main">]</span> limproc_is_thelub<span class="main">[</span><span class="operator">OF</span> ch2ch_cont<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 3<span class="main"><span class="main">]</span></span><span class="main">]</span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-le_DT_adm"><span class="command">lemma</span></span> le_DT_adm<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="free">u</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>cpo<span class="main">)</span> <span class="main">‚áí</span> <span class="tfree">'b</span> process<span class="main">)</span> <span class="main">‚üπ</span> monofun <span class="free">v</span> <span class="main">‚üπ</span> adm<span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="free">u</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> adm_conj<span class="main">[</span><span class="operator">OF</span> le_T_adm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span> le_D_adm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>trace_divergence_refine_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> le_FD_adm <span class="main">=</span> le_adm<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπMonotonicity‚Ä∫</span></span>

<span class="keyword1" id="Assertions_ext-mono_det_D"><span class="command">lemma</span></span> mono_det_D<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ü¶</span><span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">S'</span><span class="main">‚üß</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚ñ°</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="main">(</span><span class="free">P'</span> <span class="main">‚ñ°</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_det Un_mono divergence_refine_def<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-mono_det_T"><span class="command">lemma</span></span> mono_det_T<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ü¶</span><span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">S'</span><span class="main">‚üß</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚ñ°</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="main">(</span><span class="free">P'</span> <span class="main">‚ñ°</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T_det Un_mono trace_refine_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> mono_det_DT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ü¶</span><span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">S'</span><span class="main">‚üß</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚ñ°</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="main">(</span><span class="free">P'</span> <span class="main">‚ñ°</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> mono_det_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">=</span> mono_det_FD<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="comment1">‚Äï‚ÄπDeterministic choice monotony doesn't hold for <span class="antiquoted"><span class="raw_text"><span class="operator">‚Äπ</span>‚äë<span class="hidden">‚á©</span><sub>F</sub>‚Ä∫</span></span>‚Ä∫</span>


<span class="keyword1" id="Assertions_ext-mono_ndet_F"><span class="command">lemma</span></span> mono_ndet_F<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ü¶</span><span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">S'</span><span class="main">‚üß</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="main">(</span><span class="free">P'</span> <span class="main">‚äì</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_ndet Un_mono failure_refine_def<span class="main">)</span> 

<span class="keyword1" id="Assertions_ext-mono_ndet_D"><span class="command">lemma</span></span> mono_ndet_D<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ü¶</span><span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">S'</span><span class="main">‚üß</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="main">(</span><span class="free">P'</span> <span class="main">‚äì</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_ndet Un_mono divergence_refine_def<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-mono_ndet_T"><span class="command">lemma</span></span> mono_ndet_T<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ü¶</span><span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">S'</span><span class="main">‚üß</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="main">(</span><span class="free">P'</span> <span class="main">‚äì</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T_ndet Un_mono trace_refine_def<span class="main">)</span> 

<span class="keyword1"><span class="command">corollary</span></span> mono_ndet_DT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ü¶</span><span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">S'</span><span class="main">‚üß</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="main">(</span><span class="free">P'</span> <span class="main">‚äì</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> mono_ndet_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">=</span> 
                 mono_ndet_FD<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1" id="Assertions_ext-mono_ndet_F_left"><span class="command">lemma</span></span> mono_ndet_F_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_ndet failure_refine_def order_trans<span class="main">)</span> 

<span class="keyword1" id="Assertions_ext-mono_ndet_D_left"><span class="command">lemma</span></span> mono_ndet_D_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_ndet divergence_refine_def order_trans<span class="main">)</span> 

<span class="keyword1" id="Assertions_ext-mono_ndet_T_left"><span class="command">lemma</span></span> mono_ndet_T_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_ndet trace_refine_def order_trans<span class="main">)</span> 

<span class="keyword1"><span class="command">corollary</span></span> mono_ndet_DT_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> mono_ndet_F_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">S</span> <span class="main">‚äì</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> mono_ndet_D_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">S</span> <span class="main">‚äì</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> mono_ndet_T_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">S</span> <span class="main">‚äì</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> mono_ndet_DT_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">S</span> <span class="main">‚äì</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def Ndet_commute<span class="main">)</span> 
  
<span class="keyword1"><span class="command">lemmas</span></span> 
mono_ndet_FD_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> 
             mono_ndet_FD_left<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
mono_ndet_FD_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> 
             mono_ndet_FD_right<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1" id="Assertions_ext-mono_ndet_det_FD"><span class="command">lemma</span></span> mono_ndet_det_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">‚ñ°</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> det_id failure_divergence_refine_def mono_det_FD mono_ndet_FD_left 
            mono_ndet_FD_right order_refl<span class="main">)</span> 

<span class="keyword1"><span class="command">corollary</span></span> mono_ndet_det_F<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">‚ñ°</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mono_ndet_det_D<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">‚ñ°</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mono_ndet_det_T<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">‚ñ°</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mono_ndet_det_DT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">‚äì</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">‚ñ°</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FD_F FD_D le_F_T D_T_DT<span class="main">)</span> 


<span class="keyword1" id="Assertions_ext-mono_seq_F_right"><span class="command">lemma</span></span> mono_seq_F_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">S'</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> failure_refine_def F_seq append_single_T_imp_tickFree<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> NF_ND <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Assertions_ext-mono_seq_D_right"><span class="command">lemma</span></span> mono_seq_D_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">S'</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divergence_refine_def D_seq<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-mono_seq_T_right"><span class="command">lemma</span></span>  mono_seq_T_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">S'</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trace_refine_def T_seq append_single_T_imp_tickFree<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> D_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">corollary</span></span> mono_seq_DT_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">S'</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-mono_seq_DT_left"><span class="command">lemma</span></span> mono_seq_DT_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P'</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="main">(</span><span class="free">P'</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def divergence_refine_def trace_refine_def D_seq T_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_elem_T Process.F_T T_F append.right_neutral 
            is_processT5_S3 subset_eq<span class="main">)</span> 

<span class="comment1">‚Äï‚Äπleft sequence monotony doesn't hold for <span class="antiquoted"><span class="raw_text"><span class="operator">‚Äπ</span>‚äë<span class="hidden">‚á©</span><sub>F</sub>‚Ä∫</span></span>, <span class="antiquoted"><span class="raw_text"><span class="operator">‚Äπ</span>‚äë<span class="hidden">‚á©</span><sub>D</sub>‚Ä∫</span></span> and <span class="antiquoted"><span class="raw_text"><span class="operator">‚Äπ</span>‚äë<span class="hidden">‚á©</span><sub>T</sub>‚Ä∫</span></span>‚Ä∫</span>

<span class="keyword1"><span class="command">corollary</span></span> mono_seq_DT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P'</span> <span class="main">‚üπ</span> <span class="free">S</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">S'</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="main">(</span><span class="free">P'</span> <span class="main">`;`</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mono_seq_DT_left mono_seq_DT_right trans_DT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword1"><span class="command">lemmas</span></span> mono_seq_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">=</span> mono_seq_FD<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>


<span class="keyword1" id="Assertions_ext-mono_mprefix_F_process"><span class="command">lemma</span></span> mono_mprefix_F_process<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">‚üπ</span> Mprefix <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> Mprefix <span class="free">A</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> failure_refine_def F_Mprefix<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-mono_mprefix_D_process"><span class="command">lemma</span></span> mono_mprefix_D_process<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">‚üπ</span> Mprefix <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> Mprefix <span class="free">A</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divergence_refine_def D_Mprefix<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-mono_mprefix_T_process"><span class="command">lemma</span></span> mono_mprefix_T_process<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">‚üπ</span> Mprefix <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> Mprefix <span class="free">A</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trace_refine_def T_Mprefix<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> mono_mprefix_DT_process<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">‚üπ</span> Mprefix <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> Mprefix <span class="free">A</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemmas</span></span> 
mono_mprefix_FD_process<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> 
                mono_mprefix_FD<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1" id="Assertions_ext-mono_mprefix_DT_set"><span class="command">lemma</span></span> mono_mprefix_DT_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">‚äÜ</span> <span class="free">B</span> <span class="main">‚üπ</span> Mprefix <span class="free">B</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> Mprefix <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_Mprefix D_Mprefix trace_divergence_refine_def 
                    trace_refine_def divergence_refine_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> mono_mprefix_D_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">‚äÜ</span> <span class="free">B</span> <span class="main">‚üπ</span> Mprefix <span class="free">B</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> Mprefix <span class="free">A</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mono_mprefix_T_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">‚äÜ</span> <span class="free">B</span> <span class="main">‚üπ</span> Mprefix <span class="free">B</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> Mprefix <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DT_D DT_T<span class="main">)</span>

<span class="comment1">‚Äï‚ÄπMprefix set monotony doesn't hold for <span class="antiquoted"><span class="raw_text"><span class="operator">‚Äπ</span>‚äë<span class="hidden">‚á©</span><sub>F</sub>‚Ä∫</span></span> and <span class="antiquoted"><span class="raw_text"><span class="operator">‚Äπ</span>‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub>‚Ä∫</span></span> where it holds for deterministic choice‚Ä∫</span>


<span class="keyword1" id="Assertions_ext-mono_hide_F"><span class="command">lemma</span></span> mono_hide_F<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> \<span class="main">\</span> <span class="free">A</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hide_set_empty failure_refine_def F_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Un_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> UnCI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">‚àà</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> rec_nat <span class="skolem">t</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">i</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">@</span> <span class="main">[</span>ev <span class="skolem">a</span><span class="main">]</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">hence</span></span> AA<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>ev <span class="skolem">a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_mono_def lift_Suc_mono_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">‚àà</span> range <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> old.nat.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> range_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">‚àà</span> D <span class="free">Q</span> <span class="main">‚àß</span> tickFree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">‚àß</span> trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> A<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>AA a<span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> is_processT7<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>ev <span class="skolem">a</span><span class="main">]</span>"</span></span><span class="main">]</span> front_tickFree_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> 
  <span class="keyword1"><span class="command">with</span></span> B C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">f</span> <span class="free">P</span> <span class="free">A</span> <span class="main">‚àß</span> <span class="skolem">t</span> <span class="main">‚àà</span> range <span class="skolem">f</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> D_T F_subset_imp_T_subset subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">b</span> <span class="skolem">u</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> F_subset_imp_T_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Assertions_ext-mono_hide_T"><span class="command">lemma</span></span> mono_hide_T<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> \<span class="main">\</span> <span class="free">A</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hide_set_empty<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>trace_refine_def T_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> Un_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> UnCI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 11<span class="main">:</span><span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> tt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">‚àà</span> T <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Process.F_T subset_eq<span class="main">)</span> 
    <span class="keyword1"><span class="command">with</span></span> 11<span class="main">(</span>1<span class="main">)</span> inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">f</span> <span class="free">P</span> <span class="free">A</span> <span class="main">‚àß</span> <span class="skolem">t</span> <span class="main">‚àà</span> range <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 11<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 11<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tt append_Nil2 front_tickFree_Nil is_processT2_TR 
                nonTickFree_n_frontTickFree tick_T_F<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> Un_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 21<span class="main">:</span><span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> rec_nat <span class="skolem">t</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">i</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">@</span> <span class="main">[</span>ev <span class="skolem">a</span><span class="main">]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> AA<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>ev <span class="skolem">a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_mono_def lift_Suc_mono_less_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">‚àà</span> range <span class="skolem">f</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> old.nat.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> range_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">‚àà</span> D <span class="free">Q</span> <span class="main">‚àß</span> tickFree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">‚àß</span> trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 21<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 21<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> A<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>AA 21<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span> 
          <span class="keyword1"><span class="command">using</span></span> is_processT7<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>ev <span class="skolem">a</span><span class="main">]</span>"</span></span><span class="main">]</span> front_tickFree_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span> 
    <span class="keyword1"><span class="command">with</span></span> B C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">f</span> <span class="free">P</span> <span class="free">A</span> <span class="main">‚àß</span> <span class="skolem">t</span> <span class="main">‚àà</span> range <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 21<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> D_T subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 21 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 22<span class="main">:</span><span class="main">(</span>2 <span class="skolem">b</span> <span class="skolem">u</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-mono_hide_DT"><span class="command">lemma</span></span> mono_hide_DT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="main">‚üπ</span> <span class="free">P</span> \<span class="main">\</span> <span class="free">A</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> \<span class="main">\</span> <span class="free">A</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>trace_divergence_refine_def divergence_refine_def 
                    trace_refine_def D_hiding T_hiding<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> DT_T<span class="main">[</span><span class="operator">THEN</span> mono_hide_T<span class="main">,</span> <span class="operator">OF</span> as<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> mono_hide_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> 
                 mono_hide_FD<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="comment1">‚Äï‚ÄπObviously, Hide monotony doesn't hold for <span class="antiquoted"><span class="raw_text"><span class="operator">‚Äπ</span>‚äë<span class="hidden">‚á©</span><sub>D</sub>‚Ä∫</span></span>‚Ä∫</span>


<span class="keyword1" id="Assertions_ext-mono_sync_DT"><span class="command">lemma</span></span> mono_sync_DT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P'</span> <span class="main">‚üπ</span> <span class="free">Q</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q'</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">‚ü¶</span> <span class="free">A</span> <span class="main">‚üß</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="main">(</span><span class="free">P'</span> <span class="main">‚ü¶</span> <span class="free">A</span> <span class="main">‚üß</span> <span class="free">Q'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>trace_divergence_refine_def divergence_refine_def trace_refine_def T_sync D_sync<span class="main">)</span> 
     <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> mono_sync_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> 
                 mono_sync_FD<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="comment1">‚Äï‚Äπsynchronization monotony doesn't hold for <span class="antiquoted"><span class="raw_text"><span class="operator">‚Äπ</span>‚äë<span class="hidden">‚á©</span><sub>F</sub>‚Ä∫</span></span>, <span class="antiquoted"><span class="raw_text"><span class="operator">‚Äπ</span>‚äë<span class="hidden">‚á©</span><sub>D</sub>‚Ä∫</span></span> and <span class="antiquoted"><span class="raw_text"><span class="operator">‚Äπ</span>‚äë<span class="hidden">‚á©</span><sub>T</sub>‚Ä∫</span></span>‚Ä∫</span>


<span class="keyword1" id="Assertions_ext-mono_mndet_F_process"><span class="command">lemma</span></span> mono_mndet_F_process<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">‚üπ</span> mndet <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> mndet <span class="free">A</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> failure_refine_def F_mndet write0_def F_Mprefix<span class="main">)</span> 

<span class="keyword1" id="Assertions_ext-mono_mndet_D_process"><span class="command">lemma</span></span> mono_mndet_D_process<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">‚üπ</span> mndet <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> mndet <span class="free">A</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divergence_refine_def D_mndet write0_def D_Mprefix<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-mono_mndet_T_process"><span class="command">lemma</span></span> mono_mndet_T_process<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">‚üπ</span> mndet <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> mndet <span class="free">A</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trace_refine_def T_mndet write0_def T_Mprefix<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> mono_mndet_DT_process<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">x</span><span class="main">‚àà</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">‚üπ</span> mndet <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> mndet <span class="free">A</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_divergence_refine_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemmas</span></span> 
mono_mndet_FD_process<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> 
              mono_mndet_FD<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> 
mono_mndet_FD_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> 
              mndet_FD_subset<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">corollary</span></span> mono_mndet_F_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">‚â†</span> <span class="main">{}</span> <span class="main">‚üπ</span> <span class="free">A</span> <span class="main">‚äÜ</span> <span class="free">B</span> <span class="main">‚üπ</span> mndet <span class="free">B</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> mndet <span class="free">A</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mono_mndet_D_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">‚â†</span> <span class="main">{}</span> <span class="main">‚üπ</span> <span class="free">A</span> <span class="main">‚äÜ</span> <span class="free">B</span> <span class="main">‚üπ</span> mndet <span class="free">B</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> mndet <span class="free">A</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mono_mndet_T_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">‚â†</span> <span class="main">{}</span> <span class="main">‚üπ</span> <span class="free">A</span> <span class="main">‚äÜ</span> <span class="free">B</span> <span class="main">‚üπ</span> mndet <span class="free">B</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> mndet <span class="free">A</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mono_mndet_DT_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">‚â†</span> <span class="main">{}</span> <span class="main">‚üπ</span> <span class="free">A</span> <span class="main">‚äÜ</span> <span class="free">B</span> <span class="main">‚üπ</span> mndet <span class="free">B</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> mndet <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FD_F FD_D le_F_T D_T_DT<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> 
Mprefix_refines_Mndet_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> 
                          Mprefix_refines_Mndet<span class="main">[</span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">corollary</span></span> Mprefix_refines_Mndet_F<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mndet <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> Mprefix <span class="free">A</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Mprefix_refines_Mndet_D<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mndet <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> Mprefix <span class="free">A</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Mprefix_refines_Mndet_T<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mndet <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> Mprefix <span class="free">A</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Mprefix_refines_Mndet_DT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mndet <span class="free">A</span> <span class="free">P</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> Mprefix <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FD_F FD_D le_F_T D_T_DT<span class="main">)</span> 


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπReference processes and their unfolding rules‚Ä∫</span></span>

<span class="keyword1"><span class="command">thm</span></span> DF_def DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def RUN_def CHAOS_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">‚áí</span> <span class="tfree">'a</span> process"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">‚â°</span> <span class="keyword1">Œº</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span>SKIP <span class="main">‚äì</span> STOP <span class="main">‚äì</span> <span class="main">(</span><span class="main">‚ñ°</span> <span class="bound">x</span> <span class="main">‚àà</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">‚Üí</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">thm</span></span> DF_unfold DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold

<span class="keyword1" id="Assertions_ext-RUN_unfold"><span class="command">lemma</span></span> RUN_unfold <span class="main">:</span> <span class="quoted"><span class="quoted">"RUN <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">‚ñ°</span> <span class="bound">z</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚Üí</span> RUN <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RUN_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Assertions_ext-CHAOS_unfold"><span class="command">lemma</span></span> CHAOS_unfold <span class="main">:</span> <span class="quoted"><span class="quoted">"CHAOS <span class="free">A</span> <span class="main">=</span> <span class="main">(</span>STOP <span class="main">‚äì</span> <span class="main">(</span><span class="main">‚ñ°</span> <span class="bound">z</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚Üí</span> CHAOS <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CHAOS_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
                                              
<span class="keyword1" id="Assertions_ext-CHAOS"><span class="command">lemma</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span> <span class="main">‚â°</span> SKIP <span class="main">‚äì</span> STOP <span class="main">‚äì</span> <span class="main">(</span><span class="main">‚ñ°</span> <span class="bound">x</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚Üí</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="main">(</span>SKIP <span class="main">‚äì</span> STOP <span class="main">‚äì</span> <span class="main">(</span><span class="main">‚ñ°</span> <span class="bound">x</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚Üí</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπProcess events and reference processes events‚Ä∫</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">events_of</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">events_of</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">‚â°</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">t</span><span class="main">‚àà</span>T <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">.</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> ev <span class="bound">a</span> <span class="main">‚àà</span> set <span class="bound">t</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Assertions_ext-events_DF"><span class="command">lemma</span></span> events_DF<span class="main">:</span> <span class="quoted"><span class="quoted">"events_of <span class="main">(</span>DF <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>events_of_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>DF <span class="free">A</span><span class="main">)</span> <span class="main">‚üπ</span> ev <span class="skolem">x</span> <span class="main">‚àà</span> set <span class="skolem">t</span> <span class="main">‚üπ</span> <span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">#</span> <span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span><span class="main">‚äì</span><span class="bound">z</span><span class="main">‚àà</span><span class="free">A</span> <span class="main">‚Üí</span>  DF <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DF_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ev <span class="skolem">aa</span> <span class="main">‚àß</span> <span class="skolem">aa</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚àß</span> <span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>DF <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_mndet write0_def T_Mprefix T_STOP<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚üπ</span> <span class="main">‚àÉ</span><span class="bound">xa</span><span class="main">‚àà</span>T <span class="main">(</span>DF <span class="free">A</span><span class="main">)</span><span class="main">.</span> ev <span class="skolem">x</span> <span class="main">‚àà</span> set <span class="bound">xa</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> DF_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_mndet write0_def T_Mprefix<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_elem_T list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-events_DF"><span class="command">lemma</span></span> events_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"events_of <span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>events_of_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span> <span class="main">‚üπ</span> ev <span class="skolem">x</span> <span class="main">‚àà</span> set <span class="skolem">t</span> <span class="main">‚üπ</span> <span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">#</span> <span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span><span class="main">(</span><span class="main">‚äì</span><span class="bound">z</span><span class="main">‚àà</span><span class="free">A</span> <span class="main">‚Üí</span>  DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span> <span class="main">‚äì</span> SKIP<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ev <span class="skolem">aa</span> <span class="main">‚àß</span> <span class="skolem">aa</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚àß</span> <span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_mndet write0_def T_Mprefix T_STOP T_SKIP T_ndet<span class="main">)</span>  
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚üπ</span> <span class="main">‚àÉ</span><span class="bound">xa</span><span class="main">‚àà</span>T <span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span><span class="main">.</span> ev <span class="skolem">x</span> <span class="main">‚àà</span> set <span class="bound">xa</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_mndet write0_def T_Mprefix T_SKIP T_ndet<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_elem_T list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-events_RUN"><span class="command">lemma</span></span> events_RUN<span class="main">:</span> <span class="quoted"><span class="quoted">"events_of <span class="main">(</span>RUN <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>events_of_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>RUN <span class="free">A</span><span class="main">)</span> <span class="main">‚üπ</span> ev <span class="skolem">x</span> <span class="main">‚àà</span> set <span class="skolem">t</span> <span class="main">‚üπ</span> <span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">#</span> <span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span><span class="main">‚ñ°</span><span class="bound">z</span><span class="main">‚àà</span><span class="free">A</span> <span class="main">‚Üí</span>  RUN <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> RUN_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ev <span class="skolem">aa</span> <span class="main">‚àß</span> <span class="skolem">aa</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚àß</span> <span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>RUN <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_Mprefix<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚üπ</span> <span class="main">‚àÉ</span><span class="bound">xa</span><span class="main">‚àà</span>T <span class="main">(</span>RUN <span class="free">A</span><span class="main">)</span><span class="main">.</span> ev <span class="skolem">x</span> <span class="main">‚àà</span> set <span class="bound">xa</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> RUN_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_Mprefix<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_elem_T list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-events_CHAOS"><span class="command">lemma</span></span> events_CHAOS<span class="main">:</span> <span class="quoted"><span class="quoted">"events_of <span class="main">(</span>CHAOS <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>events_of_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>CHAOS <span class="free">A</span><span class="main">)</span> <span class="main">‚üπ</span> ev <span class="skolem">x</span> <span class="main">‚àà</span> set <span class="skolem">t</span> <span class="main">‚üπ</span> <span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">#</span> <span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>STOP <span class="main">‚äì</span> <span class="main">(</span><span class="main">‚ñ°</span> <span class="bound">z</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚Üí</span> CHAOS <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> CHAOS_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ev <span class="skolem">aa</span> <span class="main">‚àß</span> <span class="skolem">aa</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚àß</span> <span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>CHAOS <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_ndet T_Mprefix T_STOP<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚üπ</span> <span class="main">‚àÉ</span><span class="bound">xa</span><span class="main">‚àà</span>T <span class="main">(</span>CHAOS <span class="free">A</span><span class="main">)</span><span class="main">.</span> ev <span class="skolem">x</span> <span class="main">‚àà</span> set <span class="bound">xa</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> CHAOS_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_ndet T_Mprefix T_STOP<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_elem_T list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-events_CHAOS"><span class="command">lemma</span></span> events_CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"events_of <span class="main">(</span>CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>events_of_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span> <span class="main">‚üπ</span> ev <span class="skolem">x</span> <span class="main">‚àà</span> set <span class="skolem">t</span> <span class="main">‚üπ</span> <span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">#</span> <span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>SKIP <span class="main">‚äì</span> STOP <span class="main">‚äì</span> <span class="main">(</span><span class="main">‚ñ°</span> <span class="bound">z</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚Üí</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> ev <span class="skolem">aa</span> <span class="main">‚àß</span> <span class="skolem">aa</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚àß</span> <span class="skolem">t</span> <span class="main">‚àà</span> T <span class="main">(</span>CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_ndet T_Mprefix T_STOP T_SKIP<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> <span class="free">A</span> <span class="main">‚üπ</span> <span class="main">‚àÉ</span><span class="bound">xa</span><span class="main">‚àà</span>T <span class="main">(</span>CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span><span class="main">.</span> ev <span class="skolem">x</span> <span class="main">‚àà</span> set <span class="bound">xa</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_ndet T_Mprefix T_STOP T_SKIP<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_elem_T list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-events_div"><span class="command">lemma</span></span> events_div<span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">‚â†</span> <span class="main">{}</span> <span class="main">‚üπ</span>  events_of <span class="main">(</span><span class="free">P</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>events_of_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xa</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àà</span> D <span class="free">P</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÉ</span><span class="bound">x</span><span class="main">‚àà</span>T <span class="free">P</span><span class="main">.</span> ev <span class="skolem">xa</span> <span class="main">‚àà</span> set <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True  
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">@</span><span class="main">[</span>ev <span class="skolem">xa</span><span class="main">]</span> <span class="main">‚àà</span> T <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 NT_ND front_tickFree_single is_processT7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>ev <span class="skolem">xa</span><span class="main">]</span> <span class="main">‚àà</span> T <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> D_T D_imp_front_tickFree append_single_T_imp_tickFree butlast_snoc 
                front_tickFree_single nonTickFree_n_frontTickFree process_charn<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">thm</span></span> DF_subset

<span class="keyword1" id="Assertions_ext-DF"><span class="command">lemma</span></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_subset_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">‚â†</span> <span class="main">{}</span> <span class="main">‚üπ</span> <span class="free">A</span> <span class="main">‚äÜ</span> <span class="free">B</span> <span class="main">‚üπ</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">B</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> le_FD_adm<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>monofunI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mono_ndet_FD<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> mono_mndet_FD_process mono_mndet_FD_set trans_FD<span class="main">)</span> 

<span class="keyword1" id="Assertions_ext-RUN_subset_DT"><span class="command">lemma</span></span> RUN_subset_DT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">‚äÜ</span> <span class="free">B</span> <span class="main">‚üπ</span> RUN <span class="free">B</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub><span class="hidden">‚á©</span><sub>T</sub></span> RUN <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> RUN_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> le_DT_adm<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>monofunI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> RUN_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mono_mprefix_DT_process mono_mprefix_DT_set trans_DT<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-CHAOS_subset_FD"><span class="command">lemma</span></span> CHAOS_subset_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">‚äÜ</span> <span class="free">B</span> <span class="main">‚üπ</span> CHAOS <span class="free">B</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> CHAOS <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> CHAOS_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> le_FD_adm<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>monofunI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> CHAOS_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failure_divergence_refine_def le_ref_def 
                     D_Mprefix D_ndet F_STOP F_Mprefix F_ndet<span class="main">)</span> 

<span class="keyword1" id="Assertions_ext-CHAOS"><span class="command">lemma</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_subset_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">‚äÜ</span> <span class="free">B</span> <span class="main">‚üπ</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">B</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> le_FD_adm<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>monofunI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failure_divergence_refine_def le_ref_def 
                     D_Mprefix D_ndet F_STOP F_Mprefix F_ndet<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπRelations between refinements on reference processes‚Ä∫</span></span>

<span class="keyword1" id="Assertions_ext-CHAOS_has_all_tickFree_failures"><span class="command">lemma</span></span> CHAOS_has_all_tickFree_failures<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"tickFree <span class="free">a</span> <span class="main">‚üπ</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ev <span class="bound">x</span> <span class="main">‚àà</span> set <span class="free">a</span><span class="main">}</span> <span class="main">‚äÜ</span> <span class="free">A</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="main">(</span>CHAOS <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> CHAOS_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>F_ndet F_STOP<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a0</span> <span class="skolem">al</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">al</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.left_neutral append_Cons front_tickFree_charn front_tickFree_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CHAOS_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>F_ndet F_STOP F_Mprefix events_of_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> event_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-CHAOS"><span class="command">lemma</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_has_all_failures<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> as<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>events_of <span class="free">P</span><span class="main">)</span> <span class="main">‚äÜ</span> <span class="free">A</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">a</span> <span class="main">‚üπ</span> set <span class="skolem">a</span> <span class="main">‚äÜ</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">t</span><span class="main">‚àà</span>T <span class="free">P</span><span class="main">.</span> set <span class="bound">t</span><span class="main">)</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="main">(</span>CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>F_ndet F_STOP<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a0</span> <span class="skolem">al</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">al</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.left_neutral append_Cons front_tickFree_charn front_tickFree_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>F_ndet F_STOP F_SKIP F_Mprefix events_of_def as<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span><span class="main">=</span>tick"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> front_tickFree_charn 
                    front_tickFree_mono list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tickFree_Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> event_set image_iff as<span class="main">[</span><span class="operator">simplified</span> events_of_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_T SUP_upper failure_refine_def process_charn subrelI<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_has_all_failures_ev<span class="main">:</span> <span class="quoted"><span class="quoted">"CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="main">(</span>events_of <span class="free">P</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">P</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_has_all_failures_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_has_all_failures<span class="main">)</span>


<span class="keyword1" id="Assertions_ext-DF"><span class="command">lemma</span></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_DF_refine_F<span class="main">:</span> <span class="quoted"><span class="quoted">"DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> DF <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_F_adm monofunI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> DF_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 

<span class="keyword1" id="Assertions_ext-DF_RUN_refine_F"><span class="command">lemma</span></span> DF_RUN_refine_F<span class="main">:</span> <span class="quoted"><span class="quoted">"DF <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> RUN <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DF_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_F_adm monofunI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> RUN_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Mprefix_refines_Mndet_F mono_mndet_F_process trans_F<span class="main">)</span>

<span class="keyword1" id="Assertions_ext-CHAOS_DF_refine_F"><span class="command">lemma</span></span> CHAOS_DF_refine_F<span class="main">:</span> <span class="quoted"><span class="quoted">"CHAOS <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> DF <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CHAOS_def DF_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> parallel_fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monofunI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_F_adm<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monofun_snd<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>adm_def failure_refine_def F_mndet 
                                  F_Mprefix write0_def F_ndet F_STOP<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_CHAOS_refine_F<span class="main">:</span> <span class="quoted"><span class="quoted">"CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> CHAOS <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_refine_F<span class="main">:</span> <span class="quoted"><span class="quoted">"CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_has_all_failures events_CHAOS events_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> 
                    trans_F<span class="main"><span class="main">[</span></span><span class="operator">OF</span> CHAOS_DF_refine_F DF_RUN_refine_F<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1" id="Assertions_ext-div_free_DF"><span class="command">lemma</span></span> div_free_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def fix_def<span class="main">)</span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">‚â°</span> <span class="main">Œª</span><span class="bound">i</span><span class="main">.</span> iterate <span class="bound">i</span><span class="main">‚ãÖ</span><span class="main">(</span><span class="keyword1">Œõ</span> x<span class="main">.</span> <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span><span class="free">A</span> <span class="main">‚Üí</span>  <span class="bound">x</span><span class="main">)</span> <span class="main">‚äì</span> SKIP<span class="main">)</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"D <span class="main">(</span><span class="skolem">Y</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">‚â†</span> <span class="main">[]</span> <span class="main">‚àß</span> hd <span class="bound">d</span>  <span class="main">‚àà</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">‚àß</span> tl <span class="bound">d</span> <span class="main">‚àà</span> D<span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Y_def D_STOP D_SKIP D_mndet write0_def D_Mprefix D_ndet<span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">‚àà</span> D<span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">‚üπ</span> length <span class="skolem">d</span> <span class="main">‚â•</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">d</span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">d</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nitpick.size_list_simp<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">‚àà</span> D <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">‚àâ</span> D <span class="main">(</span><span class="skolem">Y</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_n_not_le_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"D <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> D_LUB<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> limproc_is_thelub<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-div_free_DF"><span class="command">lemma</span></span> div_free_DF<span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span>DF <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> DF <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_D_adm monofunI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> DF_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> divergence_refine_def div_free_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-div_free_CHAOS"><span class="command">lemma</span></span> div_free_CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"D <span class="main">(</span>CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_D_adm monofunI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span><span class="free">A</span> <span class="main">‚Üí</span>  <span class="skolem">x</span><span class="main">)</span> <span class="main">‚äì</span> SKIP<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>SKIP <span class="main">‚äì</span> SKIP <span class="main">‚äì</span> <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span><span class="free">A</span> <span class="main">‚Üí</span>  <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ndet_commute ndet_id<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP <span class="main">‚äì</span> SKIP <span class="main">‚äì</span> <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span><span class="free">A</span> <span class="main">‚Üí</span>  <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="main">(</span>SKIP <span class="main">‚äì</span> STOP <span class="main">‚äì</span> <span class="main">(</span><span class="main">‚ñ°</span><span class="bound">xa</span><span class="main">‚àà</span><span class="free">A</span> <span class="main">‚Üí</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> DT_D Mprefix_refines_Mndet_D STOP_leDT idem_D 
                mono_mprefix_D_process mono_ndet_D trans_D<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span><span class="free">A</span> <span class="main">‚Üí</span>  <span class="skolem">x</span><span class="main">)</span> <span class="main">|-|</span> SKIP<span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="main">(</span>SKIP <span class="main">|-|</span> STOP <span class="main">|-|</span> Mprefix <span class="free">A</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> divergence_refine_def div_free_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-div_free_CHAOS"><span class="command">lemma</span></span> div_free_CHAOS<span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span>CHAOS <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> CHAOS <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_D_adm monofunI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> CHAOS_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> divergence_refine_def div_free_CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-div_free_RUN"><span class="command">lemma</span></span> div_free_RUN<span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span>RUN <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CHAOS <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> RUN <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CHAOS_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_D_adm monofunI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> RUN_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> divergence_refine_def div_free_CHAOS <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_DF_refine_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> DF <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> DF_RUN_refine_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"DF <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> RUN <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> CHAOS_DF_refine_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"CHAOS <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> DF <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_CHAOS_refine_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> CHAOS <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_refine_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>  <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> div_free_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> div_free_CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> div_free_DF<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> div_free_RUN<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
        div_free_CHAOS<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
        F_D_FD<span class="main">[</span><span class="operator">OF</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_DF_refine_F<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> F_D_FD<span class="main">[</span><span class="operator">OF</span> DF_RUN_refine_F<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
        F_D_FD<span class="main">[</span><span class="operator">OF</span> CHAOS_DF_refine_F<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> F_D_FD<span class="main">[</span><span class="operator">OF</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_CHAOS_refine_F<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
        F_D_FD<span class="main">[</span><span class="operator">OF</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_refine_F<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>divergence_refine_def<span class="main">)</span> 


<span class="keyword1" id="Assertions_ext-traces_CHAOS_sub"><span class="command">lemma</span></span> traces_CHAOS_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"T<span class="main">(</span>CHAOS <span class="free">A</span><span class="main">)</span> <span class="main">‚äÜ</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> set <span class="bound">s</span> <span class="main">‚äÜ</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">sa</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">‚àà</span> T <span class="main">(</span>CHAOS <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="main">‚àà</span> set <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="main">‚àà</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> CHAOS_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_ndet T_STOP T_Mprefix<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-traces_RUN_sub"><span class="command">lemma</span></span> traces_RUN_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> set <span class="bound">s</span> <span class="main">‚äÜ</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">}</span> <span class="main">‚äÜ</span> T<span class="main">(</span>RUN <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">s</span> <span class="main">‚äÜ</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">‚àà</span> T <span class="main">(</span>RUN <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nil_elem_T<span class="main">)</span> <span class="main">(</span><span class="operator">subst</span> RUN_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_Mprefix<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> RUN_all_tickfree_traces1<span class="main">:</span> <span class="quoted"><span class="quoted">"T<span class="main">(</span>RUN <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> set <span class="bound">s</span> <span class="main">‚äÜ</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">}</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> DF_all_tickfree_traces1<span class="main">:</span> <span class="quoted"><span class="quoted">"T<span class="main">(</span>DF <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> set <span class="bound">s</span> <span class="main">‚äÜ</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">}</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> CHAOS_all_tickfree_traces1<span class="main">:</span> <span class="quoted"><span class="quoted">"T<span class="main">(</span>CHAOS <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> set <span class="bound">s</span> <span class="main">‚äÜ</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> DF_RUN_refine_F<span class="main">[</span><span class="operator">THEN</span> le_F_T<span class="main">,</span> <span class="operator">simplified</span> trace_refine_def<span class="main">]</span>
        CHAOS_DF_refine_F<span class="main">[</span><span class="operator">THEN</span> le_F_T<span class="main">,</span><span class="operator">simplified</span> trace_refine_def<span class="main">]</span> 
        traces_CHAOS_sub traces_RUN_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">corollary</span></span> RUN_all_tickfree_traces2<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="free">s</span> <span class="main">‚üπ</span> <span class="free">s</span> <span class="main">‚àà</span> T<span class="main">(</span>RUN UNIV<span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> DF_all_tickfree_traces2<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="free">s</span> <span class="main">‚üπ</span> <span class="free">s</span> <span class="main">‚àà</span> T<span class="main">(</span>DF UNIV<span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> CHAOS_all_tickfree_trace2<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="free">s</span> <span class="main">‚üπ</span> <span class="free">s</span> <span class="main">‚àà</span> T<span class="main">(</span>CHAOS UNIV<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tickFree_def RUN_all_tickfree_traces1 
                       DF_all_tickfree_traces1 CHAOS_all_tickfree_traces1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> event_set insertE subsetI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Assertions_ext-traces_CHAOS"><span class="command">lemma</span></span> traces_CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"T<span class="main">(</span>CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span> <span class="main">‚äÜ</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> front_tickFree <span class="bound">s</span> <span class="main">‚àß</span> set <span class="bound">s</span> <span class="main">‚äÜ</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span> <span class="main">‚à™</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>is_processT2_TR<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">sa</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">‚àà</span> T <span class="main">(</span>CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="main">‚àà</span> set <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="main">‚àâ</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="main">=</span> tick"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_ndet T_STOP T_SKIP T_Mprefix<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Assertions_ext-traces_DF"><span class="command">lemma</span></span> traces_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_sub<span class="main">:</span> 
                      <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> front_tickFree <span class="bound">s</span> <span class="main">‚àß</span> set <span class="bound">s</span> <span class="main">‚äÜ</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span> <span class="main">‚à™</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">}</span> <span class="main">‚äÜ</span> T<span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">::</span><span class="tfree">'a</span> process<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"set <span class="skolem">s</span> <span class="main">‚äÜ</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="main">(</span><span class="main">(</span>tick<span class="main">::</span><span class="tfree">'a</span> event<span class="main">)</span> <span class="main">#</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">‚üπ</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> butlast_snoc front_tickFree_charn list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tickFree_Cons<span class="main">)</span> 
  <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">‚àà</span> T <span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nil_elem_T<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_Mprefix T_mndet write0_def T_SKIP T_ndet T_STOP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons append_Nil front_tickFree_charn front_tickFree_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons append_Nil front_tickFree_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_all_front_tickfree_traces1<span class="main">:</span> 
                              <span class="quoted"><span class="quoted">"T<span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> front_tickFree <span class="bound">s</span> <span class="main">‚àß</span> set <span class="bound">s</span> <span class="main">‚äÜ</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span> <span class="main">‚à™</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_all_front_tickfree_traces1<span class="main">:</span> 
                              <span class="quoted"><span class="quoted">"T<span class="main">(</span>CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> front_tickFree <span class="bound">s</span> <span class="main">‚àß</span> set <span class="bound">s</span> <span class="main">‚äÜ</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span> <span class="main">‚à™</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_refine_F<span class="main">[</span><span class="operator">THEN</span> le_F_T<span class="main">,</span> <span class="operator">simplified</span> trace_refine_def<span class="main">]</span>
        traces_CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_sub traces_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">corollary</span></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_all_front_tickfree_traces2<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="free">s</span> <span class="main">‚üπ</span> <span class="free">s</span> <span class="main">‚àà</span> T<span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV<span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_all_front_tickfree_traces2<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="free">s</span> <span class="main">‚üπ</span> <span class="free">s</span> <span class="main">‚àà</span> T<span class="main">(</span>CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tickFree_def DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_all_front_tickfree_traces1 
                      CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_all_front_tickfree_traces1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> event_set subsetI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">corollary</span></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_has_all_traces<span class="main">:</span> <span class="quoted"><span class="quoted">"DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_has_all_traces<span class="main">:</span> <span class="quoted"><span class="quoted">"CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>trace_refine_def DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_all_front_tickfree_traces2 is_processT2_TR subsetI<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>trace_refine_def CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_all_front_tickfree_traces2 is_processT2_TR subsetI<span class="main">)</span> 

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Properties">
<div class="head">
<h1>Theory Properties</h1>
</div>
<pre class="source"><span class="comment1">‚Äï‚Äπ ******************************************************************** 
 * Project         : CSP-RefTK - A Refinement Toolkit for HOL-CSP
 * Version         : 1.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *
 * This file       : Theorems on DF and LF
 *
 * Copyright (c) 2020 Universit√© Paris-Saclay, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************‚Ä∫</span>

<span class="keyword1"><span class="command">theory</span></span> Properties
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="Assertions_ext.html">Assertions_ext</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπDeadlock Free‚Ä∫</span></span>

<span class="keyword1"><span class="command">thm</span></span> deadlock_free_def

<span class="keyword1" id="Properties-deadlock_free_implies_div_free"><span class="command">lemma</span></span> deadlock_free_implies_div_free<span class="main">:</span> <span class="quoted"><span class="quoted">"deadlock_free <span class="free">P</span> <span class="main">‚üπ</span> D <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deadlock_free_def div_free_DF failure_divergence_refine_def le_ref_def<span class="main">)</span>

<span class="keyword1" id="Properties-deadlock_free_implies_non_terminating"><span class="command">lemma</span></span> deadlock_free_implies_non_terminating<span class="main">:</span> <span class="quoted"><span class="quoted">"deadlock_free <span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'a</span> process<span class="main">)</span> <span class="main">‚üπ</span> <span class="main">‚àÄ</span><span class="bound">s</span><span class="main">‚àà</span>T <span class="free">P</span><span class="main">.</span> tickFree <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> deadlock_free_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> FD_F<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> le_F_T<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> trace_refine_def 
  <span class="keyword1"><span class="command">using</span></span> DF_all_tickfree_traces1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span><span class="main">]</span> tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deadlock_free_v2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">‚áí</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">deadlock_free_v2</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">‚â°</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1" id="Properties-deadlock_free_v2_is_right"><span class="command">lemma</span></span> deadlock_free_v2_is_right<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"deadlock_free_v2 <span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'a</span> process<span class="main">)</span> <span class="main">‚ü∑</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound">s</span><span class="main">‚àà</span>T <span class="free">P</span><span class="main">.</span> tickFree <span class="bound">s</span> <span class="main">‚ü∂</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> UNIV<span class="main">::</span><span class="tfree">'a</span> event set<span class="main">)</span> <span class="main">‚àâ</span> F <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"deadlock_free_v2 <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">s</span> <span class="main">‚ü∂</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> UNIV<span class="main">)</span> <span class="main">‚àâ</span> F <span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>F_mndet write0_def F_Mprefix F_ndet F_SKIP<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>F_mndet write0_def F_Mprefix F_ndet F_SKIP<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">s</span><span class="main">‚àà</span>T <span class="free">P</span><span class="main">.</span> tickFree <span class="bound">s</span> <span class="main">‚ü∂</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> UNIV<span class="main">)</span> <span class="main">‚àâ</span> F <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> deadlock_free_v2_def failure_refine_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> as1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">s</span><span class="main">‚àà</span>T <span class="free">P</span><span class="main">.</span> tickFree <span class="bound">s</span> <span class="main">‚ü∂</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> UNIV<span class="main">)</span> <span class="main">‚àâ</span> F <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> as2<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">s</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="main">‚àÉ</span><span class="bound">aa</span> <span class="main">‚àà</span> UNIV<span class="main">.</span> ev <span class="bound">aa</span> <span class="main">‚àâ</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span><span class="main">)</span>"</span></span> 
       <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>F_mndet write0_def F_Mprefix F_ndet F_SKIP<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">hda</span> <span class="skolem">tla</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def fix_def<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">‚â°</span> <span class="main">Œª</span><span class="bound">i</span><span class="main">.</span> iterate <span class="bound">i</span><span class="main">‚ãÖ</span><span class="main">(</span><span class="keyword1">Œõ</span> x<span class="main">.</span> <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">‚Üí</span>  <span class="bound">x</span><span class="main">)</span> <span class="main">‚äì</span> SKIP<span class="main">)</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="main">(</span><span class="skolem">hda</span> <span class="main">#</span> <span class="skolem">tla</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">tla</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="skolem">tla</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚àÉ</span><span class="bound">aa</span><span class="main">.</span> ev <span class="bound">aa</span> <span class="main">‚àâ</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> Y_def <span class="keyword1"><span class="command">have</span></span> cc<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">tla</span> <span class="main">‚üπ</span> <span class="main">‚àÉ</span><span class="bound">aa</span><span class="main">‚àà</span>UNIV<span class="main">.</span> ev <span class="bound">aa</span> <span class="main">‚àâ</span> <span class="skolem">b</span> <span class="main">‚üπ</span><span class="main">(</span><span class="skolem">tla</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> 
        <span class="keyword1"><span class="command">using</span></span> F_LUB<span class="main">[</span><span class="operator">OF</span> cc<span class="main">]</span> limproc_is_thelub<span class="main">[</span><span class="operator">OF</span> cc<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Y_def <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span><span class="quoted"><span class="quoted">"F<span class="main">(</span>mndet UNIV <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">‚äì</span> SKIP<span class="main">)</span> <span class="main">‚äÜ</span> F <span class="main">(</span><span class="skolem">Y</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tla</span> <span class="main">‚â†</span> <span class="main">[]</span> <span class="main">‚üπ</span> <span class="skolem">hda</span> <span class="main">‚â†</span> tick"</span></span> <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">tla</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> butlast_snoc front_tickFree_charn 
                      list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tickFree_Cons<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a append_Cons append_Nil front_tickFree_Nil front_tickFree_mono<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">hda</span><span class="main">#</span><span class="skolem">tla</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="main">(</span><span class="skolem">Y</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">using</span></span> f c e<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> d<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_mndet write0_def F_Mprefix Y_def F_ndet F_SKIP<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> event.exhaust<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
      <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">hda</span><span class="main">#</span><span class="skolem">tla</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="main">(</span><span class="skolem">Y</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> NF_ND cc g po_class.chainE proc_ord2a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> a b c <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">hda</span><span class="main">#</span><span class="skolem">tla</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> F_LUB<span class="main">[</span><span class="operator">OF</span> cc<span class="main">]</span> is_ub_thelub<span class="main">[</span><span class="operator">OF</span> cc<span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_LUB_2 cc g limproc_is_thelub po_class.chainE proc_ord2a process_charn<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>   
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"deadlock_free_v2 <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>deadlock_free_v2_def failure_refine_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> as3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">‚àà</span> T <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">s</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> F_T <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">using</span></span> as3 is_processT2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="main">(</span>DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">s</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> FT_True<span class="main">:</span>True
      <span class="keyword1"><span class="command">hence</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> UNIV<span class="main">)</span> <span class="main">‚àâ</span> F <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 as1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FT_True UNIV_I UNIV_eq_I a1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> as2 as3 emptyE event.exhaust 
                  is_processT6_S1 tickFree_implies_front_tickFree_single<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> FT_False<span class="main">:</span> False                                                                 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> T_F_spec UNIV_witness a1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> append_single_T_imp_tickFree 
                  as2 emptyE is_processT5_S7<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="Properties-deadlock_free_v2_implies_div_free"><span class="command">lemma</span></span> deadlock_free_v2_implies_div_free<span class="main">:</span> <span class="quoted"><span class="quoted">"deadlock_free_v2 <span class="free">P</span> <span class="main">‚üπ</span> D <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_T append_single_T_imp_tickFree deadlock_free_v2_is_right ex_in_conv 
            nonTickFree_n_frontTickFree process_charn<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> deadlock_free_v2_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"deadlock_free_v2 <span class="free">P</span> <span class="main">=</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> deadlock_free_v2_def 
  <span class="keyword1"><span class="command">using</span></span> deadlock_free_v2_implies_div_free FD_F F_D_FD deadlock_free_v2_def divergence_refine_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 

<span class="keyword1" id="Properties-all_events_refusal"><span class="command">lemma</span></span> all_events_refusal<span class="main">:</span> 
                        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{</span>tick<span class="main">}</span> <span class="main">‚à™</span> ev <span class="main">`</span> <span class="main">(</span>events_of <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="free">P</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> UNIV<span class="main">::</span><span class="tfree">'a</span> event set<span class="main">)</span> <span class="main">‚àà</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{</span>tick<span class="main">}</span> <span class="main">‚à™</span> ev <span class="main">`</span> events_of <span class="free">P</span><span class="main">)</span> <span class="main">‚àà</span> F <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> UNIV<span class="main">)</span> <span class="main">‚àâ</span> F <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">‚àâ</span> <span class="main">{</span>tick<span class="main">}</span> <span class="main">‚à™</span> ev <span class="main">`</span> events_of <span class="free">P</span> <span class="main">‚àß</span> <span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">c</span><span class="main">]</span> <span class="main">‚àà</span> T <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_processT5_S1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span> <span class="main">‚à™</span> ev <span class="main">`</span> events_of <span class="free">P</span>"</span></span> <span class="quoted"><span class="free">P</span></span> 
            <span class="quoted"><span class="quoted">"UNIV <span class="main">-</span> <span class="main">(</span><span class="main">{</span>tick<span class="main">}</span> <span class="main">‚à™</span> ev <span class="main">`</span> events_of <span class="free">P</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> F_T a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>events_of_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span>  
  <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> UNIV<span class="main">)</span> <span class="main">‚àà</span> F <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> deadlock_free_v2_is_right_wrt_events<span class="main">:</span>
  <span class="quoted"><span class="quoted">"deadlock_free_v2 <span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'a</span> process<span class="main">)</span> <span class="main">‚ü∑</span> 
                                  <span class="main">(</span><span class="main">‚àÄ</span><span class="bound">s</span><span class="main">‚àà</span>T <span class="free">P</span><span class="main">.</span> tickFree <span class="bound">s</span> <span class="main">‚ü∂</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="main">{</span>tick<span class="main">}</span> <span class="main">‚à™</span> ev <span class="main">`</span> <span class="main">(</span>events_of <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àâ</span> F <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> deadlock_free_v2_is_right <span class="keyword1"><span class="command">using</span></span> all_events_refusal <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">using</span></span> is_processT4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1" id="Properties-deadlock_free_is_deadlock_free_v2"><span class="command">lemma</span></span> deadlock_free_is_deadlock_free_v2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"deadlock_free <span class="free">P</span> <span class="main">‚üπ</span> deadlock_free_v2 <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_DF_refine_FD deadlock_free_def deadlock_free_v2_FD trans_FD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπNon-terminating Runs‚Ä∫</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">non_terminating</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">‚áí</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">non_terminating</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">‚â°</span> RUN UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> non_terminating_refine_DF<span class="main">:</span> <span class="quoted"><span class="quoted">"non_terminating <span class="free">P</span> <span class="main">=</span> DF UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> non_terminating_refine_CHAOS<span class="main">:</span> <span class="quoted"><span class="quoted">"non_terminating <span class="free">P</span> <span class="main">=</span> CHAOS UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>T</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DF_all_tickfree_traces1 RUN_all_tickfree_traces1 CHAOS_all_tickfree_traces1 
                    non_terminating_def trace_refine_def<span class="main">)</span>

<span class="keyword1" id="Properties-non_terminating_is_right"><span class="command">lemma</span></span> non_terminating_is_right<span class="main">:</span> <span class="quoted"><span class="quoted">"non_terminating <span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'a</span> process<span class="main">)</span> <span class="main">‚ü∑</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound">s</span><span class="main">‚àà</span>T <span class="free">P</span><span class="main">.</span> tickFree <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>non_terminating_def trace_refine_def tickFree_def RUN_all_tickfree_traces1<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>non_terminating_def trace_refine_def RUN_all_tickfree_traces2<span class="main">)</span>

<span class="keyword1" id="Properties-nonterminating_implies_div_free"><span class="command">lemma</span></span> nonterminating_implies_div_free<span class="main">:</span> <span class="quoted"><span class="quoted">"non_terminating <span class="free">P</span> <span class="main">‚üπ</span> D <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> non_terminating_is_right
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NT_ND equals0I front_tickFree_charn process_charn tickFree_Cons tickFree_append<span class="main">)</span> 

<span class="keyword1" id="Properties-non_terminating_implies_F"><span class="command">lemma</span></span> non_terminating_implies_F<span class="main">:</span> <span class="quoted"><span class="quoted">"non_terminating <span class="free">P</span> <span class="main">‚üπ</span> CHAOS UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> non_terminating_is_right failure_refine_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> CHAOS_has_all_tickFree_failures F_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">corollary</span></span> non_terminating_F<span class="main">:</span> <span class="quoted"><span class="quoted">"non_terminating <span class="free">P</span> <span class="main">=</span> CHAOS UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>non_terminating_implies_F non_terminating_refine_CHAOS le_F_T<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> non_terminating_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"non_terminating <span class="free">P</span> <span class="main">=</span> CHAOS UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> non_terminating_F
  <span class="keyword1"><span class="command">using</span></span> div_free_CHAOS nonterminating_implies_div_free FD_F F_D_FD divergence_refine_def 
        non_terminating_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπLifelock Freeness‚Ä∫</span></span>

<span class="keyword1"><span class="command">thm</span></span> lifelock_free_def

<span class="keyword1"><span class="command">corollary</span></span> lifelock_free_is_non_terminating<span class="main">:</span> <span class="quoted"><span class="quoted">"lifelock_free <span class="free">P</span> <span class="main">=</span> non_terminating <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lifelock_free_def non_terminating_FD <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span>

<span class="keyword1" id="Properties-div_free_divergence_refine"><span class="command">lemma</span></span> div_free_divergence_refine<span class="main">:</span>
  <span class="quoted"><span class="quoted">"D <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">‚ü∑</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span>"</span></span> 
  <span class="quoted"><span class="quoted">"D <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">‚ü∑</span> CHAOS UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span>"</span></span> 
  <span class="quoted"><span class="quoted">"D <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">‚ü∑</span> RUN UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span>"</span></span> 
  <span class="quoted"><span class="quoted">"D <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">‚ü∑</span> DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span>"</span></span> 
  <span class="quoted"><span class="quoted">"D <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">‚ü∑</span> DF UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_free_CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> div_free_CHAOS div_free_RUN div_free_DF div_free_DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> 
                    divergence_refine_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lifelock_free_v2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">‚áí</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">lifelock_free_v2</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">‚â°</span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub> UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1" id="Properties-div_free_is_lifelock_free_v2"><span class="command">lemma</span></span> div_free_is_lifelock_free_v2<span class="main">:</span> <span class="quoted"><span class="quoted">"lifelock_free_v2 <span class="free">P</span> <span class="main">‚ü∑</span> D <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> CHAOS<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_has_all_failures_Un FD_D F_D_FD div_free_divergence_refine<span class="main">(</span>1<span class="main">)</span> lifelock_free_v2_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword1" id="Properties-lifelock_free_is_lifelock_free_v2"><span class="command">lemma</span></span> lifelock_free_is_lifelock_free_v2<span class="main">:</span> <span class="quoted"><span class="quoted">"lifelock_free <span class="free">P</span> <span class="main">‚üπ</span> lifelock_free_v2 <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FD_D div_free_divergence_refine<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> div_free_is_lifelock_free_v2 lifelock_free_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> deadlock_free_v2_is_lifelock_free_v2<span class="main">:</span> <span class="quoted"><span class="quoted">"deadlock_free_v2 <span class="free">P</span> <span class="main">‚üπ</span> lifelock_free_v2 <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deadlock_free_v2_implies_div_free div_free_is_lifelock_free_v2<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπNew laws‚Ä∫</span></span>

<span class="keyword1" id="Properties-non_terminating_seq"><span class="command">lemma</span></span> non_terminating_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"non_terminating <span class="free">P</span> <span class="main">‚üπ</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> non_terminating_is_right Process_eq_spec D_seq F_seq F_T is_processT7<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> process_charn <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> process_charn <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">using</span></span> F_T is_processT5_S2a <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">using</span></span> D_T front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Properties-non_terminating_inter"><span class="command">lemma</span></span> non_terminating_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"non_terminating <span class="free">P</span> <span class="main">‚üπ</span> lifelock_free_v2 <span class="free">Q</span> <span class="main">‚üπ</span> non_terminating <span class="main">(</span><span class="free">P</span> <span class="main">‚ü¶</span><span class="free">C</span><span class="main">‚üß</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> non_terminating_is_right div_free_is_lifelock_free_v2 T_sync<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equals0D ftf_syn1 ftf_syn21 insertI1 tickFree_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> NT_ND is_processT7_S tickFree_append<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T empty_iff ftf_syn1 ftf_syn21 insertI1 tickFree_def<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Fix_ind_ext">
<div class="head">
<h1>Theory Fix_ind_ext</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">‚Äï‚Äπ ********************************************************************
 * Project         : CSP-RefTK - A Refinement Toolkit for HOL-CSP
 * Version         : 1.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *
 * This file       : More Fixpoint and k-Induction Schemata
 *
 * Copyright (c) 2020 Universit√© Paris-Saclay, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************‚Ä∫</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‚Äπ Advanced Induction Schemata ‚Ä∫</span></span>

<span class="keyword1"><span class="command">theory</span></span> Fix_ind_ext

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOLCF/HOLCF.html">HOLCF</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‚Äπk-fixpoint-induction‚Ä∫</span></span>

<span class="keyword1" id="Fix_ind_ext-nat_k_induct"><span class="command">lemma</span></span> nat_k_induct<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">n<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">n<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">+</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">‚ü∂</span> <span class="free">P</span> <span class="main">(</span><span class="bound">n<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">+</span><span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="free">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">thm</span></span> fix_ind fix_ind2 

<span class="keyword1" id="Fix_ind_ext-fix_ind_k"><span class="command">lemma</span></span> fix_ind_k<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> adm<span class="main">:</span> <span class="quoted"><span class="quoted">"adm <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> base_k_steps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>iterate <span class="bound">i</span><span class="main">‚ãÖ</span><span class="free">f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span>  <span class="free">P</span> <span class="main">(</span>iterate <span class="bound">i</span><span class="main">‚ãÖ</span><span class="free">f</span><span class="main">‚ãÖ</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="main">(</span>iterate <span class="free">k</span><span class="main">‚ãÖ</span><span class="free">f</span><span class="main">‚ãÖ</span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>fix<span class="main">‚ãÖ</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fix_def2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> admD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> adm chain_iterate<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nat_k_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> base_k_steps<span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> add.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> iterate_iterate<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">blast</span> 

<span class="keyword1" id="Fix_ind_ext-nat_k_skip_induct"><span class="command">lemma</span></span> nat_k_skip_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">‚â•</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">n<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">n<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">)</span> <span class="main">‚ü∂</span> <span class="free">P</span> <span class="main">(</span><span class="bound">n<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">+</span><span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="free">k</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Fix_ind_ext-fix_ind_k_skip"><span class="command">lemma</span></span> fix_ind_k_skip<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">‚â•</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> adm<span class="main">:</span> <span class="quoted"><span class="quoted">"adm <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> base_k_steps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>iterate <span class="bound">i</span><span class="main">‚ãÖ</span><span class="free">f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="main">(</span>iterate <span class="free">k</span><span class="main">‚ãÖ</span><span class="free">f</span><span class="main">‚ãÖ</span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>fix<span class="main">‚ãÖ</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fix_def2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> admD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> adm chain_iterate<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nat_k_skip_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> k_1 base_k_steps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">using</span></span> step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> iterate_iterate<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">thm</span></span> parallel_fix_ind

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‚ÄπParallel fixpoint-induction‚Ä∫</span></span>

<span class="keyword1" id="Fix_ind_ext-parallel_fix_ind_inc"><span class="command">lemma</span></span> parallel_fix_ind_inc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> adm<span class="main">:</span> <span class="quoted"><span class="quoted">"adm <span class="main">(</span><span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> base_fst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="main">‚ä•</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> base_snd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">‚ä•</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">‚ãÖ</span><span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">(</span><span class="free">H</span><span class="main">‚ãÖ</span><span class="bound">y</span><span class="main">)</span> <span class="main">‚üπ</span> <span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">‚ãÖ</span><span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">H</span><span class="main">‚ãÖ</span><span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>fix<span class="main">‚ãÖ</span><span class="free">G</span><span class="main">)</span> <span class="main">(</span>fix<span class="main">‚ãÖ</span><span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> adm <span class="keyword1"><span class="command">have</span></span> adm'<span class="main">:</span> <span class="quoted"><span class="quoted">"adm <span class="main">(</span>case_prod <span class="free">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> split_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>iterate <span class="skolem">i</span><span class="main">‚ãÖ</span><span class="free">G</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">(</span>iterate <span class="skolem">j</span><span class="main">‚ãÖ</span><span class="free">H</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">+</span><span class="skolem">j</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i'</span> <span class="skolem">j'</span>
      <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">i'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">j'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>iterate <span class="skolem">i'</span><span class="main">‚ãÖ</span><span class="free">G</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">(</span>iterate <span class="skolem">j'</span><span class="main">‚ãÖ</span><span class="free">H</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>iterate <span class="skolem">i'</span><span class="main">‚ãÖ</span><span class="free">G</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">(</span>iterate <span class="skolem">j</span><span class="main">‚ãÖ</span><span class="free">H</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>iterate <span class="skolem">i</span><span class="main">‚ãÖ</span><span class="free">G</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">(</span>iterate <span class="skolem">j'</span><span class="main">‚ãÖ</span><span class="free">H</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.hyps"</span> add_strict_mono i j <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.hyps"</span> i <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.hyps"</span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i j step<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>base_fst<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>base_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">i</span><span class="main">.</span> case_prod <span class="free">P</span> <span class="main">(</span>iterate <span class="bound">i</span><span class="main">‚ãÖ</span><span class="free">G</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">,</span> iterate <span class="bound">i</span><span class="main">‚ãÖ</span><span class="free">H</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"case_prod <span class="free">P</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>iterate <span class="bound">i</span><span class="main">‚ãÖ</span><span class="free">G</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">,</span> iterate <span class="bound">i</span><span class="main">‚ãÖ</span><span class="free">H</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> admD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> adm'<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> iterate <span class="bound">i</span><span class="main">‚ãÖ</span><span class="free">G</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">(</span><span class="main">‚®Ü</span><span class="bound">i</span><span class="main">.</span> iterate <span class="bound">i</span><span class="main">‚ãÖ</span><span class="free">H</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lub_Pair<span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>fix<span class="main">‚ãÖ</span><span class="free">G</span><span class="main">)</span> <span class="main">(</span>fix<span class="main">‚ãÖ</span><span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fix_def2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Process_norm">
<div class="head">
<h1>Theory Process_norm</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">‚Äï‚Äπ ********************************************************************
 * Project         : CSP-RefTK - A Refinement Toolkit for HOL-CSP
 * Version         : 1.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *
 * This file       : A Normalization Theory
 *
 * Copyright (c) 2020 Universit√© Paris-Saclay, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************‚Ä∫</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‚Äπ Normalisation of Deterministic CSP Processes ‚Ä∫</span></span>

<span class="keyword1"><span class="command">theory</span></span> Process_norm

<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="Properties.html">Properties</a>"</span> <span class="quoted">"<a href="Fix_ind_ext.html">Fix_ind_ext</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‚ÄπDeterministic normal-forms with explicit state‚Ä∫</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">P_dnorm</span> <span class="free"><span class="bound"><span class="entity">Tr</span></span></span> <span class="free"><span class="bound"><span class="entity">Up</span></span></span> <span class="main">‚â°</span> <span class="main">(</span><span class="keyword1">Œº</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">Œª</span> <span class="bound">s</span><span class="main">.</span> <span class="main">‚ñ°</span> <span class="bound">e</span> <span class="main">‚àà</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Tr</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main">‚Üí</span> <span class="bound">X</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Up</span></span></span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> P_dnorm <span class="main">(</span><span class="quoted">"<span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span>_<span class="keyword1">,</span>_<span class="keyword1">‚üß</span>"</span> 60<span class="main">)</span>

<span class="keyword1" id="Process_norm-dnorm_cont"><span class="command">lemma</span></span> dnorm_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Tr</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state</span><span class="main">::</span>type <span class="main">‚áí</span> <span class="tfree">'event</span><span class="main">::</span>type set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Up</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state</span> <span class="main">‚áí</span> <span class="tfree">'event</span> <span class="main">‚áí</span> <span class="tfree">'state</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">Œª</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> <span class="main">‚ñ°</span> <span class="bound">e</span> <span class="main">‚àà</span> <span class="main">(</span><span class="free">Tr</span> <span class="bound">s</span><span class="main">)</span> <span class="main">‚Üí</span> <span class="bound">X</span> <span class="main">(</span><span class="free">Ur</span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"cont <span class="var">?f</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">Œª</span><span class="bound">X</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">X</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont_fun<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‚ÄπInterleaving product lemma‚Ä∫</span></span>

<span class="keyword1" id="Process_norm-dnorm_inter"><span class="command">lemma</span></span> dnorm_inter<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Tr<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">::</span>type <span class="main">‚áí</span> <span class="tfree">'event</span><span class="main">::</span>type set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Tr<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">::</span>type <span class="main">‚áí</span> <span class="tfree">'event</span> set"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Up<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">‚áí</span> <span class="tfree">'event</span> <span class="main">‚áí</span> <span class="tfree">'state<span class="hidden">‚á©</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Up<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state<span class="hidden">‚á©</span><sub>2</sub></span> <span class="main">‚áí</span> <span class="tfree">'event</span> <span class="main">‚áí</span> <span class="tfree">'state<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">‚â°</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="free">Tr<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="free">Up<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">‚üß</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">‚â°</span> fix<span class="main">‚ãÖ</span><span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?P</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">‚â°</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="free">Tr<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">,</span><span class="free">Up<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">‚üß</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">‚â°</span> fix<span class="main">‚ãÖ</span><span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?Q</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">)</span>

  <span class="keyword2"><span class="keyword">assumes</span></span> indep<span class="main">:</span> <span class="quoted"><span class="quoted">‚Äπ<span class="main">‚àÄ</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="free">Tr<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">‚à©</span> <span class="free">Tr<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span> <span class="main">=</span> <span class="main">{}</span>‚Ä∫</span></span>

  <span class="keyword2"><span class="keyword">defines</span></span> Tr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Tr</span> <span class="main">‚â°</span> <span class="main">(</span><span class="main">Œª</span><span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span><span class="main">.</span> <span class="free">Tr<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">‚à™</span> <span class="free">Tr<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> Up<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Up</span> <span class="main">‚â°</span> <span class="main">(</span><span class="main">Œª</span><span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="bound">e</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">e</span> <span class="main">‚àà</span> <span class="free">Tr<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">Up<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">e</span><span class="main">,</span><span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>
                                <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">e</span> <span class="main">‚àà</span> <span class="free">Tr<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span> <span class="free">Up<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">e</span><span class="main">)</span>
                                <span class="keyword1">else</span> <span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword2"><span class="keyword">defines</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">‚â°</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="free">Tr</span><span class="main">,</span><span class="free">Up</span><span class="main">‚üß</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">‚â°</span> fix<span class="main">‚ãÖ</span><span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?S</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">)</span>
  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="free">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">|||</span> <span class="free">Q</span> <span class="free">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span> <span class="main">(</span><span class="free">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="free">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> P_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="var">?P</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?P</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">]</span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">have</span></span> Q_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="var">?Q</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?Q</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">]</span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">have</span></span> S_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="var">?S</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?S</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">]</span> S <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> dir1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">|||</span> <span class="free">Q</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">‚äë</span> <span class="free">S</span> <span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> P<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Q<span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>parallel_fix_ind_inc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">|||</span> <span class="bound">y</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">‚äë</span> <span class="free">S</span> <span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> adm<span class="main">:</span>1                                       
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> adm_all adm_below<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont2cont_fun<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> base_fst<span class="main">:</span><span class="main">(</span>2 <span class="skolem">y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inter_commute app_strict minimal par_Int_bot<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> base_snd<span class="main">:</span><span class="main">(</span>3 <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_Int_bot<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>4 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="var">?C</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mprefix_Par_Int<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> C<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> S_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tr Up mprefix_Un_distr<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> mono_det_ref mono_mprefix_ref<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> indep <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> indep <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>     
  <span class="keyword1"><span class="command">have</span></span> dir2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span>  <span class="free">S</span> <span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">‚äë</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">|||</span> <span class="free">Q</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> S<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">‚äë</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">|||</span> <span class="free">Q</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> adm<span class="main">:</span>1
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> adm_all adm_below<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_fun<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>3 <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="var">?C</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span>
        <span class="keyword1"><span class="command">have</span></span> P_rec_sym<span class="main">:</span><span class="quoted"><span class="quoted">"Mprefix <span class="main">(</span><span class="free">Tr<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">Up<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P_rec <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">have</span></span> Q_rec_sym<span class="main">:</span><span class="quoted"><span class="quoted">"Mprefix <span class="main">(</span><span class="free">Tr<span class="hidden">‚á©</span><sub>2</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">Up<span class="hidden">‚á©</span><sub>2</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q_rec <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tr Up mprefix_Un_distr<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> P_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Q_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> mprefix_Par_Int<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> C<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> mono_det_ref mono_mprefix_ref<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Q_rec_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> P_rec_sym<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> step<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> indep <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> dir1 dir2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> below_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‚ÄπSynchronous product lemma‚Ä∫</span></span>
<span class="keyword1" id="Process_norm-dnorm_par"><span class="command">lemma</span></span> dnorm_par<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Tr<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">::</span>type <span class="main">‚áí</span> <span class="tfree">'event</span><span class="main">::</span>type set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Tr<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">::</span>type <span class="main">‚áí</span> <span class="tfree">'event</span> set"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Up<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">‚áí</span> <span class="tfree">'event</span> <span class="main">‚áí</span> <span class="tfree">'state<span class="hidden">‚á©</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Up<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state<span class="hidden">‚á©</span><sub>2</sub></span> <span class="main">‚áí</span> <span class="tfree">'event</span> <span class="main">‚áí</span> <span class="tfree">'state<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">‚â°</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="free">Tr<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="free">Up<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">‚üß</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">‚â°</span> fix<span class="main">‚ãÖ</span><span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?P</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">‚â°</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="free">Tr<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">,</span><span class="free">Up<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">‚üß</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">‚â°</span> fix<span class="main">‚ãÖ</span><span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?Q</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">)</span>

  <span class="keyword2"><span class="keyword">defines</span></span> Tr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Tr</span> <span class="main">‚â°</span> <span class="main">(</span><span class="main">Œª</span><span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span><span class="main">.</span> <span class="free">Tr<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">‚à©</span> <span class="free">Tr<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> Up<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Up</span> <span class="main">‚â°</span> <span class="main">(</span><span class="main">Œª</span><span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">Up<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">e</span><span class="main">,</span> <span class="free">Up<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword2"><span class="keyword">defines</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">‚â°</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="free">Tr</span><span class="main">,</span><span class="free">Up</span><span class="main">‚üß</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">‚â°</span> fix<span class="main">‚ãÖ</span><span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?S</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">)</span>
  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="free">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">||</span> <span class="free">Q</span> <span class="free">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span> <span class="main">(</span><span class="free">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="free">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> P_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="var">?P</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?P</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">]</span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">have</span></span> Q_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="var">?Q</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?Q</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">]</span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">have</span></span> S_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="var">?S</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?S</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">]</span> S <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> dir1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">||</span> <span class="free">Q</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">‚äë</span> <span class="free">S</span> <span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> P<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Q<span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>parallel_fix_ind<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">||</span> <span class="bound">y</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">‚äë</span> <span class="free">S</span> <span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> adm<span class="main">:</span>1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> adm_all adm_below<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont2cont_fun<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> base<span class="main">:</span>2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_Int_bot<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="var">?C</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mprefix_Par_distr<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> C<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"UNIV"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> S_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tr Up mprefix_Un_distr<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step mono_mprefix_ref<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>     
  <span class="keyword1"><span class="command">have</span></span> dir2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span>  <span class="free">S</span> <span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">‚äë</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">||</span> <span class="free">Q</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> S<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">x</span><span class="main">.</span> <span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">,</span><span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">‚äë</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">||</span> <span class="free">Q</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> adm<span class="main">:</span>1
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> adm_all adm_below<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_fun<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>3 <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="var">?C</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span>
        <span class="keyword1"><span class="command">have</span></span> P_rec_sym<span class="main">:</span><span class="quoted"><span class="quoted">"Mprefix <span class="main">(</span><span class="free">Tr<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">Up<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P_rec <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">have</span></span> Q_rec_sym<span class="main">:</span><span class="quoted"><span class="quoted">"Mprefix <span class="main">(</span><span class="free">Tr<span class="hidden">‚á©</span><sub>2</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">Up<span class="hidden">‚á©</span><sub>2</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q_rec <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="skolem">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="skolem">s<span class="hidden">‚á©</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tr Up<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> P_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Q_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> mprefix_Par_distr<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> C<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"UNIV"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main">)</span> 
          <span class="keyword1"><span class="command">using</span></span> step <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> dir1 dir2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> below_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‚ÄπConsequences‚Ä∫</span></span>
<span class="comment1">‚Äï‚Äπreachable states from one starting state‚Ä∫</span>
<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">‚Ñú</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">Tr</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state</span><span class="main">::</span>type <span class="main">‚áí</span> <span class="tfree">'event</span><span class="main">::</span>type set"</span></span> 
                <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">Up</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state</span> <span class="main">‚áí</span> <span class="tfree">'event</span> <span class="main">‚áí</span> <span class="tfree">'state</span>"</span></span> 
                <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">s<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'state</span></span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> rbase<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">‚á©</span><sub>0</sub></span> <span class="main">‚àà</span> <span class="free">‚Ñú</span> <span class="free">Tr</span> <span class="free">Up</span> <span class="free">s<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span>
      <span class="main">|</span> rstep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">‚àà</span> <span class="free">‚Ñú</span> <span class="free">Tr</span> <span class="free">Up</span> <span class="free">s<span class="hidden">‚á©</span><sub>0</sub></span> <span class="main">‚üπ</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">‚àà</span> <span class="free">Tr</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>  <span class="main">‚üπ</span> <span class="free">Up</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">‚àà</span> <span class="free">‚Ñú</span> <span class="free">Tr</span> <span class="free">Up</span> <span class="free">s<span class="hidden">‚á©</span><sub>0</sub></span>"</span></span>



<span class="comment1">‚Äï‚ÄπDeadlock freeness‚Ä∫</span>
<span class="keyword1" id="Process_norm-deadlock_free_dnorm_"><span class="command">lemma</span></span> deadlock_free_dnorm_ <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Tr</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state</span><span class="main">::</span>type <span class="main">‚áí</span> <span class="tfree">'event</span><span class="main">::</span>type set"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Up</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'state</span> <span class="main">‚áí</span> <span class="tfree">'event</span> <span class="main">‚áí</span> <span class="tfree">'state</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'state</span></span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> non_reachable_sink<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">s</span> <span class="main">‚àà</span> ‚Ñú <span class="free">Tr</span> <span class="free">Up</span> <span class="free">s<span class="hidden">‚á©</span><sub>0</sub></span><span class="main">.</span> <span class="free">Tr</span> <span class="bound">s</span> <span class="main">‚â†</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">‚â°</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="free">Tr</span><span class="main">,</span><span class="free">Up</span><span class="main">‚üß</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">‚â°</span> fix<span class="main">‚ãÖ</span><span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?P</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">‚àà</span> ‚Ñú <span class="free">Tr</span> <span class="free">Up</span> <span class="free">s<span class="hidden">‚á©</span><sub>0</sub></span> <span class="main">‚üπ</span> deadlock_free_v2 <span class="main">(</span><span class="free">P</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> deadlock_free_v2_FD DF<span class="hidden">‚á©</span><sub>S</sub><span class="hidden">‚á©</span><sub>K</sub><span class="hidden">‚á©</span><sub>I</sub><span class="hidden">‚á©</span><sub>P</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"adm <span class="main">(</span><span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> <span class="main">‚àÄ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">‚àà</span> ‚Ñú <span class="free">Tr</span> <span class="free">Up</span> <span class="free">s<span class="hidden">‚á©</span><sub>0</sub></span> <span class="main">‚ü∂</span> <span class="bound">a</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_FD_adm monofun_def<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">‚àà</span> ‚Ñú <span class="free">Tr</span> <span class="free">Up</span> <span class="free">s<span class="hidden">‚á©</span><sub>0</sub></span> <span class="main">‚üπ</span> <span class="main">‚ä•</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'event</span> process"</span></span>
  <span class="keyword1"><span class="command">have</span></span> P_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="var">?P</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="var">?P</span> <span class="bound">X</span><span class="main">)</span>"</span></span><span class="main">]</span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword3"><span class="command">assume</span></span> 1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">‚àà</span> ‚Ñú <span class="free">Tr</span> <span class="free">Up</span> <span class="free">s<span class="hidden">‚á©</span><sub>0</sub></span> <span class="main">‚üπ</span> <span class="skolem">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span> <span class="bound">s</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span>   2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">‚àà</span> ‚Ñú <span class="free">Tr</span> <span class="free">Up</span> <span class="free">s<span class="hidden">‚á©</span><sub>0</sub></span> "</span></span>
  <span class="keyword1"><span class="command">from</span></span>   1 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Œõ</span> x<span class="main">.</span> <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span>UNIV <span class="main">‚Üí</span>  <span class="bound">x</span><span class="main">)</span> <span class="main">‚äì</span> SKIP<span class="main">)</span><span class="main">‚ãÖ</span><span class="skolem">x</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">P</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>failure_divergence_refine_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> P_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> trans_FD<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> failure_divergence_refine_def<span class="main"><span class="main">,</span></span> 
                       <span class="operator">rotated</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> Mprefix_refines_Mndet<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> CSP.mono_ndet_FD_left<span class="main">)</span>      
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CSP.mono_ndet_FD_right rstep empty_not_UNIV mndet_distrib mono_mndet_FD 
              non_reachable_sink sup_top_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemmas</span></span> deadlock_free_dnorm <span class="main">=</span> deadlock_free_dnorm_<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> rbase<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="CopyBuffer_props">
<div class="head">
<h1>Theory CopyBuffer_props</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">‚Äï‚Äπ ********************************************************************
 * Project         : CSP-RefTK - A Refinement Toolkit for HOL-CSP
 * Version         : 1.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *
 * This file       : The Copy-Buffer Example Revisited
 *
 * Copyright (c) 2020 Universit√© Paris-Saclay, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************‚Ä∫</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‚ÄπExamples‚Ä∫</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‚ÄπCopyBuffer Refinement over an infinite alphabet‚Ä∫</span></span>

<span class="keyword1"><span class="command">theory</span></span>     CopyBuffer_props
 <span class="keyword2"><span class="keyword">imports</span></span>   <span class="quoted">"<a href="../HOL-CSP/CopyBuffer.html">HOL-CSP.CopyBuffer</a>"</span> <span class="quoted">"<a href="Properties.html">Properties</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‚Äπ The Copy-Buffer vs. reference processes ‚Ä∫</span></span>

<span class="keyword1" id="CopyBuffer_props-DF_COPY"><span class="command">lemma</span></span> DF_COPY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DF <span class="main">(</span>range left <span class="main">‚à™</span> range right<span class="main">)</span><span class="main">)</span> <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> COPY"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DF_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> fix_ind2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> failure_divergence_refine_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"adm <span class="main">(</span><span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">‚â§</span> COPY<span class="main">)</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> le_adm<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>monofunI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span> <span class="main">‚ä•</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚Üí</span>  <span class="main">‚ä•</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mndet_subset_FD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I empty_iff imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚Üí</span>  <span class="main">‚ä•</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">‚Üí</span>  <span class="main">‚ä•</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> read_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Mprefix_refines_Mndet comp_apply dual_order.antisym mono_mprefix_FD order_refl<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚äì</span><span class="bound">x</span><span class="main">‚àà</span>range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span>  <span class="main">‚ä•</span><span class="main">)</span> <span class="main">‚â§</span> COPY"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  1 2 COPY_rec bot_less1 mono_read_FD order.trans<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> channel process"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>  *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">‚â§</span> COPY"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ** <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚äì</span><span class="bound">x</span><span class="main">‚àà</span>range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span> <span class="main">‚â§</span> COPY"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range right <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mndet_subset_FD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I Un_commute empty_iff imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range right <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">(</span>right<span class="main">`!`</span><span class="skolem">x</span> <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> mndet_subset_FD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>right <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"range right"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>write_def write0_def mndet_unit<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">(</span>right<span class="main">`!`</span><span class="skolem">x</span> <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">‚Üí</span> <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">‚Üí</span><span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_read_FD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span> <span class="bound">X</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚Üí</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mndet_subset_FD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I empty_iff imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚Üí</span> <span class="bound">X</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">‚Üí</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> read_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Mprefix_refines_Mndet comp_apply dual_order.antisym mono_mprefix_FD order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 3 4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span>"</span></span><span class="main">]</span> 
         5  <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span> 
                    <span class="main">(</span><span class="main">‚äì</span><span class="bound">xa</span><span class="main">‚àà</span> range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">‚Üí</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> * ** <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">‚Üí</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">‚â§</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">‚Üí</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">‚Üí</span>  COPY<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_read_FD mono_write_FD<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚äì</span><span class="bound">x</span><span class="main">‚àà</span>range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span>  <span class="main">‚äì</span><span class="bound">x</span><span class="main">‚àà</span>range left <span class="main">‚à™</span> range right <span class="main">‚Üí</span>  <span class="skolem">P</span><span class="main">)</span> <span class="main">‚â§</span> COPY"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> 6 7  COPY_rec dual_order.trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‚Äπ ... and abstract consequences ‚Ä∫</span></span>

<span class="keyword1"><span class="command">corollary</span></span> df_COPY<span class="main">:</span> <span class="quoted"><span class="quoted">"deadlock_free COPY"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> lf_COPY<span class="main">:</span> <span class="quoted"><span class="quoted">"lifelock_free COPY"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> DF_COPY DF_Univ_freeness UNIV_not_empty image_is_empty sup_eq_bot_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> CHAOS_DF_refine_FD DF_COPY DF_Univ_freeness UNIV_not_empty deadlock_free_def 
            image_is_empty lifelock_free_def sup_eq_bot_iff trans_FD<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> df_v2_COPY<span class="main">:</span> <span class="quoted"><span class="quoted">"deadlock_free_v2 COPY"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> lf_v2_COPY<span class="main">:</span> <span class="quoted"><span class="quoted">"lifelock_free_v2 COPY"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nt_COPY<span class="main">:</span> <span class="quoted"><span class="quoted">"non_terminating COPY"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> df_COPY deadlock_free_is_deadlock_free_v2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lf_COPY lifelock_free_is_lifelock_free_v2<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> lf_COPY lifelock_free_is_non_terminating <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="CopyBuffer_props-DF_SYSTEM"><span class="command">lemma</span></span> DF_SYSTEM<span class="main">:</span> <span class="quoted"><span class="quoted">"DF UNIV <span class="keyword1">‚äë<span class="hidden">‚á©</span><sub>F</sub><span class="hidden">‚á©</span><sub>D</sub></span> SYSTEM"</span></span>
  <span class="keyword1"><span class="command">using</span></span> DF_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>range left <span class="main">‚à™</span> range right<span class="main">)</span>"</span></span> <span class="quoted">UNIV</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  impl_refines_spec<span class="main">[</span><span class="operator">THEN</span> le_approx_implies_le_ref<span class="main">]</span> DF_COPY 
  failure_divergence_refine_def trans_FD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">corollary</span></span> df_SYSTEM<span class="main">:</span> <span class="quoted"><span class="quoted">"deadlock_free SYSTEM"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> lf_SYSTEM<span class="main">:</span> <span class="quoted"><span class="quoted">"lifelock_free SYSTEM"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DF_SYSTEM deadlock_free_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> CHAOS_DF_refine_FD DF_SYSTEM lifelock_free_def trans_FD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">corollary</span></span> df_v2_SYSTEM<span class="main">:</span> <span class="quoted"><span class="quoted">"deadlock_free_v2 SYSTEM"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> lf_v2_SYSTEM<span class="main">:</span> <span class="quoted"><span class="quoted">"lifelock_free_v2 SYSTEM"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nt_SYSTEM<span class="main">:</span> <span class="quoted"><span class="quoted">"non_terminating SYSTEM"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> df_SYSTEM deadlock_free_is_deadlock_free_v2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lf_SYSTEM lifelock_free_is_lifelock_free_v2<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> lf_SYSTEM lifelock_free_is_non_terminating <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DiningPhilosophers">
<div class="head">
<h1>Theory DiningPhilosophers</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">‚Äï‚Äπ ********************************************************************
 * Project         : CSP-RefTK - A Refinement Toolkit for HOL-CSP
 * Version         : 1.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *
 * This file       : Example on Structural Parameterisation: Dining Philosophers
 *
 * Copyright (c) 2020 Universit√© Paris-Saclay, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * TrHIS SOFTrWARE IS PROVIDED BY TrHE COPYRIGHTr HOLDERS AND CONTrRIBUTrORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTrIES, INCLUDING, BUTr NOTr
 * LIMITrED TrO, TrHE IMPLIED WARRANTrIES OF MERCHANTrABILITrY AND FITrNESS FOR
 * A PARTrICULAR PURPOSE ARE DISCLAIMED. IN NO EVENTr SHALL TrHE COPYRIGHTr
 * OWNER OR CONTrRIBUTrORS BE LIABLE FOR ANY DIRECTr, INDIRECTr, INCIDENTrAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTrIAL DAMAGES (INCLUDING, BUTr NOTr
 * LIMITrED TrO, PROCUREMENTr OF SUBSTrITrUTrE GOODS OR SERVICES; LOSS OF USE,
 * DATrA, OR PROFITrS; OR BUSINESS INTrERRUPTrION) HOWEVER CAUSED AND ON ANY
 * TrHEORY OF LIABILITrY, WHETrHER IN CONTrRACTr, STrRICTr LIABILITrY, OR TrORTr
 * (INCLUDING NEGLIGENCE OR OTrHERWISE) ARISING IN ANY WAY OUTr OF TrHE USE
 * OF TrHIS SOFTrWARE, EVEN IF ADVISED OF TrHE POSSIBILITrY OF SUCH DAMAGE.
 ******************************************************************************‚Ä∫</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‚Äπ Generalized Dining Philosophers ‚Ä∫</span></span>

<span class="keyword1"><span class="command">theory</span></span>     DiningPhilosophers
 <span class="keyword2"><span class="keyword">imports</span></span>   <span class="quoted">"<a href="Process_norm.html">Process_norm</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπPreliminary lemmas for proof automation‚Ä∫</span></span>

<span class="keyword1" id="DiningPhilosophers-Suc_mod"><span class="command">lemma</span></span> Suc_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">‚üπ</span> <span class="free">i</span> <span class="main">‚â†</span> Suc <span class="free">i</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def mod_Suc mod_if mod_mod_trivial n_not_Suc_n<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> suc_mods <span class="main">=</span> Suc_mod Suc_mod<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1" id="DiningPhilosophers-l_suc"><span class="command">lemma</span></span> l_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">‚üπ</span> <span class="main">¬¨</span> <span class="free">n</span> <span class="main">‚â§</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="DiningPhilosophers-minus_suc"><span class="command">lemma</span></span> minus_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚üπ</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">‚â†</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="keyword1" id="DiningPhilosophers-numeral_4_eq_4"><span class="command">lemma</span></span> numeral_4_eq_4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="DiningPhilosophers-numeral_5_eq_5"><span class="command">lemma</span></span> numeral_5_eq_5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">5</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‚ÄπThe dining processes definition‚Ä∫</span></span>

<span class="keyword1"><span class="command">locale</span></span> DiningPhilosophers <span class="main">=</span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> N_g1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> dining_event  <span class="main">=</span> picks <span class="main">(</span><span class="free"><span class="entity">phil</span></span><span class="main">:</span><span class="quoted">nat</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">fork</span></span><span class="main">:</span><span class="quoted">nat</span><span class="main">)</span>
                       <span class="main">|</span> putsdown <span class="main">(</span>phil<span class="main">:</span><span class="quoted">nat</span><span class="main">)</span> <span class="main">(</span>fork<span class="main">:</span><span class="quoted">nat</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">RPHIL</span><span class="main">::</span>  <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> dining_event process"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">RPHIL</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Œº</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span>picks <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">‚Üí</span> <span class="main">(</span>picks <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">‚Üí</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LPHIL0</span><span class="main">::</span>  <span class="quoted"><span class="quoted">"dining_event process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">LPHIL0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Œº</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span>picks <span class="main">0</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">‚Üí</span> <span class="main">(</span>picks <span class="main">0</span> <span class="main">0</span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="main">0</span> <span class="main">0</span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="main">0</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">‚Üí</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FORK</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> dining_event process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">FORK</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Œº</span> <span class="bound">X</span><span class="main">.</span>   <span class="main">(</span>picks <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">‚Üí</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">‚ñ°</span> <span class="main">(</span>picks <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">N</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">N</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">‚Üí</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">foldPHILs</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">‚â°</span> fold <span class="main">(</span><span class="main">Œª</span> <span class="bound">i</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">|||</span> RPHIL <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span> <span class="main">(</span>LPHIL0<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">foldFORKs</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">‚â°</span> fold <span class="main">(</span><span class="main">Œª</span> <span class="bound">i</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">|||</span> FORK <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span> <span class="main">(</span>FORK <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">PHILs</span> <span class="main">‚â°</span> foldPHILs <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">FORKs</span> <span class="main">‚â°</span> foldFORKs <span class="free">N</span>"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> FORKs_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"FORKs <span class="main">=</span> fold <span class="main">(</span><span class="main">Œª</span> <span class="bound">i</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">|||</span> FORK <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> <span class="free">N</span><span class="main">]</span> SKIP"</span></span>
  <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> upt_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Inter_commute Inter_skip1<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">‚üπ</span> PHILs <span class="main">=</span> <span class="main">(</span>LPHIL0 <span class="main">|||</span> RPHIL <span class="main">1</span> <span class="main">|||</span> RPHIL <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> upt_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>numeral_2_eq_2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">DINING</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dining_event process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">DINING</span> <span class="main">=</span> <span class="main">(</span>FORKs <span class="main">||</span> PHILs<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπUnfolding rules‚Ä∫</span></span>

<span class="keyword1" id="DiningPhilosophers-RPHIL_rec"><span class="command">lemma</span></span> RPHIL_rec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"RPHIL <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>picks <span class="free">i</span> <span class="free">i</span> <span class="main">‚Üí</span> <span class="main">(</span>picks <span class="free">i</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="free">i</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="free">i</span> <span class="free">i</span>  <span class="main">‚Üí</span> RPHIL <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RPHIL_def write0_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="DiningPhilosophers-LPHIL0_rec"><span class="command">lemma</span></span> LPHIL0_rec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"LPHIL0 <span class="main">=</span> <span class="main">(</span>picks <span class="main">0</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">‚Üí</span> <span class="main">(</span>picks <span class="main">0</span> <span class="main">0</span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="main">0</span> <span class="main">0</span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="main">0</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">‚Üí</span> LPHIL0<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>LPHIL0_def write0_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="DiningPhilosophers-FORK_rec"><span class="command">lemma</span></span> FORK_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"FORK <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>  <span class="main">(</span>picks <span class="free">i</span> <span class="free">i</span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="free">i</span> <span class="free">i</span> <span class="main">‚Üí</span> <span class="main">(</span>FORK <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">‚ñ°</span> <span class="main">(</span>picks <span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">N</span><span class="main">)</span> <span class="free">i</span> <span class="main">‚Üí</span> <span class="main">(</span>putsdown <span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">N</span><span class="main">)</span> <span class="free">i</span> <span class="main">‚Üí</span> <span class="main">(</span>FORK <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>FORK_def write0_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπTranslation into normal form‚Ä∫</span></span>

<span class="keyword1" id="DiningPhilosophers-N_pos"><span class="command">lemma</span></span> N_pos<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> N_g1 neq0_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> N_pos_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> suc_mods<span class="main">[</span><span class="operator">OF</span> N_g1<span class="main">]</span> l_suc<span class="main">[</span><span class="operator">OF</span> N_g1<span class="main">]</span> minus_suc<span class="main">[</span><span class="operator">OF</span> N_pos<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe one-fork process‚Ä∫</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> fork_id <span class="main">=</span> <span class="quoted">nat</span>
<span class="keyword1"><span class="command">type_synonym</span></span> fork_state <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fork_transitions</span><span class="main">::</span> <span class="quoted"><span class="quoted">"fork_id <span class="main">‚áí</span> fork_state <span class="main">‚áí</span> dining_event set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Tr<span class="hidden">‚á©</span><sub>f</sub></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">0</span>        <span class="keyword1">then</span> <span class="main">{</span>picks <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span> <span class="main">‚à™</span> <span class="main">{</span>picks <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">N</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span>
                    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">1</span>   <span class="keyword1">then</span> <span class="main">{</span>putsdown <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span>
                    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="numeral">2</span>   <span class="keyword1">then</span> <span class="main">{</span>putsdown <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">N</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span>
                    <span class="keyword1">else</span>                 <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">declare</span></span> Un_insert_right<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> Un_insert_left<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="DiningPhilosophers-ev_fork_idx"><span class="command">lemma</span></span> ev_fork_idx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">‚àà</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free">i</span> <span class="free">s</span> <span class="main">‚üπ</span> fork <span class="free">e</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fork_state_update</span><span class="main">::</span> <span class="quoted"><span class="quoted">"fork_id <span class="main">‚áí</span> fork_state <span class="main">‚áí</span> dining_event <span class="main">‚áí</span> fork_state"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>f</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Up<span class="hidden">‚á©</span><sub>f</sub></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span>picks <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>                   <span class="keyword1">then</span> <span class="main">1</span>
                      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span>picks <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">N</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>  <span class="keyword1">then</span> <span class="numeral">2</span>
                      <span class="keyword1">else</span>                                      <span class="main">0</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"fork_id <span class="main">‚áí</span> fork_state <span class="main">‚áí</span> dining_event process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">,</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">‚üß</span>"</span></span>

<span class="keyword1" id="DiningPhilosophers-FORK"><span class="command">lemma</span></span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main">:</span>  <span class="quoted"><span class="quoted">"FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span> <span class="bound">s</span><span class="main">.</span> <span class="main">‚ñ°</span> <span class="bound">e</span> <span class="main">‚àà</span> <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free">i</span> <span class="bound">s</span><span class="main">)</span> <span class="main">‚Üí</span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free">i</span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free">i</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">X</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free">i</span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="DiningPhilosophers-FORK_refines_FORK"><span class="command">lemma</span></span> FORK_refines_FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">0</span> <span class="main">‚äë</span> FORK <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k_skip<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> x<span class="main">.</span><span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free">i</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free">i</span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">‚â§</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"adm <span class="main">(</span><span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">0</span> <span class="main">‚äë</span> FORK <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_fun<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>3
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">.</span> <span class="main">(</span>iterate <span class="bound">j</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> FORK <span class="free">i</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> less_2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚à®</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="main">0</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> FORK <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="main">1</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> FORK <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> FORK_rec<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def
                    fork_transitions_def
                    mprefix_Un_distr mono_det_ref mono_mprefix_ref<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>4 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="numeral">2</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="skolem">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> FORK <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> FORK_rec<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def numeral_2_eq_2
                  fork_transitions_def fork_state_update_def
                  mprefix_Un_distr mono_det_ref mono_mprefix_ref<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-FORK"><span class="command">lemma</span></span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_refines_FORK<span class="main">:</span> <span class="quoted"><span class="quoted">"FORK <span class="free">i</span> <span class="main">‚äë</span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> FORK_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k_skip<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">‚â§</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"adm <span class="main">(</span><span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">‚äë</span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>3
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>4 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"iterate <span class="main">1</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="skolem">x</span> <span class="main">‚äë</span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def
                     fork_transitions_def fork_state_update_def
                     mprefix_Un_distr<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fork_transitions_def fork_state_update_def
                  mprefix_Un_distr mono_det_ref mono_mprefix_ref<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-FORK"><span class="command">lemma</span></span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_is_FORK<span class="main">:</span> <span class="quoted"><span class="quoted">"FORK <span class="free">i</span> <span class="main">=</span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FORK_refines_FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_refines_FORK below_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe all-forks process in normal form‚Ä∫</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> forks_state <span class="main">=</span> <span class="quoted"><span class="quoted">"nat list"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">forks_transitions</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> forks_state <span class="main">‚áí</span> dining_event set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Tr<span class="hidden">‚á©</span><sub>F</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Tr<span class="hidden">‚á©</span><sub>F</sub></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="DiningPhilosophers-forks_transitions_take"><span class="command">lemma</span></span> forks_transitions_take<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Tr<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">n</span> <span class="free">fs</span> <span class="main">=</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">n</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>forks_transitions_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">forks_state_update</span><span class="main">::</span> <span class="quoted"><span class="quoted">"forks_state <span class="main">‚áí</span> dining_event <span class="main">‚áí</span> forks_state"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Up<span class="hidden">‚á©</span><sub>F</sub></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">i</span><span class="main">=</span><span class="main">(</span>fork <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="keyword1">in</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">[</span><span class="bound">i</span><span class="main">:=</span><span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="DiningPhilosophers-forks_update_take"><span class="command">lemma</span></span> forks_update_take<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="free">n</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">fs</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="main">(</span>take <span class="free">n</span> <span class="free">fs</span><span class="main">)</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> forks_state_update_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_less_le nat_neq_iff nth_take order_refl take_update_cancel take_update_swap<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> forks_state <span class="main">‚áí</span> dining_event process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">,</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span><span class="main">‚üß</span>"</span></span>

<span class="keyword1" id="DiningPhilosophers-FORKs"><span class="command">lemma</span></span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main">:</span>  <span class="quoted"><span class="quoted">"FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span> <span class="bound">fs</span><span class="main">.</span> <span class="main">‚ñ°</span> <span class="bound">e</span> <span class="main">‚àà</span> <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">n</span> <span class="bound">fs</span><span class="main">)</span> <span class="main">‚Üí</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="bound">fs</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">fs</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">n</span> <span class="bound">fs</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">X</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="bound">fs</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="DiningPhilosophers-FORKs"><span class="command">lemma</span></span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_0<span class="main">:</span> <span class="quoted"><span class="quoted">"FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">0</span> <span class="free">fs</span> <span class="main">=</span> STOP"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>forks_transitions_def Mprefix_STOP<span class="main">)</span>

<span class="keyword1" id="DiningPhilosophers-FORKs"><span class="command">lemma</span></span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1_dir1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">fs</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚üπ</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">1</span> <span class="free">fs</span> <span class="main">‚äë</span> <span class="main">(</span>FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">0</span> <span class="main">(</span><span class="free">fs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">fs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span>
                                         <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> x<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">fs</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>F</sub></span> <span class="main">1</span> <span class="bound">fs</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="bound">fs</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> adm<span class="main">:</span>1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont_fun<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>3 <span class="skolem">X</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="main">0</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="main">0</span> <span class="main">(</span><span class="skolem">fs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>forks_state_update_def forks_transitions_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ev_fork_idx step.prems list_update_nonempty nth_list_update_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-FORKs"><span class="command">lemma</span></span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1_dir2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">fs</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚üπ</span> <span class="main">(</span>FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">0</span> <span class="main">(</span><span class="free">fs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">‚äë</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">1</span> <span class="free">fs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">fs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span>
                                         <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> x<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="main">0</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>f</sub></span> <span class="main">0</span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> adm<span class="main">:</span>1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont_fun<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>3 <span class="skolem">X</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="main">0</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="main">0</span> <span class="main">(</span><span class="skolem">fs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>forks_state_update_def forks_transitions_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ev_fork_idx step.prems list_update_nonempty nth_list_update_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-FORKs"><span class="command">lemma</span></span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">fs</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚üπ</span> <span class="main">(</span>FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">0</span> <span class="main">(</span><span class="free">fs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">1</span> <span class="free">fs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1_dir1 FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1_dir2 below_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="DiningPhilosophers-FORKs"><span class="command">lemma</span></span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_unfold<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">‚üπ</span> length <span class="free">fs</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">‚üπ</span>
                              FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">fs</span> <span class="main">=</span> <span class="main">(</span>FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span>butlast <span class="free">fs</span><span class="main">)</span><span class="main">|||</span><span class="main">(</span>FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span><span class="free">fs</span><span class="main">!</span><span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> below_antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">‚üπ</span> length <span class="free">fs</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">‚üπ</span>
                               FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">fs</span> <span class="main">‚äë</span> <span class="main">(</span>FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span>butlast <span class="free">fs</span><span class="main">)</span><span class="main">|||</span>FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span><span class="free">fs</span><span class="main">!</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">fs</span></span>
               <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span>
                              <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> x<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">fs</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>F</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">fs</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="bound">fs</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> adm<span class="main">:</span>1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont_fun<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>3 <span class="skolem">X</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> indep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">n</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">‚à©</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free">n</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>forks_transitions_def fork_transitions_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>indep dnorm_inter FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>forks_transitions_def Un_commute lessThan_Suc nth_butlast<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">e</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"fork <span class="skolem">e</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="skolem">fs</span> <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 a butlast_list_update forks_state_update_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> ev_fork_idx lessThan_iff less_not_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">e</span> <span class="skolem">m</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">‚àâ</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free">n</span> <span class="main">(</span><span class="skolem">fs</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ev_fork_idx <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="skolem">fs</span> <span class="skolem">e</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">fs</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> ev_fork_idx forks_state_update_def nth_list_update_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="main">(</span>butlast <span class="skolem">fs</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> butlast <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="skolem">fs</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>forks_state_update_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> butlast_conv_take forks_state_update_def forks_update_take length_list_update<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 2 a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="skolem">fs</span> <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main">]</span> c d forks_state_update_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> indep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free">n</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">‚à©</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="free">n</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>forks_transitions_def fork_transitions_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">‚üπ</span> length <span class="free">fs</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">‚üπ</span>
                              <span class="main">(</span>FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span>butlast <span class="free">fs</span><span class="main">)</span><span class="main">|||</span>FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span><span class="free">fs</span><span class="main">!</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">‚äë</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">fs</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>indep dnorm_inter FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> fix_ind<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span>
        P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">‚ü∂</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound">x</span><span class="main">.</span> length <span class="bound">x</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">‚ü∂</span> <span class="bound">a</span> <span class="main">(</span>butlast <span class="bound">x</span><span class="main">,</span> <span class="bound">x</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">‚äë</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main"><span class="main">,</span></span>
        <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> base<span class="main">:</span>1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont_fun<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>2 <span class="skolem">X</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>forks_transitions_def
                                                          Un_commute lessThan_Suc nth_butlast<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">e</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"fork <span class="skolem">e</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="skolem">fs</span> <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 a butlast_list_update forks_state_update_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> a ev_fork_idx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">e</span> <span class="skolem">m</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="main">(</span>butlast <span class="skolem">fs</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> butlast <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="skolem">fs</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>forks_state_update_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> butlast_conv_take forks_state_update_def forks_update_take length_list_update<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="skolem">fs</span> <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main">]</span> a forks_state_update_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-ft"><span class="command">lemma</span></span> ft<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">‚üπ</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span>replicate <span class="free">n</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> foldFORKs <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_unfold FORK<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_is_FORK<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Suc_le_D butlast_snoc replicate_Suc replicate_append_same<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1 One_nat_def leI length_replicate less_Suc0 nth_replicate replicate_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> FORKs_is_FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">N</span> <span class="main">(</span>replicate <span class="free">N</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> FORKs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ft N_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe one-philosopher process in normal form:‚Ä∫</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> phil_id <span class="main">=</span> <span class="quoted">nat</span>
<span class="keyword1"><span class="command">type_synonym</span></span> phil_state <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rphil_transitions</span><span class="main">::</span> <span class="quoted"><span class="quoted">"phil_id <span class="main">‚áí</span> phil_state <span class="main">‚áí</span> dining_event set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span> <span class="keyword1">if</span>      <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">0</span>  <span class="keyword1">then</span> <span class="main">{</span>picks <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span>
                     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">1</span>  <span class="keyword1">then</span> <span class="main">{</span>picks <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>
                     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="numeral">2</span>  <span class="keyword1">then</span> <span class="main">{</span>putsdown <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>
                     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="numeral">3</span>  <span class="keyword1">then</span> <span class="main">{</span>putsdown <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span>
                     <span class="keyword1">else</span>                <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lphil0_transitions</span><span class="main">::</span> <span class="quoted"><span class="quoted">"phil_state <span class="main">‚áí</span> dining_event set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Tr<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Tr<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">0</span>       <span class="keyword1">then</span> <span class="main">{</span>picks <span class="main">0</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>
                     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">1</span>  <span class="keyword1">then</span> <span class="main">{</span>picks <span class="main">0</span> <span class="main">0</span><span class="main">}</span>
                     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="numeral">2</span>  <span class="keyword1">then</span> <span class="main">{</span>putsdown <span class="main">0</span> <span class="main">0</span><span class="main">}</span>
                     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="numeral">3</span>  <span class="keyword1">then</span> <span class="main">{</span>putsdown <span class="main">0</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>
                     <span class="keyword1">else</span>                <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rphil_phil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">‚àà</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">i</span> <span class="free">s</span> <span class="main">‚üπ</span> phil <span class="free">e</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> lphil0_phil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">‚àà</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">s</span> <span class="main">‚üπ</span> phil <span class="free">e</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rphil_transitions_def lphil0_transitions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rphil_state_update</span><span class="main">::</span> <span class="quoted"><span class="quoted">"fork_id <span class="main">‚áí</span> fork_state <span class="main">‚áí</span> dining_event <span class="main">‚áí</span> fork_state"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Up<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span>picks <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>               <span class="keyword1">then</span> <span class="main">1</span>
                       <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span>picks <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>      <span class="keyword1">then</span> <span class="numeral">2</span>
                       <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span>putsdown <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>   <span class="keyword1">then</span> <span class="numeral">3</span>
                       <span class="keyword1">else</span>                                  <span class="main">0</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lphil0_state_update</span><span class="main">::</span> <span class="quoted"><span class="quoted">"fork_state <span class="main">‚áí</span> dining_event <span class="main">‚áí</span> fork_state"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span>picks <span class="main">0</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>         <span class="keyword1">then</span> <span class="main">1</span>
                     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span>picks <span class="main">0</span> <span class="main">0</span><span class="main">)</span>        <span class="keyword1">then</span> <span class="numeral">2</span>
                     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span>putsdown <span class="main">0</span> <span class="main">0</span><span class="main">)</span>     <span class="keyword1">then</span> <span class="numeral">3</span>
                     <span class="keyword1">else</span>                                <span class="main">0</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"fork_id <span class="main">‚áí</span> fork_state <span class="main">‚áí</span> dining_event process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">‚üß</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"fork_state <span class="main">‚áí</span> dining_event process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span> <span class="main">=</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span><span class="main">,</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span><span class="main">‚üß</span>"</span></span>

<span class="keyword1" id="DiningPhilosophers-RPHIL"><span class="command">lemma</span></span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main">:</span>  <span class="quoted"><span class="quoted">"RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span> <span class="bound">s</span><span class="main">.</span> <span class="main">‚ñ°</span> <span class="bound">e</span> <span class="main">‚àà</span> <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">i</span> <span class="bound">s</span><span class="main">)</span> <span class="main">‚Üí</span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">i</span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">i</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">X</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">i</span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="DiningPhilosophers-LPHIL0"><span class="command">lemma</span></span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main">:</span>  <span class="quoted"><span class="quoted">"LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span> <span class="bound">s</span><span class="main">.</span> <span class="main">‚ñ°</span> <span class="bound">e</span> <span class="main">‚àà</span> <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">s</span><span class="main">)</span> <span class="main">‚Üí</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">X</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="DiningPhilosophers-RPHIL_refines_RPHIL"><span class="command">lemma</span></span> RPHIL_refines_RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">0</span> <span class="main">‚äë</span> RPHIL <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k_skip<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral">4</span></span>
                                 <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> x<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">i</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">i</span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">‚â§</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"adm <span class="main">(</span><span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">0</span> <span class="main">‚äë</span> RPHIL <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_fun<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>3
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">.</span> <span class="main">(</span>iterate <span class="bound">j</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> RPHIL <span class="free">i</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> less_2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">(</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚à®</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">1</span>  <span class="main">‚à®</span> <span class="bound">j</span> <span class="main">=</span> <span class="numeral">2</span>  <span class="main">‚à®</span> <span class="bound">j</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="main">0</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> RPHIL <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="main">1</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> RPHIL <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> RPHIL_rec<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def rphil_transitions_def mono_mprefix_ref<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="numeral">2</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> RPHIL <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> RPHIL_rec<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 write0_def rphil_transitions_def
                    rphil_state_update_def mono_mprefix_ref<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="numeral">3</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> RPHIL <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> RPHIL_rec<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_3_eq_3 write0_def rphil_transitions_def
                    rphil_state_update_def mono_mprefix_ref minus_suc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_pos<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>4 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="numeral">4</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="skolem">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> RPHIL <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> RPHIL_rec<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def numeral_4_eq_4 rphil_transitions_def rphil_state_update_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>minus_suc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_pos<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">using</span></span> minus_suc<span class="main">[</span><span class="operator">OF</span> i_pos<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-LPHIL0_refines_LPHIL0"><span class="command">lemma</span></span> LPHIL0_refines_LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">0</span> <span class="main">‚äë</span> LPHIL0"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k_skip<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral">4</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> x<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">‚â§</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"adm <span class="main">(</span><span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">0</span> <span class="main">‚äë</span> LPHIL0<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_fun<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>3
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">.</span> <span class="main">(</span>iterate <span class="bound">j</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> LPHIL0"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> less_2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚ãÄ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">(</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚à®</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">1</span>  <span class="main">‚à®</span> <span class="bound">j</span> <span class="main">=</span> <span class="numeral">2</span>  <span class="main">‚à®</span> <span class="bound">j</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="main">0</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> LPHIL0"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="main">1</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> LPHIL0"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> LPHIL0_rec<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def lphil0_transitions_def mono_mprefix_ref<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="numeral">2</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> LPHIL0"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> LPHIL0_rec<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 write0_def lphil0_transitions_def
                    lphil0_state_update_def mono_mprefix_ref<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="numeral">3</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="main">‚ä•</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> LPHIL0"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> LPHIL0_rec<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_3_eq_3 write0_def lphil0_transitions_def
                    lphil0_state_update_def mono_mprefix_ref<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>4 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterate <span class="numeral">4</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="skolem">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">‚äë</span> LPHIL0"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> LPHIL0_rec<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def numeral_4_eq_4 lphil0_transitions_def
                  lphil0_state_update_def mono_mprefix_ref<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-RPHIL"><span class="command">lemma</span></span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_refines_RPHIL<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"RPHIL <span class="free">i</span> <span class="main">‚äë</span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> RPHIL_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k_skip<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">‚â§</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"adm <span class="main">(</span><span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">‚äë</span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>3
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>4 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def rphil_transitions_def rphil_state_update_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def rphil_transitions_def rphil_state_update_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>minus_suc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_pos<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def rphil_transitions_def rphil_state_update_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>minus_suc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_pos<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def rphil_transitions_def rphil_state_update_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>minus_suc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_pos<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> minus_suc<span class="main">[</span><span class="operator">OF</span> i_pos<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-LPHIL0"><span class="command">lemma</span></span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_refines_LPHIL0<span class="main">:</span> <span class="quoted"><span class="quoted">"LPHIL0 <span class="main">‚äë</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> LPHIL0_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k_skip<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">‚â§</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"adm <span class="main">(</span><span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">‚äë</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>3
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>4 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"iterate <span class="main">1</span><span class="main">‚ãÖ</span><span class="var">?f</span><span class="main">‚ãÖ</span><span class="skolem">x</span> <span class="main">‚äë</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def lphil0_transitions_def lphil0_state_update_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def lphil0_transitions_def lphil0_state_update_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def lphil0_transitions_def lphil0_state_update_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def lphil0_transitions_def lphil0_state_update_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-RPHIL"><span class="command">lemma</span></span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_is_RPHIL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚üπ</span> RPHIL <span class="free">i</span> <span class="main">=</span> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">i</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RPHIL_refines_RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_refines_RPHIL below_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="DiningPhilosophers-LPHIL0"><span class="command">lemma</span></span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_is_LPHIL0<span class="main">:</span> <span class="quoted"><span class="quoted">"LPHIL0 <span class="main">=</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> LPHIL0_refines_LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_refines_LPHIL0 below_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe normal form for the global philosopher network‚Ä∫</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> phils_state <span class="main">=</span> <span class="quoted"><span class="quoted">"nat list"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">phils_transitions</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> phils_state <span class="main">‚áí</span> dining_event set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Tr<span class="hidden">‚á©</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span><span class="main">0</span><span class="main">)</span> <span class="main">‚à™</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">‚àà</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> phils_phil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">‚üπ</span> <span class="free">e</span> <span class="main">‚àà</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free">n</span> <span class="free">s</span> <span class="main">‚üπ</span> phil <span class="free">e</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phils_transitions_def lphil0_phil rphil_phil<span class="main">)</span>

<span class="keyword1" id="DiningPhilosophers-phils_transitions_take"><span class="command">lemma</span></span> phils_transitions_take<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">‚üπ</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free">n</span> <span class="free">ps</span> <span class="main">=</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free">n</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phils_transitions_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">phils_state_update</span><span class="main">::</span> <span class="quoted"><span class="quoted">"phils_state <span class="main">‚áí</span> dining_event <span class="main">‚áí</span> phils_state"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Up<span class="hidden">‚á©</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">i</span><span class="main">=</span><span class="main">(</span>phil <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">[</span><span class="bound">i</span><span class="main">:=</span><span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">]</span>
                                       <span class="keyword1">else</span>          <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">[</span><span class="bound">i</span><span class="main">:=</span><span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="DiningPhilosophers-phils_update_take"><span class="command">lemma</span></span> phils_update_take<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="free">n</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free">ps</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="main">(</span>take <span class="free">n</span> <span class="free">ps</span><span class="main">)</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phils_state_update_def lphil0_state_update_def
                              rphil_state_update_def take_update_swap<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> phils_state <span class="main">‚áí</span> dining_event process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span><span class="main">‚üß</span>"</span></span>

<span class="keyword1" id="DiningPhilosophers-PHILs"><span class="command">lemma</span></span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main">:</span>  <span class="quoted"><span class="quoted">"PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span> <span class="bound">ps</span><span class="main">.</span> <span class="main">‚ñ°</span> <span class="bound">e</span> <span class="main">‚àà</span> <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free">n</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">‚Üí</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="bound">ps</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">ps</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free">n</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">X</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="bound">ps</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="DiningPhilosophers-PHILs"><span class="command">lemma</span></span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1_dir1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ps</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚üπ</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">1</span> <span class="free">ps</span> <span class="main">‚äë</span> <span class="main">(</span>LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span><span class="free">ps</span><span class="main">!</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">ps</span></span>
             <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span>
                            <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> x<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">ps</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="main">1</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="bound">ps</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> adm<span class="main">:</span>1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont_fun<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>3 <span class="skolem">X</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phils_state_update_def phils_transitions_def<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">e</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">[</span><span class="main">0</span> <span class="main">:=</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">e</span><span class="main">]</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lphil0_transitions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-PHILs"><span class="command">lemma</span></span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1_dir2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ps</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚üπ</span> <span class="main">(</span>LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span><span class="free">ps</span><span class="main">!</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">‚äë</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">1</span> <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span>
                                         <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> x<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> adm<span class="main">:</span>1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont_fun<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>3 <span class="skolem">X</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phils_state_update_def phils_transitions_def<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">e</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">[</span><span class="main">0</span> <span class="main">:=</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">e</span><span class="main">]</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lphil0_transitions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-PHILs"><span class="command">lemma</span></span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ps</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">‚üπ</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">1</span> <span class="free">ps</span> <span class="main">=</span> <span class="main">(</span>LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span><span class="free">ps</span><span class="main">!</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1_dir1 PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1_dir2 below_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="DiningPhilosophers-PHILs"><span class="command">lemma</span></span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_unfold<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ps</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">‚üπ</span>
                            PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">ps</span> <span class="main">=</span> <span class="main">(</span>PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span>butlast <span class="free">ps</span><span class="main">)</span><span class="main">|||</span><span class="main">(</span>RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span><span class="free">ps</span><span class="main">!</span><span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> below_antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ps</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">‚üπ</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">ps</span> <span class="main">‚äë</span> <span class="main">(</span>PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span>butlast <span class="free">ps</span><span class="main">)</span><span class="main">|||</span>RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span><span class="free">ps</span><span class="main">!</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">ps</span></span>
               <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>fix_ind_k<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span>
                              <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> x<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">ps</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="bound">ps</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> adm<span class="main">:</span>1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont_fun<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> base_k_steps<span class="main">:</span>2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span><span class="main">(</span>3 <span class="skolem">X</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> indep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free">n</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">‚à©</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">n</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> phils_phil rphil_phil n_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> step <span class="keyword1"><span class="command">have</span></span> tra<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="skolem">ps</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free">n</span> <span class="main">(</span>butlast <span class="skolem">ps</span><span class="main">)</span> <span class="main">‚à™</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">n</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_pos phils_transitions_def nth_butlast Suc_leI
                        atLeastLessThanSuc Un_commute Un_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>indep dnorm_inter PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tra<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">e</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">ps</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span> phils_phil phils_state_update_def step n_pos
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"phil <span class="skolem">e</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> exists_least_iff nth_list_update_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="main">(</span>butlast <span class="skolem">ps</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> butlast <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"phil <span class="skolem">e</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phils_state_update_def butlast_list_update
                                          lphil0_state_update_def rphil_state_update_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> step<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> length_list_update phils_state_update_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main">]</span> c d e <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">e</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> step<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> length_list_update phils_state_update_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> e<span class="main">]</span> n_pos
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> butlast_list_update rphil_phil phils_state_update_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> disjoint_iff_not_equal indep<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> indep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">‚àÄ</span><span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free">n</span> <span class="bound">s<span class="hidden">‚á©</span><sub>1</sub></span> <span class="main">‚à©</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">n</span> <span class="bound">s<span class="hidden">‚á©</span><sub>2</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phils_phil rphil_phil <span class="keyword1"><span class="command">using</span></span> n_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ps</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">‚üπ</span> <span class="main">(</span>PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span>butlast <span class="free">ps</span><span class="main">)</span><span class="main">|||</span>RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span><span class="free">ps</span><span class="main">!</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">‚äë</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>indep dnorm_inter RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> fix_ind<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span>
        P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">Œª</span><span class="bound">a</span><span class="main">.</span> <span class="main">‚àÄ</span><span class="bound">x</span><span class="main">.</span> length <span class="bound">x</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">‚ü∂</span> <span class="bound">a</span> <span class="main">(</span>butlast <span class="bound">x</span><span class="main">,</span> <span class="bound">x</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span> <span class="main">‚äë</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> base step<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> base
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cont_fun<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">X</span> <span class="skolem">ps</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> tra<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="skolem">ps</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free">n</span> <span class="main">(</span>butlast <span class="skolem">ps</span><span class="main">)</span> <span class="main">‚à™</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">n</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_pos phils_transitions_def nth_butlast
                        Suc_leI atLeastLessThanSuc Un_commute Un_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>indep dnorm_inter PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tra<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> mono_mprefix_ref<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">e</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">ps</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span> phils_phil phils_state_update_def step n_pos
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"phil <span class="skolem">e</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> exists_least_iff nth_list_update_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="main">(</span>butlast <span class="skolem">ps</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> butlast <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"phil <span class="skolem">e</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>phils_state_update_def butlast_list_update
                                          lphil0_state_update_def rphil_state_update_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> step<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> length_list_update phils_state_update_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> e<span class="main">]</span> c d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">e</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> length_list_update phils_state_update_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="skolem">ps</span> <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> e<span class="main">]</span> n_pos
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> butlast_list_update rphil_phil phils_state_update_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> disjoint_iff_not_equal indep<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-pt"><span class="command">lemma</span></span> pt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">‚üπ</span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span>replicate <span class="free">n</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> foldPHILs <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_unfold LPHIL0<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_is_LPHIL0<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Suc_le_eq butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> butlast_snoc RPHIL<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_is_RPHIL
                    nat_neq_iff replicate_append_same replicate_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def leI length_replicate less_Suc0 PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_1 nth_Cons_0 replicate_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> PHILs_is_PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">N</span> <span class="main">(</span>replicate <span class="free">N</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> PHILs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pt N_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπThe complete process system under normal form‚Ä∫</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dining_transitions</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> phils_state <span class="main">√ó</span> forks_state <span class="main">‚áí</span> dining_event set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Tr<span class="hidden">‚á©</span><sub>D</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Tr<span class="hidden">‚á©</span><sub>D</sub></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">fs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>P</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">ps</span><span class="main">)</span> <span class="main">‚à©</span> <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>F</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dining_state_update</span><span class="main">::</span>
  <span class="quoted"><span class="quoted">"phils_state <span class="main">√ó</span> forks_state <span class="main">‚áí</span> dining_event <span class="main">‚áí</span> phils_state <span class="main">√ó</span> forks_state"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>D</sub></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Up<span class="hidden">‚á©</span><sub>D</sub></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">fs</span><span class="main">)</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>P</sub></span> <span class="bound">ps</span> <span class="bound">e</span><span class="main">,</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>F</sub></span> <span class="bound">fs</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">DINING<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">‚áí</span> phils_state <span class="main">√ó</span> forks_state <span class="main">‚áí</span> dining_event process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">DINING<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="keyword1">P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>D</sub></span><span class="main">‚üß</span>"</span></span>

<span class="keyword1" id="DiningPhilosophers-ltsDining_rec"><span class="command">lemma</span></span> ltsDining_rec<span class="main">:</span>  <span class="quoted"><span class="quoted">"DINING<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">Œª</span> <span class="bound">s</span><span class="main">.</span> <span class="main">‚ñ°</span> <span class="bound">e</span> <span class="main">‚àà</span> <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">n</span> <span class="bound">s</span><span class="main">)</span> <span class="main">‚Üí</span> DINING<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">n</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>D</sub></span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fix_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Œõ</span> X<span class="main">.</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">s</span><span class="main">.</span> Mprefix <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">n</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">Œª</span><span class="bound">e</span><span class="main">.</span> <span class="bound">X</span> <span class="main">(</span><span class="keyword1">Up<span class="hidden">‚á©</span><sub>D</sub></span> <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> DINING<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="DiningPhilosophers-DINING_is_DINING"><span class="command">lemma</span></span> DINING_is_DINING<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"DINING <span class="main">=</span> DINING<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">N</span> <span class="main">(</span>replicate <span class="free">N</span> <span class="main">0</span><span class="main">,</span> replicate <span class="free">N</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DINING<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">N</span> <span class="main">(</span>replicate <span class="free">N</span> <span class="main">0</span><span class="main">,</span> replicate <span class="free">N</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
                                        <span class="main">(</span>PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">N</span> <span class="main">(</span>replicate <span class="free">N</span> <span class="main">0</span><span class="main">)</span> <span class="main">||</span> FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> <span class="free">N</span> <span class="main">(</span>replicate <span class="free">N</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DINING<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def dining_transitions_def
              dining_state_update_def dnorm_par <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> PHILs_is_PHILs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> FORKs_is_FORKs<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> DINING_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> par_comm<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‚ÄπAnd finally: Philosophers may dine ! Always !‚Ä∫</span></span>

<span class="keyword1"><span class="command">corollary</span></span> lphil_states<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">r</span> <span class="free">e</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚à®</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">r</span> <span class="free">e</span> <span class="main">=</span> <span class="main">1</span> <span class="main">‚à®</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">r</span> <span class="free">e</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">‚à®</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>l</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">r</span> <span class="free">e</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> rphil_states<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">Up<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">i</span> <span class="free">r</span> <span class="free">e</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚à®</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">i</span> <span class="free">r</span> <span class="free">e</span> <span class="main">=</span> <span class="main">1</span> <span class="main">‚à®</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">i</span> <span class="free">r</span> <span class="free">e</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">‚à®</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="free">i</span> <span class="free">r</span> <span class="free">e</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lphil0_state_update_def rphil_state_update_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="DiningPhilosophers-dining_events"><span class="command">lemma</span></span> dining_events<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">‚àà</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">N</span> <span class="free">s</span> <span class="main">‚üπ</span>
        <span class="main">(</span><span class="main">‚àÉ</span><span class="bound">i</span><span class="main">‚àà</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="free">e</span> <span class="main">=</span> picks <span class="bound">i</span> <span class="bound">i</span> <span class="main">‚à®</span> <span class="free">e</span> <span class="main">=</span> picks <span class="bound">i</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>  <span class="main">‚à®</span> <span class="free">e</span> <span class="main">=</span> putsdown <span class="bound">i</span> <span class="bound">i</span> <span class="main">‚à®</span> <span class="free">e</span> <span class="main">=</span> putsdown <span class="bound">i</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>
     <span class="main">‚à®</span> <span class="main">(</span><span class="free">e</span> <span class="main">=</span> picks <span class="main">0</span> <span class="main">0</span> <span class="main">‚à®</span> <span class="free">e</span> <span class="main">=</span> picks <span class="main">0</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">‚à®</span> <span class="free">e</span> <span class="main">=</span> putsdown <span class="main">0</span> <span class="main">0</span> <span class="main">‚à®</span> <span class="free">e</span> <span class="main">=</span> putsdown <span class="main">0</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dining_transitions_def phils_transitions_def rphil_transitions_def
                    lphil0_transitions_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.splits if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">inv_dining</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">‚â°</span>
            <span class="main">(</span><span class="main">‚àÄ</span><span class="bound">i</span><span class="main">.</span> Suc <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">N</span> <span class="main">‚ü∂</span>  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">!</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">‚ü∑</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span>Suc <span class="bound">i</span> <span class="main">‚â†</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">‚àß</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">!</span><span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">‚ü∑</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span><span class="main">0</span> <span class="main">‚â†</span> <span class="main">0</span><span class="main">)</span>
          <span class="main">‚àß</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span>                 <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">‚ü∑</span>  <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span>Suc <span class="bound">i</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span>  <span class="main">‚àß</span>   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="main">1</span> <span class="main">‚ü∑</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span>
          <span class="main">‚àß</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">N</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚à®</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">‚à®</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span>
          <span class="main">‚àß</span> <span class="main">(</span><span class="main">‚àÄ</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">N</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚à®</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">‚à®</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">‚à®</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">)</span>
          <span class="main">‚àß</span> length <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">=</span> <span class="free">N</span> <span class="main">‚àß</span> length <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> <span class="free">N</span>"</span></span>

<span class="keyword1" id="DiningPhilosophers-inv_DINING"><span class="command">lemma</span></span> inv_DINING<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">‚àà</span> ‚Ñú <span class="main">(</span><span class="keyword1">Tr<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">N</span><span class="main">)</span> <span class="keyword1">Up<span class="hidden">‚á©</span><sub>D</sub></span> <span class="main">(</span>replicate <span class="free">N</span> <span class="main">0</span><span class="main">,</span> replicate <span class="free">N</span> <span class="main">0</span><span class="main">)</span> <span class="main">‚üπ</span> inv_dining <span class="main">(</span>fst <span class="free">s</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>‚Ñú.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> rbase
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inv_dining_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dining_transitions_def phils_transitions_def forks_transitions_def
                 lphil0_transitions_def rphil_transitions_def fork_transitions_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rstep <span class="skolem">s</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rstep<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dining_transitions_def phils_transitions_def forks_transitions_def
                       lphil0_transitions_def rphil_transitions_def fork_transitions_def
                       lphil0_state_update_def rphil_state_update_def fork_state_update_def
                       dining_state_update_def phils_state_update_def forks_state_update_def
                   <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits prod.split<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> inv_dining_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ps</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_list_update<span class="main">)</span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">ps</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_list_update<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">ps</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">ps</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_list_update<span class="main">)</span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">ps</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">ps</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_list_update<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">ps</span> <span class="skolem">fs</span> <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_list_update<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span>  <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> <span class="main">(</span><span class="operator">metis</span> N_pos Suc_pred less_antisym<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> zero_neq_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">ps</span> <span class="skolem">fs</span> <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_list_update<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI conjI allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_neq_one<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">ps</span> <span class="skolem">fs</span> <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_list_update<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI conjI allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> N_pos Suc_pred less_antisym<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> n_not_Suc_n numeral_2_eq_2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">ps</span> <span class="skolem">fs</span> <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_list_update<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI conjI allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> One_nat_def n_not_Suc_n numeral_2_eq_2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiningPhilosophers-inv_implies_DF"><span class="command">lemma</span></span> inv_implies_DF<span class="main">:</span><span class="quoted"><span class="quoted">"inv_dining <span class="free">ps</span> <span class="free">fs</span> <span class="main">‚üπ</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>D</sub></span> <span class="free">N</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">fs</span><span class="main">)</span> <span class="main">‚â†</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inv_dining_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dining_transitions_def phils_transitions_def forks_transitions_def
                 lphil0_transitions_def
             <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits prod.splits<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"putsdown <span class="main">0</span> <span class="main">(</span><span class="free">N</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"putsdown <span class="main">0</span> <span class="main">0</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def<span class="main">)</span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">fs</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚üπ</span> picks <span class="main">0</span> <span class="main">0</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">‚üπ</span> putsdown <span class="main">1</span> <span class="main">0</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">x</span><span class="main">‚àà</span><span class="main">{</span>Suc <span class="main">0</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">x</span> <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rphil_transitions_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">fs</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">‚üπ</span> putsdown <span class="main">1</span> <span class="main">0</span> <span class="main">‚àà</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="main">0</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def<span class="main">)</span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">fs</span><span class="main">!</span><span class="main">0</span> <span class="main">‚â†</span> <span class="main">0</span> <span class="main">‚üπ</span> <span class="free">ps</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> N_pos N_pos_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> One_nat_def diff_is_0_eq neq0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">fs</span><span class="main">!</span><span class="main">0</span> <span class="main">‚â†</span> <span class="main">0</span> <span class="main">‚üπ</span> <span class="free">fs</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> N_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">fs</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fork_transitions_def Un_insert_left<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> b1<span class="main">[</span><span class="operator">OF</span> c<span class="main">]</span> b2<span class="main">[</span><span class="operator">OF</span> d<span class="main">]</span> N_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 4
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 4<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">OF</span> N_pos<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 41<span class="main">:</span>1 <span class="comment1">(* fs!0 = 0 *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 4<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span> <span class="operator">OF</span> N_g1<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 411<span class="main">:</span>1 <span class="comment1">(* fs!1 = 0 *)</span>
      <span class="keyword1"><span class="command">from</span></span> 411 <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> N_g1 One_nat_def neq0_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 411 <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"picks <span class="main">1</span> <span class="main">1</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> N_g1 Int_Collect One_nat_def lessThan_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 411 <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">‚üπ</span> picks <span class="main">1</span> <span class="main">1</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">‚àà</span><span class="main">{</span>Suc <span class="main">0</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rphil_transitions_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">from</span></span> 411 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a0 a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 412<span class="main">:</span>2 <span class="comment1">(* fs!1 = 1 *)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="main">1</span> <span class="main">‚à®</span> <span class="free">ps</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> N_g1 One_nat_def less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> zero_less_diff<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 412 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 4121<span class="main">:</span>1 <span class="comment1">(* ps!1 = 1 *)</span>
        <span class="keyword1"><span class="command">from</span></span> 4121 <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"picks <span class="main">1</span> <span class="main">0</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Int_Collect N_g1 N_pos One_nat_def lessThan_iff mod_less<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 4121 <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"picks <span class="main">1</span> <span class="main">0</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">‚àà</span><span class="main">{</span>Suc <span class="main">0</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rphil_transitions_def<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">from</span></span> 4121 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> b1 b2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 4122<span class="main">:</span>2 <span class="comment1">(* ps!1 = 3 *)</span>
        <span class="keyword1"><span class="command">from</span></span> 4122 <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"putsdown <span class="main">1</span> <span class="main">1</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">from</span></span> 4122 <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"putsdown <span class="main">1</span> <span class="main">1</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">‚àà</span><span class="main">{</span>Suc <span class="main">0</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rphil_transitions_def<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> b3 b4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 413<span class="main">:</span>3 <span class="comment1">(* fs!1 = 2 *)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> 413 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> False 413 <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">!</span><span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> N_g1 Suc_1 Suc_diff_1 nat_neq_iff not_gr0 zero_less_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> False 413 <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"putsdown <span class="numeral">2</span> <span class="main">1</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> False 413 <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">!</span><span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">‚üπ</span> putsdown <span class="numeral">2</span> <span class="main">1</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">‚àà</span><span class="main">{</span>Suc <span class="main">0</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rphil_transitions_def<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">from</span></span> 413 False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> c0 c1 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 42<span class="main">:</span>2 <span class="comment1">(* fs!0 = 1 *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 43<span class="main">:</span>3 <span class="comment1">(* fs!0 = 2*)</span>
    <span class="keyword1"><span class="command">from</span></span> 43 <span class="keyword1"><span class="command">have</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def gr0I<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 43 <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"putsdown <span class="main">1</span> <span class="main">0</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>f</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fork_transitions_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 43 <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">‚üπ</span> putsdown <span class="main">1</span> <span class="main">0</span> <span class="main">‚àà</span> <span class="main">(</span><span class="main">‚ãÉ</span><span class="bound">i</span><span class="main">‚àà</span><span class="main">{</span>Suc <span class="main">0</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">Tr<span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>p</sub></span> <span class="bound">i</span> <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rphil_transitions_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> N_g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">from</span></span> 43 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> d0 d1 d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 5
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> DF_DINING<span class="main">:</span> <span class="quoted"><span class="quoted">"deadlock_free_v2 DINING"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DINING_is_DINING<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub> DINING<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>_def
  <span class="keyword1"><span class="command">using</span></span> inv_DINING inv_implies_DF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> deadlock_free_dnorm<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
























</pre>
</div><div id="Conclusion">
<div class="head">
<h1>Theory Conclusion</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">‚Äï‚Äπ ******************************************************************** 
 * Project         : CSP-RefTK - A Refinement Toolkit for HOL-CSP
 * Version         : 1.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *
 * This file       : Conclusion
 *
 * Copyright (c) 2020 Universit√© Paris-Saclay, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************‚Ä∫</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‚ÄπConclusion‚Ä∫</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Conclusion
    <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOLCF/HOLCF.html">HOLCF</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‚Äπ We presented a formalisation of the most comprehensive semantic model for CSP, a 'classical' 
language for the specification and analysis of concurrent systems studied in a rich body of 
literature. For this purpose, we ported <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "tej.ea:corrected:1997"<span class="antiquote"><span class="antiquote">}</span></span></span></span> to a modern version
of Isabelle, restructured the proofs, and extended the resulting theory of the language 
substantially. The result HOL-CSP 2 has been submitted to the Isabelle AFP <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "HOL-CSP-AFP"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
thus a fairly sustainable format accessible to other researchers and tools.

We developed a novel set of deadlock - and livelock inference proof principles based on 
classical and denotational characterizations. In particular, we formally investigated the relations
between different refinement notions in the presence of deadlock - and livelock; an area where
traditional CSP literature skates over the nitty-gritty details. Finally, we demonstrated how to
exploit these results for deadlock/livelock analysis of protocols.

We put a large body of abstract CSP laws and induction principles together to form
concrete verification technologies for generalized classical problems, which have been considered
so far from the perspective of data-independence or structural parametricity. The underlying novel
principle of ``trading rich structure against rich state'' allows one to convert processes 
into classical transition systems for which established invariant techniques become applicable.

Future applications of HOL-CSP 2 could comprise a combination with model checkers, where our theory
with its derived rules can be used to certify the output of a model-checker over CSP. In our experience,
labelled transition systems generated by model checkers may be used to steer inductions or to construct
the normalized processes <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‚Äπ</span></span>P<span class="hidden">‚á©</span><sub>n</sub><span class="hidden">‚á©</span><sub>o</sub><span class="hidden">‚á©</span><sub>r</sub><span class="hidden">‚á©</span><sub>m</sub>‚ü¶œÑ<span class="hidden">‚á©</span><sub>,</sub>œÖ‚üß‚Ä∫</span></span></span></span> automatically, thus combining efficient finite reasoning 
over finite sub-systems with globally infinite systems in a logically safe way. 
‚Ä∫</span></span>


<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>

</pre>
</div>